<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Great hopes make great man</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yhaowa.gitee.io/"/>
  <updated>2019-09-25T11:05:44.000Z</updated>
  <id>http://yhaowa.gitee.io/</id>
  
  <author>
    <name>ahab</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android 9.0 Activity å¯åŠ¨æµç¨‹åˆ†æ</title>
    <link href="http://yhaowa.gitee.io/a608ff50/"/>
    <id>http://yhaowa.gitee.io/a608ff50/</id>
    <published>2019-09-15T11:42:33.000Z</published>
    <updated>2019-09-25T11:05:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»ä¸€ä¸ªé—®é¢˜å‡ºå‘ï¼šè°ƒç”¨ startActivity åç³»ç»Ÿåˆ°åº•åšäº†ä»€ä¹ˆäº‹ï¼Ÿ</p><p>å¦‚æœè®©æˆ‘å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç­”æ¡ˆä¼šæ˜¯è¿™æ ·ï¼šAndroid ç³»ç»Ÿå¯åŠ¨åä¼šå…ˆå¯åŠ¨ä¸€ä¸ª init è¿›ç¨‹ï¼Œinit è¿›ç¨‹å¯åŠ¨ Zygote è¿›ç¨‹ï¼ŒZygote è¿›ç¨‹è¿›è€Œä¼šå¯åŠ¨ system server è¿›ç¨‹ï¼Œåœ¨è¿™ä¸ª system server è¿›ç¨‹ä¸­ï¼Œä¼šå¯åŠ¨ AMSã€WMS ç­‰ç³»ç»ŸæœåŠ¡ã€‚æˆ‘ä»¬çš„ app ä¸­è°ƒç”¨ startActivity åï¼Œéœ€è¦é€šè¿‡ AMS æ‰§è¡Œå¯åŠ¨ Activityï¼Œè€Œæˆ‘ä»¬çš„ app è¿›ç¨‹ä¸ system server æ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œæ‰€ä»¥è¦è·¨è¿›ç¨‹ï¼Œè·¨è¿›ç¨‹æ˜¯é€šè¿‡ Binder æ¥å®ç°çš„ã€‚ </p><p>ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿæ»¡è„¸é—®å·è„¸ï¼‰ï¼Œæˆ‘è¿™æ˜¯å›ç­”äº†å•¥ï¼Ÿ</p><a id="more"></a><p>é—®é¢˜æ˜¯è°ƒç”¨ startActivity åç³»ç»Ÿåˆ°åº•åšäº†ä»€ä¹ˆäº‹ï¼Ÿè€Œæˆ‘å´åªæ˜¯è®²äº†ä¸‹éœ€è¦è·¨è¿›ç¨‹è°ƒç”¨ AMSï¼Œå¯ä»¥è¯´å‡ ä¹æ˜¯æ²¡æœ‰å›ç­”ã€‚ä¸ºä»€ä¹ˆæˆ‘è®²äº†ä¸€é€šå´æ ¹æœ¬æ²¡æœ‰å›ç­”åˆ°ç‚¹ä¸Šå‘¢ï¼Ÿå› ä¸ºæˆ‘ä¸ä¼šâ€¦ æˆ‘æ ¹æœ¬ä¸çŸ¥é“å…·ä½“è¦è°ƒç”¨åˆ°å“ªå‡ ä¸ªç±»ï¼Œæœ‰å“ªå‡ ä¸ªå…³é”®æ–¹æ³•ï¼Œåšäº†å“ªäº›å…³é”®çš„äº‹ï¼Œä¸ºäº†çªç ´è¿™ä¸ªéšœç¢ï¼Œä»Šå¤©å°±æ¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹åˆ°åº• startActivity åšäº†å“ªäº›äº‹ï¼Œæ¶‰åŠæºç åŸºäº <a href="http://androidxref.com/9.0.0_r3/" target="_blank" rel="noopener">Android 9.0 ç‰ˆæœ¬</a></p><p>åœ¨å¼€å§‹åˆ†æä¹‹å‰ï¼Œå¿ƒå­˜è¿™å‡ ä¸ªç–‘é—®ï¼š</p><ul><li>ä»£ç ä¸­å…·ä½“æ˜¯åœ¨å“ªé‡Œè°ƒç”¨ AMS è·¨è¿›ç¨‹é€šä¿¡çš„ï¼Ÿ</li><li>è·¨è¿›ç¨‹è°ƒç”¨ AMS æ˜¯é€šè¿‡ AIDL æ¥å£æ–¹å¼å®ç°çš„å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œå…·ä½“æ˜¯å“ªä¸ªæ¥å£ï¼Ÿ</li><li>Intent æ•°æ®å…·ä½“æ˜¯æ€æ ·è·¨è¿›ç¨‹ä¼ è¾“çš„å‘¢ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆéœ€è¦ AMS å»æ‰§è¡Œ Activity çš„å¯åŠ¨ï¼ŒAMS åˆ°åº•åšäº†å“ªäº›äº‹ï¼Ÿ</li><li>AMS æ‰§è¡Œå®Œåå†å›åˆ° app è¿›ç¨‹ä¹Ÿæ˜¯è·¨è¿›ç¨‹ï¼Œè¿™éƒ¨åˆ†æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ </li><li>ä¸Šä¸€ä¸ª Activity onPause æ–¹æ³•æ‰§è¡Œå®Œæ–°çš„ Activity æ‰èƒ½è¢«åˆ›å»ºï¼Œè¿™ä¸ªé€»è¾‘æ˜¯åœ¨å“ªé‡Œæ§åˆ¶çš„ï¼Ÿ</li></ul><p>å¥½äº†å¼€è½¦å§ï¼ğŸ™‚ï¸</p><p>startActivity é¦–å…ˆä¼šè°ƒç”¨åˆ° Activity#startActivityForResult æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityForResult</span><span class="params">(@RequiresPermission Intent intent, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">          @Nullable Bundle options)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (mParent == <span class="keyword">null</span>) &#123;<span class="comment">//ã€aã€‘</span></span><br><span class="line">          options = transferSpringboardActivityOptions(options);</span><br><span class="line">          Instrumentation.ActivityResult ar =</span><br><span class="line">              mInstrumentation.execStartActivity(</span><br><span class="line">                  <span class="keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="keyword">this</span>,</span><br><span class="line">                  intent, requestCode, options);<span class="comment">//ã€bã€‘</span></span><br><span class="line">          <span class="comment">//çœç•¥...</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">              mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode, options);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>ã€aã€‘. mParent æ˜¯ä¸€ä¸ª Activityï¼Œçˆ¶ Activity æ˜¯ä»€ä¹ˆåœºæ™¯ä¸‹çš„å‘¢ï¼Œèµ·åˆæ€€ç–‘ä¸ manifest ä¸­ parentActivityName é…ç½®æœ‰å…³ï¼Œä½†å¹¶æ²¡æœ‰ã€‚<br>ã€bã€‘. è¿›ä¸€æ­¥è°ƒç”¨ Instrumentation çš„ execStartActivity æ–¹æ³•ï¼ŒInstrumentation ç”¨äºå…·ä½“æ“ä½œæŸä¸ª Activity çš„åŠŸèƒ½ï¼ˆå•å‘è°ƒç”¨ AMSï¼‰ä»¥åŠç»Ÿè®¡ã€æµ‹é‡è¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å¼€é”€ï¼Œè¿™ä¸å®ƒçš„ä¸­æ–‡å«ä¹‰â€ä»ªè¡¨ç›˜â€å¯ä»¥è¯´æ˜¯ç›¸å½“å»åˆã€‚ä¸€ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ª Instrumentation å¯¹è±¡ï¼Œæ¯ä¸ª Activity éƒ½æŒæœ‰ Instrumentation ã€‚</p><p>Instrumentation çš„ execStartActivity æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActivityResult <span class="title">execStartActivity</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Context who, IBinder contextThread, IBinder token, String target,</span></span></span><br><span class="line"><span class="function"><span class="params">    Intent intent, <span class="keyword">int</span> requestCode, Bundle options)</span> </span>&#123;</span><br><span class="line">    IApplicationThread whoThread = (IApplicationThread) contextThread;</span><br><span class="line">    <span class="keyword">if</span> (mActivityMonitors != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="comment">//çœç•¥...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        intent.migrateExtraStreamToClipData();</span><br><span class="line">        intent.prepareToLeaveProcess(who);</span><br><span class="line">        <span class="keyword">int</span> result = ActivityManager.getService()</span><br><span class="line">            .startActivity(whoThread, who.getBasePackageName(), intent,</span><br><span class="line">                    intent.resolveTypeIfNeeded(who.getContentResolver()),</span><br><span class="line">                    token, target, requestCode, <span class="number">0</span>, <span class="keyword">null</span>, options); <span class="comment">//ã€aã€‘</span></span><br><span class="line">        checkStartActivityResult(result, intent);<span class="comment">//ã€bã€‘</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failure from system"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ã€bã€‘. å¤„ç†å¯åŠ¨ Activity çš„ç»“æœï¼Œå¦‚æœç»“æœå€¼å¼‚å¸¸çš„è¯è¿›ä¸€æ­¥æŠ›å‡ºå¼‚å¸¸<br>ã€aã€‘. é€šè¿‡ ActivityManager è·å–åˆ° AMS å¹¶è°ƒç”¨ startActivity æ–¹æ³•ï¼Œè¿™ä¹Ÿè¯´æ˜ä¸Šé¢å¯¹ Instrumentation çš„æè¿°æ˜¯æ­£ç¡®çš„ï¼Œç¡®å®æ˜¯é€šè¿‡å®ƒæ¥è°ƒç”¨ AMS çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¹Ÿèƒ½è‡ªä¿¡çš„å›ç­” â€œstartActivity æ–¹æ³•æ˜¯åœ¨å“ªé‡Œè·¨è¿›ç¨‹è°ƒç”¨ AMS çš„â€ é—®é¢˜äº†ã€‚</p><p>ç»§ç»­æ¥çœ‹ ActivityManager çš„ getService æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IActivityManager <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IActivityManagerSingleton.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityManager&gt; IActivityManagerSingleton =</span><br><span class="line">        <span class="keyword">new</span> Singleton&lt;IActivityManager&gt;() &#123;<span class="comment">//ã€aã€‘</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> IActivityManager <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);<span class="comment">//ã€bã€‘</span></span><br><span class="line">                <span class="keyword">final</span> IActivityManager am = IActivityManager.Stub.asInterface(b);<span class="comment">//ã€cã€‘</span></span><br><span class="line">                <span class="keyword">return</span> am;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure></p><p>ã€aã€‘. è¿™é‡Œé€šè¿‡ Singleton+æ³›å‹ æ–¹å¼å®ç°äº†å•ä¾‹ï¼Œæœ‰ lazy å’Œæ˜“è¯»çš„ä¼˜ç‚¹ï¼Œå¹³æ—¶å†™å•ä¾‹ä¸€èˆ¬æ˜¯é€šè¿‡é™æ€å†…éƒ¨ç±»æˆ–æšä¸¾å®ç°çš„ï¼Œé€‚å½“çš„åœºæ™¯ä¹Ÿå¯ä»¥è€ƒè™‘ç”¨è¿™ç§æ–¹å¼å†™ï¼Œä¸è¿‡ Singleton æ˜¯ @hide çš„ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¤–éƒ¨å®šä¹‰<br>ã€bã€‘. åœ¨å­¦ä¹  Binder æœºåˆ¶çš„æ—¶å€™æœ‰å››ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼ŒClientã€Serverã€ServiceManagerã€Binder é©±åŠ¨ï¼ŒServiceManager ä¸»è¦ä½œç”¨å°±æ˜¯å¸®åŠ©ç³»ç»Ÿç»´æŠ¤ä¼—å¤šçš„ Service åˆ—è¡¨ï¼ŒServiceManager æœ¬èº«ä¹Ÿæ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œæ‰€ä»¥ä» ServiceManager ä¸­è·å– Service ä¹Ÿæ˜¯ä¸€ä¸ªè·¨è¿›ç¨‹æ“ä½œï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå†…éƒ¨ä»¥ HashMap&lt;String, IBinder&gt; å½¢å¼ç¼“å­˜äº†å„ä¸ª Serviceã€‚<br>ã€cã€‘. è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯æ ‡å‡†çš„ AIDL çš„è°ƒç”¨æ ¼å¼ï¼ŒIActivityManager å°±æ˜¯è·¨è¿›ç¨‹è°ƒç”¨ AMS çš„ AIDL æ¥å£ï¼Œæºç ä½äº frameworks/base/core/java/android/app/IActivityManager.aidlï¼Œè¿™æ—¶æˆ‘ä»¬å°±èƒ½å›ç­”å¼€å¤´çš„ â€œè·¨è¿›ç¨‹è°ƒç”¨ AMS æ˜¯é€šè¿‡ AIDL æ¥å£æ–¹å¼å®ç°çš„å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œå…·ä½“æ˜¯å“ªä¸ªæ¥å£â€ é—®é¢˜äº†ã€‚</p><p>å°±è¿™æ ·è°ƒç”¨é€»è¾‘åœ¨ Instrumentation ä¸­ç”± AMS æ¥ç®¡ï¼ŒAMS ç»§æ‰¿ IActivityManager.Stub å®ç°äº† IPC æ–¹æ³•ï¼Œä¾› Instrumentationã€Context è°ƒç”¨ï¼ŒAMS ä»£ç é‡å¾ˆåºå¤§ï¼ˆ27000+è¡Œï¼‰ï¼Œæºç ä½äº frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java</p><p>æ¥ç€æ¥çœ‹ AMS çš„ startActivityAsUser æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions, <span class="keyword">int</span> userId,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">boolean</span> validateIncomingUser)</span> </span>&#123;</span><br><span class="line">    enforceNotIsolatedCaller(<span class="string">"startActivity"</span>);</span><br><span class="line"></span><br><span class="line">    userId = mActivityStartController.checkTargetUser(userId, validateIncomingUser,</span><br><span class="line">            Binder.getCallingPid(), Binder.getCallingUid(), <span class="string">"startActivityAsUser"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Switch to user app stacks here.</span></span><br><span class="line">    <span class="keyword">return</span> mActivityStartController.obtainStarter(intent, <span class="string">"startActivityAsUser"</span>)</span><br><span class="line">            .setCaller(caller)</span><br><span class="line">            .setCallingPackage(callingPackage)</span><br><span class="line">            .setResolvedType(resolvedType)</span><br><span class="line">            .setResultTo(resultTo)</span><br><span class="line">            .setResultWho(resultWho)</span><br><span class="line">            .setRequestCode(requestCode)</span><br><span class="line">            .setStartFlags(startFlags)</span><br><span class="line">            .setProfilerInfo(profilerInfo)</span><br><span class="line">            .setActivityOptions(bOptions)</span><br><span class="line">            .setMayWait(userId)</span><br><span class="line">            .execute();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå°±å·²ç»å¤„äº system server è¿›ç¨‹äº†ï¼Œå¯¹äºå¼€å¤´çš„é—®é¢˜ â€œIntent æ•°æ®å…·ä½“æ˜¯æ€æ ·è·¨è¿›ç¨‹ä¼ è¾“çš„â€ï¼Œä¹Ÿæœ‰äº†ç­”æ¡ˆï¼Œæ˜¯é€šè¿‡è°ƒç”¨ AIDL æ¥å£æ–¹æ³•ä½œä¸ºå‚æ•°ç›´æ¥ä¼ é€’çš„ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ° Activity çš„å¯åŠ¨é€»è¾‘ç”¨ ActivityStarter åšäº†ä¸€å±‚å°è£…ï¼Œå†™æ³•ä¸Šæ›´åŠ æ¸…æ™°ï¼ŒActivityStarter çš„ execute æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mRequest.mayWait) &#123;</span><br><span class="line">            <span class="keyword">return</span> startActivityMayWait(mRequest.caller, mRequest.callingUid,</span><br><span class="line">                    mRequest.callingPackage, mRequest.intent, mRequest.resolvedType,</span><br><span class="line">                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line">                    mRequest.resultWho, mRequest.requestCode, mRequest.startFlags,</span><br><span class="line">                    mRequest.profilerInfo, mRequest.waitResult, mRequest.globalConfig,</span><br><span class="line">                    mRequest.activityOptions, mRequest.ignoreTargetSecurity, mRequest.userId,</span><br><span class="line">                    mRequest.inTask, mRequest.reason,</span><br><span class="line">                    mRequest.allowPendingRemoteAnimationRegistryLookup);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> startActivity(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,</span><br><span class="line">                    mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,</span><br><span class="line">                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line">                    mRequest.resultWho, mRequest.requestCode, mRequest.callingPid,</span><br><span class="line">                    mRequest.callingUid, mRequest.callingPackage, mRequest.realCallingPid,</span><br><span class="line">                    mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,</span><br><span class="line">                    mRequest.ignoreTargetSecurity, mRequest.componentSpecified,</span><br><span class="line">                    mRequest.outActivity, mRequest.inTask, mRequest.reason,</span><br><span class="line">                    mRequest.allowPendingRemoteAnimationRegistryLookup);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        onExecutionComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿›ä¸€æ­¥ä¼šè°ƒç”¨ startActivityMayWait æ–¹æ³•ï¼Œç„¶åå°±æ˜¯åœ¨ ActivityStarter ä¸€å¤§é•¿ä¸²çš„è°ƒç”¨äº†ï¼Œè°ƒç”¨é¡ºåºä¸ºï¼šstartActivityMayWait -&gt; startActivity -&gt; startActivity -&gt; startActivity -&gt; startActivityUncheckedï¼Œ</p><h5 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h5><ol><li><a href="https://blog.csdn.net/itachi85/article/details/78569299" target="_blank" rel="noopener">Androidæ·±å…¥å››å¤§ç»„ä»¶ï¼ˆå…­ï¼‰Android8.0 æ ¹Activityå¯åŠ¨è¿‡ç¨‹ï¼ˆå‰ç¯‡ï¼‰</a></li><li><a href="https://blog.csdn.net/qinjuning/article/details/7262769" target="_blank" rel="noopener">Androidä¸­ActivityManagerServiceä¸åº”ç”¨ç¨‹åº(å®¢æˆ·ç«¯)é€šä¿¡æ¨¡å‹åˆ†æ</a></li><li><a href="https://www.2cto.com/kf/201903/799681.html" target="_blank" rel="noopener">Android startActivityåŸç†åˆ†æ(åŸºäºAndroid 8.1 AOSP)</a></li><li><a href="https://segmentfault.com/a/1190000019042206" target="_blank" rel="noopener">AMS startActivity())</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»ä¸€ä¸ªé—®é¢˜å‡ºå‘ï¼šè°ƒç”¨ startActivity åç³»ç»Ÿåˆ°åº•åšäº†ä»€ä¹ˆäº‹ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœè®©æˆ‘å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç­”æ¡ˆä¼šæ˜¯è¿™æ ·ï¼šAndroid ç³»ç»Ÿå¯åŠ¨åä¼šå…ˆå¯åŠ¨ä¸€ä¸ª init è¿›ç¨‹ï¼Œinit è¿›ç¨‹å¯åŠ¨ Zygote è¿›ç¨‹ï¼ŒZygote è¿›ç¨‹è¿›è€Œä¼šå¯åŠ¨ system server è¿›ç¨‹ï¼Œåœ¨è¿™ä¸ª system server è¿›ç¨‹ä¸­ï¼Œä¼šå¯åŠ¨ AMSã€WMS ç­‰ç³»ç»ŸæœåŠ¡ã€‚æˆ‘ä»¬çš„ app ä¸­è°ƒç”¨ startActivity åï¼Œéœ€è¦é€šè¿‡ AMS æ‰§è¡Œå¯åŠ¨ Activityï¼Œè€Œæˆ‘ä»¬çš„ app è¿›ç¨‹ä¸ system server æ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œæ‰€ä»¥è¦è·¨è¿›ç¨‹ï¼Œè·¨è¿›ç¨‹æ˜¯é€šè¿‡ Binder æ¥å®ç°çš„ã€‚ &lt;/p&gt;
&lt;p&gt;ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿæ»¡è„¸é—®å·è„¸ï¼‰ï¼Œæˆ‘è¿™æ˜¯å›ç­”äº†å•¥ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="Framework" scheme="http://yhaowa.gitee.io/categories/Framework/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
      <category term="Framework" scheme="http://yhaowa.gitee.io/tags/Framework/"/>
    
      <category term="AMS" scheme="http://yhaowa.gitee.io/tags/AMS/"/>
    
  </entry>
  
  <entry>
    <title>Android é›†æˆ FFmpeg (å››) è½»æ¾å®ç°ä¸€ä¸ªéŸ³è§†é¢‘ç¼–è¾‘ App</title>
    <link href="http://yhaowa.gitee.io/798144ac/"/>
    <id>http://yhaowa.gitee.io/798144ac/</id>
    <published>2019-06-16T12:07:18.000Z</published>
    <updated>2019-06-28T10:02:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡å…³äº FFmpeg çš„æ–‡ç« ï¼Œè®²çš„å¤§æ¦‚æ˜¯åŸºäº FFmpeg å®ç°äº†ä¸€ä¸ª Appï¼Œæ”¯æŒè§†é¢‘æ‹¼å›¾ç­‰å¼ºå¤§ç‚«é…·çš„éŸ³è§†é¢‘ç¼–è¾‘åŠŸèƒ½ï¼Œå…¶åŸç†æ˜¯åœ¨ Android ç«¯é›†æˆ FFmpegï¼Œé€šè¿‡å‘½ä»¤æ–¹å¼è°ƒç”¨ FFmpegã€‚</p><p>å°½ç®¡åœ¨ Android ç«¯é›†æˆå‘½ä»¤æ–¹å¼è°ƒç”¨å¹¶ä¸å¤æ‚ï¼Œä½†ä¸€ä¸ªå…·æœ‰å¼ºå¤§ç‚«é…·éŸ³è§†é¢‘ç¼–è¾‘åŠŸèƒ½çš„ App æ˜¯æœ‰ä»·å€¼çš„ã€‚ç”±æ­¤å¯å‘ï¼Œå¹¶å†³å®šæ•²ä¸‹ Android é›†æˆ FFmpeg ç³»åˆ—çš„ç¬¬å››ç¯‡ï¼Œä»¥ä¸€ä¸ªå®é™…åº”ç”¨çš„æ–¹å¼å±•ç° FFmpeg å¼ºå¤§çš„éŸ³è§†é¢‘ç¼–è¾‘åŠŸèƒ½ã€‚</p><blockquote><p>å¼ºçƒˆå»ºè®®ä½ ä¸‹è½½è¯•ç”¨æ„Ÿå—ä¸€ä¸‹ï¼š<a href="https://fir.im/f3vd" target="_blank" rel="noopener">https://fir.im/f3vd</a></p></blockquote><a id="more"></a><p>åº”ç”¨æˆªå›¾ï¼š</p><p><img src="../img/19.jpg" alt></p><blockquote><p>æºç ï¼š<a href="https://github.com/yhaolpz/FFmpegCmd" target="_blank" rel="noopener">https://github.com/yhaolpz/FFmpegCmd</a></p></blockquote><p>è‹¥æƒ³å®ç°æ›´å¤šæ•ˆæœï¼Œè§ <a href="http://ffmpeg.org/ffmpeg.html" target="_blank" rel="noopener">ffmpeg Documentation</a>ï¼Œåº”ç”¨ä»£ç éå¸¸ç®€å•ï¼Œè¿™é‡Œå°±ä¸å†è¿‡å¤šé˜è¿°ï¼Œç›´æ¥æŸ¥çœ‹æºç ï¼Œä¸€çœ‹å³æ‡‚ï¼Œç†è®ºçŸ¥è¯†åŠç¼–è¯‘å®ç°è§å‰ä¸‰ç¯‡ï¼š</p><blockquote><p><a href="https://yhaolpz.github.io/e0b4d9fc/" target="_blank" rel="noopener">Android é›†æˆ FFmpeg (ä¸€) åŸºç¡€çŸ¥è¯†åŠç®€å•è°ƒç”¨</a><br><a href="https://yhaolpz.github.io/ddeb5551/" target="_blank" rel="noopener">Android é›†æˆ FFmpeg (äºŒ) ä»¥å‘½ä»¤æ–¹å¼è°ƒç”¨ FFmpeg</a><br><a href="https://yhaolpz.github.io/8837781/" target="_blank" rel="noopener">Android é›†æˆ FFmpeg (ä¸‰) è·å– FFmpeg æ‰§è¡Œè¿›åº¦</a></p></blockquote><p>è¿™ä¸ªç³»åˆ—ä¹Ÿç®—æ˜¯ç”»ä¸ªå¥å·ï¼Œåç»­å°†å­¦ä¹  OpenGL ç›¸å…³ï¼Œç»“åˆå®ç°é«˜æ•ˆçš„å®æ—¶æ¸²æŸ“ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡å…³äº FFmpeg çš„æ–‡ç« ï¼Œè®²çš„å¤§æ¦‚æ˜¯åŸºäº FFmpeg å®ç°äº†ä¸€ä¸ª Appï¼Œæ”¯æŒè§†é¢‘æ‹¼å›¾ç­‰å¼ºå¤§ç‚«é…·çš„éŸ³è§†é¢‘ç¼–è¾‘åŠŸèƒ½ï¼Œå…¶åŸç†æ˜¯åœ¨ Android ç«¯é›†æˆ FFmpegï¼Œé€šè¿‡å‘½ä»¤æ–¹å¼è°ƒç”¨ FFmpegã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡åœ¨ Android ç«¯é›†æˆå‘½ä»¤æ–¹å¼è°ƒç”¨å¹¶ä¸å¤æ‚ï¼Œä½†ä¸€ä¸ªå…·æœ‰å¼ºå¤§ç‚«é…·éŸ³è§†é¢‘ç¼–è¾‘åŠŸèƒ½çš„ App æ˜¯æœ‰ä»·å€¼çš„ã€‚ç”±æ­¤å¯å‘ï¼Œå¹¶å†³å®šæ•²ä¸‹ Android é›†æˆ FFmpeg ç³»åˆ—çš„ç¬¬å››ç¯‡ï¼Œä»¥ä¸€ä¸ªå®é™…åº”ç”¨çš„æ–¹å¼å±•ç° FFmpeg å¼ºå¤§çš„éŸ³è§†é¢‘ç¼–è¾‘åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼ºçƒˆå»ºè®®ä½ ä¸‹è½½è¯•ç”¨æ„Ÿå—ä¸€ä¸‹ï¼š&lt;a href=&quot;https://fir.im/f3vd&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://fir.im/f3vd&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="éŸ³è§†é¢‘" scheme="http://yhaowa.gitee.io/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
      <category term="FFmpeg" scheme="http://yhaowa.gitee.io/tags/FFmpeg/"/>
    
      <category term="éŸ³è§†é¢‘" scheme="http://yhaowa.gitee.io/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>Android OpenGL ESï¼ˆä¸‰ï¼‰ç®€å•å›¾å½¢å˜æ¢</title>
    <link href="http://yhaowa.gitee.io/1008175c/"/>
    <id>http://yhaowa.gitee.io/1008175c/</id>
    <published>2019-06-16T09:11:32.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°½ç®¡å¯¹ VAOã€VBO ä»¥åŠçº¹ç†ç›¸å…³çš„çŸ¥è¯†è·ƒè·ƒæ¬²è¯•ï¼Œä½†è¿˜æ˜¯å†³å®šè€ä¸‹å¿ƒæ¥ï¼Œå…ˆå­¦ä¹ ç»˜åˆ¶ä¸€äº›ç®€å•å›¾å½¢åŠå›¾å½¢å˜æ¢ï¼Œåœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¹Ÿåªæ˜¯ç®€å•å­¦ä¹ äº†ä¸‹ GLSL è¯­è¨€ï¼Œè¿™ç¯‡æ–‡ç« çš„å­¦ä¹ ä¹Ÿå¯ä»¥å¯¹ GLSL è¯­è¨€æœ‰æ›´å¥½çš„æŒæ¡ã€‚</p><a id="more"></a><blockquote><p>æ­£åœ¨å­¦ä¹ â€¦</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°½ç®¡å¯¹ VAOã€VBO ä»¥åŠçº¹ç†ç›¸å…³çš„çŸ¥è¯†è·ƒè·ƒæ¬²è¯•ï¼Œä½†è¿˜æ˜¯å†³å®šè€ä¸‹å¿ƒæ¥ï¼Œå…ˆå­¦ä¹ ç»˜åˆ¶ä¸€äº›ç®€å•å›¾å½¢åŠå›¾å½¢å˜æ¢ï¼Œåœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¹Ÿåªæ˜¯ç®€å•å­¦ä¹ äº†ä¸‹ GLSL è¯­è¨€ï¼Œè¿™ç¯‡æ–‡ç« çš„å­¦ä¹ ä¹Ÿå¯ä»¥å¯¹ GLSL è¯­è¨€æœ‰æ›´å¥½çš„æŒæ¡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="OpenGL" scheme="http://yhaowa.gitee.io/categories/OpenGL/"/>
    
    
      <category term="OpenGL" scheme="http://yhaowa.gitee.io/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>Android OpenGL ESï¼ˆäºŒï¼‰ç»˜åˆ¶ä¸‰è§’å½¢</title>
    <link href="http://yhaowa.gitee.io/2296ca3/"/>
    <id>http://yhaowa.gitee.io/2296ca3/</id>
    <published>2019-06-16T08:39:50.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡ä¸Šç¯‡æ–‡ç« çš„å­¦ä¹ ï¼Œç°åœ¨å·²ç»äº†è§£åˆ°ï¼Œè¦æƒ³åœ¨ Android ç«¯ä½¿ç”¨ OpenGL ES ç»˜åˆ¶å›¾å½¢ï¼Œå¿…é¡»åˆ›å»º OpenGL ES ç¯å¢ƒå’Œè§†å›¾çª—å£ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æ„å»º EGL ç¯å¢ƒï¼Œå³ OpenGL ES å’Œ Android åº•å±‚å¹³å°è§†çª—ç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚å¦å¤– OpenGL ES 2.0 ç‰ˆæœ¬ä¸ºå¯ç¼–ç¨‹ç®¡çº¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™ç€è‰²å™¨ç¨‹åºæ¥ç¡®å®šç»˜åˆ¶å†…å®¹ï¼Œå³ç¼–å†™ Vertex Shader é¡¶ç‚¹ç€è‰²å™¨å’Œ Fragment Shader ç‰‡å…ƒç€è‰²å™¨ã€‚</p><p>è€Œè¿™äº›å·¥ä½œå¯ä»¥é€šè¿‡ GLSurfaceView éå¸¸ç®€å•çš„å®ç°ã€‚</p><a id="more"></a><p>åœ¨ä»‹ç» GLSurfaceView ä¹‹å‰å…ˆæ¥çœ‹ä¸‹ Android ç³»ç»Ÿæä¾›çš„ä¸ OpenGL ES ç›¸å…³çš„åŒ…ï¼š</p><ul><li>javax.microedition.khronos.openglesï¼š å­˜æ”¾ GL ç»˜å›¾æŒ‡ä»¤ç›¸å…³ä»£ç </li><li>javax.microedition.khronos.eglï¼š å­˜æ”¾ EGL ç®¡ç†ç›¸å…³ä»£ç ï¼ŒåŒ…æ‹¬ Displayã€surface ç­‰</li><li>android.openglï¼š å­˜æ”¾ GL è¾…åŠ©ç±»ï¼Œè¿æ¥ OpenGL ä¸ Android Viewï¼ŒActivity ç­‰</li></ul><p>å…¶ä¸­ GLSurfaceView å¤„äº android.opengl åŒ…ä¸­ï¼ŒGLSurfaceView å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>å†…ç½® EGL ç®¡ç†ï¼Œè‡ªå¸¦ GL ä¸Šä¸‹æ–‡ç¯å¢ƒå’Œ GLThread ç»˜åˆ¶çº¿ç¨‹</li><li>èµ·åˆ°è¿æ¥ OpenGL ES ä¸ Android çš„ View å±‚æ¬¡ç»“æ„ä¹‹é—´çš„æ¡¥æ¢ä½œç”¨</li><li>ä½¿å¾— OpenGL ES åº“é€‚åº”äº Activity ç”Ÿå‘½å‘¨æœŸ</li><li>ç»§æ‰¿è‡ª SurfaceViewï¼Œæ‹¥æœ‰ SurfaceView çš„å…¨éƒ¨ç‰¹æ€§ï¼Œç»˜åˆ¶ç»“æœä¼šè¾“å‡ºåˆ° SurfaceView æ‰€æä¾›çš„ Surface ä¸Š</li><li>æä¾›äº†æ–¹ä¾¿ä½¿ç”¨çš„è°ƒè¯•å·¥å…·æ¥è·Ÿè¸ª OpenGL ES å‡½æ•°è°ƒç”¨ä»¥å¸®åŠ©æ£€æŸ¥é”™è¯¯</li></ul><p>é€šè¿‡ GLSurfaceView çš„ setRenderer æ–¹æ³•å¯è®¾ç½®è¦æ¸²æŸ“çš„æ•ˆæœï¼Œå³ GLSurfaceView.Renderer æ¸²æŸ“å™¨æ¥å£ï¼Œè¯¥æ¥å£æ–¹æ³•ï¼š</p><ul><li>onSurfaceCreatedï¼šæ¸²æŸ“çº¿ç¨‹å¼€å¯æ—¶è°ƒç”¨ï¼Œå¯åšåˆå§‹åŒ–èƒŒæ™¯è‰²ã€åˆå§‹åŒ–çº¹ç†èµ„æºç­‰å·¥ä½œ</li><li>onSurfaceChangedï¼šçª—å£å°ºå¯¸æ”¹å˜æ—¶è°ƒç”¨ï¼Œé€šå¸¸ä¼šè®¾ç½®è§†çª—èŒƒå›´æˆ–æŠ•å½±çŸ©é˜µç­‰</li><li>onDrawFrameï¼šå¤–éƒ¨è¯·æ±‚æ¸²æŸ“ä¸€æ¬¡å°±è°ƒç”¨ä¸€æ¬¡ï¼Œå¯åœ¨æ­¤è½½å…¥ç€è‰²å™¨ç¨‹åºã€æ¿€æ´»ç»‘å®šçº¹ç†ä»¥åŠè°ƒç”¨ç»˜åˆ¶</li></ul><p>ä¸‹é¢æ¥çœ‹å…·ä½“å¦‚ä½•ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">implements</span> <span class="title">GLSurfaceView</span>.<span class="title">Renderer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String vertexShaderResource =</span><br><span class="line">            <span class="string">"attribute vec3 vPosition;"</span> +</span><br><span class="line">                    <span class="string">"void main() &#123;"</span> +</span><br><span class="line">                    <span class="string">"  gl_Position = vec4(vPosition.x, vPosition.y, vPosition.z, 1.0);"</span> +</span><br><span class="line">                    <span class="string">"&#125;"</span>;</span><br><span class="line">    <span class="comment">//ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String fragmentShaderResource =</span><br><span class="line">            <span class="string">"precision mediump float;"</span> +</span><br><span class="line">                    <span class="string">"uniform vec4 vColor;"</span> +</span><br><span class="line">                    <span class="string">"void main() &#123;"</span> +</span><br><span class="line">                    <span class="string">"  gl_FragColor = vColor;"</span> +</span><br><span class="line">                    <span class="string">"&#125;"</span>;</span><br><span class="line">    <span class="comment">//é¡¶ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span>[] vertexCoords = <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;</span><br><span class="line">            <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="comment">// top</span></span><br><span class="line">            -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="comment">// bottom left</span></span><br><span class="line">            <span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span>  <span class="comment">// bottom right</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> color[] = &#123;<span class="number">1.0f</span>, <span class="number">0f</span>, <span class="number">0f</span>, <span class="number">1.0f</span>&#125;; <span class="comment">//red</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç€è‰²å™¨ç¨‹åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mProgram;</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> FloatBuffer vertexFloatBuffer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceCreated</span><span class="params">(GL10 gl, EGLConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®æ¸…ç©ºå±å¹•åçš„èƒŒæ™¯è‰²</span></span><br><span class="line">        GLES30.glClearColor(<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>);</span><br><span class="line">        <span class="comment">//æ„å»ºé¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">        <span class="keyword">int</span> vertexShader = GLES30.glCreateShader(GLES30.GL_VERTEX_SHADER);</span><br><span class="line">        GLES30.glShaderSource(vertexShader, vertexShaderResource);</span><br><span class="line">        GLES30.glCompileShader(vertexShader);</span><br><span class="line">        <span class="comment">//æ„å»ºç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">        <span class="keyword">int</span> fragmentShader = GLES30.glCreateShader(GLES30.GL_FRAGMENT_SHADER);</span><br><span class="line">        GLES30.glShaderSource(fragmentShader, fragmentShaderResource);</span><br><span class="line">        GLES30.glCompileShader(fragmentShader);</span><br><span class="line">        <span class="comment">//æ„å»ºç€è‰²å™¨ç¨‹åºï¼Œå¹¶å°†é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨é“¾æ¥è¿›æ¥</span></span><br><span class="line">        mProgram = GLES30.glCreateProgram();</span><br><span class="line">        GLES30.glAttachShader(mProgram, vertexShader);</span><br><span class="line">        GLES30.glAttachShader(mProgram, fragmentShader);</span><br><span class="line">        GLES30.glLinkProgram(mProgram);</span><br><span class="line">        <span class="comment">//é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨é“¾æ¥åˆ°ç€è‰²å™¨ç¨‹åºåå°±æ— ç”¨äº†</span></span><br><span class="line">        GLES30.glDeleteShader(vertexShader);</span><br><span class="line">        GLES30.glDeleteShader(fragmentShader);</span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºéœ€è¦çš„é¡¶ç‚¹æ•°æ®æ ¼å¼</span></span><br><span class="line">        vertexFloatBuffer = floatToBuffer(vertexCoords);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceChanged</span><span class="params">(GL10 gl, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®è§†çª—</span></span><br><span class="line">        GLES30.glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawFrame</span><span class="params">(GL10 gl)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ¸…ç©ºå±å¹•ï¼Œæ“¦é™¤å±å¹•ä¸Šæ‰€æœ‰çš„é¢œè‰²ï¼Œç”¨ glClearColor å®šä¹‰çš„é¢œè‰²å¡«å……</span></span><br><span class="line">        GLES30.glClear(GLES30.GL_COLOR_BUFFER_BIT);</span><br><span class="line">        <span class="comment">//åœ¨å½“å‰ EGL ç¯å¢ƒæ¿€æ´»ç€è‰²å™¨ç¨‹åº</span></span><br><span class="line">        GLES30.glUseProgram(mProgram);</span><br><span class="line">        <span class="comment">//è·å–é¡¶ç‚¹ç€è‰²å™¨çš„ vPosition æˆå‘˜å¥æŸ„</span></span><br><span class="line">        <span class="keyword">int</span> positionHandle = GLES30.glGetAttribLocation(mProgram, <span class="string">"vPosition"</span>);</span><br><span class="line">        <span class="comment">//å¯ç”¨å¥æŸ„</span></span><br><span class="line">        GLES30.glEnableVertexAttribArray(positionHandle);</span><br><span class="line">        <span class="comment">//è®¾ç½®é¡¶ç‚¹åæ ‡æ•°æ®</span></span><br><span class="line">        GLES30.glVertexAttribPointer(positionHandle, <span class="number">3</span>, GLES30.GL_FLOAT,</span><br><span class="line">                <span class="keyword">false</span>, <span class="number">3</span> * <span class="number">4</span>, vertexFloatBuffer);</span><br><span class="line">        <span class="comment">//è·å–ç‰‡å…ƒç€è‰²å™¨çš„ vColor æˆå‘˜å¥æŸ„</span></span><br><span class="line">        <span class="keyword">int</span> colorHandle = GLES30.glGetUniformLocation(mProgram, <span class="string">"vColor"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®é¢œè‰²</span></span><br><span class="line">        GLES30.glUniform4fv(colorHandle, <span class="number">1</span>, color, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//ç»˜åˆ¶ä¸‰è§’å½¢</span></span><br><span class="line">        GLES30.glDrawArrays(GLES30.GL_TRIANGLE_STRIP, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">//ç¦æ­¢é¡¶ç‚¹æ•°ç»„çš„å¥æŸ„</span></span><br><span class="line">        GLES30.glDisableVertexAttribArray(positionHandle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> FloatBuffer <span class="title">floatToBuffer</span><span class="params">(<span class="keyword">float</span>[] a)</span> </span>&#123;</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocateDirect(a.length * <span class="number">4</span>); <span class="comment">//floatå 4ä¸ªå­—èŠ‚</span></span><br><span class="line">        buffer.order(ByteOrder.nativeOrder());</span><br><span class="line">        FloatBuffer byteBuffer = buffer.asFloatBuffer();</span><br><span class="line">        byteBuffer.put(a);</span><br><span class="line">        byteBuffer.position(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> byteBuffer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é¡¶ç‚¹è¾“å…¥"><a href="#é¡¶ç‚¹è¾“å…¥" class="headerlink" title="é¡¶ç‚¹è¾“å…¥"></a>é¡¶ç‚¹è¾“å…¥</h4><p>è¦ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ï¼Œå°±è¦ç¡®å®šä¸‰ä¸ªé¡¶ç‚¹çš„ 3D åæ ‡ï¼ˆOpenGL æ˜¯ä¸€ä¸ª 3D å›¾å½¢åº“ï¼Œåœ¨ OpenGL ä¸­æŒ‡å®šçš„æ‰€æœ‰åæ ‡éƒ½éœ€è¦æ˜¯ 3D åæ ‡ï¼Œå³ xã€y å’Œ zï¼‰ã€‚è€Œé¡¶ç‚¹åæ ‡èµ·å§‹äºå±€éƒ¨åæ ‡ï¼Œéœ€è¦ä¸ºæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼Œå³ xã€yã€z çš„èŒƒå›´é™å®šäº -1 åˆ° 1 ä¹‹é—´ï¼Œä»»ä½•è½åœ¨èŒƒå›´å¤–çš„åæ ‡éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚ä¸Šé¢ä»£ç ä¸­è¾“å…¥çš„é¡¶ç‚¹æ•°æ®ä¸ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span>[] vertexCoords = <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå°† z åæ ‡éƒ½è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºä¸‰è§’å½¢æ¯ä¸€ç‚¹çš„æ·±åº¦éƒ½ä¸º 0ï¼ˆé€šå¸¸æ·±åº¦å¯ä»¥ç†è§£ä¸ºzåæ ‡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªåƒç´ åœ¨ç©ºé—´ä¸­å’Œä½ çš„è·ç¦»ï¼Œå¦‚æœç¦»ä½ è¿œå°±å¯èƒ½è¢«åˆ«çš„åƒç´ é®æŒ¡ï¼Œä½ å°±çœ‹ä¸åˆ°å®ƒäº†ï¼Œå®ƒä¼šè¢«ä¸¢å¼ƒï¼Œä»¥èŠ‚çœèµ„æºï¼‰ï¼Œè¿™æ ·å®šä¹‰çš„é¡¶ç‚¹æ•°æ®ååº”åˆ°æ ‡å‡†åŒ–è®¾å¤‡åæ ‡ç³»ä¸­å°±æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="../img/17.jpg" alt></p><h4 id="è§£é‡Šé¡¶ç‚¹æ•°æ®"><a href="#è§£é‡Šé¡¶ç‚¹æ•°æ®" class="headerlink" title="è§£é‡Šé¡¶ç‚¹æ•°æ®"></a>è§£é‡Šé¡¶ç‚¹æ•°æ®</h4><p>å¯ä»¥çœ‹åˆ°è°ƒç”¨ glVertexAttribPointer è®¾ç½®é¡¶ç‚¹æ•°æ®æ—¶å¹¶ä¸æ˜¯ç›´æ¥æŠŠ float[] æ•°ç»„ä¼ é€’è¿›å»ï¼Œè€Œæ˜¯è½¬æ¢æˆ FloatBuffer ä¼ å…¥ï¼Œæ‰€è°“çš„è§£é‡Šé¡¶ç‚¹æ•°æ®å°±æ˜¯è¯´æ˜è¾“å…¥æ•°æ®çš„å“ªä¸€ä¸ªéƒ¨åˆ†å¯¹åº”é¡¶ç‚¹ç€è‰²å™¨çš„å“ªä¸€ä¸ªé¡¶ç‚¹å±æ€§ã€‚å¯¹äº glVertexAttribPointer å‡½æ•°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">glVertexAttribPointer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> indx,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> size, </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> type,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> normalized,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> stride,</span></span></span><br><span class="line"><span class="function"><span class="params">    java.nio.Buffer ptr</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure></p><ul><li>indxï¼šæŒ‡å®šè¦é…ç½®çš„é¡¶ç‚¹å±æ€§ï¼Œè¿™é‡Œä¼ å…¥é¡¶ç‚¹ç€è‰²å™¨çš„ vPosition æˆå‘˜å¥æŸ„</li><li>sizeï¼šæŒ‡å®šé¡¶ç‚¹å±æ€§çš„å¤§å°ï¼Œé¡¶ç‚¹å±æ€§æ˜¯ä¸€ä¸ª vec3ï¼Œå®ƒç”± 3 ä¸ªå€¼ï¼ˆxã€yã€zï¼‰ç»„æˆï¼Œæ‰€ä»¥å¤§å°ä¼ å…¥ 3</li><li>typeï¼šæŒ‡å®šæ•°æ®çš„ç±»å‹ä¸º float ç±»å‹</li><li>normalizedï¼šæ˜¯å¦å¸Œæœ›æ•°æ®è¢«æ ‡å‡†åŒ–</li><li>strideï¼šæŒ‡å®šè¿ç»­çš„é¡¶ç‚¹æ•°æ®ä¹‹é—´çš„é—´éš”ï¼Œç”±äºä¸€ä¸ªé¡¶ç‚¹æ•°æ®é•¿åº¦ä¸º 3 ä¸ª floatï¼Œæ‰€ä»¥æŠŠæ­¥é•¿è®¾ç½®ä¸º 3 * 4ï¼ˆä¸€ä¸ª float å  4 ä¸ªå­—èŠ‚ï¼‰</li><li>ptrï¼šé¡¶ç‚¹æ•°æ®</li></ul><p>ä¸‹å›¾å¾ˆå¥½çš„é˜é‡Šè¿™ä¸ªé€»è¾‘ï¼š</p><p><img src="../img/18.jpg" alt></p><h4 id="é¡¶ç‚¹ç€è‰²å™¨"><a href="#é¡¶ç‚¹ç€è‰²å™¨" class="headerlink" title="é¡¶ç‚¹ç€è‰²å™¨"></a>é¡¶ç‚¹ç€è‰²å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String vertexShaderResource =</span><br><span class="line">    <span class="string">"attribute vec3 vPosition;"</span> +</span><br><span class="line">        <span class="string">"void main() &#123;"</span> +</span><br><span class="line">        <span class="string">"  gl_Position = vec4(vPosition.x, vPosition.y, vPosition.z, 1.0);"</span> +</span><br><span class="line">        <span class="string">"&#125;"</span>;</span><br></pre></td></tr></table></figure><p>ç”±äºæ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€ä¸ª 3D åæ ‡ï¼Œè¿™é‡Œå°±åˆ›å»ºä¸€ä¸ª vec3 å˜é‡è¾“å…¥é¡¶ç‚¹åæ ‡ã€‚è€Œå†…ç½®å˜é‡ gl_Position ä¸º vec4 ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å°†ä¸‰ç»´å‘é‡è½¬æ¢ä¸ºå››ç»´å‘é‡ï¼Œæœ€å gl_Position è®¾ç½®çš„å€¼ä¼šæˆä¸ºè¯¥é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºã€‚</p><p>onDrawFrame æ–¹æ³•ä¸­åœ¨è·å–é¡¶ç‚¹ç€è‰²å™¨çš„ vPosition æˆå‘˜å¥æŸ„åï¼Œéœ€è¦è°ƒç”¨ glEnableVertexAttribArrayã€glDisableVertexAttribArray åˆ†åˆ«å¯ç”¨ã€ç¦æ­¢é¡¶ç‚¹æ•°æ®ï¼Œè€Œç‰‡æ®µç€è‰²å™¨çš„ vColor æˆå‘˜å¥æŸ„å°±ä¸éœ€è¦ã€‚è¿™æ˜¯å› ä¸ºå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œæ‰€æœ‰é¡¶ç‚¹ç€è‰²å™¨çš„å±æ€§é»˜è®¤éƒ½æ˜¯å…³é—­çš„ã€‚<br>glVertexAttribPointer åªæ˜¯å»ºç«‹ CPU å’Œ GPU ä¹‹é—´çš„é€»è¾‘è¿æ¥å®ç°å°† CPU æ•°æ®ä¸Šä¼ è‡³ GPUï¼Œä½†æ˜¯ï¼Œæ•°æ®åœ¨ GPU ç«¯æ˜¯å¦å¯è§ï¼Œå³ç€è‰²å™¨èƒ½å¦è¯»å–åˆ°æ•°æ®ï¼Œè¿˜è¦å–å†³äº glEnableVertexAttribArray æ–¹æ³•ã€‚</p><h4 id="ç‰‡æ®µç€è‰²å™¨"><a href="#ç‰‡æ®µç€è‰²å™¨" class="headerlink" title="ç‰‡æ®µç€è‰²å™¨"></a>ç‰‡æ®µç€è‰²å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String fragmentShaderResource =</span><br><span class="line"><span class="string">"precision mediump float;"</span> +</span><br><span class="line">        <span class="string">"uniform vec4 vColor;"</span> +</span><br><span class="line">        <span class="string">"void main() &#123;"</span> +</span><br><span class="line">        <span class="string">"  gl_FragColor = vColor;"</span> +</span><br><span class="line">        <span class="string">"&#125;"</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ OpenGL ä¸­å®šä¹‰ä¸€ä¸ªé¢œè‰²çš„æ•°æ®æ ¼å¼ä¸º RGBA å››ä¸ª 0.0 åˆ° 1.0 ä¹‹é—´å¼ºåº¦çš„åˆ†é‡ï¼Œç‰‡æ®µç€è‰²å™¨æ‰€åšçš„æ˜¯è®¡ç®—åƒç´ æœ€åçš„é¢œè‰²è¾“å‡ºï¼Œä¹Ÿåªæœ‰ gl_FragColor è¿™ä¸€ä¸ªè¾“å‡ºå˜é‡ã€‚</p><h4 id="ç¼–è¯‘ç€è‰²å™¨"><a href="#ç¼–è¯‘ç€è‰²å™¨" class="headerlink" title="ç¼–è¯‘ç€è‰²å™¨"></a>ç¼–è¯‘ç€è‰²å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> vertexShader = GLES30.glCreateShader(GLES30.GL_VERTEX_SHADER);</span><br><span class="line">GLES30.glShaderSource(vertexShader, vertexShaderResource);</span><br><span class="line">GLES30.glCompileShader(vertexShader);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®© OpenGL èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬ç¼–å†™çš„ç€è‰²å™¨æºç ï¼Œå¿…é¡»åœ¨è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ã€‚é¦–å…ˆé€šè¿‡ glCreateShader åˆ›å»ºä¸€ä¸ªç€è‰²å™¨å¯¹è±¡ï¼Œè¿”å›è¯¥ç€è‰²å™¨çš„ IDï¼Œç„¶åé€šè¿‡ glShaderSourceã€glCompileShader æ–¹æ³•å°†æºç é™„ç€åœ¨ç€è‰²å™¨å¯¹è±¡ä¸Šå¹¶ç¼–è¯‘å®ƒã€‚</p><p>ç¼–è¯‘ç€è‰²å™¨å¯èƒ½å¤±è´¥ï¼Œä¸€èˆ¬ç¼–è¯‘æ—¶ä¼šé€šè¿‡å¦‚ä¸‹æ–¹æ³•åˆ¤æ–­æ˜¯å¦ç¼–è¯‘æˆåŠŸå¹¶è¾“å‡ºç¼–è¯‘ä¿¡æ¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span>[] compileStatus = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>];</span><br><span class="line">GLES20.glGetShaderiv(shaderObjectId, GLES20.GL_COMPILE_STATUS, compileStatus, <span class="number">0</span>);</span><br><span class="line">Log.d(TAG, <span class="string">"glCompileStatus: "</span> + compileStatus[<span class="number">0</span>] </span><br><span class="line">            + <span class="string">" log:"</span> + GLES20.glGetShaderInfoLog(shaderObjectId));</span><br><span class="line"><span class="keyword">if</span> (compileStatus[<span class="number">0</span>] == <span class="number">0</span>) &#123; <span class="comment">//ç¼–è¯‘å¤±è´¥</span></span><br><span class="line">    GLES20.glDeleteShader(shaderObjectId);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ç€è‰²å™¨ç¨‹åº"><a href="#ç€è‰²å™¨ç¨‹åº" class="headerlink" title="ç€è‰²å™¨ç¨‹åº"></a>ç€è‰²å™¨ç¨‹åº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mProgram = GLES30.glCreateProgram();</span><br><span class="line">GLES30.glAttachShader(mProgram, vertexShader);</span><br><span class="line">GLES30.glAttachShader(mProgram, fragmentShader);</span><br><span class="line">GLES30.glLinkProgram(mProgram);</span><br></pre></td></tr></table></figure><p>ç€è‰²å™¨ç¨‹åºå¯¹è±¡æ˜¯å¤šä¸ªç€è‰²å™¨åˆå¹¶ä¹‹åå¹¶æœ€ç»ˆé“¾æ¥å®Œæˆçš„ç‰ˆæœ¬ï¼Œå®ƒå°†ç¼–è¯‘å¥½çš„é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨é“¾æ¥ä¸ºä¸€ä¸ªç€è‰²å™¨ç¨‹åºå¯¹è±¡ï¼Œé“¾æ¥åé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨å°±æ²¡ç”¨äº†ï¼Œå¯ä»¥é€šè¿‡ glDeleteShader åˆ é™¤ã€‚å°±åƒç€è‰²å™¨çš„ç¼–è¯‘ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ£€æµ‹é“¾æ¥ç€è‰²å™¨ç¨‹åºæ˜¯å¦å¤±è´¥ï¼Œå¹¶è·å–ç›¸åº”çš„æ—¥å¿—ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span>[] linkStatus = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>];</span><br><span class="line">GLES20.glGetProgramiv(mProgram, GLES20.GL_LINK_STATUS, linkStatus, <span class="number">0</span>);</span><br><span class="line">Log.d(TAG, <span class="string">"glCompileStatusï¼š"</span> + linkStatus[<span class="number">0</span>]</span><br><span class="line">            + <span class="string">" log:"</span> + GLES20.glGetProgramInfoLog(mProgram));</span><br><span class="line"><span class="keyword">if</span> (linkStatus[<span class="number">0</span>] == <span class="number">0</span>) &#123; <span class="comment">//é“¾æ¥å¤±è´¥</span></span><br><span class="line">    GLES20.glDeleteProgram(mProgram);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é“¾æ¥æˆåŠŸåï¼Œåœ¨æ¸²æŸ“çš„æ—¶å€™é€šè¿‡ glUseProgram æ–¹æ³•æ¿€æ´»ç€è‰²å™¨ç¨‹åºï¼Œå·²æ¿€æ´»ç€è‰²å™¨ç¨‹åºçš„ç€è‰²å™¨å°±ä¼šåœ¨æ¸²æŸ“æ—¶è¢«ä½¿ç”¨ï¼Œæœ€åé€šè¿‡ glDrawArrays æ–¹æ³•è§¦å‘ç»˜åˆ¶ã€‚</p><h5 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h5><p><a href="https://item.jd.com/12292642.html" target="_blank" rel="noopener">ã€ŠéŸ³è§†é¢‘å¼€å‘è¿›é˜¶æŒ‡å— - åŸºäºAndroidä¸IOSå¹³å°çš„å®è·µã€‹</a><br><a href="https://blog.csdn.net/TuGeLe/article/details/79199161" target="_blank" rel="noopener">Android GLSurfaceViewè¯¦è§£</a><br><a href="http://wiki.jikexueyuan.com/project/opengl-es-guide/glsurfaceview.html" target="_blank" rel="noopener">GLSurfaceView</a><br><a href="https://learnopengl-cn.github.io/01%20Getting%20started/04%20Hello%20Triangle/" target="_blank" rel="noopener">ä½ å¥½ï¼Œä¸‰è§’å½¢</a><br><a href="https://www.jianshu.com/p/b05884a0ff8e" target="_blank" rel="noopener">OpenGL ES 3.0 glEnableVertexAttribArrayçš„ä½œç”¨</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é€šè¿‡ä¸Šç¯‡æ–‡ç« çš„å­¦ä¹ ï¼Œç°åœ¨å·²ç»äº†è§£åˆ°ï¼Œè¦æƒ³åœ¨ Android ç«¯ä½¿ç”¨ OpenGL ES ç»˜åˆ¶å›¾å½¢ï¼Œå¿…é¡»åˆ›å»º OpenGL ES ç¯å¢ƒå’Œè§†å›¾çª—å£ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æ„å»º EGL ç¯å¢ƒï¼Œå³ OpenGL ES å’Œ Android åº•å±‚å¹³å°è§†çª—ç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚å¦å¤– OpenGL ES 2.0 ç‰ˆæœ¬ä¸ºå¯ç¼–ç¨‹ç®¡çº¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™ç€è‰²å™¨ç¨‹åºæ¥ç¡®å®šç»˜åˆ¶å†…å®¹ï¼Œå³ç¼–å†™ Vertex Shader é¡¶ç‚¹ç€è‰²å™¨å’Œ Fragment Shader ç‰‡å…ƒç€è‰²å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è€Œè¿™äº›å·¥ä½œå¯ä»¥é€šè¿‡ GLSurfaceView éå¸¸ç®€å•çš„å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="OpenGL" scheme="http://yhaowa.gitee.io/categories/OpenGL/"/>
    
    
      <category term="OpenGL" scheme="http://yhaowa.gitee.io/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>Android OpenGL ESï¼ˆä¸€ï¼‰å¼€å‘å…¥é—¨</title>
    <link href="http://yhaowa.gitee.io/eeb650a2/"/>
    <id>http://yhaowa.gitee.io/eeb650a2/</id>
    <published>2019-06-09T12:40:06.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ—©å°±å¬è¿‡å¤§åé¼é¼çš„ OpenGLï¼Œå´è¿Ÿè¿Ÿæ²¡æœ‰å®è·µå­¦ä¹ ï¼Œæœ‰äº›æƒ­æ„§ã€‚ä»Šå¤©å¼€å§‹é€šè¿‡å®è·µ+åšæ–‡æ–¹å¼å­¦ä¹ æŒæ¡ OpenGLã€‚æ­¤æ–‡å¯¹äº OpenGL çš„å­¦ä¹ åˆ†ä¸ºä»¥ä¸‹éƒ¨åˆ†ï¼š</p><ul><li>OpenGL åŸºç¡€æ¦‚å¿µ</li><li>OpenGL åæ ‡ç³»ç†è§£</li><li>OpenGL æ¸²æŸ“ç®¡çº¿</li><li>OpenGL ç€è‰²è¯­è¨€</li></ul><a id="more"></a><h1 id="OpenGL-åŸºç¡€æ¦‚å¿µ"><a href="#OpenGL-åŸºç¡€æ¦‚å¿µ" class="headerlink" title="OpenGL åŸºç¡€æ¦‚å¿µ"></a>OpenGL åŸºç¡€æ¦‚å¿µ</h1><h4 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h4><p>OpenGL å³ Open Graphics Libraryï¼Œæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€è°ƒç”¨æ–¹ä¾¿çš„åº•å±‚å›¾å½¢åº“ï¼Œå®ƒå®šä¹‰äº†è·¨ç¼–ç¨‹è¯­è¨€ã€è·¨å¹³å°çš„ä¸“ä¸šå›¾å½¢ç¨‹åºæ¥å£ï¼Œå¯ç”¨äºäºŒç»´æˆ–ä¸‰ç»´å›¾åƒçš„å¤„ç†ä¸æ¸²æŸ“ã€‚</p><p>OpenGL æ˜¯è·¨å¹³å°çš„ï¼Œé™¤äº†å®ƒçº¯ç²¹ä¸“æ³¨çš„æ¸²æŸ“å¤–ï¼Œå…¶ä»–å†…å®¹åœ¨æ¯ä¸ªå¹³å°ä¸Šéƒ½è¦æœ‰å®ƒçš„å…·ä½“å®ç°ï¼Œæ¯”å¦‚ä¸Šä¸‹æ–‡ç¯å¢ƒå’Œçª—å£çš„ç®¡ç†å°±äº¤ç”±å„ä¸ªè®¾å¤‡è‡ªå·±æ¥å®Œæˆã€‚</p><h4 id="OpenGL-ES"><a href="#OpenGL-ES" class="headerlink" title="OpenGL ES"></a>OpenGL ES</h4><p>OpenGL ES ï¼ˆOpenGL for Embedded Systemsï¼‰æ˜¯ä¸‰ç»´å›¾å½¢ API OpenGL çš„å­é›†ï¼Œé’ˆå¯¹æ‰‹æœºã€PDA å’Œæ¸¸æˆä¸»æœºç­‰åµŒå…¥å¼è®¾å¤‡è€Œè®¾è®¡ã€‚</p><p>Android å¯¹åº” OpenGL ES çš„ç‰ˆæœ¬æ”¯æŒå¦‚ä¸‹ï¼š</p><ul><li>Android 1.0 å¼€å§‹æ”¯æŒ OpenGL ES 1.0 åŠ 1.1</li><li>Android 2.2 å¼€å§‹æ”¯æŒ OpenGL ES 2.0</li><li>Android 4.3 å¼€å§‹æ”¯æŒ OpenGL ES 3.0</li><li>Android 5.0 å¼€å§‹æ”¯æŒ OpenGL ES 3.1</li></ul><p>å…¶ä¸­ OpenGL ES 1.0 æ˜¯ä»¥ OpenGL 1.3 è§„èŒƒä¸ºåŸºç¡€çš„ï¼ŒOpenGL ES 1.1 æ˜¯ä»¥ OpenGL 1.5 è§„èŒƒä¸ºåŸºç¡€çš„ï¼Œè€Œ OpenGL ES 2.0 åŸºäº OpenGL 2.0 å®ç°ã€‚2.x ç‰ˆæœ¬ç›¸æ¯” 1.x ç‰ˆæœ¬æœ‰è¾ƒå¤§å·®å¼‚ï¼Œ1.x ç‰ˆæœ¬ä¸º fixed function pipelineï¼Œå³å›ºå®šç®¡çº¿ç¡¬ä»¶ï¼Œè€Œ 2.x ç‰ˆæœ¬ä¸º programmable pipelineï¼Œå¯ç¼–ç¨‹ç®¡çº¿ç¡¬ä»¶ã€‚</p><p>å›ºå®šç®¡çº¿ä¸­åŸæœ¬ç”±ç³»ç»Ÿåšçš„ä¸€éƒ¨åˆ†å·¥ä½œï¼Œåœ¨å¯ç¼–ç¨‹ç®¡çº¿ä¸­å¿…é¡»éœ€è¦è‡ªå·±å†™ç¨‹åºå®ç°ï¼Œå…·ä½“ç¨‹åºä¸º vertex shaderï¼ˆé¡¶ç‚¹ç€è‰²å™¨ï¼‰å’Œ fragment shaderï¼ˆç‰‡å…ƒç€è‰²å™¨ï¼‰ã€‚</p><h4 id="OpenGL-ä¸Šä¸‹æ–‡"><a href="#OpenGL-ä¸Šä¸‹æ–‡" class="headerlink" title="OpenGL ä¸Šä¸‹æ–‡"></a>OpenGL ä¸Šä¸‹æ–‡</h4><p>OpenGL æ˜¯ä¸€ä¸ªä»…ä»…å…³æ³¨å›¾åƒæ¸²æŸ“çš„å›¾åƒæ¥å£åº“ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å®ƒéœ€è¦å°†é¡¶ç‚¹ä¿¡æ¯ã€çº¹ç†ä¿¡æ¯ã€ç¼–è¯‘å¥½çš„ç€è‰²å™¨ç­‰æ¸²æŸ“çŠ¶æ€ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œè€Œå­˜å‚¨è¿™äº›ä¿¡æ¯çš„æ•°æ®ç»“æ„å°±å¯ä»¥çœ‹ä½œ OpenGL çš„ä¸Šä¸‹æ–‡ã€‚</p><p>è°ƒç”¨ä»»ä½• OpenGL å‡½æ•°å‰ï¼Œå¿…é¡»å·²ç»åˆ›å»ºäº† OpenGL Contextï¼ŒGL Context å­˜å‚¨äº†OpenGL çš„çŠ¶æ€å˜é‡ä»¥åŠå…¶ä»–æ¸²æŸ“æœ‰å…³çš„ä¿¡æ¯ã€‚OpenGL æ˜¯ä¸ªçŠ¶æ€æœºï¼Œæœ‰å¾ˆå¤šçŠ¶æ€å˜é‡ï¼Œæ˜¯ä¸ªæ ‡å‡†çš„è¿‡ç¨‹å¼æ“ä½œè¿‡ç¨‹ï¼Œæ”¹å˜çŠ¶æ€ä¼šå½±å“åç»­æ‰€æœ‰æ“ä½œï¼Œè¿™å’Œé¢å‘å¯¹è±¡çš„è§£è€¦åŸåˆ™ä¸ç¬¦ï¼Œæ¯•ç«Ÿæ¸²æŸ“æœ¬èº«å°±æ˜¯ä¸ªå¤æ‚çš„è¿‡ç¨‹ã€‚OpenGL é‡‡ç”¨ Client-Server æ¨¡å‹æ¥è§£é‡Š OpenGL ç¨‹åºï¼Œå³ Server å­˜å‚¨ GL Contextï¼ˆå¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼‰ï¼ŒClient æå‡ºæ¸²æŸ“è¯·æ±‚ï¼ŒServer ç»™äºˆå“åº”ï¼Œä¸€èˆ¬ Server å’Œ Client éƒ½åœ¨æˆ‘ä»¬çš„ PC ä¸Šï¼Œä½† Server å’Œ Client ä¹Ÿå¯ä»¥æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥ã€‚</p><p>ä¹‹åçš„æ¸²æŸ“å·¥ä½œå°±è¦ä¾èµ–è¿™äº›æ¸²æŸ“çŠ¶æ€ä¿¡æ¯æ¥å®Œæˆï¼Œå½“ä¸€ä¸ªä¸Šä¸‹æ–‡è¢«é”€æ¯æ—¶ï¼Œå®ƒæ‰€å¯¹åº”çš„ OpenGL æ¸²æŸ“å·¥ä½œä¹Ÿå°†ç»“æŸã€‚</p><h4 id="EGL"><a href="#EGL" class="headerlink" title="EGL"></a>EGL</h4><p>åœ¨ OpenGL çš„è®¾è®¡ä¸­ï¼ŒOpenGL æ˜¯ä¸è´Ÿè´£ç®¡ç†çª—å£çš„ï¼Œçª—å£çš„ç®¡ç†äº¤ç”±å„ä¸ªè®¾å¤‡è‡ªå·±æ¥å®Œæˆï¼Œå…·ä½“æ¥è®²ï¼ŒIOS å¹³å°ä¸Šä½¿ç”¨ EAGL æä¾›æœ¬åœ°å¹³å°å¯¹ OpenGL çš„å®ç°ï¼Œåœ¨ Android å¹³å°ä¸Šä½¿ç”¨ EGL æä¾›æœ¬åœ°å¹³å°å¯¹ OpenGL çš„å®ç°ã€‚EGL æ˜¯ OpenGL ES å’Œ Android åº•å±‚å¹³å°è§†çª—ç³»ç»Ÿä¹‹é—´çš„æ¥å£ï¼Œåœ¨ OpenGL çš„è¾“å‡ºä¸è®¾å¤‡å±å¹•ä¹‹é—´æ¶æ¥èµ·ä¸€ä¸ªæ¡¥æ¢ï¼Œæ‰¿æ‹…äº†ä¸º OpenGL æä¾›ä¸Šä¸‹æ–‡ç¯å¢ƒä»¥åŠç®¡ç†çª—å£çš„èŒè´£ã€‚</p><p>EGL ä¸ºåŒç¼“å†²å·¥ä½œæ¨¡å¼ï¼Œå³æœ‰ä¸€ä¸ª Back Frame Buffer å’Œä¸€ä¸ª Front Frame Bufferï¼Œæ­£å¸¸ç»˜åˆ¶çš„ç›®æ ‡éƒ½æ˜¯ Back Frame Bufferï¼Œç»˜åˆ¶å®Œæˆåå†è°ƒç”¨ eglSwapBuffer APIï¼Œå°†ç»˜åˆ¶å®Œæ¯•çš„ FrameBuffer äº¤æ¢åˆ° Front Frame Buffer å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>ä»ä»£ç å±‚é¢æ¥çœ‹ï¼ŒOpenGL ES çš„ opengles åŒ…ä¸‹å®šä¹‰äº†å¹³å°æ— å…³çš„ç»˜å›¾æŒ‡ä»¤ï¼ŒEGLï¼ˆjavax.microedition.khronos.eglï¼‰<br>åˆ™å®šä¹‰äº†æ§åˆ¶ displaysï¼Œcontexts ä»¥åŠ surfaces çš„ç»Ÿä¸€çš„å¹³å°æ¥å£ã€‚</p><ul><li>Displayï¼ˆEGLDisplayï¼‰ æ˜¯å¯¹å®é™…æ˜¾ç¤ºè®¾å¤‡çš„æŠ½è±¡</li><li>Surfaceï¼ˆEGLSurfaceï¼‰æ˜¯å¯¹ç”¨æ¥å­˜å‚¨å›¾åƒçš„å†…å­˜åŒºåŸŸ FrameBuffer çš„æŠ½è±¡ï¼ŒåŒ…æ‹¬ Color Bufferã€Stencil Bufferã€Depth Buffer</li><li>Contextï¼ˆEGLContextï¼‰å­˜å‚¨ OpenGL ES ç»˜å›¾çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯</li></ul><p><img src="../img/1.jpeg" alt></p><blockquote><p>ä½¿ç”¨ EGL ç»˜å›¾çš„ä¸€èˆ¬æ­¥éª¤ï¼š<br>è·å– EGLDisplay å¯¹è±¡<br>åˆå§‹åŒ–ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥<br>è·å– EGLConfig å¯¹è±¡<br>åˆ›å»º EGLContext å®ä¾‹<br>åˆ›å»º EGLSurface å®ä¾‹<br>è¿æ¥ EGLContext å’Œ EGLSurface<br>ä½¿ç”¨ GL æŒ‡ä»¤ç»˜åˆ¶å›¾å½¢<br>æ–­å¼€å¹¶é‡Šæ”¾ä¸ EGLSurface å…³è”çš„ EGLContext å¯¹è±¡<br>åˆ é™¤ EGLSurface å¯¹è±¡<br>åˆ é™¤ EGLContext å¯¹è±¡<br>ç»ˆæ­¢ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥</p></blockquote><p>ä¸€èˆ¬æ¥è¯´åœ¨ Android å¹³å°ä¸Šå¼€å‘ OpenGL ES åº”ç”¨ï¼Œæ— éœ€æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ¥ç»˜åˆ¶å›¾å½¢ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ GLSurfaceView æ§ä»¶ï¼Œè¯¥æ§ä»¶æä¾›äº†å¯¹ Displayã€Surface ä»¥åŠ Context çš„ç®¡ç†ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘æµç¨‹ã€‚</p><h4 id="OpenGL-çº¹ç†"><a href="#OpenGL-çº¹ç†" class="headerlink" title="OpenGL çº¹ç†"></a>OpenGL çº¹ç†</h4><p>çº¹ç†ï¼ˆTextureï¼‰æ˜¯ä¸€ä¸ª 2D å›¾ç‰‡ï¼ˆç”šè‡³ä¹Ÿæœ‰ 1D å’Œ 3D çš„çº¹ç†ï¼‰ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ·»åŠ ç‰©ä½“çš„ç»†èŠ‚ï¼›ä½ å¯ä»¥æƒ³è±¡çº¹ç†æ˜¯ä¸€å¼ ç»˜æœ‰ç –å—çš„çº¸ï¼Œæ— ç¼æŠ˜å è´´åˆåˆ°ä½ çš„ 3D çš„æˆ¿å­ä¸Šï¼Œè¿™æ ·ä½ çš„æˆ¿å­çœ‹èµ·æ¥å°±åƒæœ‰ç –å¢™å¤–è¡¨äº†ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨ä¸€å¼ å›¾ç‰‡ä¸Šæ’å…¥éå¸¸å¤šçš„ç»†èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥è®©ç‰©ä½“éå¸¸ç²¾ç»†è€Œä¸ç”¨æŒ‡å®šé¢å¤–çš„é¡¶ç‚¹ã€‚</p><h1 id="OpenGL-åæ ‡ç³»ç†è§£"><a href="#OpenGL-åæ ‡ç³»ç†è§£" class="headerlink" title="OpenGL åæ ‡ç³»ç†è§£"></a>OpenGL åæ ‡ç³»ç†è§£</h1><p>OpenGL è¦æ±‚è¾“å…¥çš„é¡¶ç‚¹åæ ‡éƒ½æ˜¯æ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼Œå³æ¯ä¸ªé¡¶ç‚¹çš„ xã€yã€z éƒ½åœ¨ -1 åˆ° 1 ä¹‹é—´ï¼Œç”±æ ‡å‡†åŒ–è®¾å¤‡åæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡çš„è¿‡ç¨‹ä¸­ä¼šç»å†å˜æ¢å¤šä¸ªåæ ‡ç³»ç»Ÿï¼Œåœ¨è¿™äº›ç‰¹å®šçš„åæ ‡ç³»ä¸­ï¼Œä¸€äº›æ“ä½œå’Œè®¡ç®—å¯ä»¥æ›´åŠ æ–¹ä¾¿ã€‚</p><p><img src="../img/15.jpg" alt></p><ul><li><strong>1. å±€éƒ¨åæ ‡</strong><br>é¡¶ç‚¹åæ ‡èµ·å§‹äºå±€éƒ¨ç©ºé—´ï¼ˆLocal Spaceï¼‰ï¼Œåœ¨è¿™é‡Œç§°ä¸ºå±€éƒ¨åæ ‡ï¼Œæ˜¯ä»¥ç‰©ä½“æŸä¸€ç‚¹ä¸ºåŸç‚¹è€Œå»ºç«‹çš„ï¼Œè¯¥åæ ‡ç³»ä»…å¯¹è¯¥ç‰©ä½“é€‚ç”¨ï¼Œç”¨æ¥ç®€åŒ–å¯¹ç‰©ä½“å„éƒ¨åˆ†åæ ‡çš„æè¿°ã€‚ç‰©ä½“æ”¾åˆ°åœºæ™¯ä¸­æ—¶ï¼Œå„éƒ¨åˆ†ç»å†çš„åæ ‡å˜æ¢ç›¸åŒï¼Œç›¸å¯¹ä½ç½®ä¸å˜ã€‚</li><li><strong>2. ä¸–ç•Œåæ ‡</strong><br>å±€éƒ¨åæ ‡é€šè¿‡æ¨¡å‹çŸ©é˜µè¿›è¡Œä½ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ï¼Œå°†ç‰©ä½“ä»å±€éƒ¨å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ï¼Œå¹¶å’Œå…¶ä»–ç‰©ä½“ä¸€èµ·ç›¸å¯¹äºä¸–ç•Œçš„åŸç‚¹æ‘†æ”¾ã€‚</li><li><strong>3. è§‚å¯Ÿåæ ‡</strong><br>å°†ä¸–ç•Œç©ºé—´åæ ‡è½¬åŒ–ä¸ºç”¨æˆ·è§†é‡å‰æ–¹çš„åæ ‡ï¼Œé€šå¸¸æ˜¯ç”±ä¸€ç³»åˆ—çš„ä½ç§»å’Œæ—‹è½¬çš„ç»„åˆï¼ˆè§‚å¯ŸçŸ©é˜µï¼‰æ¥å®Œæˆã€‚</li><li><strong>4. è£å‰ªåæ ‡</strong><br>åæ ‡åˆ°è¾¾è§‚å¯Ÿç©ºé—´ä¹‹åï¼Œé€šè¿‡æŠ•å½±çŸ©é˜µä¼šå°†æŒ‡å®šèŒƒå›´å†…çš„åæ ‡å˜æ¢ä¸ºæ ‡å‡†åŒ–è®¾å¤‡åæ ‡çš„èŒƒå›´(-1.0, 1.0)ï¼Œæ‰€æœ‰åœ¨èŒƒå›´å¤–çš„åæ ‡ä¼šè¢«è£å‰ªæ‰ã€‚</li><li><strong>5. å±å¹•åæ ‡</strong><br>å°†è£å‰ªåæ ‡ä½äº(-1.0, 1.0)èŒƒå›´çš„åæ ‡å˜æ¢åˆ°ç”± glViewport å‡½æ•°æ‰€å®šä¹‰çš„åæ ‡èŒƒå›´å†…ï¼Œæœ€åå˜æ¢å‡ºæ¥çš„åæ ‡å°†ä¼šé€åˆ°å…‰æ …å™¨ï¼Œå°†å…¶è½¬åŒ–ä¸ºç‰‡æ®µã€‚</li></ul><h1 id="OpenGL-æ¸²æŸ“ç®¡çº¿"><a href="#OpenGL-æ¸²æŸ“ç®¡çº¿" class="headerlink" title="OpenGL æ¸²æŸ“ç®¡çº¿"></a>OpenGL æ¸²æŸ“ç®¡çº¿</h1><p>OpenGL æ¸²æŸ“ç®¡çº¿æµç¨‹ä¸ºï¼šé¡¶ç‚¹æ•°æ® -&gt; é¡¶ç‚¹ç€è‰²å™¨ -&gt; å›¾å…ƒè£…é… -&gt; å‡ ä½•ç€è‰²å™¨ -&gt; å…‰æ …åŒ– -&gt; ç‰‡æ®µç€è‰²å™¨ -&gt; é€ç‰‡æ®µå¤„ç† -&gt; å¸§ç¼“å†² </p><p><img src="../img/16.jpg" alt></p><p>OpenGL æ¸²æŸ“ç®¡çº¿çš„æµç¨‹å…¶å®å°±æ˜¯ OpenGL å¼•æ“æ¸²æŸ“å›¾åƒçš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ OpenGL å¼•æ“ä¸€æ­¥ä¸€æ­¥çš„å°†å›¾ç‰‡æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„è¿‡ç¨‹ï¼Œæ¸²æŸ“ç®¡çº¿å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><ul><li><p><strong>1. æŒ‡å®šå‡ ä½•å¯¹è±¡</strong><br>é¦–å…ˆè¦äº†è§£å‡ ä½•å›¾å…ƒçš„æ¦‚å¿µï¼Œå‡ ä½•å›¾å…ƒå°±æ˜¯ç‚¹ã€ç›´çº¿ã€ä¸‰è§’çº¿ç­‰å‡ ä½•å¯¹è±¡ï¼Œåœ¨æä¾›äº†é¡¶ç‚¹åæ ‡åï¼Œè¿˜è¦ç¡®å®šå…·ä½“è¦ç”»çš„æ˜¯ç‚¹ã€çº¿æ®µè¿˜æ˜¯ä¸‰è§’å½¢ï¼Œè¿™å°±è¦ç¡®å®šå…·ä½“æ‰§è¡Œçš„ç»˜åˆ¶æŒ‡ä»¤ã€‚æ¯”å¦‚ OpenGL æä¾›ç»™å¼€å‘è€…çš„ç»˜åˆ¶æ–¹æ³• glDrawArraysï¼Œè¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æŒ‡å®šç»˜åˆ¶æ–¹å¼ï¼Œå¯é€‰å€¼æœ‰ï¼š<br><strong>GL_POINTS</strong>ï¼šä»¥ç‚¹çš„å½¢å¼è¿›è¡Œç»˜åˆ¶ï¼Œé€šå¸¸ç”¨åœ¨ç»˜åˆ¶ç²’å­æ•ˆæœçš„åœºæ™¯ã€‚<br><strong>GL_LINES</strong>ï¼šä»¥çº¿çš„å½¢å¼è¿›è¡Œç»˜åˆ¶ï¼Œé€šå¸¸ç”¨äºç»˜åˆ¶ç›´çº¿çš„åœºæ™¯ã€‚<br><strong>GL_TRIANGLE_STRIP</strong>ï¼šä»¥ä¸‰è§’å½¢çš„å½¢å¼è¿›è¡Œç»˜åˆ¶ï¼Œæ‰€æœ‰äºŒç»´å›¾åƒçš„æ¸²æŸ“éƒ½ä¼šä½¿ç”¨è¿™ç§æ–¹å¼ã€‚<br>å…·ä½“é€‰ç”¨å“ªä¸€ç§ç»˜åˆ¶æ–¹å¼å†³å®šäº† OpenGL æ¸²æŸ“ç®¡çº¿çš„ç¬¬ä¸€é˜¶æ®µåº”å¦‚ä½•å»ç»˜åˆ¶å‡ ä½•å›¾å…ƒï¼Œè¿™å°±æ˜¯ç¬¬ä¸€é˜¶æ®µæŒ‡å®šå‡ ä½•å¯¹è±¡ã€‚</p></li><li><p><strong>2. é¡¶ç‚¹å¤„ç†</strong><br>ä¸è®ºä¸Šé¢çš„å‡ ä½•å›¾å…ƒæ˜¯å¦‚ä½•æŒ‡å®šçš„ï¼Œæ‰€æœ‰çš„å‡ ä½•æ•°æ®éƒ½å°†ä¼šé€šè¿‡è¿™ä¸ªé˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µçš„æ“ä½œå†…å®¹æœ‰ï¼šæ ¹æ®æ¨¡å‹è§†å›¾ï¼ˆå³æ ¹æ®å‡ ä½•å›¾å…ƒåˆ›å»ºçš„ç‰©ä½“ï¼‰å’ŒæŠ•å½±çŸ©é˜µè¿›è¡Œå˜æ¢æ¥æ”¹å˜é¡¶ç‚¹çš„ä½ç½®ï¼Œæ ¹æ®çº¹ç†åæ ‡ä¸çº¹ç†çŸ©é˜µæ¥æ”¹å˜çº¹ç†åæ ‡çš„ä½ç½®ï¼Œå¦‚æœè®¾è®¡ä¸‰ç»´çš„æ¸²æŸ“ï¼Œè¿˜è¦å¤„ç†å…‰ç…§è®¡ç®—å’Œæ³•çº¿å˜æ¢ã€‚<br>å…³é”®çš„æ“ä½œå°±æ˜¯é¡¶ç‚¹åæ ‡å˜æ¢åŠå…‰ç…§å¤„ç†ï¼Œæ¯ä¸ªé¡¶ç‚¹æ˜¯åˆ†åˆ«å•ç‹¬å¤„ç†çš„ã€‚è¿™ä¸ªé˜¶æ®µæ‰€æ¥å—çš„æ•°æ®æ˜¯æ¯ä¸ªé¡¶ç‚¹çš„å±æ€§ç‰¹å¾ï¼Œè¾“å‡ºçš„åˆ™æ˜¯å˜æ¢åçš„é¡¶ç‚¹æ•°æ®ã€‚</p></li><li><p><strong>3. å›¾å…ƒç»„è£…</strong><br>åœ¨é¡¶ç‚¹å¤„ç†ä¹‹åï¼Œé¡¶ç‚¹çš„å…¨éƒ¨å±æ€§éƒ½å·²ç»è¢«ç¡®å®šã€‚åœ¨è¿™ä¸ªé˜¶æ®µé¡¶ç‚¹å°†ä¼šæ ¹æ®åº”ç”¨ç¨‹åºè®¾å®šçš„å›¾å…ƒè§„åˆ™å¦‚ GL_POINTS ã€GL_TRIANGLES(ä¸‰è§’å½¢) ç­‰è¢«ç»„è£…æˆå›¾å…ƒã€‚</p></li><li><p><strong>4. çŠæ ¼åŒ–æ“ä½œ</strong><br>åœ¨å›¾å…ƒç»„è£…åä¼šä¼ é€’è¿‡æ¥å›¾å…ƒæ•°æ®ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™äº›å›¾å…ƒä¿¡æ¯è¿˜åªæ˜¯é¡¶ç‚¹è€Œå·²ï¼šé¡¶ç‚¹å¤„éƒ½è¿˜æ²¡æœ‰â€œåƒç´ ç‚¹â€ã€ç›´çº¿æ®µç«¯ç‚¹ä¹‹é—´æ˜¯ç©ºçš„ã€å¤šè¾¹å½¢çš„è¾¹å’Œå†…éƒ¨ä¹Ÿæ˜¯ç©ºçš„ï¼Œå…‰æ …åŒ–çš„ä»»åŠ¡å°±æ˜¯æ„é€ è¿™äº›ã€‚<br>è¿™ä¸ªé˜¶æ®µä¼šå°†å›¾å…ƒæ•°æ®åˆ†è§£æˆæ›´å°çš„å•å…ƒå¹¶å¯¹åº”äºå¸§ç¼“å†²åŒºçš„å„ä¸ªåƒç´ ï¼Œè¿™äº›å•å…ƒç§°ä¸ºç‰‡å…ƒï¼Œä¸€ä¸ªç‰‡å…ƒå¯èƒ½åŒ…å«çª—å£é¢œè‰²ã€çº¹ç†åæ ‡ç­‰å±æ€§ã€‚ç‰‡å…ƒçš„å±æ€§åˆ™æ˜¯å›¾å…ƒä¸Šçš„é¡¶ç‚¹æ•°æ®ç­‰ç»è¿‡æ’å€¼è€Œç¡®å®šçš„ï¼Œè¿™å°±æ˜¯çŠæ ¼åŒ–æ“ä½œï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå¥½æ¯ä¸€ä¸ªç‰‡å…ƒæ˜¯ä»€ä¹ˆã€‚</p></li><li><p><strong>5. ç‰‡å…ƒå¤„ç†</strong><br>çŠæ ¼åŒ–æ“ä½œæ„é€ äº†åƒç´ ç‚¹ï¼Œè¿™ä¸ªé˜¶æ®µå°±æ˜¯å¤„ç†è¿™äº›åƒç´ ç‚¹ï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡å¤„ç†ï¼ˆæ¯”å¦‚æäº®ã€é¥±å’Œåº¦è°ƒèŠ‚ã€å¯¹æ¯”åº¦è°ƒèŠ‚ã€é«˜æ–¯æ¨¡ç³Šç­‰ï¼‰æ¥å˜æ¢è¿™ä¸ªç‰‡å…ƒçš„é¢œè‰²ã€‚</p></li><li><p><strong>6. é€ç‰‡æ®µå¤„ç†</strong><br>è¿›è¡Œå‰ªåˆ‡ã€Alpha æµ‹è¯•ã€ æ¨¡ç‰ˆæµ‹è¯•ã€æ·±åº¦æµ‹è¯•ã€æ··åˆç­‰å¤„ç†ï¼Œè¿™äº›æ“ä½œå°†ä¼šæœ€åå½±å“å…¶åœ¨å¸§ç¼“å†²åŒºçš„é¢œè‰²å€¼ã€‚</p></li><li><p><strong>7. å¸§ç¼“å†²æ“ä½œ</strong><br>æ­¤é˜¶æ®µä¸»è¦æ‰§è¡Œå¸§ç¼“å†²çš„å†™å…¥æ“ä½œï¼Œä¹Ÿæ˜¯æ¸²æŸ“ç®¡çº¿çš„æœ€åä¸€æ­¥ï¼Œè´Ÿè´£å°†æœ€ç»ˆçš„åƒç´ ç‚¹å†™åˆ°å¸§ç¼“å†²åŒºã€‚</p></li></ul><p>ä¸Šé¢æåˆ° OpenGL ES 2.0 ç‰ˆæœ¬ç›¸æ¯”ä¹‹å‰ç‰ˆæœ¬ï¼Œæä¾›äº†å¯ç¼–ç¨‹çš„ç€è‰²å™¨æ¥ä»£æ›¿ 1.x ç‰ˆæœ¬æ¸²æŸ“ç®¡çº¿çš„æŸäº›é˜¶æ®µï¼Œå…·ä½“ä¸ºï¼š</p><ul><li>Vertex Shaderï¼ˆé¡¶ç‚¹ç€è‰²å™¨ï¼‰ç”¨äºæ›¿æ¢é¡¶ç‚¹å¤„ç†é˜¶æ®µ</li><li>Fragment Shaderï¼ˆç‰‡å…ƒç€è‰²å™¨ï¼‰ç”¨äºæ›¿æ¢ç‰‡å…ƒå¤„ç†é˜¶æ®µ</li></ul><h1 id="OpenGL-ç€è‰²è¯­è¨€"><a href="#OpenGL-ç€è‰²è¯­è¨€" class="headerlink" title="OpenGL ç€è‰²è¯­è¨€"></a>OpenGL ç€è‰²è¯­è¨€</h1><p>OpenGL ç€è‰²è¯­è¨€ GLSL å…¨ç§°ä¸º OpenGL Shading Languageï¼Œæ˜¯ä¸ºäº†å®ç°ç€è‰²å™¨çš„åŠŸèƒ½è€Œå‘å¼€å‘äººå‘˜æä¾›çš„ä¸€ç§å¼€å‘è¯­è¨€ï¼Œè¯­æ³•ä¸ C è¯­è¨€ç±»ä¼¼ï¼Œä¸‹é¢åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹æ¥å­¦ä¹  GLSLï¼š</p><ul><li><strong>1. åŸºæœ¬æ•°æ®ç±»å‹</strong></li></ul><blockquote><p>voidï¼šç©ºç±»å‹ï¼Œå³ä¸è¿”å›ä»»ä½•å€¼<br>boolï¼šå¸ƒå°”ç±»å‹ï¼Œtrue/false<br>intï¼šå¸¦ç¬¦å·çš„æ•´æ•°ï¼Œsigned integer<br>floatï¼šå¸¦ç¬¦å·çš„æµ®ç‚¹æ•°ï¼Œsigned scalar<br>vec2ã€vec3ã€vec4ï¼šn-ç»´æµ®ç‚¹æ•°å‘é‡<br>bvec2ã€bvec3ã€bvec4ï¼šn-ç»´å¸ƒå°”å‘é‡<br>ivec2ã€ivec3ã€ivec4ï¼šn-ç»´æ•´æ•°å‘é‡<br>mat2ã€mat3ã€mat4ï¼š2x2ã€3x3ã€4x4 æµ®ç‚¹æ•°çŸ©é˜µ<br>sampler2Dï¼š2D çº¹ç†<br>samplerCubeï¼šç›’çº¹ç†</p></blockquote><p>å…¶ä¸­ float å¯æŒ‡å®šç²¾åº¦ï¼š</p><blockquote><p>highï¼š32bitï¼Œä¸€èˆ¬ç”¨äºé¡¶ç‚¹åæ ‡ï¼ˆvertex Coordinateï¼‰<br>mediumï¼š16bitï¼Œä¸€èˆ¬ç”¨äºçº¹ç†åæ ‡ï¼ˆtexture Coordinateï¼‰<br>lowï¼š8bitï¼Œä¸€èˆ¬ç”¨äºé¢œè‰²è¡¨ç¤ºï¼ˆcolorï¼‰</p></blockquote><ul><li><strong>2. å˜é‡ä¿®é¥°ç¬¦</strong></li></ul><blockquote><p>noneï¼š(é»˜è®¤çš„å¯çœç•¥)æœ¬åœ°å˜é‡ï¼Œå¯è¯»å¯å†™ï¼Œå‡½æ•°çš„è¾“å…¥å‚æ•°æ—¢æ˜¯è¿™ç§ç±»å‹<br>constï¼šå£°æ˜å˜é‡æˆ–å‡½æ•°çš„å‚æ•°ä¸ºåªè¯»ç±»å‹<br>attributeï¼šç”¨äºä¿å­˜é¡¶ç‚¹æˆ–æ³•çº¿æ•°æ®,å®ƒå¯ä»¥åœ¨æ•°æ®ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œä»…èƒ½ç”¨äºé¡¶ç‚¹ç€è‰²å™¨<br>uniformï¼šåœ¨è¿è¡Œæ—¶ shader æ— æ³•æ”¹å˜ uniform å˜é‡ï¼Œä¸€èˆ¬ç”¨æ¥æ”¾ç½®ç¨‹åºä¼ é€’ç»™ shader çš„å˜æ¢çŸ©é˜µï¼Œæè´¨ï¼Œå…‰ç…§å‚æ•°ç­‰ç­‰ï¼Œå¯ç”¨äºé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨<br>varyingï¼šç”¨äºä¿®é¥°ä»é¡¶ç‚¹ç€è‰²å™¨å‘ç‰‡å…ƒç€è‰²å™¨ä¼ é€’çš„å˜é‡</p></blockquote><p>è¦æ³¨æ„å…¨å±€å˜é‡é™åˆ¶ç¬¦åªèƒ½ä¸º constã€attributeã€uniform å’Œ varying ä¸­çš„æŸä¸€ä¸ªï¼Œä¸å¯å¤åˆã€‚</p><ul><li><strong>3. å†…ç½®å˜é‡</strong></li></ul><p>GLSL ç¨‹åºä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„å†…ç½®å˜é‡ä¸ç¡¬ä»¶è¿›è¡Œæ²Ÿé€šï¼Œä»–ä»¬å¤§è‡´åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯ input ç±»å‹,ä»–è´Ÿè´£å‘ç¡¬ä»¶(æ¸²æŸ“ç®¡çº¿)å‘é€æ•°æ®ï¼›å¦ä¸€ç§æ˜¯ output ç±»å‹ï¼Œè´Ÿè´£å‘ç¨‹åºå›ä¼ æ•°æ®ï¼Œä»¥ä¾¿ç¼–ç¨‹æ—¶éœ€è¦ã€‚<br>é¡¶ç‚¹ç€è‰²å™¨ä¸­ output ç±»å‹çš„å†…ç½®å˜é‡å¦‚ä¸‹ï¼š</p><blockquote><p>highp vec4  gl_Positionï¼šæ”¾ç½®é¡¶ç‚¹åæ ‡ä¿¡æ¯<br>mediump float gl_PointSizeï¼šéœ€è¦ç»˜åˆ¶ç‚¹çš„å¤§å°,(åªåœ¨gl.POINTSæ¨¡å¼ä¸‹æœ‰æ•ˆ)</p></blockquote><p>ç‰‡å…ƒç€è‰²å™¨ä¸­ input ç±»å‹çš„å†…ç½®å˜é‡å¦‚ä¸‹ï¼š</p><blockquote><p>mediump vec4 gl_FragCoord;ï¼šç‰‡å…ƒåœ¨ framebuffer ç”»é¢çš„ç›¸å¯¹ä½ç½®<br>bool gl_FrontFacingï¼šæ ‡å¿—å½“å‰å›¾å…ƒæ˜¯ä¸æ˜¯æ­£é¢å›¾å…ƒçš„ä¸€éƒ¨åˆ†<br>mediump vec2 gl_PointCoordï¼šç»è¿‡æ’å€¼è®¡ç®—åçš„çº¹ç†åæ ‡,ç‚¹çš„èŒƒå›´æ˜¯0.0åˆ°1.0</p></blockquote><p>ç‰‡å…ƒç€è‰²å™¨ä¸­ output ç±»å‹çš„å†…ç½®å˜é‡å¦‚ä¸‹ï¼š</p><blockquote><p>mediump vec4 gl_FragColorï¼šè®¾ç½®å½“å‰ç‰‡ç‚¹çš„é¢œè‰²<br>mediump vec4 gl_FragData[n]ï¼šè®¾ç½®å½“å‰ç‰‡ç‚¹çš„é¢œè‰²,ä½¿ç”¨glDrawBuffersæ•°æ®æ•°ç»„</p></blockquote><ul><li><strong>4. å†…ç½®å¸¸é‡</strong></li></ul><p>GLSL æä¾›äº†ä¸€äº›å†…ç½®çš„å¸¸é‡ï¼Œç”¨æ¥è¯´æ˜å½“å‰ç³»ç»Ÿçš„ä¸€äº›ç‰¹æ€§ã€‚æœ‰æ—¶æˆ‘ä»¬éœ€è¦é’ˆå¯¹è¿™äº›ç‰¹æ€§ï¼Œå¯¹ shader ç¨‹åºè¿›è¡Œä¼˜åŒ–ï¼Œè®©ç¨‹åºå…¼å®¹åº¦æ›´å¥½ã€‚</p><p>é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„å†…ç½®å¸¸é‡å¦‚ä¸‹ï¼š</p><blockquote><p>const mediump int gl_MaxVertexAttribs &gt;= 8ï¼šé¡¶ç‚¹ç€è‰²å™¨ä¸­å¯ç”¨çš„æœ€å¤§ attributes æ•°<br>const mediump int gl_MaxVertexUniformVectors &gt;= 128ï¼šé¡¶ç‚¹ç€è‰²å™¨ä¸­å¯ç”¨çš„æœ€å¤§ uniform vectors æ•°<br>const mediump int gl_MaxVaryingVectors &gt;= 8ï¼šé¡¶ç‚¹ç€è‰²å™¨ä¸­å¯ç”¨çš„æœ€å¤§ varying vectors æ•°<br>const mediump int gl_MaxVertexTextureImageUnits &gt;= 0ï¼šé¡¶ç‚¹ç€è‰²å™¨ä¸­å¯ç”¨çš„æœ€å¤§çº¹ç†å•å…ƒæ•°<br>const mediump int gl_MaxCombinedTextureImageUnits &gt;= 8ï¼šè¡¨ç¤ºæœ€å¤šæ”¯æŒå¤šå°‘ä¸ªçº¹ç†å•å…ƒ</p></blockquote><p>ç‰‡å…ƒç€è‰²å™¨ä¸­çš„å†…ç½®å¸¸é‡å¦‚ä¸‹ï¼š</p><blockquote><p>const mediump int gl_MaxTextureImageUnits &gt;= 8ï¼šç‰‡å…ƒç€è‰²å™¨ä¸­èƒ½è®¿é—®çš„æœ€å¤§çº¹ç†å•å…ƒæ•°<br>const mediump int gl_MaxFragmentUniformVectors &gt;= 16ï¼šç‰‡å…ƒç€è‰²å™¨ä¸­å¯ç”¨çš„æœ€å¤§ uniform vectors æ•°<br>const mediump int gl_MaxDrawBuffers = 1ï¼šè¡¨ç¤ºå¯ç”¨çš„ drawBuffers æ•°,åœ¨ OpenGL ES 2.0 ä¸­è¿™ä¸ªå€¼ä¸º 1, åœ¨å°†æ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰æ‰€å˜åŒ–</p></blockquote><p>ä¸Šé¢è¿™äº›å€¼çš„å¤§å°å–å†³äº OpenGL ES åœ¨æŸè®¾å¤‡ä¸Šçš„å…·ä½“å®ç°ã€‚</p><ul><li><strong>5. å†…ç½®å‡½æ•°</strong></li></ul><blockquote><p>é€šç”¨å‡½æ•°ï¼šabsã€floorã€minã€max ç­‰ï¼Œå‚æ•°å¯ä¼ å…¥ float/vec2/vec3/vec4 ç±»å‹<br>è§’åº¦å‡½æ•°ï¼šsinã€cos ç­‰ï¼Œå‚æ•°å¯ä¼ å…¥ float/vec2/vec3/vec4 ç±»å‹<br>æŒ‡æ•°å‡½æ•°ï¼špowã€log ç­‰ï¼Œå‚æ•°å¯ä¼ å…¥ float/vec2/vec3/vec4 ç±»å‹<br>å‡ ä½•å‡½æ•°ï¼šdistanceã€dot ç­‰ï¼Œå‚æ•°å¯ä¼ å…¥ float/vec2/vec3/vec4 ç±»å‹<br>çŸ©é˜µå‡½æ•°ï¼šmatrixCompMultï¼Œå‚æ•°ä¼ å…¥ mat ç±»å‹<br>å‘é‡å‡½æ•°ï¼šlessThanã€equal ç­‰ï¼Œå‚æ•°å¯ä¼ å…¥ vec2/vec3/vec4 ç±»å‹<br>çº¹ç†å‡½æ•°ï¼štexture2Dã€texture2DProj ç­‰</p></blockquote><p>æ›´è¯¦ç»†çš„å†…ç½®å‡½æ•°ä»‹ç»å¯å»å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ï¼Œåœ¨æ­¤åªç®€å•åˆ—ä¸€ä¸‹å¤§è‡´ç§ç±»ã€‚</p><h5 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h5><p><a href="https://item.jd.com/12292642.html" target="_blank" rel="noopener">ã€ŠéŸ³è§†é¢‘å¼€å‘è¿›é˜¶æŒ‡å— - åŸºäºAndroidä¸IOSå¹³å°çš„å®è·µã€‹</a><br><a href="https://baike.baidu.com/item/OpenGL/238984?fr=aladdin" target="_blank" rel="noopener">OpenGL ç™¾åº¦ç™¾ç§‘</a><br><a href="https://blog.csdn.net/qq_36383623/article/details/89315921" target="_blank" rel="noopener">OpenGL Contextï¼ˆæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼‰</a><br><a href="https://baike.baidu.com/item/OpenGL%20ES" target="_blank" rel="noopener">OpenGL ES ç™¾åº¦ç™¾ç§‘</a><br><a href="https://blog.csdn.net/weixin_41101173/article/details/80036809" target="_blank" rel="noopener">åœ¨Androidä¸­ä½¿ç”¨OpenGL ESè¿›è¡Œå¼€å‘ç¬¬ï¼ˆä¸€ï¼‰èŠ‚ï¼šæ¦‚å¿µå…ˆè¡Œ</a><br><a href="https://blog.csdn.net/jackie03/article/details/7298682" target="_blank" rel="noopener">Android OpenGL ESï¼ˆå››ï¼‰:å…³äºEGL</a><br><a href="https://blog.csdn.net/qq_35370018/article/details/80156643" target="_blank" rel="noopener">åˆå­¦OpenGLï¼ˆ4ï¼‰ï¼šçº¹ç†</a><br><a href="https://blog.csdn.net/u011153817/article/details/51899091" target="_blank" rel="noopener">OpenGLå„åæ ‡ç³»åŠæ¨¡å‹çŸ©é˜µã€æŠ•å½±çŸ©é˜µç­‰çš„æ·±å…¥ç†è§£</a><br><a href="https://www.cnblogs.com/liangliangh/p/4116164.html" target="_blank" rel="noopener">OpenGLç®¡çº¿ï¼ˆç”¨ç»å…¸ç®¡çº¿ä»£è¯´ç€è‰²å™¨å†…éƒ¨ï¼‰</a><br><a href="https://blog.csdn.net/jeffasd/article/details/77989274" target="_blank" rel="noopener">OpenGL shader GLSL ä¸­æ–‡æ‰‹å†Œ</a><br><a href="https://learnopengl-cn.github.io/01%20Getting%20started/08%20Coordinate%20Systems/" target="_blank" rel="noopener">åæ ‡ç³»ç»Ÿ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ—©å°±å¬è¿‡å¤§åé¼é¼çš„ OpenGLï¼Œå´è¿Ÿè¿Ÿæ²¡æœ‰å®è·µå­¦ä¹ ï¼Œæœ‰äº›æƒ­æ„§ã€‚ä»Šå¤©å¼€å§‹é€šè¿‡å®è·µ+åšæ–‡æ–¹å¼å­¦ä¹ æŒæ¡ OpenGLã€‚æ­¤æ–‡å¯¹äº OpenGL çš„å­¦ä¹ åˆ†ä¸ºä»¥ä¸‹éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenGL åŸºç¡€æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;OpenGL åæ ‡ç³»ç†è§£&lt;/li&gt;
&lt;li&gt;OpenGL æ¸²æŸ“ç®¡çº¿&lt;/li&gt;
&lt;li&gt;OpenGL ç€è‰²è¯­è¨€&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="OpenGL" scheme="http://yhaowa.gitee.io/categories/OpenGL/"/>
    
    
      <category term="OpenGL" scheme="http://yhaowa.gitee.io/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>Android çŸ¥è¯†ç®€è®°</title>
    <link href="http://yhaowa.gitee.io/c75061d/"/>
    <id>http://yhaowa.gitee.io/c75061d/</id>
    <published>2019-06-01T12:42:37.000Z</published>
    <updated>2020-03-14T10:22:13.293Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h3><blockquote><ul><li>1.ç½‘ç»œ&amp;ç®—æ³•&amp;æ•°æ®ç»“æ„</li><li>2.Java åŸºç¡€&amp;å®¹å™¨&amp;åŒæ­¥&amp;è®¾è®¡æ¨¡å¼</li><li>3.Java è™šæ‹Ÿæœº&amp;å†…å­˜ç»“æ„&amp;GC&amp;ç±»åŠ è½½&amp;å››ç§å¼•ç”¨&amp;åŠ¨æ€ä»£ç†</li><li>4.Android åŸºç¡€&amp;æ€§èƒ½ä¼˜åŒ–&amp;Framwork</li><li>5.Android æ¨¡å—åŒ–&amp;çƒ­ä¿®å¤&amp;çƒ­æ›´æ–°&amp;æ‰“åŒ…&amp;æ··æ·†&amp;å‹ç¼©&amp;AOP</li><li>6.JNI&amp;éŸ³è§†é¢‘&amp;FFmpeg&amp;æ’­æ”¾å™¨</li><li>7.AndroidStudio&amp;Lint&amp;gradle&amp;maven&amp;CI&amp;CD</li></ul></blockquote><a id="more"></a><h1 id="1-ç½‘ç»œ-amp-ç®—æ³•-amp-æ•°æ®ç»“æ„"><a href="#1-ç½‘ç»œ-amp-ç®—æ³•-amp-æ•°æ®ç»“æ„" class="headerlink" title="1.ç½‘ç»œ&amp;ç®—æ³•&amp;æ•°æ®ç»“æ„"></a>1.ç½‘ç»œ&amp;ç®—æ³•&amp;æ•°æ®ç»“æ„</h1><h4 id="ç½‘ç»œåè®®æ¨¡å‹"><a href="#ç½‘ç»œåè®®æ¨¡å‹" class="headerlink" title="ç½‘ç»œåè®®æ¨¡å‹"></a>ç½‘ç»œåè®®æ¨¡å‹</h4><ul><li>åº”ç”¨å±‚ï¼šè´Ÿè´£å¤„ç†ç‰¹å®šçš„åº”ç”¨ç¨‹åºç»†èŠ‚ï¼Œå¦‚ HTTPã€FTPã€DNS</li><li>è¿è¾“å±‚ï¼šä¸ºä¸¤å°ä¸»æœºæä¾›ç«¯åˆ°ç«¯çš„åŸºç¡€é€šä¿¡ï¼Œå¦‚ TCPã€UDP</li><li>ç½‘ç»œå±‚ï¼šæ§åˆ¶åˆ†ç»„ä¼ è¾“ã€è·¯ç”±é€‰æ‹©ç­‰ï¼Œå¦‚ IP</li><li>é“¾è·¯å±‚ï¼šæ“ä½œç³»ç»Ÿè®¾å¤‡é©±åŠ¨ç¨‹åºã€ç½‘å¡ç›¸å…³æ¥å£</li></ul><h4 id="TCP-å’Œ-UDP-åŒºåˆ«"><a href="#TCP-å’Œ-UDP-åŒºåˆ«" class="headerlink" title="TCP å’Œ UDP åŒºåˆ«"></a>TCP å’Œ UDP åŒºåˆ«</h4><ul><li>TCP è¿æ¥ï¼›å¯é ï¼›æœ‰åºï¼›é¢å‘å­—èŠ‚æµï¼›é€Ÿåº¦æ…¢ï¼›è¾ƒé‡é‡ï¼›å…¨åŒå·¥ï¼›é€‚ç”¨äºæ–‡ä»¶ä¼ è¾“ã€æµè§ˆå™¨ç­‰<br>å…¨åŒå·¥ï¼šA ç»™ B å‘æ¶ˆæ¯çš„åŒæ—¶ï¼ŒB ä¹Ÿèƒ½ç»™ A å‘<br>åŠåŒå·¥ï¼šA ç»™ B å‘æ¶ˆæ¯çš„åŒæ—¶ï¼ŒB ä¸èƒ½ç»™ A å‘</li><li>UDP æ— è¿æ¥ï¼›ä¸å¯é ï¼›æ— åºï¼›é¢å‘æŠ¥æ–‡ï¼›é€Ÿåº¦å¿«ï¼›è½»é‡ï¼›é€‚ç”¨äºå³æ—¶é€šè®¯ã€è§†é¢‘é€šè¯ç­‰</li></ul><h4 id="TCP-ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCP-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCP ä¸‰æ¬¡æ¡æ‰‹"></a>TCP ä¸‰æ¬¡æ¡æ‰‹</h4><ol><li>Aï¼šä½ èƒ½å¬åˆ°å—ï¼Ÿ</li><li>Bï¼šæˆ‘èƒ½å¬åˆ°ï¼Œä½ èƒ½å¬åˆ°å—ï¼Ÿ</li><li>Aï¼šæˆ‘èƒ½å¬åˆ°ï¼Œå¼€å§‹å§</li></ol><ul><li>A å’Œ B ä¸¤æ–¹éƒ½è¦èƒ½ç¡®ä¿ï¼šæˆ‘è¯´çš„è¯ï¼Œä½ èƒ½å¬åˆ°ï¼›ä½ è¯´çš„è¯ï¼Œæˆ‘èƒ½å¬åˆ°ã€‚æ‰€ä»¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹</li></ul><h4 id="TCP-å››æ¬¡æŒ¥æ‰‹"><a href="#TCP-å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCP å››æ¬¡æŒ¥æ‰‹"></a>TCP å››æ¬¡æŒ¥æ‰‹</h4><ol><li>Aï¼šæˆ‘è¯´å®Œäº†</li><li>Bï¼šæˆ‘çŸ¥é“äº†ï¼Œç­‰ä¸€ä¸‹ï¼Œæˆ‘å¯èƒ½è¿˜æ²¡è¯´å®Œ</li><li>Bï¼šæˆ‘ä¹Ÿè¯´å®Œäº†</li><li>Aï¼šæˆ‘çŸ¥é“äº†ï¼Œç»“æŸå§</li></ol><ul><li>B æ”¶åˆ° A ç»“æŸçš„æ¶ˆæ¯å B å¯èƒ½è¿˜æ²¡è¯´å®Œï¼Œæ²¡æ³•ç«‹å³å›å¤ç»“æŸæ ‡ç¤ºï¼Œåªèƒ½ç­‰è¯´å®Œåå†å‘Šè¯‰ A ï¼šæˆ‘è¯´å®Œäº†</li></ul><h4 id="POST-å’Œ-GET-åŒºåˆ«"><a href="#POST-å’Œ-GET-åŒºåˆ«" class="headerlink" title="POST å’Œ GET åŒºåˆ«"></a>POST å’Œ GET åŒºåˆ«</h4><ul><li>Get å‚æ•°æ”¾åœ¨ url ä¸­ï¼›Post å‚æ•°æ”¾åœ¨ request Body ä¸­</li><li>Get å¯èƒ½ä¸å®‰å…¨ï¼Œå› ä¸ºå‚æ•°æ”¾åœ¨ url ä¸­</li></ul><h4 id="HTTP-è¯·æ±‚è¿‡ç¨‹"><a href="#HTTP-è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="HTTP è¯·æ±‚è¿‡ç¨‹"></a>HTTP è¯·æ±‚è¿‡ç¨‹</h4><ol><li>DNS åŸŸåè§£æ</li><li>TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</li><li>å‘èµ· HTTP è¯·æ±‚</li></ol><h4 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h4><ul><li>HTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜æ–‡ä¼ è¾“ï¼›HTTPS ä½¿ç”¨ SSL åè®®å¯¹ HTTP ä¼ è¾“æ•°æ®è¿›è¡Œäº†åŠ å¯†</li><li>HTTP é»˜è®¤ 80 ç«¯å£ï¼›HTTPS é»˜è®¤ 443 ç«¯å£</li><li>ä¼˜ç‚¹ï¼šå®‰å…¨</li><li>ç¼ºç‚¹ï¼šè´¹æ—¶ã€SSL è¯ä¹¦æ”¶è´¹ï¼ŒåŠ å¯†èƒ½åŠ›è¿˜æ˜¯æœ‰é™çš„ï¼Œä½†æ˜¯æ¯” HTTP å¼ºå¤šäº†</li><li>åŠ å¯†è¿‡ç¨‹ï¼š</li></ul><h4 id="å¹³è¡¡äºŒå‰æ ‘ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€çº¢é»‘æ ‘"><a href="#å¹³è¡¡äºŒå‰æ ‘ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€çº¢é»‘æ ‘" class="headerlink" title="å¹³è¡¡äºŒå‰æ ‘ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€çº¢é»‘æ ‘"></a>å¹³è¡¡äºŒå‰æ ‘ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€çº¢é»‘æ ‘</h4><h1 id="2-Java-åŸºç¡€-amp-å®¹å™¨-amp-åŒæ­¥-amp-è®¾è®¡æ¨¡å¼"><a href="#2-Java-åŸºç¡€-amp-å®¹å™¨-amp-åŒæ­¥-amp-è®¾è®¡æ¨¡å¼" class="headerlink" title="2.Java åŸºç¡€&amp;å®¹å™¨&amp;åŒæ­¥&amp;è®¾è®¡æ¨¡å¼"></a>2.Java åŸºç¡€&amp;å®¹å™¨&amp;åŒæ­¥&amp;è®¾è®¡æ¨¡å¼</h1><h4 id="StringBuilderã€StringBufferã€-ã€String-concat-é“¾æ¥å­—ç¬¦ä¸²ï¼š"><a href="#StringBuilderã€StringBufferã€-ã€String-concat-é“¾æ¥å­—ç¬¦ä¸²ï¼š" class="headerlink" title="StringBuilderã€StringBufferã€+ã€String.concat é“¾æ¥å­—ç¬¦ä¸²ï¼š"></a>StringBuilderã€StringBufferã€+ã€String.concat é“¾æ¥å­—ç¬¦ä¸²ï¼š</h4><ul><li>StringBuffer çº¿ç¨‹å®‰å…¨ï¼ŒStringBuilder çº¿ç¨‹ä¸å®‰å…¨</li><li>+å®é™…ä¸Šæ˜¯ç”¨ StringBuilder æ¥å®ç°çš„ï¼Œæ‰€ä»¥éå¾ªç¯ä½“å¯ä»¥ç›´æ¥ç”¨ +ï¼Œå¾ªç¯ä½“ä¸è¡Œï¼Œå› ä¸ºä¼šé¢‘ç¹åˆ›å»º StringBuilder</li><li>String.concat å®è´¨æ˜¯ new String ï¼Œæ•ˆç‡ä¹Ÿä½ï¼Œè€—æ—¶æ’åºï¼šStringBuilder &lt; StringBuffer &lt; concat &lt; +</li></ul><h4 id="Java-æ³›å‹æ“¦é™¤"><a href="#Java-æ³›å‹æ“¦é™¤" class="headerlink" title="Java æ³›å‹æ“¦é™¤"></a>Java æ³›å‹æ“¦é™¤</h4><ul><li>ä¿®é¥°æˆå‘˜å˜é‡ç­‰ç±»ç»“æ„ç›¸å…³çš„æ³›å‹ä¸ä¼šè¢«æ“¦é™¤</li><li>å®¹å™¨ç±»æ³›å‹ä¼šè¢«æ“¦é™¤</li></ul><h4 id="Exception-å’Œ-Error"><a href="#Exception-å’Œ-Error" class="headerlink" title="Exception å’Œ Error"></a>Exception å’Œ Error</h4><ul><li>Exception å’Œ Error éƒ½ç»§æ‰¿è‡ª Throwable</li><li>Error å¤§éƒ¨åˆ†æ˜¯æŒ‡ä¸å¯æ¢å¤çš„é”™è¯¯çŠ¶æ€ï¼Œæ¯”å¦‚ OOMï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦æ•è·</li><li>Exception åˆ†ä¸º CheckedException å’Œ UnCheckedException<ul><li>CheckedExceptionï¼šå¿…é¡»æ˜¾å¼æ•è·ï¼Œå—ç¼–è¯‘å™¨æ£€æŸ¥ï¼Œæ¯”å¦‚ io æ“ä½œ</li><li>UnCheckedExceptionï¼šä¸ç”¨æ˜¾ç¤ºæ•è·ï¼Œæ¯”å¦‚ç©ºæŒ‡é’ˆã€æ•°ç»„è¶Šç•Œç­‰</li></ul></li></ul><h4 id="IO-ã€-NIOã€-OKIO"><a href="#IO-ã€-NIOã€-OKIO" class="headerlink" title="IO ã€ NIOã€ OKIO"></a>IO ã€ NIOã€ OKIO</h4><ul><li>IO æ˜¯é¢å‘æµçš„ï¼Œä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚çš„å¤„ç†ï¼ŒNIO æ˜¯é¢å‘ç¼“å†²åŒºçš„ï¼Œä¸€æ¬¡äº§ç”Ÿæˆ–æ¶ˆè´¹ä¸€ä¸ªæ•°æ®å—</li><li>IO æ˜¯é˜»å¡çš„ï¼ŒNIO æ˜¯éé˜»å¡çš„</li><li>NIO æ”¯æŒå†…å­˜æ˜ å°„æ–¹å¼</li><li>okio ç›¸æ¯” io å’Œ nioï¼Œapi æ›´ç®€å•æ˜“ç”¨</li><li>okio æ”¯æŒè¶…æ—¶æœºåˆ¶</li><li>okio å¼•å…¥ ByteString ç©ºé—´æ¢æ—¶é—´æé«˜æ€§èƒ½</li><li>okio é‡‡ç”¨ segment æœºåˆ¶è¿›è¡Œå†…å­˜å…±äº«ï¼ŒèŠ‚çœ copy æ—¶é—´æ¶ˆè€—</li></ul><h4 id="ArrayListã€LinkedList"><a href="#ArrayListã€LinkedList" class="headerlink" title="ArrayListã€LinkedList"></a>ArrayListã€LinkedList</h4><ul><li><p>ArrayList</p><ul><li>åŸºäºæ•°ç»„å®ç°ï¼ŒæŸ¥æ‰¾å¿«ï¼šo(1)ï¼Œå¢åˆ æ…¢ï¼šo(n)</li><li>åˆå§‹å®¹é‡ä¸º10ï¼Œæ‰©å®¹é€šè¿‡ System.arrayCopy æ–¹æ³•</li></ul></li><li><p>LinkedList</p><ul><li>åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼ŒæŸ¥æ‰¾æ…¢ï¼šo(n)ï¼Œå¢åˆ å¿«ï¼šo(1)</li><li>å°è£…äº†é˜Ÿåˆ—å’Œæ ˆçš„è°ƒç”¨</li></ul></li></ul><h4 id="HashMap-ã€HashTableã€HashSet"><a href="#HashMap-ã€HashTableã€HashSet" class="headerlink" title="HashMap ã€HashTableã€HashSet"></a>HashMap ã€HashTableã€HashSet</h4><ul><li><p>HashMapï¼ˆå…è®¸ key/value ä¸º nullï¼‰</p><ul><li>åŸºäºæ•°ç»„å’Œå•å‘é“¾è¡¨å®ç°ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼›é“¾è¡¨æ˜¯ä¸ºè§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼Œå­˜æ”¾çš„æ˜¯keyå’Œvalueç»“åˆçš„å®ä½“</li><li>æ•°ç»„ç´¢å¼•é€šè¿‡ key.hashCodeï¼ˆè¿˜ä¼šäºŒæ¬¡ hashï¼‰ å¾—åˆ°ï¼Œåœ¨é“¾è¡¨ä¸Šé€šè¿‡ key.equals ç´¢å¼•</li><li>å“ˆå¸Œå†²çªè½åœ¨åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œç›´æ¥æ”¾åœ¨é“¾è¡¨å¤´éƒ¨ï¼ˆjava1.8åæ”¾åˆ°å°¾éƒ¨ï¼‰</li><li>JAVA 8 ä¸­é“¾è¡¨æ•°é‡å¤§äº 8 æ—¶ä¼šè½¬ä¸ºçº¢é»‘æ ‘å­˜å‚¨ï¼ŒæŸ¥æ‰¾æ—¶é—´ç”± O(n) å˜ä¸º O(logn)</li><li>æ•°ç»„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼šè¿™æ ·å°±èƒ½é€šè¿‡ä½è¿ç®—å®ç°å–ä½™ï¼Œä»è€Œè®© index èƒ½è½åœ¨æ•°ç»„é•¿åº¦èŒƒå›´å†…</li><li>åŠ è½½å› å­ï¼ˆé»˜è®¤0.75ï¼‰è¡¨ç¤ºæ·»åŠ åˆ°å¤šå°‘å¡«å……æ¯”æ—¶è¿›è¡Œæ‰©å®¹ï¼Œå¡«å……æ¯”å¤§ï¼šé“¾è¡¨è¾ƒé•¿ï¼ŒæŸ¥æ‰¾æ…¢ï¼›å¡«å……æ¯”å°ï¼šé“¾è¡¨çŸ­ï¼ŒæŸ¥æ‰¾å¿«</li><li>æ‰©å®¹æ—¶ç›´æ¥åˆ›å»ºåŸæ•°ç»„ä¸¤å€çš„é•¿åº¦ï¼Œç„¶åå°†åŸæœ‰å¯¹è±¡å†è¿›è¡Œhashæ‰¾åˆ°æ–°çš„indexï¼Œé‡æ–°æ”¾</li></ul></li><li><p>HashTableï¼ˆä¸å…è®¸ key/value ä¸º null)</p><ul><li>æ•°æ®ç»“æ„å’Œ HashMap ä¸€æ ·</li><li>çº¿ç¨‹å®‰å…¨</li></ul></li><li><p>HashSet</p><ul><li>åŸºäº HashMap å®ç°ï¼Œå…ƒç´ å°±æ˜¯ HashMap çš„ keyï¼ŒValue ä¼ å…¥äº†ä¸€ä¸ªå›ºå®šå€¼</li></ul></li></ul><h4 id="ArrayMapã€SparseArray"><a href="#ArrayMapã€SparseArray" class="headerlink" title="ArrayMapã€SparseArray"></a>ArrayMapã€SparseArray</h4><ul><li><p>ArrayMap</p><ul><li>åŸºäºä¸¤ä¸ªæ•°ç»„å®ç°ï¼Œä¸€ä¸ªå­˜æ”¾ hashï¼›ä¸€ä¸ªå­˜æ”¾é”®å€¼å¯¹</li><li>å­˜æ”¾ hash çš„æ•°ç»„æ˜¯æœ‰åºçš„ï¼ŒæŸ¥æ‰¾æ—¶ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾</li><li>å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶é”®å€¼å¯¹æ•°ç»„é‡Œè¿ç»­å­˜æ”¾ï¼ŒæŸ¥æ‰¾æ—¶ä¹Ÿæ˜¯é€šè¿‡ key.equalsç´¢å¼•ï¼Œæ‰¾ä¸åˆ°æ—¶å…ˆå‘åå†å‘å‰éå†ç›¸åŒhashå€¼çš„é”®å€¼å¯¹æ•°ç»„</li><li>æ‰©å®¹æ—¶ä¸åƒ HashMap ç›´æ¥ doubleï¼Œå†…å­˜åˆ©ç”¨ç‡é«˜ï¼›ä¹Ÿä¸éœ€è¦é‡å»ºå“ˆå¸Œè¡¨ï¼Œåªéœ€è¦è°ƒç”¨ system.arraycopy æ•°ç»„æ‹·è´ï¼Œæ€§èƒ½è¾ƒé«˜</li><li>ä¸é€‚åˆå­˜å¤§é‡æ•°æ®ï¼ˆ1000ä»¥ä¸‹ï¼‰ï¼Œå› ä¸ºæ•°æ®é‡å¤§çš„æ—¶å€™äºŒåˆ†æŸ¥æ‰¾ç›¸æ¯”çº¢é»‘æ ‘ä¼šæ…¢å¾ˆå¤š</li></ul></li><li><p>SparseArray</p><ul><li>åŸºäº ArrayMapï¼Œkey åªèƒ½æ˜¯ç‰¹å®šç±»å‹</li></ul></li></ul><h4 id="Concurrent-é›†åˆ"><a href="#Concurrent-é›†åˆ" class="headerlink" title="Concurrent é›†åˆ"></a>Concurrent é›†åˆ</h4><ul><li>ConcurrentHashMap<ul><li>æ•°æ®ç»“æ„è·Ÿ HashMap ä¸€æ ·ï¼Œè¿˜æ˜¯æ•°ç»„åŠ é“¾è¡¨</li><li>é‡‡ç”¨ segment åˆ†æ®µé”æŠ€æœ¯ï¼Œä¸åƒ HashTable æ— è„‘ç›´æ¥åŒæ­¥ put å’Œ get æ“ä½œ</li><li>get æ“ä½œæ²¡æœ‰åŠ é”ï¼Œå› ä¸º value ç”¨ volatile ä¿®é¥°æ¥ä¿è¯å¯è§è¡Œï¼Œæ€§èƒ½å¾ˆé«˜</li><li>java1.8 åå»é™¤åˆ†æ®µé”ï¼Œé‡‡ç”¨ CAS ä¹è§‚é”åŠ  synchronized æ¥å®ç°</li></ul></li></ul><h4 id="WeakHashMap-åŸç†"><a href="#WeakHashMap-åŸç†" class="headerlink" title="WeakHashMap åŸç†"></a>WeakHashMap åŸç†</h4><h4 id="LRUCache-åŸç†"><a href="#LRUCache-åŸç†" class="headerlink" title="LRUCache åŸç†"></a>LRUCache åŸç†</h4><ul><li>åŸºäºè®¿é—®é¡ºåºæ’åºçš„ LinkedHashMap å®ç°ï¼Œæœ€è¿‘è®¿é—®çš„ä¼šæ’åœ¨æœ€å</li></ul><h4 id="Volatile-å…³é”®å­—"><a href="#Volatile-å…³é”®å­—" class="headerlink" title="Volatile å…³é”®å­—"></a>Volatile å…³é”®å­—</h4><ul><li>åªèƒ½ç”¨æ¥ä¿®é¥°å˜é‡ï¼Œé€‚ç”¨ä¿®é¥°å¯èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è®¿é—®çš„å˜é‡</li><li>ç›¸å½“äºè½»é‡çº§çš„ synchronizedï¼Œvolatitle èƒ½ä¿è¯æœ‰åºæ€§ï¼ˆç¦ç”¨æŒ‡ä»¤é‡æ’åºï¼‰ã€å¯è§æ€§</li><li>å˜é‡ä½äºä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå˜é‡åœ¨è‡ªå·±çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­æœ‰ä»½æ‹·è´ï¼Œçº¿ç¨‹ç›´æ¥æ“ä½œçš„æ˜¯è¿™ä¸ªæ‹·è´</li><li>è¢« volatile ä¿®é¥°çš„å˜é‡æ”¹å˜åä¼šç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä¿æŒå˜é‡çš„å¯è§æ€§<blockquote><p>åŒé‡æ£€æŸ¥å•ä¾‹ï¼Œä¸ºä»€ä¹ˆè¦åŠ  violateï¼Ÿ<br>volatileæƒ³è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æƒ³è¦ä½¿ç”¨instanceï¼Œå‘ç°instance!=nullï¼Œä½†æ˜¯å®é™…ä¸Šinstanceè¿˜æœªåˆå§‹åŒ–å®Œæ¯•è¿™ä¸ªé—®é¢˜ã€‚å°†instance =newInstance();æ‹†åˆ†ä¸º3å¥è¯æ˜¯ã€‚1.åˆ†é…å†…å­˜2.åˆå§‹åŒ–3.å°†instanceæŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œvolatileå¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿å…ˆæ‰§è¡Œ2ï¼Œåæ‰§è¡Œ3</p></blockquote></li></ul><h4 id="wait-å’Œ-sleep"><a href="#wait-å’Œ-sleep" class="headerlink" title="wait å’Œ sleep"></a>wait å’Œ sleep</h4><ul><li>sleep æ˜¯ Thread çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨</li><li>wait æ˜¯ Object çš„æˆå‘˜æ–¹æ³•ï¼Œåªèƒ½åœ¨ synchronized ä»£ç å—ä¸­è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥ IllegalMonitorStateException éæ³•ç›‘æ§çŠ¶æ€å¼‚å¸¸</li><li>sleep ä¸ä¼šé‡Šæ”¾å…±äº«èµ„æºé”ï¼Œwait ä¼šé‡Šæ”¾å…±äº«èµ„æºé”</li></ul><h4 id="waitã€notifyã€notifyAll"><a href="#waitã€notifyã€notifyAll" class="headerlink" title="waitã€notifyã€notifyAll"></a>waitã€notifyã€notifyAll</h4><ul><li>é”æ± ï¼šæŸä¸ªå¯¹è±¡çš„é”å·²è¢«çº¿ç¨‹Aæ‹¥æœ‰ï¼Œå…¶ä»–çº¿ç¨‹è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„ synchronized æ–¹æ³•è·å–é”æ—¶å°±ä¼šè¿›å…¥è¯¥å¯¹è±¡çš„é”æ± ï¼Œé”æ± ä¸­çš„çº¿ç¨‹å›å»ç«äº‰è¯¥å¯¹è±¡çš„é”</li><li>ç­‰å¾…æ± ï¼šæŸä¸ªçº¿ç¨‹è°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„ wait æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œè¿›å…¥è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ï¼Œç­‰å¾…æ± ä¸­çš„çº¿ç¨‹ä¸ä¼šå»ç«äº‰è¯¥å¯¹è±¡çš„é”</li><li>è°ƒç”¨ notify ä¼šéšæœºå”¤é†’ç­‰å¾…æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå”¤é†’åä¼šè¿›å…¥åˆ°é”æ± </li><li>è°ƒç”¨ notifyAll ä¼šå”¤é†’ç­‰å¾…æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œå”¤é†’åä¼šéƒ½è¿›å…¥åˆ°é”æ± </li></ul><h4 id="lock-å’Œ-synchronized"><a href="#lock-å’Œ-synchronized" class="headerlink" title="lock å’Œ synchronized"></a>lock å’Œ synchronized</h4><ul><li>synchronized æ˜¯ Java å…³é”®å­—ï¼Œå†…ç½®ç‰¹æ€§ï¼›Lock æ˜¯ä¸€ä¸ªæ¥å£</li><li>synchronized ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼›lock éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥éœ€è¦å†™åˆ° try catch å—ä¸­å¹¶åœ¨ finally ä¸­é‡Šæ”¾é”</li><li>synchronized æ— æ³•ä¸­æ–­ç­‰å¾…é”ï¼›lock å¯ä»¥ä¸­æ–­</li><li>Lock å¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»/å†™æ“ä½œçš„æ•ˆç‡</li><li>ç«äº‰èµ„æºæ¿€çƒˆæ—¶ï¼Œlock çš„æ€§èƒ½ä¼šæ˜æ˜¾çš„ä¼˜äº synchronized</li></ul><h4 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h4><ul><li>å®šä¹‰ï¼šå·²ç»è·å–åˆ°é”åï¼Œå†æ¬¡è°ƒç”¨åŒæ­¥ä»£ç å—/å°è¯•è·å–é”æ—¶ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œç›¸å…³ä»£ç </li><li>ReentrantLock å’Œ synchronized éƒ½æ˜¯å¯é‡å…¥é”</li></ul><h4 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h4><ul><li>å®šä¹‰ï¼šç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ä¼šä¼˜å…ˆè·å¾—é”</li><li>éå…¬å¹³é”æ— æ³•ä¿è¯å“ªä¸ªçº¿ç¨‹è·å–åˆ°é”ï¼Œsynchronized å°±æ˜¯éå…¬å¹³é”</li><li>ReentrantLock é»˜è®¤æ—¶éå…¬å¹³é”ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”</li></ul><h4 id="ä¹è§‚é”å’Œæ‚²è§‚é”"><a href="#ä¹è§‚é”å’Œæ‚²è§‚é”" class="headerlink" title="ä¹è§‚é”å’Œæ‚²è§‚é”"></a>ä¹è§‚é”å’Œæ‚²è§‚é”</h4><ul><li>æ‚²è§‚é”ï¼šçº¿ç¨‹ä¸€æ—¦å¾—åˆ°é”ï¼Œå…¶ä»–çº¿ç¨‹å°±æŒ‚èµ·ç­‰å¾…ï¼Œé€‚ç”¨äºå†™å…¥æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼›synchronized å°±æ˜¯æ‚²è§‚é”<br>ä¹è§‚é”ï¼šå‡è®¾æ²¡æœ‰å†²çªï¼Œä¸åŠ é”ï¼Œæ›´æ–°æ•°æ®æ—¶åˆ¤æ–­è¯¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯åˆ™ä¸è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œé€‚ç”¨äºè¯»å–æ“ä½œé¢‘ç¹çš„åœºæ™¯</li><li>ä¹è§‚é” CASï¼šCompare And Swapï¼Œæ›´æ–°æ•°æ®æ—¶å…ˆæ¯”è¾ƒåŸå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰åˆ™è¡¨ç¤ºæ•°æ®è¿‡å»ï¼Œä¸è¿›è¡Œæ•°æ®æ›´æ–°</li><li>ä¹è§‚é”å®ç°ï¼šAtomicIntegerã€AtomicLongã€AtomicBoolean</li></ul><h4 id="æ­»é”-4-ä¸ªå¿…è¦æ¡ä»¶"><a href="#æ­»é”-4-ä¸ªå¿…è¦æ¡ä»¶" class="headerlink" title="æ­»é” 4 ä¸ªå¿…è¦æ¡ä»¶"></a>æ­»é” 4 ä¸ªå¿…è¦æ¡ä»¶</h4><ul><li>äº’æ–¥</li><li>å æœ‰ä¸”ç­‰å¾…</li><li>ä¸å¯æŠ¢å </li><li>å¾ªç¯ç­‰å¾…</li></ul><h4 id="Synchronized-åŸç†"><a href="#Synchronized-åŸç†" class="headerlink" title="Synchronized åŸç†"></a>Synchronized åŸç†</h4><ul><li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç›‘è§†å™¨é”ï¼šmonitorï¼ŒåŒæ­¥ä»£ç å—ä¼šæ‰§è¡Œ  monitorenter å¼€å§‹ï¼Œmotnitorexit ç»“æŸ </li><li>Wait/notify å°±ä¾èµ– monitor ç›‘è§†å™¨ï¼Œæ‰€ä»¥åœ¨éåŒæ­¥ä»£ç å—ä¸­æ‰§è¡Œä¼šæŠ¥ IllegalMonitorStateException å¼‚å¸¸</li></ul><h4 id="å…­å¤§åŸåˆ™ï¼ˆDJå•å¼€ä¸€é‡Œï¼‰"><a href="#å…­å¤§åŸåˆ™ï¼ˆDJå•å¼€ä¸€é‡Œï¼‰" class="headerlink" title="å…­å¤§åŸåˆ™ï¼ˆDJå•å¼€ä¸€é‡Œï¼‰"></a>å…­å¤§åŸåˆ™ï¼ˆDJå•å¼€ä¸€é‡Œï¼‰</h4><ul><li>å¼€é—­åŸåˆ™ï¼šå¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li><li>å•ä¸€æŒ‡è´£åŸåˆ™ï¼šä¸€ä¸ªç±»æŒ‡è´£å•ä¸€</li><li>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šå¼•ç”¨åŸºç±»çš„åœ°æ–¹éƒ½èƒ½æ›¿æ¢æˆå­ç±»å¯¹è±¡</li><li>ä¾èµ–å€’ç½®åŸåˆ™ï¼šé«˜å±‚æ¬¡æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¬¡æ¨¡å—çš„å…·ä½“å®ç°ï¼ŒæŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚</li><li>æ¥å£éš”ç¦»åŸåˆ™ï¼šç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š</li><li>è¿ªç±³ç‰¹åŸåˆ™ï¼šä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä»–å¯¹è±¡åº”è¯¥æœ‰å°½é‡å°‘çš„äº†è§£</li></ul><h4 id="Java-23-ç§è®¾è®¡æ¨¡å¼ï¼ˆæŒ‰ç›®çš„åˆ†ç±»ä¸ºï¼š5-7-11ï¼‰"><a href="#Java-23-ç§è®¾è®¡æ¨¡å¼ï¼ˆæŒ‰ç›®çš„åˆ†ç±»ä¸ºï¼š5-7-11ï¼‰" class="headerlink" title="Java 23 ç§è®¾è®¡æ¨¡å¼ï¼ˆæŒ‰ç›®çš„åˆ†ç±»ä¸ºï¼š5+7+11ï¼‰"></a>Java 23 ç§è®¾è®¡æ¨¡å¼ï¼ˆæŒ‰ç›®çš„åˆ†ç±»ä¸ºï¼š5+7+11ï¼‰</h4><blockquote><p>1995 å¹´ GoFï¼ˆå››äººç»„ï¼‰å‡ºäº†ä¸€æœ¬è®¾è®¡æ¨¡å¼çš„ä¹¦ï¼Œæ”¶å½•äº† 23 ç§è®¾è®¡æ¨¡å¼ï¼Œæ ‘ç«‹è®¾è®¡æ¨¡å¼é‡Œç¨‹ç¢‘ï¼Œä¹Ÿå«ï¼šGoF è®¾è®¡æ¨¡å¼</p></blockquote><ul><li>åˆ›å»ºå‹ï¼ˆ5ï¼‰ï¼šæè¿°æ€ä¹ˆåˆ›å»ºå¯¹è±¡<ul><li>1.å•ä¾‹æ¨¡å¼</li><li>2.åŸå‹æ¨¡å¼ï¼šå¯¹è±¡çš„æ‹·è´</li><li>3.å»ºé€ è€…æ¨¡å¼</li><li>4.å·¥å‚æ¨¡å¼ï¼šå»ºç«‹ä¸€ä¸ªå·¥å‚æ–¹æ³•æ¥åˆ¶é€ æ–°çš„å¯¹è±¡</li><li>5.æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š</li></ul></li><li>ç»“æ„å‹ï¼ˆ7ï¼‰ï¼šæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§è§„åˆ™ç»„æˆæ›´å¤§çš„ç»“æ„ï¼ˆé”®ç›˜è®°å¿†ï¼šqw sd zzxï¼‰<ul><li>1.æ¡¥æ¥æ¨¡å¼ï¼šå¯¹äºä¸¤ä¸ªæˆ–ä»¥ä¸Šçº¬åº¦ç‹¬ç«‹å˜åŒ–çš„åœºæ™¯ï¼Œå°†æŠ½è±¡ä¸å…·ä½“å®ç°åˆ†ç¦»ï¼Œå®ä¾‹ï¼šç”¨ä¸åŒé¢œè‰²ç”»ä¸åŒå½¢çŠ¶</li><li>2.å¤–è§‚æ¨¡å¼ï¼šå¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œå¤–éƒ¨ä¸ç”¨å…³å¿ƒå†…éƒ¨å­ç³»ç»Ÿçš„å…·ä½“å®ç°ï¼Œè¿™æ˜¯â€è¿ªç±³ç‰¹åŸåˆ™â€çš„å…¸å‹åº”ç”¨</li><li>3.é€‚é…å™¨æ¨¡å¼ï¼šæ”¹å˜ç±»çš„æ¥å£ï¼Œä½¿åŸæœ¬ç”±äºæ¥å£ä¸åŒ¹é…è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€å·¥ä½œï¼Œå®ä¾‹ï¼šRecycleView çš„ Adapter ä¸ç®¡ä»€ä¹ˆç±»å‹çš„ View éƒ½è¿”å› ViewHolder</li><li>4.ä»£ç†æ¨¡å¼ï¼šç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</li><li>5.ç»„åˆæ¨¡å¼ï¼šå°†å¯¹è±¡ç»„æˆæ ‘å½¢ç»“æ„ï¼Œç”¨äºå¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ï¼Œå®ä¾‹ï¼šViewGroup</li><li>6.è£…é¥°æ¨¡å¼ï¼šå¯¹å¯¹è±¡åŒ…è£…ä¸€å±‚ï¼ŒåŠ¨æ€çš„å¢åŠ ä¸€äº›é¢å¤–åŠŸèƒ½ï¼Œå®ä¾‹ï¼šContextWrapper åŒ…è£… Context</li><li>7.äº«å…ƒæ¨¡å¼ï¼šå¤ç”¨å¯¹è±¡ï¼Œå®ä¾‹ï¼šjava çš„å¸¸é‡æ± ï¼ˆæ¯”å¦‚ Stringï¼‰ï¼Œçº¿ç¨‹æ± ï¼ŒMessage.obtain ç­‰</li></ul></li><li>è¡Œä¸ºå‹ï¼ˆ11ï¼‰ï¼šæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€ä¹ˆç›¸äº’åä½œï¼Œæ€æ ·åˆ†é…æŒ‡è´£ï¼ˆè®°å¿†ï¼š3è€… 3çŸ­ 4é•¿ 1æ¨¡ç‰ˆæ–¹æ³•ï¼‰<ul><li>1.è§‚å¯Ÿè€…æ¨¡å¼ï¼šä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå¤šä¸ªè§‚å¯Ÿè€…å¯ä»¥åŒæ—¶ç›‘å¬æŸä¸€ä¸ªå¯¹è±¡ï¼Œå®ä¾‹ï¼šjetpack çš„ lifeCycle æ·»åŠ ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿè€…</li><li>2.ä¸­ä»‹è€…æ¨¡å¼ï¼šå®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡å°è£…ä¸€ç³»åˆ—å¯¹è±¡çš„äº¤äº’ï¼Œè§£è€¦è¿™äº›å¯¹è±¡ï¼Œå®ä¾‹ï¼šMVP çš„ P</li><li>3.è®¿é—®è€…æ¨¡å¼ï¼šå°†ä½œç”¨äºæŸæ•°æ®ç»“æ„ä¸­å„å…ƒç´ çš„æ“ä½œåˆ†ç¦»å‡ºæ¥å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œå¯¹è¿™äº›å…ƒç´ æ·»åŠ æ–°çš„æ“ä½œï¼Œä½†ä¸æ”¹å˜åŸæ•°æ®ç»“æ„ï¼Œå®ä¾‹ï¼šasm ä¸­çš„ classVisitor ä¸­å†åˆ†åˆ«å¯¹ç±»æ³¨è§£ã€å˜é‡ã€æ–¹æ³•ç­‰è¿›è¡Œå¤„ç†</li><li>4.çŠ¶æ€æ¨¡å¼ï¼šè¡Œä¸ºç”±çŠ¶æ€å†³å®šï¼Œä¸åŒçŠ¶æ€ä¸‹ç”±ä¸åŒè¡Œä¸ºï¼Œä¸ç­–ç•¥æ¨¡å¼ç±»ä¼¼ï¼Œå®ä¾‹ï¼šä¸åŒçŠ¶æ€ä¸‹æœ‰åŒä¸€ç§æ“ä½œçš„ä¸åŒè¡Œä¸ºçš„å­ç±»å®ç°</li><li>5.å‘½ä»¤æ¨¡å¼ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡å‘å‡ºï¼Œäº¤ç»™åˆ«çš„å¯¹è±¡å»å¤„ç†è¯·æ±‚ï¼Œå®ä¾‹ï¼šHandler å‘é€å®šä¹‰å¥½çš„æ¶ˆæ¯äº‹ä»¶</li><li>6.ç­–ç•¥æ¨¡å¼ï¼šå°†ä¸€ç³»åˆ—çš„ç®—æ³•å°è£…èµ·æ¥ï¼Œæ–¹ä¾¿æ›¿æ¢ï¼Œå®ä¾‹ï¼šåŠ¨ç”»çš„æ—¶é—´æ’å€¼å™¨</li><li>7.è´£ä»»é“¾æ¨¡å¼ï¼šè®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œå®ä¾‹ï¼šView äº‹ä»¶ä¼ é€’æœºåˆ¶</li><li>8.å¤‡å¿˜å½•æ¨¡å¼ï¼šä¿å­˜å¯¹è±¡ä¹‹å‰çš„çŠ¶æ€ï¼Œæ–¹ä¾¿åé¢æ¢å¤</li><li>9.è¿­ä»£å™¨æ¨¡å¼ï¼šæä¾›ä¸€ç§æ–¹æ³•éå†å®¹å™¨ä¸­çš„å…ƒç´ ï¼Œè€Œä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºï¼Œå®ä¾‹ï¼šé›†åˆçš„è¿­ä»£å™¨</li><li>10.è§£é‡Šå™¨æ¨¡å¼ï¼šå¤šæ¬¡å‡ºç°çš„é—®é¢˜æœ‰ä¸€å®šè§„å¾‹ï¼Œå°±å¯ä»¥å½’çº³æˆä¸€ç§ç®€å•çš„è¯­è¨€æ¥è§£é‡Šï¼Œå®ä¾‹ï¼šAndroidManifest æ–‡ä»¶ã€GLES ç€è‰²å™¨è¯­è¨€</li><li>11.æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰ä¸€å¥—å›ºå®šæ­¥éª¤ï¼Œæ–¹ä¾¿ç›´æ¥æ‰§è¡Œï¼Œå®ä¾‹ï¼šAsyncTask</li></ul></li></ul><h1 id="3-Java-è™šæ‹Ÿæœº-amp-å†…å­˜ç»“æ„-amp-GC-amp-ç±»åŠ è½½-amp-å››ç§å¼•ç”¨-amp-åŠ¨æ€ä»£ç†"><a href="#3-Java-è™šæ‹Ÿæœº-amp-å†…å­˜ç»“æ„-amp-GC-amp-ç±»åŠ è½½-amp-å››ç§å¼•ç”¨-amp-åŠ¨æ€ä»£ç†" class="headerlink" title="3.Java è™šæ‹Ÿæœº&amp;å†…å­˜ç»“æ„&amp;GC&amp;ç±»åŠ è½½&amp;å››ç§å¼•ç”¨&amp;åŠ¨æ€ä»£ç†"></a>3.Java è™šæ‹Ÿæœº&amp;å†…å­˜ç»“æ„&amp;GC&amp;ç±»åŠ è½½&amp;å››ç§å¼•ç”¨&amp;åŠ¨æ€ä»£ç†</h1><h4 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h4><ul><li>å®šä¹‰ï¼šå¯ä»¥ç†è§£æˆä¸€ä¸ªè™šæ„çš„è®¡ç®—æœºï¼Œè§£é‡Šè‡ªå·±çš„å­—èŠ‚ç æŒ‡ä»¤é›†æ˜ å°„åˆ°æœ¬åœ° CPU æˆ– OS çš„æŒ‡ä»¤é›†ï¼Œä¸Šå±‚åªéœ€å…³æ³¨ Class æ–‡ä»¶ï¼Œä¸æ“ä½œç³»ç»Ÿæ— å…³ï¼Œå®ç°è·¨å¹³å°</li><li>Kotlin å°±æ˜¯èƒ½è§£é‡Šæˆ Class æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è·‘åœ¨ JVM ä¸Š</li></ul><h4 id="JVM-å†…å­˜æ¨¡å‹"><a href="#JVM-å†…å­˜æ¨¡å‹" class="headerlink" title="JVM å†…å­˜æ¨¡å‹"></a>JVM å†…å­˜æ¨¡å‹</h4><ul><li>Java å¤šçº¿ç¨‹ä¹‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜</li><li>å…±äº«å˜é‡å­˜æ”¾äºä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ä¼šæ‹·è´ä¸€ä»½å…±äº«å˜é‡åˆ°æœ¬åœ°å†…å­˜</li><li>volatile å…³é”®å­—å°±æ˜¯ç»™å†…å­˜æ¨¡å‹æœåŠ¡çš„ï¼Œç”¨æ¥ä¿è¯å†…å­˜å¯è§æ€§å’Œé¡ºåºæ€§</li></ul><h4 id="JVM-å†…å­˜ç»“æ„"><a href="#JVM-å†…å­˜ç»“æ„" class="headerlink" title="JVM å†…å­˜ç»“æ„"></a>JVM å†…å­˜ç»“æ„</h4><ul><li>çº¿ç¨‹ç§æœ‰ï¼š<ul><li>1.ç¨‹åºè®¡æ•°å™¨ï¼šè®°å½•æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œè‹¥æ­£åœ¨æ‰§è¡Œ Native æ–¹æ³•åˆ™ä¸ºç©º</li><li>2.è™šæ‹Ÿæœºæ ˆï¼šæ‰§è¡Œæ–¹æ³•æ—¶æŠŠæ–¹æ³•æ‰€éœ€æ•°æ®å­˜ä¸ºä¸€ä¸ªæ ˆå¸§å…¥æ ˆï¼Œæ‰§è¡Œå®Œåå‡ºæ ˆ</li><li>3.æœ¬åœ°æ–¹æ³•æ ˆï¼šåŒè™šæ‹Ÿæœºæ ˆï¼Œä½†æ˜¯é’ˆå¯¹çš„æ˜¯ Native æ–¹æ³•</li></ul></li><li>çº¿ç¨‹å…±äº«ï¼š<ul><li>1.å †ï¼šå­˜å‚¨ Java å®ä¾‹ï¼ŒGC ä¸»è¦åŒºåŸŸï¼Œåˆ†ä»£æ”¶é›† GC æ–¹æ³•ä¼šå§å †åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£</li><li>2.æ–¹æ³•åŒºï¼šå­˜å‚¨ç±»ä¿¡æ¯ï¼Œå¸¸é‡æ± ï¼Œé™æ€å˜é‡ç­‰æ•°æ®</li></ul></li></ul><h4 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h4><ul><li>å›æ”¶åŒºåŸŸï¼šåªé’ˆå¯¹å †ã€æ–¹æ³•åŒºï¼›çº¿ç¨‹ç§æœ‰åŒºåŸŸæ•°æ®ä¼šéšçº¿ç¨‹ç»“æŸé”€æ¯ï¼Œä¸ç”¨å›æ”¶</li><li>å›æ”¶ç±»å‹ï¼š<ul><li>1.å †ä¸­çš„å¯¹è±¡<ul><li>åˆ†ä»£æ”¶é›† GC æ–¹æ³•ä¼šå§å †åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£</li><li>æ–°ç”Ÿä»£ï¼šæ–°å»ºå°å¯¹è±¡ä¼šè¿›å…¥æ–°ç”Ÿä»£ï¼›é€šè¿‡å¤åˆ¶ç®—æ³•å›æ”¶å¯¹è±¡</li><li>è€å¹´ä»£ï¼šæ–°å»ºå¤§å¯¹è±¡åŠè€å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ï¼›é€šè¿‡æ ‡è®°-æ¸…é™¤ç®—æ³•å›æ”¶å¯¹è±¡</li></ul></li><li>2.æ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ã€å¸¸é‡æ± </li></ul></li><li>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ï¼š<ul><li>1.å¼•ç”¨è®¡æ•°æ³•<ul><li>ç¼ºç‚¹ï¼šå¾ªç¯å¼•ç”¨</li></ul></li><li>2.å¯è¾¾æ€§åˆ†ææ³•<ul><li>å®šä¹‰ï¼šä» GC ROOT å¼€å§‹æœç´¢ï¼Œä¸å¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å¯ä»¥è¢«å›æ”¶çš„</li><li>GC ROOT ï¼š<ul><li>1.è™šæ‹Ÿæœºæ ˆ/æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>2.æ–¹æ³•åŒºä¸­å¸¸é‡/é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡</li></ul></li></ul></li></ul></li></ul><h4 id="Minor-GC-Major-GC-Full-GC"><a href="#Minor-GC-Major-GC-Full-GC" class="headerlink" title="Minor GC/Major GC/Full GC"></a>Minor GC/Major GC/Full GC</h4><ul><li>Minor GCï¼ˆYoung GCï¼‰ï¼šå³æ–°ç”Ÿä»£ï¼ˆåˆ†ä¸ºä¸€ä¸ª Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºï¼‰çš„åƒåœ¾å›æ”¶<ul><li>Eden åŒºæ— ç”¨å¯¹è±¡è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡ä¼šç§»åˆ° Survivor åŒº</li><li>Survivor åŒºçš„å­˜æ´»å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°å¦ä¸€ä¸ª Survivor åŒºï¼Œå¤åˆ¶æ¬¡æ•°ä¹Ÿè®°åšå¹´é¾„ï¼Œå¹´é¾„è¶³å¤Ÿå¤§æ—¶ï¼ˆ15ï¼‰ä¼šç§»åˆ°è€å¹´ä»£</li><li>å¦‚æœ Survivor åŒºå·²æ»¡ï¼Œåˆ™å­˜æ´»å¯¹è±¡ä¼šè¢«æå‰ç§»åŠ¨åˆ°è€å¹´ä»£ï¼ˆè¿‡æ—©æå‡ï¼‰ï¼Œå¦‚æœè€å¹´ä»£ä¹Ÿæ— æ³•å®¹çº³ï¼Œåˆ™ä¼šè§¦å‘ Full GCï¼ˆæå‡å¤±è´¥ï¼‰</li><li>è€å¹´ä»£çš„å¯¹è±¡å¯èƒ½å¼•ç”¨æ–°ç”Ÿä»£å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¼•ç”¨ä¼šè¢«ä½œä¸º GC Roots</li></ul></li><li>Major GCï¼šé€šå¸¸æ˜¯è·Ÿ Full GC ç­‰ä»·çš„ï¼Œå›æ”¶æ•´ä¸ªå †</li><li>Full GCï¼šå›æ”¶æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£<ul><li>å½“è¦åœ¨è€å¹´ä»£åˆ†é…ç©ºé—´ä½†æ— æ³•å®¹çº³æ—¶è§¦å‘</li><li>å½“ä¸»åŠ¨è°ƒç”¨ System.gc æ—¶è§¦å‘</li></ul></li></ul><h4 id="å››ç§å¼•ç”¨"><a href="#å››ç§å¼•ç”¨" class="headerlink" title="å››ç§å¼•ç”¨"></a>å››ç§å¼•ç”¨</h4><ul><li>å¼ºå¼•ç”¨ï¼šä¸ä¼šè¢«å›æ”¶</li><li>è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³æ—¶ä¼šè¢«å›æ”¶</li><li>å¼±å¼•ç”¨ï¼šgc æ—¶ä¼šè¢«å›æ”¶</li><li>è™šå¼•ç”¨ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°å¯¹è±¡ï¼Œå¯ä»¥ç›‘å¬å¯¹è±¡çš„å›æ”¶</li></ul><h4 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h4><ul><li>ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼š<br>1.åŠ è½½ï¼›2.éªŒè¯ï¼›3.å‡†å¤‡ï¼›4.è§£æï¼›5.åˆå§‹åŒ–ï¼›6.ä½¿ç”¨ï¼›7.å¸è½½</li><li>ç±»åŠ è½½è¿‡ç¨‹ï¼š<br>1.åŠ è½½ï¼šè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼›ç”Ÿæˆæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å­˜å‚¨ç»“æ„ï¼›åœ¨å†…å­˜ä¸­ç”Ÿæˆ Class å¯¹è±¡<br>2.éªŒè¯ï¼šç¡®ä¿è¯¥ Class å­—èŠ‚æµç¬¦åˆè™šæ‹Ÿæœºè¦æ±‚<br>3.å‡†å¤‡ï¼šåˆå§‹åŒ–é™æ€å˜é‡<br>4.è§£æï¼šå°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨<br>5.åˆå§‹åŒ–ï¼šæ‰§è¡Œé™æ€å—ä»£ç ã€ç±»å˜é‡èµ‹å€¼</li><li>ç±»åŠ è½½æ—¶æœºï¼š<br>1.å®ä¾‹åŒ–å¯¹è±¡<br>2.è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•<br>3.è°ƒç”¨ç±»çš„é™æ€å˜é‡ï¼ˆæ”¾å…¥å¸¸é‡æ± çš„å¸¸é‡é™¤å¤–ï¼‰</li><li>ç±»åŠ è½½å™¨ï¼šè´Ÿè´£åŠ è½½ class æ–‡ä»¶<br>1.å¼•å¯¼ç±»åŠ è½½å™¨ - æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨<br>2.æ‹“å±•ç±»åŠ è½½å™¨ - ç»§æ‰¿è‡ªå¼•å¯¼ç±»åŠ è½½å™¨<br>3.ç³»ç»Ÿç±»åŠ è½½å™¨ - ç»§æ‰¿è‡ªæ‹“å±•ç±»åŠ è½½å™¨</li><li>åŒäº²å§”æ‰˜æ¨¡å‹ï¼š<ul><li>å½“è¦åŠ è½½ä¸€ä¸ª class æ—¶ï¼Œä¼šå…ˆé€å±‚å‘ä¸Šè®©çˆ¶åŠ è½½å™¨å…ˆåŠ è½½ï¼ŒåŠ è½½å¤±è´¥æ‰ä¼šè‡ªå·±åŠ è½½</li><li>ä¸ºä»€ä¹ˆå«åŒäº²ï¼Ÿä¸è€ƒè™‘è‡ªå®šä¹‰åŠ è½½å™¨ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨éœ€è¦ç½‘ä¸Šè¯¢é—®ä¸¤å±‚ï¼Œæ‰€ä»¥å«åŒäº²</li><li>åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»æ—¶ï¼Œé™¤äº†ç±»ä¿¡æ¯ï¼Œè¿˜å¿…é¡»æ—¶åŒä¸€ä¸ªç±»åŠ è½½å™¨</li><li>ä¼˜ç‚¹ï¼š<ul><li>é˜²æ­¢é‡å¤åŠ è½½ï¼Œçˆ¶åŠ è½½å™¨åŠ è½½è¿‡äº†å°±æ²¡å¿…è¦åŠ è½½äº†</li><li>å®‰å…¨ï¼Œé˜²æ­¢ç¯¡æ”¹æ ¸å¿ƒåº“ç±»</li></ul></li></ul></li></ul><h4 id="åŠ¨æ€ä»£ç†åŸç†åŠå®ç°"><a href="#åŠ¨æ€ä»£ç†åŸç†åŠå®ç°" class="headerlink" title="åŠ¨æ€ä»£ç†åŸç†åŠå®ç°"></a>åŠ¨æ€ä»£ç†åŸç†åŠå®ç°</h4><ul><li>InvocationHandler æ¥å£ï¼ŒåŠ¨æ€ä»£ç†ç±»éœ€è¦å®ç°è¿™ä¸ªæ¥å£</li><li>Proxy.newProxyInstanceï¼Œç”¨äºåŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡</li><li>Retrofit åº”ç”¨ï¼š Retrofit é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œä¸ºæˆ‘ä»¬å®šä¹‰çš„è¯·æ±‚æ¥å£éƒ½ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå®ç°è¯·æ±‚</li></ul><h1 id="4-Android-åŸºç¡€-amp-æ€§èƒ½ä¼˜åŒ–-amp-Framwork"><a href="#4-Android-åŸºç¡€-amp-æ€§èƒ½ä¼˜åŒ–-amp-Framwork" class="headerlink" title="4.Android åŸºç¡€&amp;æ€§èƒ½ä¼˜åŒ–&amp;Framwork"></a>4.Android åŸºç¡€&amp;æ€§èƒ½ä¼˜åŒ–&amp;Framwork</h1><h4 id="Android-è§£æ-XML"><a href="#Android-è§£æ-XML" class="headerlink" title="Android è§£æ XML"></a>Android è§£æ XML</h4><ul><li>SAXï¼šæµå¼è§£æ</li><li>DOMï¼šå…ˆæŠŠ XML å…¨éƒ¨è¯»å–åˆ°å†…å­˜ï¼Œå†è®¿é—®æ ‘å½¢ç»“æ„ï¼Œå¾ˆæ¶ˆè€—å†…å­˜</li><li>PULLï¼šæµå¼è§£æï¼ŒAndroid å†…ç½®çš„é»˜è®¤è§£ææ–¹å¼</li></ul><h4 id="Activity-ç”Ÿå‘½å‘¨æœŸ"><a href="#Activity-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activity ç”Ÿå‘½å‘¨æœŸ"></a>Activity ç”Ÿå‘½å‘¨æœŸ</h4><ul><li>A æ‰“å¼€ B ç•Œé¢ï¼Œä¼šå…ˆæ‰§è¡Œ A çš„ onPauseï¼Œå†æ‰§è¡Œ B çš„ onCreateã€onStartã€onResumeï¼Œå†æ‰§è¡Œ A çš„ onStop</li><li>B ç•Œé¢çš„æ‰“å¼€ä¾èµ– A ç•Œé¢ onPause æ–¹æ³•æ‰§è¡Œå®Œï¼Œæ‰€ä»¥ä¸è¦åœ¨ onPause ä¸­åšè€—æ—¶æ“ä½œ</li></ul><h4 id="Activity-å¯åŠ¨æ¨¡å¼"><a href="#Activity-å¯åŠ¨æ¨¡å¼" class="headerlink" title="Activity å¯åŠ¨æ¨¡å¼"></a>Activity å¯åŠ¨æ¨¡å¼</h4><ul><li>standard æ ‡å‡†æ¨¡å¼</li><li>singleTop æ ˆé¡¶å¤ç”¨æ¨¡å¼ï¼Œ<ul><li>æ¨é€ç‚¹å‡»æ¶ˆæ¯ç•Œé¢</li></ul></li><li>singleTask æ ˆå†…å¤ç”¨æ¨¡å¼ï¼Œ<ul><li>é¦–é¡µ</li></ul></li><li>singleInstance å•ä¾‹æ¨¡å¼ï¼Œå•ç‹¬ä½äºä¸€ä¸ªä»»åŠ¡æ ˆä¸­<ul><li>æ‹¨æ‰“ç”µè¯ç•Œé¢</li></ul></li><li>ç»†èŠ‚ï¼š<ul><li>taskAffinityï¼šä»»åŠ¡ç›¸å…³æ€§ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡æ ˆåç§°ï¼Œé»˜è®¤ä¸ºåº”ç”¨åŒ…å</li><li>allowTaskReparentingï¼šå…è®¸è½¬ç§»ä»»åŠ¡æ ˆ</li></ul></li></ul><h4 id="MeasureSpec-æµ‹é‡è§„åˆ™"><a href="#MeasureSpec-æµ‹é‡è§„åˆ™" class="headerlink" title="MeasureSpec æµ‹é‡è§„åˆ™"></a>MeasureSpec æµ‹é‡è§„åˆ™</h4><ul><li>EXACTLYï¼šçˆ¶ View æŒ‡å®šäº†å­ View ç¡®åˆ‡çš„å¤§å°</li><li>AT_MOSTï¼šçˆ¶ View æŒ‡å®šä¸€ä¸ªå¤§å°ï¼Œå­ View ä¸èƒ½è¶…è¿‡è¿™ä¸ªå€¼</li><li>UNSPECIFIENDï¼š çˆ¶ View ä¸å¯¹å­ View æœ‰ä»»ä½•é™åˆ¶</li></ul><h4 id="View-å·¥ä½œåŸç†"><a href="#View-å·¥ä½œåŸç†" class="headerlink" title="View å·¥ä½œåŸç†"></a>View å·¥ä½œåŸç†</h4><ul><li>DecorView (FrameLayout)<ul><li>LinearLayout<ul><li>titlebar<ul><li>Content</li><li>è°ƒç”¨ setContentView è®¾ç½®çš„ View</li></ul></li></ul></li></ul></li></ul><ul><li>ViewRoot çš„ performTraversals æ–¹æ³•è°ƒç”¨è§¦å‘å¼€å§‹ View çš„ç»˜åˆ¶ï¼Œç„¶åä¼šä¾æ¬¡è°ƒç”¨:<ul><li>performMeasureï¼šéå† View çš„ measure æµ‹é‡å°ºå¯¸</li><li>performLayoutï¼šéå† View çš„ layout ç¡®å®šä½ç½®</li><li>performDrawï¼šéå† View çš„ draw ç»˜åˆ¶</li></ul></li></ul><h4 id="äº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#äº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="äº‹ä»¶åˆ†å‘æœºåˆ¶"></a>äº‹ä»¶åˆ†å‘æœºåˆ¶</h4><ul><li>ä¸€ä¸ª MotionEvent äº§ç”Ÿåï¼ŒæŒ‰ Activity -&gt; Window -&gt; decorView -&gt; View é¡ºåºä¼ é€’ï¼ŒView ä¼ é€’è¿‡ç¨‹å°±æ˜¯äº‹ä»¶åˆ†å‘ï¼Œä¸»è¦ä¾èµ–ä¸‰ä¸ªæ–¹æ³•:</li><li>dispatchTouchEventï¼šç”¨äºåˆ†å‘äº‹ä»¶ï¼Œåªè¦æ¥å—åˆ°ç‚¹å‡»äº‹ä»¶å°±ä¼šè¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—äº†å½“å‰äº‹ä»¶</li><li>onInterceptTouchEventï¼šç”¨äºåˆ¤æ–­æ˜¯å¦æ‹¦æˆªäº‹ä»¶ï¼Œå½“ ViewGroup ç¡®å®šè¦æ‹¦æˆªäº‹ä»¶åï¼Œè¯¥äº‹ä»¶åºåˆ—éƒ½ä¸ä¼šå†è§¦å‘è°ƒç”¨æ­¤ ViewGroup çš„ onIntercept</li><li>onTouchEventï¼šç”¨äºå¤„ç†äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦å¤„ç†äº†å½“å‰äº‹ä»¶ï¼Œæœªå¤„ç†åˆ™ä¼ é€’ç»™çˆ¶å®¹å™¨å¤„ç†</li><li>ç»†èŠ‚ï¼š<ul><li>ä¸€ä¸ªäº‹ä»¶åºåˆ—åªèƒ½è¢«ä¸€ä¸ª View æ‹¦æˆªä¸”æ¶ˆè€—</li><li>View æ²¡æœ‰ onIntercept æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ onTouchEvent å¤„ç†</li><li>OnTouchListener ä¼˜å…ˆçº§æ¯” OnTouchEvent é«˜ï¼ŒonClickListener ä¼˜å…ˆçº§æœ€ä½</li><li>requestDisallowInterceptTouchEvent å¯ä»¥å±è”½çˆ¶å®¹å™¨ onIntercet æ–¹æ³•çš„è°ƒç”¨</li></ul></li></ul><h4 id="Window-ã€-WindowManagerã€WMSã€SurfaceFlinger"><a href="#Window-ã€-WindowManagerã€WMSã€SurfaceFlinger" class="headerlink" title="Window ã€ WindowManagerã€WMSã€SurfaceFlinger"></a>Window ã€ WindowManagerã€WMSã€SurfaceFlinger</h4><ul><li>WIndowï¼šæŠ½è±¡æ¦‚å¿µä¸æ˜¯å®é™…å­˜åœ¨çš„ï¼Œè€Œæ˜¯ä»¥ View çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡ PhoneWindow å®ç°</li><li>WindowManagerï¼šå¤–ç•Œè®¿é—® Window çš„å…¥å£ï¼Œå†…éƒ¨ä¸ WMS äº¤äº’æ˜¯ä¸ª IPC è¿‡ç¨‹</li><li>WMSï¼šç®¡ç†çª—å£ Surface çš„å¸ƒå±€å’Œæ¬¡åºï¼Œä½œä¸ºç³»ç»Ÿçº§æœåŠ¡å•ç‹¬è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹</li><li>SurfaceFlingerï¼šå°† WMS ç»´æŠ¤çš„çª—å£æŒ‰ä¸€å®šæ¬¡åºæ··åˆåæ˜¾ç¤ºåˆ°å±å¹•ä¸Š</li></ul><h4 id="View-åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»"><a href="#View-åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»" class="headerlink" title="View åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»"></a>View åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»</h4><ul><li>View åŠ¨ç”»ï¼š<ul><li>ä½œç”¨å¯¹è±¡æ˜¯ Viewï¼Œå¯ç”¨ xml å®šä¹‰ï¼Œå»ºè®® xml å®ç°æ¯”è¾ƒæ˜“è¯»</li><li>æ”¯æŒå››ç§æ•ˆæœï¼šå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ã€é€æ˜åº¦</li></ul></li><li>å¸§åŠ¨ç”»ï¼š<ul><li>é€šè¿‡ AnimationDrawable å®ç°ï¼Œå®¹æ˜“ OOM</li></ul></li><li>å±æ€§åŠ¨ç”»ï¼š<ul><li>å¯ä½œç”¨äºä»»ä½•å¯¹è±¡ï¼Œå¯ç”¨ xml å®šä¹‰ï¼ŒAndroid 3 å¼•å…¥ï¼Œå»ºè®®ä»£ç å®ç°æ¯”è¾ƒçµæ´»</li><li>åŒ…æ‹¬ ObjectAnimatorã€ValuetAnimatorã€AnimatorSet</li><li>æ—¶é—´æ’å€¼å™¨ï¼šæ ¹æ®æ—¶é—´æµé€çš„ç™¾åˆ†æ¯”è®¡ç®—å½“å‰å±æ€§æ”¹å˜çš„ç™¾åˆ†æ¯”<ul><li>ç³»ç»Ÿé¢„ç½®åŒ€é€Ÿã€åŠ é€Ÿã€å‡é€Ÿç­‰æ’å€¼å™¨</li></ul></li><li>ç±»å‹ä¼°å€¼å™¨ï¼šæ ¹æ®å½“å‰å±æ€§æ”¹å˜çš„ç™¾åˆ†æ¯”è®¡ç®—æ”¹å˜åçš„å±æ€§å€¼<ul><li>ç³»ç»Ÿé¢„ç½®æ•´å‹ã€æµ®ç‚¹ã€è‰²å€¼ç­‰ç±»å‹ä¼°å€¼å™¨</li></ul></li><li>ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š<ul><li>é¿å…ä½¿ç”¨å¸§åŠ¨ç”»ï¼Œå®¹æ˜“OOM</li><li>ç•Œé¢é”€æ¯æ—¶åœæ­¢åŠ¨ç”»ï¼Œé¿å…å†…å­˜æ³„æ¼</li><li>å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼Œæé«˜åŠ¨ç”»æµç•…æ€§ ï¼Œç¡¬ä»¶åŠ é€Ÿï¼š<ul><li>å°† cpu ä¸€éƒ¨åˆ†å·¥ä½œåˆ†æ‹…ç»™ gpu ï¼Œä½¿ç”¨ gpu å®Œæˆç»˜åˆ¶å·¥ä½œ</li><li>ä»å·¥ä½œåˆ†æ‘Šå’Œç»˜åˆ¶æœºåˆ¶ä¸¤ä¸ªæ–¹é¢ä¼˜åŒ–äº†ç»˜åˆ¶é€Ÿåº¦</li></ul></li></ul></li></ul></li></ul><h4 id="Handlerã€MessageQueueã€Looper-åŠ-postDelayed-åŸç†"><a href="#Handlerã€MessageQueueã€Looper-åŠ-postDelayed-åŸç†" class="headerlink" title="Handlerã€MessageQueueã€Looper åŠ postDelayed åŸç†"></a>Handlerã€MessageQueueã€Looper åŠ postDelayed åŸç†</h4><ul><li>Handlerï¼šå¼€å‘ç›´æ¥æ¥è§¦çš„ç±»ï¼Œå†…éƒ¨æŒæœ‰ MessageQueue å’Œ Looper</li><li>MessageQueueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†…éƒ¨é€šè¿‡å•é“¾è¡¨å­˜å‚¨æ¶ˆæ¯</li><li>Looperï¼šå†…éƒ¨æŒæœ‰ MessageQueueï¼Œå¾ªç¯æŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œæœ‰å°±å¤„ç†ï¼Œæ²¡å°±é˜»å¡</li><li>postDelayed å…¶å®å°±æ˜¯è°ƒç”¨ postAtTime å®ç°çš„ï¼Œä¼ å…¥çš„æ—¶é—´æˆ³åŸºäº SystemClock.uptimeMillisï¼Œå³ boot æ—¶é—´</li><li>è¿›ä¸€æ­¥ä¼šè°ƒç”¨ MessageQueue#enqueueMessage å°†æ¶ˆæ¯æ’å…¥åˆ°é˜Ÿåˆ—</li><li>æ’å…¥æ¶ˆæ¯æ—¶ä¼šæ ¹æ®æ¶ˆæ¯æ‰§è¡Œæ—¶åˆ» Message#when æ¥å†³å®šæ’å…¥åˆ°ä»€ä¹ˆä½ç½®ï¼Œwhen ä¸º 0 æˆ–æœ€æ—©æ‰§è¡Œå°±ä¼šæ’å…¥åˆ°é“¾è¡¨å¤´ï¼Œå¦åˆ™æŒ‰æ‰§è¡Œæ—¶åˆ»æ’åºæ’å…¥</li><li>æ’å…¥åå¦‚æœæ­£åœ¨é˜»å¡åˆ™ä¼šå°è¯•å”¤é†’ï¼Œæ’å…¥åˆ°å¤´éƒ¨åˆ™ä¼šå”¤é†’ï¼Œæ’å…¥åˆ°é˜Ÿåˆ—ä¸­åˆ™å†æ ¹æ®å…¶ä»–æ¡ä»¶åˆ¤æ–­æ˜¯å¦éœ€è¦å”¤é†’</li><li>Looper#loop ä¸­è°ƒç”¨ MessageQueue#next å–æ¶ˆæ¯ï¼Œnext æ–¹æ³•é™¤éæ˜¯å³å°†é”€æ¯æ—¶ä¼šè¿”å› nullï¼Œå¦åˆ™å°±ä¼šè¿”å›æ¶ˆæ¯ï¼Œæ²¡æœ‰æ¶ˆæ¯å°±é˜»å¡ã€‚å¦‚æœå½“å‰æ—¶åˆ»è¿˜æ²¡åˆ°æ¶ˆæ¯çš„æ‰§è¡Œæ—¶åˆ» whenï¼Œå°±ä¼šå†é˜»å¡è¿™ä¸ªæ—¶é—´å·®çš„æ—¶é—´</li><li>é˜»å¡æ˜¯è°ƒç”¨ nativePollOnce å®ç°ï¼ŒåŸºäº Linux epoll äº‹ä»¶ç®¡ç†æœºåˆ¶ï¼Œä¸»çº¿ç¨‹ä¸ä¼šå› ä¸º Looper é˜»å¡æ˜¯å› ä¸ºç³»ç»Ÿæ¯ 16ms ä¼šå‘é€ä¸€ä¸ªåˆ·æ–° UI æ¶ˆæ¯å”¤é†’ </li><li>Looper#loop ä¸­å–å‡ºæ¶ˆæ¯åé€šè¿‡ Message#target æ‹¿åˆ° handlerï¼Œç„¶åè°ƒç”¨ Handler#dispatchMessage åˆ†å‘å¤„ç†æ¶ˆæ¯</li></ul><h4 id="MVCã€MVPã€MVVM"><a href="#MVCã€MVPã€MVVM" class="headerlink" title="MVCã€MVPã€MVVM"></a>MVCã€MVPã€MVVM</h4><ul><li>MVPï¼šModelï¼šå¤„ç†æ•°æ®ï¼›Viewï¼šæ§åˆ¶è§†å›¾ï¼›Presenterï¼šåˆ†ç¦» Activity å’Œ Model</li><li>MVVMï¼šModelï¼šå¤„ç†è·å–ä¿å­˜æ•°æ®ï¼›Viewï¼šæ§åˆ¶è§†å›¾ï¼›ViewModelï¼šæ•°æ®å®¹å™¨<ul><li>ä½¿ç”¨ Jetpack ç»„ä»¶æ¶æ„çš„ LiveDataã€ViewModel ä¾¿æ·å®ç° MVVM</li></ul></li></ul><h4 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h4><ul><li>å¦‚ä½•æ„ŸçŸ¥å£°æ˜å‘¨æœŸï¼šåƒ Glide ä¸€æ ·ç»™ç•Œé¢æ·»åŠ äº†æ— è§†å›¾çš„ Fragment</li></ul><h4 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h4><ul><li>ç•Œé¢æ—‹è½¬çŸ­æš‚é”€æ¯é‡å»ºæ—¶å¦‚ä½•ä¿å­˜ ViewModel ï¼Ÿ<ul><li>ViewModel ä¿å­˜åœ¨ ViewModelStore ä¸­</li><li>å½“ Activity é…ç½®å˜æ›´é”€æ¯æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ onRetainNonConfigurationInstance ä¿å­˜ NonConfigurationInstancesï¼Œè€Œ ViewModel å°±ä¿å­˜åœ¨ NonConfigurationInstances ä¸­</li><li>é‡å»ºæ—¶ onCreate æ–¹æ³•é€šè¿‡ getLastNonConfigurationInstance æ–¹æ³•è·å–åˆ° NonConfigurationInstancesï¼Œä»è€Œè·å–åˆ° ViewModelStore</li></ul></li></ul><h4 id="Serializableã€Parcelable"><a href="#Serializableã€Parcelable" class="headerlink" title="Serializableã€Parcelable"></a>Serializableã€Parcelable</h4><ul><li>Serializable ï¼šJava åºåˆ—åŒ–æ–¹å¼ï¼Œé€‚ç”¨äºå­˜å‚¨å’Œç½‘ç»œä¼ è¾“ï¼ŒserialVersionUID ç”¨äºç¡®å®šååºåˆ—åŒ–å’Œç±»ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´æ—¶ååºåˆ—åŒ–å›å¤±è´¥</li><li>Parcelable ï¼šAndroid åºåˆ—åŒ–æ–¹å¼ï¼Œé€‚ç”¨äºç»„ä»¶é€šä¿¡æ•°æ®ä¼ é€’ï¼Œæ€§èƒ½é«˜ï¼Œå› ä¸ºä¸åƒ Serializable ä¸€æ ·æœ‰å¤§é‡åå°„æ“ä½œï¼Œé¢‘ç¹ GC</li></ul><h4 id="Linux-IPC-æ–¹å¼"><a href="#Linux-IPC-æ–¹å¼" class="headerlink" title="Linux IPC æ–¹å¼"></a>Linux IPC æ–¹å¼</h4><ul><li>ç®¡é“ï¼š</li><li>ä¿¡å·é‡ï¼šå¸¸ä½œä¸ºä¸€ç§é”æœºåˆ¶ï¼Œé˜²æ­¢æŸè¿›ç¨‹æ­£åœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿè®¿é—®è¯¥èµ„æºã€‚å› æ­¤ï¼Œä¸»è¦ä½œä¸ºè¿›ç¨‹é—´ä»¥åŠåŒä¸€è¿›ç¨‹å†…ä¸åŒçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ‰‹æ®µ</li><li>ä¿¡å·ï¼šä¸é€‚ç”¨äºä¿¡æ¯äº¤æ¢ï¼Œæ›´é€‚ç”¨äºè¿›ç¨‹ä¸­æ–­æ§åˆ¶ï¼Œæ¯”å¦‚éæ³•å†…å­˜è®¿é—®ï¼Œæ€æ­»æŸä¸ªè¿›ç¨‹ç­‰ï¼ˆAndroidä¸­çš„Kill Processé‡‡ç”¨çš„å°±æ˜¯signalï¼ˆä¿¡å·ï¼‰æœºåˆ¶ï¼‰</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šä¿¡æ¯å¤åˆ¶ä¸¤æ¬¡ï¼Œé¢å¤–çš„CPUæ¶ˆè€—ï¼›ä¸åˆé€‚é¢‘ç¹æˆ–ä¿¡æ¯é‡å¤§çš„é€šä¿¡</li><li>å…±äº«å†…å­˜ï¼šæ— é¡»å¤åˆ¶ï¼Œå…±äº«ç¼“å†²åŒºç›´æ¥ä»˜é™„åŠ åˆ°è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé€Ÿåº¦å¿«ï¼›ä½†è¿›ç¨‹é—´çš„åŒæ­¥é—®é¢˜æ“ä½œç³»ç»Ÿæ— æ³•å®ç°ï¼Œå¿…é¡»å„è¿›ç¨‹åˆ©ç”¨åŒæ­¥å·¥å…·è§£å†³</li><li>socketï¼š</li></ul><h4 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h4><ul><li>Android ä¸­åŸºäº C/S ç»“æ„çš„ä¸€ç§é¢å‘å¯¹è±¡çš„è¿›ç¨‹é—´é€šä¿¡çš„æœºåˆ¶</li><li>ä¸»è¦ç”¨åœ¨ system_server è¿›ç¨‹ä¸ä¸Šå±‚ App å±‚çš„ IPC äº¤äº’</li><li>åŒ…å«ï¼šClient,Server,Binder é©±åŠ¨å’Œ ServiceManager å››å¤§ç»„æˆéƒ¨åˆ†</li></ul><h4 id="Android-ä¸ºä»€ä¹ˆé€‰æ‹©-binder"><a href="#Android-ä¸ºä»€ä¹ˆé€‰æ‹©-binder" class="headerlink" title="Android ä¸ºä»€ä¹ˆé€‰æ‹© binder"></a>Android ä¸ºä»€ä¹ˆé€‰æ‹© binder</h4><ul><li>æ€§èƒ½ï¼šä½¿ç”¨ mmap ä¸€æ¬¡æ•°æ®æ‹·è´å®ç° IPCï¼Œä¼ ç»Ÿ IPCï¼šç”¨æˆ·Aç©ºé—´-&gt;å†…æ ¸-&gt;ç”¨æˆ·Bç©ºé—´ï¼›mmap å°†å†…æ ¸ä¸ç”¨æˆ·Bç©ºé—´æ˜ å°„ï¼Œå®ç°ç›´æ¥ä»ç”¨æˆ·Aç©ºé—´-&gt;ç”¨æˆ·Bç©ºé—´ï¼Œè€Œ Linux çš„ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Socket éƒ½éœ€è¦æ‹·è´ä¸¤æ¬¡ï¼Œbinder ä»…æ¬¡äºå…±äº«å†…å­˜</li><li>ç¨³å®šæ€§ï¼šåŸºäºC/Sæ¶æ„ï¼Œæ¶æ„æ¸…æ™°ï¼Œç¨³å®šæ€§å¥½ï¼Œä¸åƒå…±äº«å†…å­˜å®ç°æ–¹å¼å¤æ‚ï¼Œéœ€è¦å……åˆ†è€ƒè™‘è®¿é—®ä¸´ç•Œèµ„æºçš„å¹¶å‘åŒæ­¥é—®é¢˜</li><li>å®‰å…¨ï¼šä¼ ç»ŸLinux IPCçš„æ¥æ”¶æ–¹æ— æ³•è·å¾—å¯¹æ–¹è¿›ç¨‹å¯é çš„UID/PIDï¼Œä»è€Œæ— æ³•é‰´åˆ«å¯¹æ–¹èº«ä»½</li></ul><h4 id="Android-IPC-æ–¹å¼"><a href="#Android-IPC-æ–¹å¼" class="headerlink" title="Android IPC æ–¹å¼"></a>Android IPC æ–¹å¼</h4><ul><li>Intent extrasã€Bundleï¼šè¦æ±‚ä¼ é€’æ•°æ®èƒ½è¢«åºåˆ—åŒ–ï¼Œå®ç° Parcelableã€Serializable ï¼Œé€‚ç”¨äºå››å¤§ç»„ä»¶é€šä¿¡</li><li>æ–‡ä»¶å…±äº«ï¼šé€‚ç”¨äºäº¤æ¢ç®€å•çš„æ•°æ®å®æ—¶æ€§ä¸é«˜çš„åœºæ™¯</li><li>AIDLï¼šAIDL æ¥å£å®è´¨ä¸Šæ˜¯ç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿å®ç° BInder çš„å·¥å…·<ul><li>Android Interface Definition Languageï¼Œå¯å®ç°è·¨è¿›ç¨‹è°ƒç”¨æ–¹æ³•</li><li>æœåŠ¡ç«¯ï¼šå°†æš´æ¼ç»™å®¢æˆ·ç«¯çš„æ¥å£å£°æ˜åœ¨ AIDL æ–‡ä»¶ä¸­ï¼Œåˆ›å»º Service å®ç° AIDL æ¥å£å¹¶ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚</li><li>å®¢æˆ·ç«¯ï¼šç»‘å®šæœåŠ¡ç«¯ Service ï¼Œç»‘å®šæˆåŠŸåæ‹¿åˆ°æœåŠ¡ç«¯ Binder å¯¹è±¡è½¬ä¸º AIDL æ¥å£è°ƒç”¨</li><li>RemoteCallbackList å®ç°è·¨è¿›ç¨‹æ¥å£ç›‘å¬ï¼ŒåŒä¸ª Binder å¯¹è±¡åš key å­˜å‚¨å®¢æˆ·ç«¯æ³¨å†Œçš„ listener</li><li>ç›‘å¬ Binder æ–­å¼€ï¼š1.Binder.linkToDeath è®¾ç½®æ­»äº¡ä»£ç†ï¼›2. onServiceDisconnected å›è°ƒ</li></ul></li><li>Messengerï¼šåŸºäº AIDL å®ç°ï¼ŒæœåŠ¡ç«¯ä¸²è¡Œå¤„ç†ï¼Œä¸»è¦ç”¨äºä¼ é€’æ¶ˆæ¯ï¼Œé€‚ç”¨äºä½å¹¶å‘ä¸€å¯¹å¤šé€šä¿¡</li><li>ContentProviderï¼šåŸºäº Binder å®ç°ï¼Œé€‚ç”¨äºä¸€å¯¹å¤šè¿›ç¨‹é—´æ•°æ®å…±äº«</li><li>Socketï¼šTCPã€UDPï¼Œé€‚ç”¨äºç½‘ç»œæ•°æ®äº¤æ¢</li></ul><h4 id="Android-ç³»ç»Ÿæ¶æ„"><a href="#Android-ç³»ç»Ÿæ¶æ„" class="headerlink" title="Android ç³»ç»Ÿæ¶æ„"></a>Android ç³»ç»Ÿæ¶æ„</h4><p><img src="../img/20.jpg" alt></p><ul><li>Linux å†…æ ¸</li><li>HAL</li><li>æœ¬åœ° Native åº“å’Œ Android è¿è¡Œæ—¶ç¯å¢ƒ</li><li>Framework æ¡†æ¶å±‚</li><li>åº”ç”¨å±‚</li></ul><h4 id="Android-ç³»ç»Ÿå¯åŠ¨æµç¨‹"><a href="#Android-ç³»ç»Ÿå¯åŠ¨æµç¨‹" class="headerlink" title="Android ç³»ç»Ÿå¯åŠ¨æµç¨‹"></a>Android ç³»ç»Ÿå¯åŠ¨æµç¨‹</h4><ul><li>æŒ‰ç”µæºé”® -&gt; åŠ è½½å¼•å¯¼ç¨‹åº BootLoader åˆ° RAM -&gt; æ‰§è¡Œ BootLoader ç¨‹åºå¯åŠ¨å†…æ ¸ -&gt; å¯åŠ¨ init è¿›ç¨‹ -&gt; å¯åŠ¨ Zygote å’Œå„ç§å®ˆæŠ¤è¿›ç¨‹ -&gt;</li><li>å¯åŠ¨  System Server æœåŠ¡è¿›ç¨‹å¼€å¯ AMSã€WMS ç­‰ -&gt; å¯åŠ¨ Launcher åº”ç”¨è¿›ç¨‹</li></ul><h4 id="App-å¯åŠ¨æµç¨‹"><a href="#App-å¯åŠ¨æµç¨‹" class="headerlink" title="App å¯åŠ¨æµç¨‹"></a>App å¯åŠ¨æµç¨‹</h4><ul><li>Launcher ä¸­ç‚¹å‡»ä¸€ä¸ªåº”ç”¨å›¾æ ‡ -&gt; é€šè¿‡ AMS æŸ¥æ‰¾åº”ç”¨è¿›ç¨‹ï¼Œè‹¥ä¸å­˜åœ¨å°±é€šè¿‡ Zygote è¿›ç¨‹ fork </li></ul><h4 id="è¿›ç¨‹ä¿æ´»"><a href="#è¿›ç¨‹ä¿æ´»" class="headerlink" title="è¿›ç¨‹ä¿æ´»"></a>è¿›ç¨‹ä¿æ´»</h4><ul><li>è¿›ç¨‹ä¼˜å…ˆçº§ï¼š1.å‰å°è¿›ç¨‹ ï¼›2.å¯è§è¿›ç¨‹ï¼›3.æœåŠ¡è¿›ç¨‹ï¼›4.åå°è¿›ç¨‹ï¼›5.ç©ºè¿›ç¨‹</li><li>è¿›ç¨‹è¢« kill åœºæ™¯ï¼š1.åˆ‡åˆ°åå°å†…å­˜ä¸è¶³æ—¶è¢«æ€ï¼›2.åˆ‡åˆ°åå°å‚å•†çœç”µæœºåˆ¶æ€æ­»ï¼›3.ç”¨æˆ·ä¸»åŠ¨æ¸…ç†</li><li>ä¿æ´»æ–¹å¼ï¼š<ul><li>1.Activity ææƒï¼šæŒ‚ä¸€ä¸ª 1åƒç´  Activity å°†è¿›ç¨‹ä¼˜å…ˆçº§æé«˜åˆ°å‰å°è¿›ç¨‹</li><li>2.Service ææƒï¼šå¯åŠ¨ä¸€ä¸ªå‰å°æœåŠ¡ï¼ˆAPI&gt;18ä¼šæœ‰æ­£åœ¨è¿è¡Œé€šçŸ¥æ ï¼‰</li><li>3.å¹¿æ’­æ‹‰æ´»</li><li>4.Service æ‹‰æ´»</li><li>5.JobScheduler å®šæ—¶ä»»åŠ¡æ‹‰æ´»</li><li>6.åŒè¿›ç¨‹æ‹‰æ´»</li></ul></li></ul><h4 id="ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹"><a href="#ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹" class="headerlink" title="ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹"></a>ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹</h4><ul><li>é€Ÿåº¦ï¼š1.GZIP å‹ç¼©ï¼ˆokhttp è‡ªåŠ¨æ”¯æŒï¼‰ï¼›2.Protocol Buffer æ›¿ä»£ jsonï¼›3.ä¼˜åŒ–å›¾ç‰‡/æ–‡ä»¶æµé‡ï¼›4.IP ç›´è¿çœå» DNS è§£ææ—¶é—´</li><li>æˆåŠŸç‡ï¼š1.å¤±è´¥é‡è¯•ç­–ç•¥ï¼›</li><li>æµé‡ï¼š1.GZIP å‹ç¼©ï¼ˆokhttp è‡ªåŠ¨æ”¯æŒï¼‰ï¼›2.Protocol Buffer æ›¿ä»£ jsonï¼›3.ä¼˜åŒ–å›¾ç‰‡/æ–‡ä»¶æµé‡ï¼›5.æ–‡ä»¶ä¸‹è½½æ–­ç‚¹ç»­ä¼  ï¼›6.ç¼“å­˜</li><li>åè®®å±‚çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚æ›´ä¼˜çš„ http ç‰ˆæœ¬ç­‰</li><li>ç›‘æ§ï¼šCharles æŠ“åŒ…ã€Network Monitor ç›‘æ§æµé‡</li></ul><h4 id="UIå¡é¡¿ä¼˜åŒ–"><a href="#UIå¡é¡¿ä¼˜åŒ–" class="headerlink" title="UIå¡é¡¿ä¼˜åŒ–"></a>UIå¡é¡¿ä¼˜åŒ–</h4><ul><li>å‡å°‘å¸ƒå±€å±‚çº§åŠæ§ä»¶å¤æ‚åº¦ï¼Œé¿å…è¿‡åº¦ç»˜åˆ¶</li><li>ä½¿ç”¨ includeã€mergeã€viewstub</li><li>ä¼˜åŒ–ç»˜åˆ¶è¿‡ç¨‹ï¼Œé¿å…åœ¨ Draw ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡ã€åšè€—æ—¶æ“ä½œ</li></ul><h4 id="å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿"><a href="#å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿" class="headerlink" title="å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿"></a>å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿</h4><ul><li>1.é™æ€å˜é‡ã€å•ä¾‹å¼ºå¼•è·Ÿç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ•°æ®æˆ–èµ„æºï¼ŒåŒ…æ‹¬ EventBus</li><li>2.æ¸¸æ ‡ã€IO æµç­‰èµ„æºå¿˜è®°ä¸»åŠ¨é‡Šæ”¾</li><li>3.ç•Œé¢ç›¸å…³åŠ¨ç”»åœ¨ç•Œé¢é”€æ¯æ—¶åŠæ—¶æš‚åœ</li><li>4.å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼<ul><li>handler å†…éƒ¨ç±»å†…å­˜æ³„æ¼è§„é¿ï¼š1.ä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨ 2.ç•Œé¢é”€æ¯æ—¶æ¸…ç©ºæ¶ˆæ¯é˜Ÿåˆ—</li><li>æ£€æµ‹ï¼šAndroid Studio Profiler </li></ul></li></ul><h4 id="å†…å­˜ä¼˜åŒ–"><a href="#å†…å­˜ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h4><ul><li>å†…å­˜é—®é¢˜<ul><li>å†…å­˜æ³„æ¼</li><li>å†…å­˜æŠ–åŠ¨ï¼šé¢‘ç¹åˆ›å»ºä¸´æ—¶å¯¹è±¡</li><li>Bitmap å¤§å†…å­˜ï¼šè§„é¿ä½å›¾è¶…æ ‡</li><li>ä»£ç è´¨é‡ï¼šæšä¸¾ä»£æ›¿ intdefï¼Œä½¿ç”¨ SparseArray ä»£æ›¿ Hashmap</li></ul></li><li>æ£€æµ‹å·¥å…·<ul><li>MAT(Memory Analysis Tools) ï¼Œå¯åˆ†æ Java å †æ•°æ®ï¼Œå¯æŸ¥çœ‹å®ä¾‹å ç”¨ç©ºé—´ã€å¼•ç”¨å…³ç³»ç­‰</li><li>Android Studio è‡ªå¸¦çš„ Profiler</li><li>LeakCanary</li></ul></li></ul><h4 id="LeakCanary-åŸç†"><a href="#LeakCanary-åŸç†" class="headerlink" title="LeakCanary åŸç†"></a>LeakCanary åŸç†</h4><ul><li>é€šè¿‡å¼±å¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—ç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li><li>æ¯”å¦‚ Activity é”€æ¯æ—¶å¼€å§‹ç›‘æ§æ­¤å¯¹è±¡ï¼Œæ£€æµ‹åˆ°æœªè¢«å›æ”¶åˆ™ä¸»åŠ¨ gc ï¼Œç„¶åç»§ç»­ç›‘æ§</li></ul><h4 id="OOM-åœºæ™¯åŠè§„é¿"><a href="#OOM-åœºæ™¯åŠè§„é¿" class="headerlink" title="OOM åœºæ™¯åŠè§„é¿"></a>OOM åœºæ™¯åŠè§„é¿</h4><ul><li>åŠ è½½å¤§å›¾ï¼šå‡å°å›¾ç‰‡</li><li>å†…å­˜æ³„æ¼ï¼šè§„é¿å†…å­˜æ³„æ¼</li></ul><h4 id="ANR-é—®é¢˜åŠåˆ†æ"><a href="#ANR-é—®é¢˜åŠåˆ†æ" class="headerlink" title="ANR é—®é¢˜åŠåˆ†æ"></a>ANR é—®é¢˜åŠåˆ†æ</h4><ul><li>anr åˆ†ç±»<ul><li>ä¸»çº¿ç¨‹ 5s å†…æ²¡æœ‰å¤„ç†å®Œè¾“å…¥äº‹ä»¶</li><li>service é˜»å¡ 20s</li><li>å‰å°å¹¿æ’­é˜»å¡ 10s æˆ–åå°å¹¿å‘Šé˜»å¡ 20s</li></ul></li><li>anr å‘ç”Ÿè¿‡ç¨‹<ul><li>1.æ•è·åˆ° anrï¼Œå‘é€ linux ä¿¡å·é‡ 3</li><li>2.è¿›ç¨‹æ¥å—åˆ°ä¿¡å·é‡å°† anr ä¿¡æ¯å†™å…¥ data/anr/traces.txt æ–‡ä»¶</li><li>3.Log æ‰“å° anr ä¿¡æ¯</li><li>4.è¿›ç¨‹è¿›å…¥ anr çŠ¶æ€ï¼Œå¼¹å‡º anr æç¤ºæ¡†</li></ul></li><li>ç›‘æ§ anr<ul><li>1.Android 5.0 ä»¥ä¸‹ç›‘å¬ traces.txt æ–‡ä»¶å†™å…¥</li><li>2.æ¯éš” 5s å‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯åˆ¤æ–­ä¸»çº¿ç¨‹æ˜¯å¦é˜»å¡</li></ul></li><li>åˆ†æ anr<ul><li>æŸ¥çœ‹ cpu è´Ÿè½½æ˜¯å¦æ˜¯ cpu èµ„æºç´§å¼ å¯¼è‡´</li><li>æŸ¥çœ‹å †æ ˆçœ‹æ˜¯å¦æ˜¯æˆ‘ä»¬çš„ä»£ç è€—æ—¶è¿‡é•¿</li></ul></li><li>é¿å… anr<ul><li>ä¸»çº¿ç¨‹ä¸­ä¸è¦åšè€—æ—¶æ“ä½œï¼Œæ³¨æ„ä½¿ç”¨ IntentService </li><li>é™ä½å­çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œè®©ä¸»çº¿ç¨‹å¯ä»¥æ›´å¤šçš„è·å–åˆ° cpu èµ„æº</li></ul></li></ul><h1 id="5-Android-æ¨¡å—åŒ–-amp-çƒ­ä¿®å¤-amp-çƒ­æ›´æ–°-amp-æ‰“åŒ…-amp-æ··æ·†-amp-å‹ç¼©-amp-AOP"><a href="#5-Android-æ¨¡å—åŒ–-amp-çƒ­ä¿®å¤-amp-çƒ­æ›´æ–°-amp-æ‰“åŒ…-amp-æ··æ·†-amp-å‹ç¼©-amp-AOP" class="headerlink" title="5.Android æ¨¡å—åŒ–&amp;çƒ­ä¿®å¤&amp;çƒ­æ›´æ–°&amp;æ‰“åŒ…&amp;æ··æ·†&amp;å‹ç¼©&amp;AOP"></a>5.Android æ¨¡å—åŒ–&amp;çƒ­ä¿®å¤&amp;çƒ­æ›´æ–°&amp;æ‰“åŒ…&amp;æ··æ·†&amp;å‹ç¼©&amp;AOP</h1><h4 id="Dalvik-å’Œ-ART"><a href="#Dalvik-å’Œ-ART" class="headerlink" title="Dalvik å’Œ ART"></a>Dalvik å’Œ ART</h4><ul><li>Dalvik<ul><li>è°·æ­Œè®¾è®¡ä¸“ç”¨äº Android å¹³å°çš„ Java è™šæ‹Ÿæœºï¼Œå¯ç›´æ¥è¿è¡Œ .dex æ–‡ä»¶ï¼Œé€‚åˆå†…å­˜å’Œå¤„ç†é€Ÿåº¦æœ‰é™çš„ç³»ç»Ÿ </li><li>JVM æŒ‡ä»¤é›†æ˜¯åŸºäºæ ˆçš„ï¼›Dalvik æŒ‡ä»¤é›†æ˜¯åŸºäºå¯„å­˜å™¨çš„ï¼Œä»£ç æ‰§è¡Œæ•ˆç‡æ›´ä¼˜</li></ul></li><li>ART<ul><li>Dalvik æ¯æ¬¡è¿è¡Œéƒ½è¦å°†å­—èŠ‚ç è½¬æ¢æˆæœºå™¨ç ï¼›ART åœ¨åº”ç”¨å®‰è£…æ—¶å°±ä¼šè½¬æ¢æˆæœºå™¨ç ï¼Œæ‰§è¡Œé€Ÿåº¦æ›´å¿«</li><li>ART å­˜å‚¨æœºå™¨ç å ç”¨ç©ºé—´æ›´å¤§ï¼Œç©ºé—´æ¢æ—¶é—´</li></ul></li></ul><h4 id="APK-æ‰“åŒ…æµç¨‹"><a href="#APK-æ‰“åŒ…æµç¨‹" class="headerlink" title="APK æ‰“åŒ…æµç¨‹"></a>APK æ‰“åŒ…æµç¨‹</h4><ul><li>1.aapt æ‰“åŒ…èµ„æºæ–‡ä»¶ç”Ÿæˆ R.java æ–‡ä»¶ï¼›aidl ç”Ÿæˆ java æ–‡ä»¶</li><li>2.å°† java æ–‡ä»¶ç¼–è¯‘ä¸º class æ–‡ä»¶</li><li>3.å°†å·¥ç¨‹åŠç¬¬ä¸‰æ–¹çš„ class æ–‡ä»¶è½¬æ¢æˆ dex æ–‡ä»¶</li><li>4.å°† dex æ–‡ä»¶ã€soã€ç¼–è¯‘è¿‡çš„èµ„æºã€åŸå§‹èµ„æºç­‰æ‰“åŒ…æˆ apk æ–‡ä»¶</li><li>5.ç­¾å</li><li>6.èµ„æºæ–‡ä»¶å¯¹é½ï¼Œå‡å°‘è¿è¡Œæ—¶å†…å­˜</li></ul><h4 id="App-å®‰è£…è¿‡ç¨‹"><a href="#App-å®‰è£…è¿‡ç¨‹" class="headerlink" title="App å®‰è£…è¿‡ç¨‹"></a>App å®‰è£…è¿‡ç¨‹</h4><ul><li>é¦–å…ˆè¦è§£å‹ APKï¼Œèµ„æºã€soç­‰æ”¾åˆ°åº”ç”¨ç›®å½•</li><li>Dalvik ä¼šå°† dex å¤„ç†æˆ ODEX ï¼›ART ä¼šå°† dex å¤„ç†æˆ OATï¼›</li><li>OAT åŒ…å« dex å’Œå®‰è£…æ—¶ç¼–è¯‘çš„æœºå™¨ç </li></ul><h4 id="ç˜¦åŒ…"><a href="#ç˜¦åŒ…" class="headerlink" title="ç˜¦åŒ…"></a>ç˜¦åŒ…</h4><ul><li>1.èµ„æºæ–¹é¢ï¼šèµ„æºåœ¨çº¿åŒ–ã€å›¾ç‰‡ä½¿ç”¨ webp æ ¼å¼ã€tint ç€è‰²ç”Ÿæˆä¸åŒè‰²è°ƒçš„åˆ‡ã€ä½¿ç”¨ icon font</li><li>2.so åº“ï¼šä¿ç•™ä¸€ä¸ª cpu æ¶æ„çš„ so æ–‡ä»¶</li><li>3.AS Inspect Code æ¸…é™¤æ— ç”¨ä»£ç å’Œèµ„æº</li><li>4.ä»£ç æ··æ·†ï¼šä½¿ç”¨ ProGuard å¯ä»¥ç§»é™¤æ— ç”¨çš„ç±»ã€å­—æ®µã€æ–¹æ³•ï¼ˆå‹ç¼©ï¼‰ï¼Œç§»é™¤æ— ç”¨å­—èŠ‚ç æŒ‡ä»¤ </li><li>5.ä¸ä¿ç•™è¡Œå·ï¼šä½¿ç”¨ ProGuard é…ç½®ä¸ä¿ç•™è¡Œå· </li><li>6.å¼€å¯ shrinkResourcesï¼šç§»é™¤æ— ç”¨èµ„æº </li><li>7.èµ„æºæ··æ·†ï¼šä½¿ç”¨ AndResGuard ç¼©çŸ­èµ„æºé•¿åº¦ï¼Œå¯¹èµ„æºè¿›è¡Œ 7z å‹ç¼©ç­‰ï¼ˆç›´æ¥å¯¹apkæ“ä½œï¼‰</li><li>8.ä»£ç ç»“æ„ç®€åŒ–ï¼Œæ¯”å¦‚ç”¨ intdef ä»£æ›¿ æšä¸¾(ä¸€ä¸ªæšä¸¾æœ‰1~1.4kbå¤§å°)</li><li>9.ä½¿ç”¨ compileOnly åœ¨åªéœ€ç¼–è¯‘æ—¶ä¾èµ–çš„åœºæ™¯ï¼Œä¸ä¼šæ‰“åˆ° apk é‡Œ</li><li>10.ä½¿ç”¨ thinR æ’ä»¶å‰”é™¤ R æ–‡ä»¶ï¼Œå°†å¼•ç”¨ R å­—æ®µçš„åœ°æ–¹æ›¿æ¢æˆå¯¹åº”å¸¸é‡</li><li>11.Android 7.0 ä½¿ç”¨ V2(apksigner) ä»£æ›¿ V1(jarsigner) ç­¾åå·¥å…·</li><li>12.åŠ¨æ€åŠ è½½ so åº“(System.loadåŠ è½½ç»å¯¹è·¯å¾„æ–‡ä»¶)ã€æ’ä»¶åŒ–æŠ€æœ¯ã€App Bundle</li><li>13.ä½¿ç”¨ facebook çš„ redex</li></ul><h4 id="Android-ç±»åŠ è½½å™¨"><a href="#Android-ç±»åŠ è½½å™¨" class="headerlink" title="Android ç±»åŠ è½½å™¨"></a>Android ç±»åŠ è½½å™¨</h4><ul><li>BootClassLoader(åŠ è½½ Franwork çº§åˆ«çš„ç±»)</li><li>PathClassLoader(åŠ è½½ç³»ç»Ÿç±»å’Œ data/app åº”ç”¨ç›®å½•ä¸‹çš„ dex æ–‡ä»¶)</li><li>DexClassLoader(åŠ è½½è‡ªå®šä¹‰çš„ dex æ–‡ä»¶æˆ– jarï¼Œæ”¯æŒä» sd å¡ä¸­è¿›è¡ŒåŠ è½½)</li></ul><h4 id="æ’ä»¶åŒ–"><a href="#æ’ä»¶åŒ–" class="headerlink" title="æ’ä»¶åŒ–"></a>æ’ä»¶åŒ–</h4><ul><li>DexClassLoader åŠ¨æ€åŠ è½½</li><li>VirtualAPKï¼šåŠ¨æ€åŠ è½½ï¼Œå››å¤§ç»„ä»¶æœªæ³¨å†Œé—®é¢˜é€šè¿‡ hook AMSã€Instrumentation ç­‰è§£å†³</li></ul><h4 id="çƒ­ä¿®å¤åŸç†"><a href="#çƒ­ä¿®å¤åŸç†" class="headerlink" title="çƒ­ä¿®å¤åŸç†"></a>çƒ­ä¿®å¤åŸç†</h4><ul><li>Native Hookï¼ˆAndFixï¼‰ï¼šç›´æ¥åœ¨ native å±‚è¿›è¡Œæ–¹æ³•çš„ç»“æ„ä½“ä¿¡æ¯å¯¹æ¢</li><li>åˆ†åŒ…ï¼ˆQFixï¼‰ï¼šæ’å…¥æ–° dex åˆ° dexElements[]ï¼Œåˆ©ç”¨ ClassLoader é€šè¿‡éå† dexElements[] æ¥ findClass çš„ç‰¹æ€§</li><li>Java Hookï¼ˆRobustï¼‰ï¼šhook æ¯ä¸ªæ–¹æ³•ï¼Œåœ¨æ¯ä¸ªæ–¹æ³•é‡ŒåŸ‹å¥½å‡†å¤‡æ›¿æ¢çš„é€»è¾‘</li></ul><h4 id="ç»„ä»¶åŒ–"><a href="#ç»„ä»¶åŒ–" class="headerlink" title="ç»„ä»¶åŒ–"></a>ç»„ä»¶åŒ–</h4><ul><li>ARoute è·¯ç”±å®ç°ï¼šé€šè¿‡ APT è§£æ @Route ç­‰æ³¨è§£ï¼Œç»“åˆ JavaPoet ç”Ÿæˆè·¯ç”±è¡¨ï¼Œå³è·¯ç”±ä¸ Activity çš„æ˜ å°„å…³ç³»</li></ul><h4 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h4><ul><li>åŸºäº Gradle Transform API åˆ›å»º TransForm ï¼Œå…¶æ‰§è¡Œæ—¶æœºåœ¨ class è¢«æ‰“åŒ…æˆ dex ä¹‹å‰</li><li>åœ¨ TransForm ä¸­é€šè¿‡ javassist æˆ– asm ä¿®æ”¹å­—èŠ‚ç </li><li>åŸºäº Gradle Plugin API è‡ªå®šä¹‰æ’ä»¶ï¼Œåº”ç”¨è‡ªå®šä¹‰çš„ TransForm</li></ul><h1 id="6-JNI-amp-éŸ³è§†é¢‘-amp-FFmpeg-amp-æ’­æ”¾å™¨"><a href="#6-JNI-amp-éŸ³è§†é¢‘-amp-FFmpeg-amp-æ’­æ”¾å™¨" class="headerlink" title="6.JNI&amp;éŸ³è§†é¢‘&amp;FFmpeg&amp;æ’­æ”¾å™¨"></a>6.JNI&amp;éŸ³è§†é¢‘&amp;FFmpeg&amp;æ’­æ”¾å™¨</h1><h4 id="SurfaceViewã€TextureViewã€SurfaceTextureã€GLSurfaceView"><a href="#SurfaceViewã€TextureViewã€SurfaceTextureã€GLSurfaceView" class="headerlink" title="SurfaceViewã€TextureViewã€SurfaceTextureã€GLSurfaceView"></a>SurfaceViewã€TextureViewã€SurfaceTextureã€GLSurfaceView</h4><ul><li>SurfaceViewï¼šä½¿ç”¨åŒç¼“å†²æœºåˆ¶ï¼Œæœ‰è‡ªå·±çš„ surfaceï¼Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹é‡Œç»˜åˆ¶ï¼ŒAndroid7.0ä¹‹å‰ä¸èƒ½å¹³ç§»ã€ç¼©æ”¾</li><li>TextureViewï¼šæŒæœ‰ SurfaceTextureï¼Œå°†å›¾åƒå¤„ç†ä¸º OpenGL çº¹ç†æ›´æ–°åˆ° HardwareLayerï¼Œå¿…é¡»å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼ŒAndroid5.0ä¹‹å‰åœ¨ä¸»çº¿ç¨‹æ¸²æŸ“ï¼Œä¹‹åæœ‰ç‹¬ç«‹çš„æ¸²æŸ“çº¿ç¨‹ï¼Œå¯ä»¥å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾</li><li>SurfaceTextureï¼šå°†å›¾åƒæµè½¬ä¸º OpenGL å¤–éƒ¨çº¹ç†ï¼Œä¸ç›´æ¥æ˜¾ç¤º</li><li>GLSurfaceViewï¼šåŠ å…¥ EGL ç®¡ç†ï¼Œè‡ªå¸¦ GL ä¸Šä¸‹æ–‡å’Œ GL æ¸²æŸ“çº¿ç¨‹</li></ul><h4 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h4><h4 id="Native-Crash"><a href="#Native-Crash" class="headerlink" title="Native Crash"></a>Native Crash</h4><ul><li>å´©æºƒè¿‡ç¨‹ï¼šnative crash æ—¶æ“ä½œç³»ç»Ÿä¼šå‘è¿›ç¨‹å‘é€ä¿¡å·ï¼Œå´©æºƒä¿¡æ¯ä¼šå†™å…¥åˆ° data/tombstones ä¸‹ï¼Œå¹¶åœ¨ logcat è¾“å‡ºå´©æºƒæ—¥å¿—</li><li>å®šä½ï¼šso åº“å‰¥ç¦»è°ƒè¯•ä¿¡æ¯çš„è¯ï¼Œåªæœ‰ç›¸å¯¹ä½ç½®æ²¡æœ‰å…·ä½“è¡Œå·ï¼Œå¯ä»¥ä½¿ç”¨ NDK æä¾›çš„ addr2line æˆ– ndk-stack æ¥å®šä½</li><li>addr2lineï¼šæ ¹æ®æœ‰è°ƒè¯•ä¿¡æ¯çš„ so å’Œç›¸å¯¹ä½ç½®å®šä½å®é™…çš„ä»£ç å¤„</li><li>ndk-stackï¼šå¯ä»¥åˆ†æ tombstone æ–‡ä»¶ï¼Œå¾—åˆ°å®é™…çš„ä»£ç è°ƒç”¨æ ˆ</li></ul><h4 id="FFmpeg"><a href="#FFmpeg" class="headerlink" title="FFmpeg"></a>FFmpeg</h4><ul><li>åŸºäºå‘½ä»¤æ–¹å¼å®ç°äº†ä¸€ä¸ªéŸ³è§†é¢‘ç¼–è¾‘ Appï¼š<a href="https://github.com/yhaolpz/FFmpegCmd" target="_blank" rel="noopener">FFEditor</a></li><li>é›†æˆç¼–è¯‘äº† AACã€MP3ã€H264 ç¼–ç å™¨</li></ul><h4 id="æ’­æ”¾å™¨åŸç†"><a href="#æ’­æ”¾å™¨åŸç†" class="headerlink" title="æ’­æ”¾å™¨åŸç†"></a>æ’­æ”¾å™¨åŸç†</h4><ul><li>è§†é¢‘æ’­æ”¾åŸç†ï¼šï¼ˆmp4ã€flvï¼‰-&gt; è§£å°è£… -&gt; ï¼ˆmp3/aacã€h264/h265ï¼‰-&gt; è§£ç  -&gt; ï¼ˆpcmã€yuvï¼‰-&gt; éŸ³è§†é¢‘åŒæ­¥ -&gt; æ¸²æŸ“æ’­æ”¾</li><li>éŸ³è§†é¢‘åŒæ­¥ï¼š<ul><li>é€‰æ‹©å‚è€ƒæ—¶é’Ÿæºï¼šéŸ³é¢‘æ—¶é—´æˆ³ã€è§†é¢‘æ—¶é—´æˆ³å’Œå¤–éƒ¨æ—¶é—´ä¸‰è€…é€‰æ‹©ä¸€ä¸ªä½œä¸ºå‚è€ƒæ—¶é’Ÿæºï¼ˆä¸€èˆ¬é€‰æ‹©éŸ³é¢‘ï¼Œå› ä¸ºäººå¯¹éŸ³é¢‘æ›´æ•æ„Ÿï¼Œijk é»˜è®¤ä¹Ÿæ˜¯éŸ³é¢‘ï¼‰</li><li>é€šè¿‡ç­‰å¾…æˆ–ä¸¢å¸§å°†è§†é¢‘æµä¸å‚è€ƒæ—¶é’Ÿæºå¯¹é½ï¼Œå®ç°åŒæ­¥</li></ul></li></ul><h4 id="IjkPlayer-åŸç†"><a href="#IjkPlayer-åŸç†" class="headerlink" title="IjkPlayer åŸç†"></a>IjkPlayer åŸç†</h4><ul><li>é›†æˆäº† MediaPlayerã€ExoPlayer å’Œ IjkPlayer ä¸‰ç§å®ç°ï¼Œå…¶ä¸­ IjkPlayer åŸºäº FFmpeg çš„ ffplay </li><li>éŸ³é¢‘è¾“å‡ºæ–¹å¼ï¼šAudioTrackã€OpenSL ESï¼›è§†é¢‘è¾“å‡ºæ–¹å¼ï¼šNativeWindowã€OpenGL ES</li></ul><h1 id="7-AndroidStudio-amp-Lint-amp-gradle-amp-maven-amp-CI-amp-CD"><a href="#7-AndroidStudio-amp-Lint-amp-gradle-amp-maven-amp-CI-amp-CD" class="headerlink" title="7.AndroidStudio&amp;Lint&amp;gradle&amp;maven&amp;CI&amp;CD"></a>7.AndroidStudio&amp;Lint&amp;gradle&amp;maven&amp;CI&amp;CD</h1><h4 id="Lint"><a href="#Lint" class="headerlink" title="Lint"></a>Lint</h4><ul><li>Android Lintæ˜¯Googleæä¾›ç»™Androidå¼€å‘è€…çš„é™æ€ä»£ç æ£€æŸ¥å·¥å…·</li><li>ä½¿ç”¨Lintå¯¹Androidå·¥ç¨‹ä»£ç è¿›è¡Œæ‰«æå’Œæ£€æŸ¥ï¼Œå¯ä»¥å‘ç°ä»£ç æ½œåœ¨çš„é—®é¢˜ï¼Œæé†’ç¨‹åºå‘˜åŠæ—©ä¿®æ­£</li><li>åŸºäº Detectorã€IssueRegistry å®ç°ï¼Œé€šè¿‡ lintChecks project å¼•å…¥</li></ul><h4 id="CI-amp-CD"><a href="#CI-amp-CD" class="headerlink" title="CI&amp;CD"></a>CI&amp;CD</h4><ul><li>Continuous integrationï¼ˆæŒç»­é›†æˆï¼Œç®€ç§°CIï¼‰ï¼šé¢‘ç¹çš„å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ï¼Œé˜²æ­¢åˆ†æ”¯å¤§å¹…åç¦»ä¸»å¹²ï¼Œæ–¹ä¾¿å¿«é€Ÿå‘ç°é”™è¯¯</li><li>Continuous deliveryï¼ˆæŒç»­äº¤ä»˜ï¼‰ï¼šé¢‘ç¹åœ°å°†è½¯ä»¶çš„æ–°ç‰ˆæœ¬ï¼Œäº¤ä»˜ç»™è´¨é‡å›¢é˜Ÿæˆ–è€…ç”¨æˆ·ï¼Œä»¥ä¾›è¯„å®¡</li><li>Continuous deploymentï¼ˆæŒç»­éƒ¨ç½²ï¼‰ï¼šæŒç»­äº¤ä»˜çš„ä¸‹ä¸€æ­¥ï¼ŒæŒ‡çš„æ˜¯ä»£ç é€šè¿‡è¯„å®¡ä»¥åï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</li><li>äº¤ä»˜åéœ€è¦è¿›è¡Œæ„å»ºï¼Œå°†æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡Œçš„å®é™…ä»£ç ï¼Œå¸¸ç”¨çš„æ„å»ºå·¥å…·æœ‰ Jenkinsã€Strider</li></ul><blockquote><h5 id="æŒç»­è¡¥å……ä¸­â€¦"><a href="#æŒç»­è¡¥å……ä¸­â€¦" class="headerlink" title="æŒç»­è¡¥å……ä¸­â€¦"></a>æŒç»­è¡¥å……ä¸­â€¦</h5></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç›®å½•ï¼š&quot;&gt;&lt;a href=&quot;#ç›®å½•ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ï¼š&quot;&gt;&lt;/a&gt;ç›®å½•ï¼š&lt;/h3&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;1.ç½‘ç»œ&amp;amp;ç®—æ³•&amp;amp;æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;2.Java åŸºç¡€&amp;amp;å®¹å™¨&amp;amp;åŒæ­¥&amp;amp;è®¾è®¡æ¨¡å¼&lt;/li&gt;
&lt;li&gt;3.Java è™šæ‹Ÿæœº&amp;amp;å†…å­˜ç»“æ„&amp;amp;GC&amp;amp;ç±»åŠ è½½&amp;amp;å››ç§å¼•ç”¨&amp;amp;åŠ¨æ€ä»£ç†&lt;/li&gt;
&lt;li&gt;4.Android åŸºç¡€&amp;amp;æ€§èƒ½ä¼˜åŒ–&amp;amp;Framwork&lt;/li&gt;
&lt;li&gt;5.Android æ¨¡å—åŒ–&amp;amp;çƒ­ä¿®å¤&amp;amp;çƒ­æ›´æ–°&amp;amp;æ‰“åŒ…&amp;amp;æ··æ·†&amp;amp;å‹ç¼©&amp;amp;AOP&lt;/li&gt;
&lt;li&gt;6.JNI&amp;amp;éŸ³è§†é¢‘&amp;amp;FFmpeg&amp;amp;æ’­æ”¾å™¨&lt;/li&gt;
&lt;li&gt;7.AndroidStudio&amp;amp;Lint&amp;amp;gradle&amp;amp;maven&amp;amp;CI&amp;amp;CD&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yhaowa.gitee.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹ Android å¼€å‘çš„ä¸€ç‚¹æ€è€ƒ</title>
    <link href="http://yhaowa.gitee.io/f713728e/"/>
    <id>http://yhaowa.gitee.io/f713728e/</id>
    <published>2019-04-07T09:17:09.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>17 å¹´æ¯•ä¸šå¼€å§‹å·¥ä½œåˆ°ç°åœ¨å·²å¿«ä¸¤ä¸ªå¹´å¤´ï¼Œåœ¨å®é™…é¡¹ç›®å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å¯¹ Android å¼€å‘æœ‰äº†ä¸€äº›è‡ªå·±çš„æ€è€ƒã€‚æœ¬ç€ç¢°æ’æ‰ä¼šæœ‰ç«èŠ±ã€è®¨è®ºæ‰ä¼šè¿›æ­¥çš„ç†å¿µï¼Œæˆ‘æŠŠå¯¹ Android å¼€å‘çš„ä¸€ç‚¹æ€è€ƒåˆ†äº«å‡ºæ¥ï¼ŒçœŸè¯šçš„å¸Œæœ›å¯ä»¥æœ‰ä¸åŒçš„è§‚ç‚¹ï¼Œåœ¨çº ç»“åé©³ä¹‹ä¸­å¾—åˆ°æœ€ä¼˜è§£ï¼Œå…±åŒè¿›æ­¥ã€‚</p><a id="more"></a><p>æœ€åˆçš„æ—¶å€™ï¼Œä½ æ˜¯å¦æ˜¯ä¸€ä¸ªå®Œç¾ä¸»ä¹‰è€…ï¼Œä¸å®¹å¿ä»»ä½•ä¸€ç‚¹ warning ä¸å¹å·ï¼Œif å¿…æœ‰ elseï¼Œswitch å¿…æœ‰ defaultï¼Œå³ä½¿ else å’Œ default ä¸­ç¡®å®ä»€ä¹ˆä¹Ÿä¸ç”¨å¤„ç†ï¼Œä½ ä¹Ÿä¼šæ·»åŠ ä¸€ä¸ª //do nothing æ³¨é‡Šï¼Œè¡¨ç¤ºè¿™é‡Œçš„é€»è¾‘æ˜¯ç»è¿‡å……åˆ†è€ƒè™‘çš„ï¼Œä¸‹æ¬¡é˜…è¯»ç¨‹åºæ—¶ï¼Œå‘Šè¯‰åˆ«äººä¹Ÿå‘Šè¯‰è‡ªå·±ï¼Œè¿™é‡Œçš„ç¡®ä»€ä¹ˆä¹Ÿä¸ç”¨å¤„ç†ï¼Œå¯ä»¥å¿«é€Ÿè·³è¿‡ã€‚</p><p>æˆ‘æƒ³å¤§å¤šæ•°å¼€å‘è€…ï¼Œéƒ½æ˜¯ç»å†è¿‡è¿™ç§å¿ƒæ€çš„ï¼Œç„¶ååœ¨ç¹å¿™çš„ç‰ˆæœ¬è¿­ä»£ä¸­ã€åœ¨èµ¶ç€å›å®¶çš„åŠ ç­æ—¶ã€åœ¨æ„ˆæ¥æ„ˆå‘çš„å¯¹è‡ªå·±çš„è–ªæ°´ä¸æ»¡æ—¶ã€åœ¨ä¸€æ¬¡åˆä¸€æ¬¡çœ‹åˆ°å›¢é˜Ÿä¸­åˆ«äººå¾—è¿‡ä¸”è¿‡çš„ä»£ç æ—¶ï¼Œæ¸æ¸çš„ï¼Œå°±å¯èƒ½å¯¹â€œç”Ÿæ´»â€å¦¥åï¼Œä¸¢æ‰äº†å®Œç¾ä¸»ä¹‰ã€‚</p><p>ç„¶è€Œå¦‚æœä½ æœ‰æ›´é«˜çš„è¿½æ±‚ï¼Œå°±è¦å‹‡æ•¢çš„æˆ˜èƒœè‡ªå·±çš„æ„Ÿæ€§ã€‚</p><h3 id="ä½¿ç”¨-IntDefã€StringDef"><a href="#ä½¿ç”¨-IntDefã€StringDef" class="headerlink" title="ä½¿ç”¨ IntDefã€StringDef"></a>ä½¿ç”¨ IntDefã€StringDef</h3><p>å¹³æ—¶ç‰¹å¸¸ç”¨çš„ View.setVisibility() æ–¹æ³•ä½¿ç”¨ IntDef æ¥è§„å®šå‚æ•°çš„å¯é€‰é¡¹ï¼Œå¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå‡å¦‚æ²¡ç”¨ IntDef ä¼šæ€ä¹ˆæ ·ï¼Ÿå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå¯èƒ½è¦ç¨å¾®é˜…è¯»ä¸€ä¸‹æºç æˆ–æŸ¥ä¸‹èµ„æ–™æ‰èƒ½çŸ¥é“ setVisibility æœ‰å“ªäº›å‚æ•°å¯ä»¥è®¾ç½®ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—æ²¡ä»€ä¹ˆå·®ï¼Œå› ä¸ºä½ å¾ˆæ¸…æ¥š setVisibility æ–¹æ³•æœ‰å“ªäº›å‚æ•°å¯ä»¥è®¾ç½®ã€‚ä½†è‹¥æ˜¯ç¨‹åºä¸­æ–°å¢çš„ä¸€ä¸ªæ–¹æ³•å‘¢ï¼Ÿæ¯”å¦‚ä½ æ–°æ¥è§¦ä¸€ä¸ªæ¨¡å—ï¼ŒæŸä¸ªç•Œé¢æœ‰è‹¥å¹²ä¸ªè·³è½¬ Actionï¼Œä½ å¾—å…ˆæ‰¾åˆ°å®šä¹‰è¿™äº› Action çš„åœ°æ–¹ï¼Œè€Œè‹¥ä¸€ä¸å°å¿ƒå°†è¿™äº› Action åˆ†æ•£å†™åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œé‚£å¯¹åé¢çš„ç»´æŠ¤å’Œæ‹“å±•å¯èƒ½å°±æ˜¯ä¸€ä¸ªç¾éš¾ã€‚</p><p>å»ºè®®å‡¡æ˜¯ç¬¦åˆè¯­ä¹‰çš„é€»è¾‘ï¼Œéƒ½å¿…é¡»ç”¨ IntDefã€StringDef æ¥çº¦æŸï¼Œå®ƒæ¯”æšä¸¾èŠ‚çœå†…å­˜ï¼Œæ€§èƒ½æ›´ä¼˜ï¼Œå…¶ RetentionPolicy.SOURCE è¡¨ç¤ºæ­¤æ³¨è§£åªåœ¨æºç ä¸­å­˜åœ¨ï¼Œç¼–è¯‘æ—¶ä¼šå‰”é™¤ã€‚ä½ å¯ä»¥åœ¨ Android Studio çš„ Live Templates ä¸­æ·»åŠ  IntDefã€StringDef å†™æ³•ï¼š<br><img src="../img/14.jpg" alt></p><h3 id="ä½¿ç”¨ç²¾å‡†è¡¨è¾¾çš„å˜é‡ç±»å‹"><a href="#ä½¿ç”¨ç²¾å‡†è¡¨è¾¾çš„å˜é‡ç±»å‹" class="headerlink" title="ä½¿ç”¨ç²¾å‡†è¡¨è¾¾çš„å˜é‡ç±»å‹"></a>ä½¿ç”¨ç²¾å‡†è¡¨è¾¾çš„å˜é‡ç±»å‹</h3><p>æ¯”å¦‚ä½ éœ€è¦å£°æ˜ä¸€ä¸ªå˜é‡æ¥è¡¨ç¤ºæŸä¸ªåŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼Œè­¬å¦‚æ§åˆ¶ä½ çš„ App æ˜¯å¦å±•ç¤ºå¹¿å‘Šï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æœåŠ¡ç«¯åœ¨çº¿ä¸‹å‘å¼€å…³æ¥æ§åˆ¶ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°ä¸‹å‘çš„å¼€å…³ï¼Œå°±æ ¹æ®åœ°åŒºæ¥å†³å®šæ˜¯å¦å±•ç¤ºã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ä½ ä¼šä½¿ç”¨ä»€ä¹ˆç±»å‹çš„å˜é‡ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨ä¸€ä¸ª int ç±»å‹å˜é‡æ¥æ§åˆ¶ï¼Œç„¶åéœ€è¦ç»™è¿™ä¸ªå˜é‡åŠ ä¸Šæ³¨é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0ï¼šå±•ç¤ºï¼› 1ï¼šä¸å±•ç¤ºï¼› 2ï¼šæœªæ¥æ”¶åˆ°åœ¨çº¿å¼€å…³ï¼Œéœ€è¦æ ¹æ®åœ°åŒºå†³å®šæ˜¯å¦å±•ç¤º</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mShouldShowAd;</span><br></pre></td></tr></table></figure><p>ä»¥åæ¯å½“æ”¹åŠ¨åˆ°è¿™éƒ¨åˆ†é€»è¾‘ï¼Œéƒ½éœ€è¦æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå˜é‡æ•°å€¼å¯¹åº”çš„å«ä¹‰ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å’Œä»£ç é‡çš„å¢å¤šï¼Œåœ¨æ­¤é€»è¾‘ä¹‹ä¸Šå¯èƒ½å †ç§¯äº†å¾ˆå¤šä»£ç ï¼Œç„¶åå°±ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼Œåˆ«äººå¯èƒ½åœ¨ä¸å­˜åœ¨çš„é€»è¾‘åˆ†æ”¯åšäº†ä¸€äº›äº‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mShouldShowAd == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mShouldShowAd == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mShouldShowAd == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”šè‡³å¯èƒ½å¯¹è¿™ä¸ªå˜é‡èµ‹å€¼ [0,2] åŒºé—´ä¹‹å¤–çš„æ•°å€¼ï¼ ä½ å¯èƒ½å¯¹è¿™ä¸ªå˜é‡çš„æ„ä¹‰å¾ˆäº†è§£ä¹Ÿç»ä¸ä¼šç”¨é”™ï¼Œä½†ä½ ä¸èƒ½ä¿è¯ä»–äººä¸ä¼šå‡ºç°ä¸Šé¢æ‰€è¯´çš„è’å”çš„ç”¨æ³•ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡ç±»å‹å¹¶ä¸èƒ½å¾ˆç²¾å‡†çš„è¡¨è¾¾å®ƒçš„è¯­ä¹‰ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•çº¦æŸæ€§ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ€æ ·æ”¹å–„è¿™ç§éš¾ç»´æŠ¤ã€æœ‰é£é™©çš„ä»£ç ï¼Ÿ</p><ul><li>å¯ä»¥ä½¿ç”¨ IntDef è§„å®šè¿™ä¸ªå˜é‡çš„å–å€¼</li><li>å¯ä»¥æ¢æˆ Boolean ç±»å‹ï¼Œç”¨ null è¡¨ç¤ºæœªè·å–åˆ°åœ¨çº¿å¼€å…³ï¼Œæ°å¥½çš„è¡¨è¾¾è¯­ä¹‰å¹¶ä¸”æ˜“è¯»ã€æ˜“ç»´æŠ¤</li></ul><h3 id="ä½¿ç”¨å°½å¯èƒ½å°‘çš„å˜é‡"><a href="#ä½¿ç”¨å°½å¯èƒ½å°‘çš„å˜é‡" class="headerlink" title="ä½¿ç”¨å°½å¯èƒ½å°‘çš„å˜é‡"></a>ä½¿ç”¨å°½å¯èƒ½å°‘çš„å˜é‡</h3><p>ä¸¾ä¸ªä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mDebug = BuildConfig.DEBUG;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mDebug) &#123;</span><br><span class="line">    Log.d(TAG, <span class="string">"..."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½ æ˜¯å¦å†™è¿‡è¿™æ ·çš„é€»è¾‘ï¼Ÿæ˜æ˜å·²ç»å­˜åœ¨äº†ä¸€ä¸ªå¯ä»¥ç›´æ¥ä½¿ç”¨çš„å˜é‡æ¡ä»¶ï¼Œä½ ä»ç„¶è¦é‡æ–°å®šä¹‰ã€‚è¿™ä¸ªä¾‹å­é€»è¾‘è¿˜ååˆ†ç®€å•ï¼Œæ­¤å˜é‡æ˜¯ final ç±»å‹çš„ï¼Œä¸ä¼šå‡ºé”™ã€‚è€Œå¦‚æœæ˜¯é final ç±»å‹çš„å˜é‡ï¼Œé‚£å°±æ˜¯å¼ºè¡Œå¢åŠ äº†ä¸€ä¸ªèµ‹å€¼è”åŠ¨çš„é€»è¾‘ï¼ŒåŸ‹ä¸‹äº†éšæ‚£ï¼Œåç»­å¦‚æœå‡ºäº†é—®é¢˜ï¼Œç™½ç™½çš„å¢åŠ äº†å®šä½é—®é¢˜çš„è·¯å¾„ä¸å¤æ‚åº¦ã€‚</p><p>å®é™…å¼€å‘ä¸­æˆ‘ä»¬å¯èƒ½è‡ªå·±éƒ½æ„è¯†ä¸åˆ°ä½¿ç”¨äº†ä¸å¿…è¦çš„å˜é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æœåŠ¡ç«¯æ¥å£ä¸€èˆ¬ä¼šæœ‰å¤šä¸ªæ¥å£ç¯å¢ƒï¼Œé‚£ä½ çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ˜¯å¦æ˜¯æµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> sIsApiHostTest;</span><br><span class="line"><span class="comment">//æ˜¯å¦æ˜¯betaç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> sIsApiHostBeta;</span><br><span class="line"><span class="comment">//æ­£å¼ç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHost = <span class="string">"http://api.com/"</span>;</span><br><span class="line"><span class="comment">//æµ‹è¯•ç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostTest = <span class="string">"http://test.api.com/"</span>;</span><br><span class="line"><span class="comment">//betaç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostBeta = <span class="string">"http://beta.api.com/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦æ˜¯æµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sIsApiHostTest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦æ˜¯betaç¯å¢ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiBeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sIsApiHostBeta;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ¥å£åŸŸå</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getApiHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isApiTest()) &#123;</span><br><span class="line">        <span class="keyword">return</span> sApiHostTest;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isApiBeta()) &#123;</span><br><span class="line">        <span class="keyword">return</span> sApiHostBeta;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sApiHost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·çœ‹èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œåªè¦ç»´æŠ¤å¥½ sIsApiHostTestã€sIsApiHostBeta è¿™ä¸¤ä¸ªå˜é‡å°±è¡Œäº†ã€‚å¦‚æœåé¢åˆæ·»åŠ äº†ä¸€ä¸ªç¯å¢ƒå‘¢ï¼Ÿåˆæ·»åŠ äº†ä¸‰å››ä¸ªç¯å¢ƒå‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¿˜è¦ç»´æŠ¤å¤šä¸ªå˜é‡ï¼Ÿè¿™ä¸ªé€»è¾‘å¯ä»¥é€šè¿‡å‡å°‘å˜é‡æ¥æ”¹å–„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“å‰ç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sCurApiHost;</span><br><span class="line"><span class="comment">//æ­£å¼ç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHost = <span class="string">"http://api.com/"</span>;</span><br><span class="line"><span class="comment">//æµ‹è¯•ç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostTest = <span class="string">"http://test.api.com/"</span>;</span><br><span class="line"><span class="comment">//betaç¯å¢ƒhost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostBeta = <span class="string">"http://beta.api.com/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦æ˜¯æµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sApiHostTest.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦æ˜¯betaç¯å¢ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiBeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sApiHostBeta.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ¥å£åŸŸå</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getApiHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sCurApiHost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å†åŠ ä¸Š StringDef å°±å®Œç¾äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@StringDef</span>(&#123;ApiHost.sApiHost, ApiHost.sApiHostTest, ApiHost.sApiHostBeta&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ApiHost &#123;</span><br><span class="line">    <span class="comment">//æ­£å¼ç¯å¢ƒhost</span></span><br><span class="line">    String sApiHost = <span class="string">"http://api.com/"</span>;</span><br><span class="line">    <span class="comment">//æµ‹è¯•ç¯å¢ƒhost</span></span><br><span class="line">    String sApiHostTest = <span class="string">"http://test.api.com/"</span>;</span><br><span class="line">    <span class="comment">//betaç¯å¢ƒhost</span></span><br><span class="line">    String sApiHostBeta = <span class="string">"http://beta.api.com/"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“å‰ç¯å¢ƒhost</span></span><br><span class="line"><span class="meta">@ApiHost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sCurApiHost = ApiHost.sApiHost;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦æ˜¯æµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ApiHost.sApiHostTest.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦æ˜¯betaç¯å¢ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiBeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ApiHost.sApiHostBeta.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ¥å£åŸŸå</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiHost</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getApiHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sCurApiHost;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®æ¥å£åŸŸå</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiHost</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setApiHost</span><span class="params">(@ApiHost String apiHost)</span> </span>&#123;</span><br><span class="line">    sCurApiHost = apiHost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ„Ÿå—åˆ°æ˜“è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€æ‹“å±•æ€§éƒ½è¹­è¹­è¹­çš„å¾€ä¸Šæ¶¨å‘¢ï¼Ÿ</p><h3 id="å•ä¸€æ•°æ®æº"><a href="#å•ä¸€æ•°æ®æº" class="headerlink" title="å•ä¸€æ•°æ®æº"></a>å•ä¸€æ•°æ®æº</h3><p>åŒæ—¶æ¥å—å¤šä¸ªæ•°æ®æºæ•°æ®çš„é€»è¾‘ç›¸æ¯”åªæ¥å—ä¸€ä¸ªæ•°æ®æºçš„æ•°æ®éœ€è¦è€ƒè™‘æ—¶åºæ€§ç­‰é—®é¢˜ï¼Œè¦å¤æ‚å¾ˆå¤šã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¯ä»¥æŠŠæ•°æ®æºå½“ä½œä½ çš„ç›´æ¥ä¸Šçº§ï¼Œä¸Šçº§ä¼šä¸å®šæ—¶çš„åˆ†é…ä»»åŠ¡ç»™ä½ åšï¼Œå¦‚æœä½ æœ‰å¤šä¸ªä¸Šçº§ï¼Œä¸€ä¸ªè®©ä½ åšä»»åŠ¡ Aï¼Œä¸€ä¸ªè®©ä½ åšä»»åŠ¡ Bï¼Œä¸” A éœ€è¦åœ¨ B ä¹‹å‰å®Œæˆï¼Œä½ è¦æ€ä¹ˆåŠï¼Ÿä¸¤ä¸ªä¸Šçº§éƒ½è®©ä½ åšä»»åŠ¡ Aï¼Œä½†æ˜¯åªç”¨åšä¸€æ¬¡ï¼Œä½ è¦æ€ä¹ˆåŠï¼Ÿ</p><p>åœ¨å®‰å“ä¸­è¾ƒä¸ºå…¸å‹çš„åœºæ™¯å°±æ˜¯åŒæ—¶åŠ è½½ç½‘ç»œå’Œæœ¬åœ°ç¼“å­˜æ•°æ®åˆ° UI ä¸Šï¼Œä½ çš„ UI ä¸Šå±•ç¤ºçš„æ•°æ®æ¥è‡ªä¸åŒçš„åœ°æ–¹ï¼Œä½ éœ€è¦è€ƒè™‘ä¸åŒæ•°æ®æºä¹‹é—´å¦‚ä½•åä½œã€‚è°·æ­Œæ¨å‡ºçš„ Jetpack å¼€å‘æŒ‡å—ä¸Šæ¨èæˆ‘ä»¬ä½¿ç”¨å•ä¸€æ•°æ®æºï¼Œå‡å¦‚ä½ çš„ç½‘ç»œæ•°æ®ä¹Ÿéœ€è¦ç¼“å­˜çš„è¯ï¼Œé‚£ä½ çš„å®ç°é€»è¾‘åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><ul><li>åŠ è½½ç½‘ç»œæ•°æ®ï¼Œè¿”å›åæ’å…¥åˆ°æœ¬åœ°<ul><li>ç»Ÿä¸€ä»æœ¬åœ°å–æ•°æ®å±•ç¤ºåˆ° UI ä¸Š</li></ul></li></ul><p>è¿™ç‚¹å’Œä¸Šé¢è¯´çš„â€œä½¿ç”¨å°½å¯èƒ½å°‘çš„å˜é‡â€æœ‰ç›¸é€šä¹‹å¤„ï¼Œéƒ½æ˜¯å°½é‡è§„é¿ä½¿ç”¨å¤šä¸ªæ¡ä»¶å˜é‡å¯¹ç¨‹åºäº§ç”Ÿå½±å“çš„é€»è¾‘ã€‚</p><h3 id="èŒè´£åˆ†ç¦»"><a href="#èŒè´£åˆ†ç¦»" class="headerlink" title="èŒè´£åˆ†ç¦»"></a>èŒè´£åˆ†ç¦»</h3><p>å¼ºçƒˆå»ºè®®ä»€ä¹ˆç±»é‡Œå°±å¹²ä»€ä¹ˆäº‹ï¼Œåˆ«æŠŠé€»è¾‘éƒ½æ‰åˆ°ä¸€å—å„¿ï¼Œè¿™æ ·éšç€ä»£ç é‡çš„å¢åŠ ï¼Œä¼šæ„ˆå‘çš„éš¾ä»¥ç»´æŠ¤ï¼Œåˆ°æœ€åå°±å˜æˆä¸€é¢—å­˜åœ¨é‡å¤§éšæ‚£çš„åœ°é›·ï¼Œçœ‹è§å°±å¤´ç–¼ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ è¦è‡ªå®šä¹‰ä¸€ä¸ª Viewï¼Œé‚£å°±åƒç³»ç»Ÿæ§ä»¶ä¸€æ ·ï¼Œåªè´Ÿè´£ä¸€ä¸ªæ§ä»¶è¯¥è´Ÿè´£çš„äº‹ï¼Œå¤„ç†ä¸€ä¸‹æ¸²æŸ“ã€å±•ç¤ºï¼ŒæŠŠæ‰‹åŠ¿äº¤äº’é€šè¿‡æ¥å£å¼€æ”¾å‡ºæ¥ï¼ŒæŠŠæ•°æ®çš„è·å–å†™åœ¨æ•°æ®ä»“åº“ä¸­ã€‚è¿™æ ·å¦‚æœæ•°æ®å±•ç¤ºå‡ºäº†é—®é¢˜ï¼Œå¯ä»¥å¾ˆå¿«çš„å®šä½åˆ°æ˜¯æ•°æ®è·å–å‡ºäº†é—®é¢˜ï¼Œè¿˜æ˜¯æ¸²æŸ“å±•ç¤ºå‡ºäº†é—®é¢˜ï¼›å¦‚æœè¿™ä¸ªæ§ä»¶çš„æ¸²æŸ“å±•ç¤ºæ˜¯ç»è¿‡éªŒè¯çš„ï¼Œä¹‹åå°±å‡ ä¹ä¸ç”¨æ”¹åŠ¨æ­¤æ§ä»¶ï¼Œè‡³å°‘ä½ æœ‰æœºä¼šå¯ä»¥å°†ä½ çš„è‡ªå®šä¹‰ View å†™çš„åƒç³»ç»Ÿçš„æ§ä»¶ä¸€æ ·ç¨³å®šã€‚</p><p>è¿™é‡Œå†æ¨èä¸€ä¸‹è°·æ­Œçš„ Jetpack - MVVM å…¨å®¶æ¡¶ï¼ŒMVC çœŸçš„æ˜¯ä¸æ˜“è¯»ã€éš¾ç»´æŠ¤ã€é—®é¢˜å¤šã€å¾ˆç®€é™‹ã€‚</p><h3 id="å›å½’æœ€åˆçš„å®Œç¾ä¸»ä¹‰"><a href="#å›å½’æœ€åˆçš„å®Œç¾ä¸»ä¹‰" class="headerlink" title="å›å½’æœ€åˆçš„å®Œç¾ä¸»ä¹‰"></a>å›å½’æœ€åˆçš„å®Œç¾ä¸»ä¹‰</h3><p>å¸Œæœ›ä½ æˆ‘å¯ä»¥æˆ˜èƒœæ„Ÿæ€§ï¼Œä¸å‘â€œç”Ÿæ´»â€å¦¥åï¼Œè®©ä¼˜ç§€æˆä¸ºå‡†åˆ™å’Œä¹ æƒ¯ï¼Œå›å½’æœ€åˆçš„å®Œç¾ä¸»ä¹‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;17 å¹´æ¯•ä¸šå¼€å§‹å·¥ä½œåˆ°ç°åœ¨å·²å¿«ä¸¤ä¸ªå¹´å¤´ï¼Œåœ¨å®é™…é¡¹ç›®å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å¯¹ Android å¼€å‘æœ‰äº†ä¸€äº›è‡ªå·±çš„æ€è€ƒã€‚æœ¬ç€ç¢°æ’æ‰ä¼šæœ‰ç«èŠ±ã€è®¨è®ºæ‰ä¼šè¿›æ­¥çš„ç†å¿µï¼Œæˆ‘æŠŠå¯¹ Android å¼€å‘çš„ä¸€ç‚¹æ€è€ƒåˆ†äº«å‡ºæ¥ï¼ŒçœŸè¯šçš„å¸Œæœ›å¯ä»¥æœ‰ä¸åŒçš„è§‚ç‚¹ï¼Œåœ¨çº ç»“åé©³ä¹‹ä¸­å¾—åˆ°æœ€ä¼˜è§£ï¼Œå…±åŒè¿›æ­¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yhaowa.gitee.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
      <category term="å¼€å‘æ¨¡å¼" scheme="http://yhaowa.gitee.io/tags/%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªè½»é‡çš„ Android ç«¯æ—¥å¿—æ‰“å°è®°å½•åº“</title>
    <link href="http://yhaowa.gitee.io/f346f34f/"/>
    <id>http://yhaowa.gitee.io/f346f34f/</id>
    <published>2019-03-31T06:22:56.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p> åœ°å€ï¼š<a href="https://github.com/yhaolpz/PLog" target="_blank" rel="noopener">https://github.com/yhaolpz/PLog</a></p><p><img src="../img/2.jpg" alt></p><p>PLog å³ Persistence Logï¼Œå¯æŒä¹…åŒ–æ—¥å¿—äºæ–‡ä»¶ï¼Œä¾¿äºè¿˜åŸç”¨æˆ·ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³å¼‚å¸¸é—®é¢˜ã€‚</p><h2 id="ç‰¹æ€§ï¼š"><a href="#ç‰¹æ€§ï¼š" class="headerlink" title="ç‰¹æ€§ï¼š"></a>ç‰¹æ€§ï¼š</h2><p>1.mmap æ–¹å¼é«˜æ•ˆå†™å…¥ï¼Œè§„é¿ IO æ“ä½œå¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—</p><p>2.å…¼å®¹å¤šè¿›ç¨‹å¹¶å‘æ–‡ä»¶å†™å…¥ï¼Œæ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨å„è‡ªçš„è¿›ç¨‹ç›®å½•ä¸‹</p><p>3.é€šè¿‡ zip å‹ç¼©å¹¶åŠ å¯†ï¼ŒèŠ‚çœä¸ŠæŠ¥æµé‡ï¼Œä¿æŠ¤æ—¥å¿—ç§å¯†æ€§</p><p>4.å†…ç½®æ”¶é›† Activity/Fragment ç”Ÿå‘½å‘¨æœŸã€å´©æºƒã€ç½‘ç»œçŠ¶æ€ç­‰å¸¸ç”¨ä¿¡æ¯ï¼š</p><a id="more"></a><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h5 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1.åˆå§‹åŒ–"></a>1.åˆå§‹åŒ–</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PLog.Config config = <span class="keyword">new</span> PLog.Config.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .logDir(mLogDirPath) <span class="comment">//æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œé»˜è®¤ä¼˜å…ˆå­˜å‚¨äºSDå¡</span></span><br><span class="line">        .logcatDebugLevel(PLog.DebugLevel.DEBUG) <span class="comment">//å…è®¸è¾“å‡ºåˆ°Logcatçš„çº§åˆ«</span></span><br><span class="line">        .recordDebugLevel(PLog.DebugLevel.DEBUG) <span class="comment">//å…è®¸è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶çš„çº§åˆ«</span></span><br><span class="line">        .fileSizeLimitDay(<span class="number">15</span>) <span class="comment">//å•å¤©æ—¥å¿—æ–‡ä»¶å­˜å‚¨ä¸Šé™</span></span><br><span class="line">        .overdueDay(<span class="number">3</span>) <span class="comment">//æ—¥å¿—æ–‡ä»¶è¿‡æœŸå¤©æ•°</span></span><br><span class="line">        .cipherKey(<span class="string">"123456"</span>) <span class="comment">//æ—¥å¿—å¯†é’¥</span></span><br><span class="line">        .build();</span><br><span class="line">PLog.init(config);</span><br></pre></td></tr></table></figure><h5 id="2-æ‰“å°"><a href="#2-æ‰“å°" class="headerlink" title="2.æ‰“å°"></a>2.æ‰“å°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ™®é€šæ‰“å°</span></span><br><span class="line">PLog.d(<span class="string">"wyh"</span>, <span class="string">"This is a log that can be recorded in a file"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Format</span></span><br><span class="line">PLog.d(<span class="string">"wyh"</span>, <span class="string">"This is a %s"</span>, <span class="string">"log"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ•°ç»„ç±»å‹</span></span><br><span class="line">PLog.d(<span class="string">"wyh"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;);</span><br><span class="line"><span class="comment">//output: [a,b,c]</span></span><br></pre></td></tr></table></figure><h5 id="3-åªè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶"><a href="#3-åªè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶" class="headerlink" title="3.åªè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶"></a>3.åªè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLog.record(PLog.DebugLevel.DEBUG,<span class="string">"wyh"</span>,<span class="string">"This is a log that can only be recorded in files"</span>);</span><br></pre></td></tr></table></figure><h5 id="4-åªè¾“å‡ºåˆ°logcat"><a href="#4-åªè¾“å‡ºåˆ°logcat" class="headerlink" title="4.åªè¾“å‡ºåˆ°logcat"></a>4.åªè¾“å‡ºåˆ°logcat</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLog.print(PLog.DebugLevel.DEBUG,<span class="string">"wyh"</span>,<span class="string">"This is a log"</span>);</span><br></pre></td></tr></table></figure><h5 id="5-è§¦å‘ä¸Šä¼ "><a href="#5-è§¦å‘ä¸Šä¼ " class="headerlink" title="5.è§¦å‘ä¸Šä¼ "></a>5.è§¦å‘ä¸Šä¼ </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PLog.upload(<span class="keyword">new</span> UploadListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(@NonNull List&lt;File&gt; files)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ä¸Šä¼ åˆ°ä½ çš„æœåŠ¡ç«¯</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å»ºè®®ä¸Šä¼ æˆåŠŸåŠæ—¶åˆ é™¤æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">             <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">                file.delete();</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å­˜å‚¨é€»è¾‘"><a href="#å­˜å‚¨é€»è¾‘" class="headerlink" title="å­˜å‚¨é€»è¾‘"></a>å­˜å‚¨é€»è¾‘</h2><h4 id="æ—¥å¿—æ–‡ä»¶ç±»å‹"><a href="#æ—¥å¿—æ–‡ä»¶ç±»å‹" class="headerlink" title="æ—¥å¿—æ–‡ä»¶ç±»å‹"></a>æ—¥å¿—æ–‡ä»¶ç±»å‹</h4><p>ä¸ºæ›´å¥½çš„åŒºåˆ†å¹¶ç®¡ç†æ—¥å¿—ï¼Œå°†ä»å†™å…¥åˆ°ä¸Šä¼ ç»å†ä¸åŒçŠ¶æ€çš„æ—¥å¿—æ–‡ä»¶åˆ’åˆ†ä¸ºä»¥ä¸‹ç±»å‹ï¼š</p><ul><li>â€œ-mmapâ€ æ­£åœ¨å†™å…¥çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸å¯ä¸Šä¼ ï¼Œæ–‡ä»¶å‘½åä¸º: yyyy-MM-dd-mmap</li><li>â€œ-mmap-upâ€ å†™å…¥å®Œæˆçš„æ—¥å¿—æ–‡ä»¶ï¼Œå¯å‹ç¼©ä¸Šä¼ ï¼Œæ–‡ä»¶å‘½åä¸º: yyyy-MM-dd-mmap-up</li><li>â€œ-mmap-up-oldâ€ å•å¤©è¾ƒæ—©å†™å…¥å®Œæˆçš„æ—¥å¿—å¤§å°ï¼Œå¯å‹ç¼©ä¸Šä¼ ï¼Œæ–‡ä»¶å‘½åä¸º: yyyy-MM-dd-mmap-up-old</li><li>â€œ-mmap-up-lastâ€ è§¦å‘ä¸Šä¼ æ—¶è¶…å‡ºå­˜å‚¨ä¸Šé™éƒ¨åˆ†çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸Šä¼ æ“ä½œçš„ä¸­é—´æ€ï¼Œä¸ä¼šé•¿ä¹…å­˜åœ¨ï¼Œå¯å‹ç¼©ä¸Šä¼ ï¼Œæ–‡ä»¶å‘½åä¸º: yyyy-MM-dd-mmap-up-last</li><li>â€œ.zipâ€ å·²å‹ç¼©åŠ å¯†çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¯ç›´æ¥ä¸Šä¼ ï¼Œæ–‡ä»¶å‘½åä¸º: yyyy-MM-dd HH:mm:ss.zip</li></ul><h4 id="æ§åˆ¶æ—¥å¿—æ—¶æ•ˆ"><a href="#æ§åˆ¶æ—¥å¿—æ—¶æ•ˆ" class="headerlink" title="æ§åˆ¶æ—¥å¿—æ—¶æ•ˆ"></a>æ§åˆ¶æ—¥å¿—æ—¶æ•ˆ</h4><p>æš‚å®šä¿ç•™æœ€è¿‘ä¸‰å¤©çš„æ—¥å¿—ï¼Œæ›´æ—©çš„æ—¥å¿—å°†ä¼šåœ¨ç‰¹å®šæ—¶æœºè‡ªåŠ¨æ¸…é™¤å½“å‰è¿›ç¨‹ç›®å½•æ‰€æœ‰ç±»å‹è¿‡æœŸçš„æ—¥å¿—æ–‡ä»¶ï¼Œè¿™äº›æ—¶æœºåŒ…æ‹¬ï¼š</p><ul><li>åˆå§‹åŒ–æ—¶</li><li>è§¦å‘ä¸Šä¼ é‡å‘½åæ—¥å¿—æ–‡ä»¶æ·»åŠ â€-upâ€æ—¶</li><li>è§¦å‘ä¸Šä¼ å‹ç¼©æ‰€æœ‰æ ‡è®°ä¸ºâ€-upâ€çš„å¯ä¸Šä¼ çš„æ—¥å¿—æ—¶</li><li>è§¦å‘ä¸Šä¼ æ‰«ææ‰€æœ‰â€.zipâ€å¯ä¸Šä¼ çš„æ—¥å¿—æ—¶</li></ul><h4 id="æ§åˆ¶å­˜å‚¨ä¸Šé™"><a href="#æ§åˆ¶å­˜å‚¨ä¸Šé™" class="headerlink" title="æ§åˆ¶å­˜å‚¨ä¸Šé™"></a>æ§åˆ¶å­˜å‚¨ä¸Šé™</h4><p>ç†è®ºä¸Šæˆ‘ä»¬åº”è¯¥é¿å…æ— æ„ä¹‰çš„æ—¥å¿—è®°å½•æ»¥ç”¨ï¼Œæ§åˆ¶æ—¥å¿—ä½“ç§¯ï¼Œä½†ä¸ºé¿å…æç«¯æƒ…å†µä¸‹å¤§é‡æ—¥å¿—å†™å…¥å¯¼è‡´å­˜å‚¨çˆ†ç‚¸ï¼Œé€šè¿‡å°†æ—¥å¿—æ–‡ä»¶åˆ†ä¸ºä¸¤ç‰‡æ§åˆ¶å­˜å‚¨ä¸Šé™ã€‚</p><p>è­¬å¦‚è§„å®šå•å¤©æ—¥å¿—å­˜å‚¨ä½“ç§¯ä¸Šé™ä¸º MAXï¼Œé€»è¾‘å¤§è‡´ä¸ºä¸‹ï¼š</p><ul><li>å½“å¤©æ—¥å¿—æ–‡ä»¶ -mmap å†™å…¥ä½“ç§¯è¾¾ MAX/3 æ—¶å°±ä¼šåœæ­¢å†™å…¥ï¼Œå¹¶å‘½åä¸º -mmap-upï¼Œç„¶åæ–°å»ºæ–‡ä»¶ -mmap ç»§ç»­å†™å…¥</li><li>å½“å†™å…¥è¾¾ MAX/3 æ—¶ï¼Œå…ˆå°†å·²å­˜åœ¨çš„ -mmap-up å‘½åä¸º -mmap-up-oldï¼Œå†å°†åˆšå†™æ»¡çš„ -mmap å‘½åä¸º -mmap-upï¼Œç„¶åæ–°å»ºæ–‡ä»¶ -mmap ç»§ç»­å†™å…¥</li><li>å½“å†™å…¥è¾¾ MAX/3 æ—¶ï¼Œå…ˆåˆ é™¤ -mmap-up-old æ–‡ä»¶ï¼Œå°†å·²å­˜åœ¨çš„ -mmap-up å‘½åä¸º -mmap-up-oldï¼Œå†å°†åˆšå†™æ»¡çš„ -mmap å‘½åä¸º -mmap-upï¼Œç„¶åæ–°å»ºæ–‡ä»¶ -mmap ç»§ç»­å†™å…¥</li></ul><p>æŒ‰ç…§æ­¤é€»è¾‘ï¼Œå‡å®šå½“å¤©å†™å…¥æ—¥å¿—ä½“ç§¯ä¸º SIZEï¼Œå¯ä»¥å°†å•å¤©æ—¥å¿—å­˜å‚¨æƒ…å†µåˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p><ul><li>a. SIZE &lt; MAX/3</li><li>b. MAX/3 &lt; SIZE &lt; MAX*2/3</li><li>c. MAX*2/3 &lt; SIZE &lt; MAX</li></ul><p>å½“å¤„äº a çŠ¶æ€æ—¶è§¦å‘ä¸Šä¼ ï¼š -mmap â€“&gt; -mmap-up â€“&gt; zip<br>å½“å¤„äº b çŠ¶æ€æ—¶è§¦å‘ä¸Šä¼ ï¼š -mmap-up â€“&gt; -mmap-up-old â€“&gt; zip ;  -mmap â€“&gt; -mmap-up â€“&gt; zip<br>å½“å¤„äº c çŠ¶æ€æ—¶è§¦å‘ä¸Šä¼ ï¼š -mmap-up-old â€“&gt; zip ;  -mmap-up â€“&gt; zip ;  -mmap â€“&gt; -mmap-up-last â€“&gt; zip</p><p>ä¸ºäº†é˜²æ­¢é¢‘ç¹çš„åˆ¤æ–­æ—¥å¿—ä½“ç§¯ï¼Œå¯è®¾ç½®æ¯éš”ä¸€å®šå†™å…¥æ¡æ•°ååˆ¤æ–­ä¸€æ¬¡è¿›è¡Œä¼˜åŒ–ï¼Œç›®å‰è®¾ç½®é—´éš”ä¸º 1000 æ¡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; åœ°å€ï¼š&lt;a href=&quot;https://github.com/yhaolpz/PLog&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/yhaolpz/PLog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../img/2.jpg&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;PLog å³ Persistence Logï¼Œå¯æŒä¹…åŒ–æ—¥å¿—äºæ–‡ä»¶ï¼Œä¾¿äºè¿˜åŸç”¨æˆ·ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³å¼‚å¸¸é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç‰¹æ€§ï¼š&quot;&gt;&lt;a href=&quot;#ç‰¹æ€§ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç‰¹æ€§ï¼š&quot;&gt;&lt;/a&gt;ç‰¹æ€§ï¼š&lt;/h2&gt;&lt;p&gt;1.mmap æ–¹å¼é«˜æ•ˆå†™å…¥ï¼Œè§„é¿ IO æ“ä½œå¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—&lt;/p&gt;
&lt;p&gt;2.å…¼å®¹å¤šè¿›ç¨‹å¹¶å‘æ–‡ä»¶å†™å…¥ï¼Œæ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨å„è‡ªçš„è¿›ç¨‹ç›®å½•ä¸‹&lt;/p&gt;
&lt;p&gt;3.é€šè¿‡ zip å‹ç¼©å¹¶åŠ å¯†ï¼ŒèŠ‚çœä¸ŠæŠ¥æµé‡ï¼Œä¿æŠ¤æ—¥å¿—ç§å¯†æ€§&lt;/p&gt;
&lt;p&gt;4.å†…ç½®æ”¶é›† Activity/Fragment ç”Ÿå‘½å‘¨æœŸã€å´©æºƒã€ç½‘ç»œçŠ¶æ€ç­‰å¸¸ç”¨ä¿¡æ¯ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yhaowa.gitee.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
      <category term="æ—¥å¿—" scheme="http://yhaowa.gitee.io/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>å•ä¾‹çš„çº¿ç¨‹å®‰å…¨åŠåºåˆ—åŒ–é—®é¢˜</title>
    <link href="http://yhaowa.gitee.io/1516a551/"/>
    <id>http://yhaowa.gitee.io/1516a551/</id>
    <published>2019-03-05T15:04:44.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>å•ä¾‹æ¨¡å¼å¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼äº†ï¼Œä½†åœ¨ä½¿ç”¨æ—¶ä¹Ÿæœ‰ä¸€äº›é—®é¢˜éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚çº¿ç¨‹å®‰å…¨æ€§å’Œåºåˆ—åŒ–ç ´åã€‚æœ¬æ–‡ä»¥å‡ ä¸ªé—®é¢˜ä¸ºå‡ºå‘ç‚¹ï¼Œåˆ†æå»¶è¿ŸåŠ è½½ã€çº¿ç¨‹å®‰å…¨ä»¥åŠåºåˆ—åŒ–ä¸‰ä¸ªæ–¹é¢ï¼Œæ·±å…¥äº†è§£ä¸€ä¸‹å•ä¾‹æ¨¡å¼çš„å„ç§å§¿åŠ¿ï¼Œä»¥ä¾¿åœ¨ä»Šåä½¿ç”¨æ—¶è¿½æ±‚æè‡´æ€§èƒ½  âŠ™ï¹âŠ™â€–âˆ£Â°</p><a id="more"></a><ul><li>é¥¿æ±‰æ–¹å¼å•ä¾‹åˆ°åº•æœ‰å¤šâ€œé¥¿â€ï¼Ÿ</li><li>é™æ€å†…éƒ¨ç±»ä¸ºä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Ÿ</li><li>æšä¸¾æ–¹å¼å•ä¾‹æ˜¯å»¶è¿ŸåŠ è½½çš„å—ï¼Ÿ</li><li>é¥¿æ±‰ã€é™æ€å†…éƒ¨ç±»ã€æšä¸¾æ–¹å¼å•ä¾‹ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</li><li>åºåˆ—åŒ–ä¸ºä»€ä¹ˆä¼šç ´åå•ä¾‹æ¨¡å¼ï¼Ÿ</li><li>æ€ä¹ˆé˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼ï¼Ÿ</li><li>æšä¸¾æ–¹å¼å•ä¾‹æ˜¯æ€ä¹ˆé¿å…åºåˆ—åŒ–ç ´åçš„ï¼Ÿ</li></ul><p>å¼€å§‹æ­£æ–‡å‰å…ˆæ€è€ƒä¸‹ä»¥ä¸Šé—®é¢˜ï¼Œå¦‚æœä½ éƒ½æŒæ¡äº†ï¼Œå°±å¯ä»¥ç‚¹å‰å‡ºå»äº†ã€‚</p><h1 id="å»¶è¿ŸåŠ è½½"><a href="#å»¶è¿ŸåŠ è½½" class="headerlink" title="å»¶è¿ŸåŠ è½½"></a>å»¶è¿ŸåŠ è½½</h1><h4 id="é¥¿æ±‰æ–¹å¼"><a href="#é¥¿æ±‰æ–¹å¼" class="headerlink" title="é¥¿æ±‰æ–¹å¼"></a>é¥¿æ±‰æ–¹å¼</h4><p>å…ˆæ¥çœ‹ä¸€ä¸‹é¥¿æ±‰æ–¹å¼å®ç°çš„å•ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸é¥¿æ±‰æ–¹å¼ä¸€å¹¶æèµ·çš„å¾€å¾€è¿˜æœ‰æ‡’æ±‰æ–¹å¼ï¼Œå¯¹æ¯”è€Œè¨€ï¼Œæ‡’æ±‰æ–¹å¼å…·æœ‰å»¶è¿ŸåŠ è½½ï¼ˆè¿™é‡Œçš„åŠ è½½æŒ‡åˆ›å»º Singleton å®ä¾‹ï¼‰çš„ä¼˜ç‚¹ã€‚è¿™å®¹æ˜“è®©äººå¯¹é¥¿æ±‰æ–¹å¼æœ‰ä¸€ä¸ªæ¶åŠ£çš„åˆ»æ¿å°è±¡ï¼šå®ƒçš„æ€§èƒ½å¾ˆä¸å¥½ï¼æ²¡æœ‰ä½¿ç”¨å®ƒçš„æ—¶å€™å®ƒå°±ä¼šåˆå§‹åŒ–ï¼Œç™½ç™½å ç”¨èµ„æºï¼</p><p>ç°åœ¨æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹ï¼Œé¥¿æ±‰æ–¹å¼å•ä¾‹åˆ°åº•æœ‰å¤šâ€œé¥¿â€ï¼Ÿå®ƒåˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šåˆå§‹åŒ–å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ç±»åŠ è½½çš„æ—¶å€™ä¼šåˆå§‹åŒ–é™æ€èµ„æºï¼Œæ‰€ä»¥é¥¿æ±‰æ–¹å¼çš„åˆå§‹åŒ–æ—¶æœºå°±æ˜¯ç±»åŠ è½½æ—¶æœºï¼Œå›é¡¾ä¸€ä¸‹ç±»åŠ è½½çš„æ—¶æœºï¼š</p><ul><li>ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡</li><li>è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•</li><li>è¯»å–ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢« final ä¿®é¥°å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾åœ¨å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰</li></ul><p>å½“ä½¿ç”¨å•ä¾‹æ—¶ï¼Œå¾€å¾€éƒ½æ˜¯å…ˆè°ƒç”¨ getInstance() è·å–å•ä¾‹ï¼Œå‡ ä¹ä¸ä¼šæ¶‰åŠå…¶ä»–çš„é™æ€æ–¹æ³•æˆ–å­—æ®µï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé¥¿æ±‰æ–¹å¼åŒæ‡’æ±‰æ–¹å¼ä¸€æ ·æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼å¦‚æœä½ çš„å•ä¾‹åªæš´éœ²äº† getInstance() æ–¹æ³•ï¼ˆä¸ªäººæ„Ÿè§‰ä¹Ÿæ˜¯æ¯”è¾ƒè§„èŒƒçš„å†™æ³•ï¼‰ï¼Œé‚£å°±æ”¾å¿ƒçš„ä½¿ç”¨é¥¿æ±‰æ–¹å¼å§ï¼å¦‚æœåˆ«äºº diss äº†ä½ çš„é¥¿æ±‰æ–¹å¼ï¼Œé‚£å°± diss å›å»è®©ä»–å»å¤ä¹ ç±»åŠ è½½æœºåˆ¶ &gt;_&lt;||| </p><h4 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h4><p>é™æ€å†…éƒ¨ç±»æ–¹å¼å•ä¾‹å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”é¥¿æ±‰æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å®ç°çš„å•ä¾‹å³ä½¿åŠ è½½äº† Singleton ç±»ï¼Œä¹Ÿä¸ä¸€å®šä¼šåˆ›å»º Singleton å®ä¾‹ï¼Œå› ä¸º Singleton çš„é™æ€å¼•ç”¨æ”¾åˆ°äº†é™æ€å†…éƒ¨ç±»ä¸­ï¼Œåªæœ‰é™æ€å†…éƒ¨ç±»è¢«åŠ è½½äº†ï¼ŒSingleton å®ä¾‹æ‰ä¼šè¢«åˆ›å»ºã€‚</p><p>å¦‚æœ Singleton ä¸­å¯¹å¤–åªæš´éœ²äº† getInstance æ–¹æ³•ï¼Œé‚£å’Œé¥¿æ±‰æ–¹å¼æ— å¼‚ï¼›å¦‚æœè¿˜æš´éœ²äº†å…¶ä»–çš„é™æ€æ–¹æ³•æˆ–å­—æ®µï¼Œé‚£ç›¸æ¯”é¥¿æ±‰æ–¹å¼ï¼Œå¯ä»¥æ›´ç²¾å‡†çš„å®ç°å»¶è¿ŸåŠ è½½ã€‚</p><h4 id="æšä¸¾æ–¹å¼"><a href="#æšä¸¾æ–¹å¼" class="headerlink" title="æšä¸¾æ–¹å¼"></a>æšä¸¾æ–¹å¼</h4><p>æšä¸¾æ–¹å¼å®ç°çš„å•ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§å½¢å¼æˆ–è®¸æˆ‘ä»¬æ— ä»ä¸‹æ‰‹ï¼Œä½†åç¼–è¯‘åå°±æ˜ç™½äº†ï¼Œç›¸å½“äºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæšä¸¾æ–¹å¼å®ç°çš„å•ä¾‹å’Œé¥¿æ±‰æ–¹å¼å·®ä¸å¤šï¼Œå»¶è¿ŸåŠ è½½æ—¶æœºä¾èµ–ç±»åŠ è½½æ—¶æœºã€‚</p><p>è¿™é‡Œéœ€è¦ææ¸…æ¥šè¢« staticã€final ä¿®é¥°çš„ç¼–è¯‘æœŸå¸¸é‡ã€è¿è¡ŒæœŸå¸¸é‡ã€‚</p><h1 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h1><p>è¿™éƒ¨åˆ†å†…å®¹å…¶å®ååˆ†ç®€å•ã€‚</p><p>ç±»åŠ è½½çš„é€»è¾‘ä½äº synchronized ä»£ç å—ä¸­ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œé¥¿æ±‰ã€é™æ€å†…éƒ¨ç±»ä»¥åŠæšä¸¾æ–¹å¼å®ç°çš„å•ä¾‹åˆå§‹åŒ–éƒ½å¤„äºç±»åŠ è½½æ—¶æœºï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>æ‡’æ±‰æ–¹å¼çš„åˆå§‹åŒ–ä¸ç±»åŠ è½½æ—¶æœºæ— å…³ï¼Œæ‰€ä»¥è¦è‡ªè¡Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1><p>æˆ‘ä»¬æœŸæœ›å•ä¾‹æ¨¡å¼å¯ä»¥å®ç°åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œé€šè¿‡ç‰¹æ®Šæ‰‹æ®µåˆ›å»ºå‡ºå…¶ä»–çš„å®ä¾‹ï¼Œå°±å¯¹å•ä¾‹æ¨¡å¼é€ æˆäº†ç ´åï¼Œåºåˆ—åŒ–å°±ä¼šç ´åå•ä¾‹æ¨¡å¼ã€‚</p><p>å‡å¦‚æˆ‘ä»¬çš„å•ä¾‹å®ç°äº† serializable æ¥å£ï¼Œåºåˆ—åŒ–æ—¶ä¼šé€šè¿‡åå°„è°ƒç”¨æ— å‚æ•°çš„æ„é€ æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œè¿™æ—¶å°±è¦é‡å†™ readResolve æ–¹æ³•é˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ™®é€šçš„ Java ç±»çš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡åå°„åˆ›å»ºæ–°çš„å®ä¾‹ã€‚è€Œæšä¸¾åœ¨åºåˆ—åŒ–çš„æ—¶å€™ä»…æ˜¯å°†æšä¸¾å¯¹è±¡çš„ name å±æ€§è¾“å‡ºåˆ°ç»“æœä¸­ï¼Œååºåˆ—åŒ–çš„æ—¶å€™åˆ™æ˜¯é€šè¿‡ java.lang.Enum çš„ valueOf æ–¹æ³•æ¥æ ¹æ®åå­—æŸ¥æ‰¾æšä¸¾å¯¹è±¡ã€‚åŒæ—¶ï¼Œç¼–è¯‘å™¨æ˜¯ä¸å…è®¸ä»»ä½•å¯¹è¿™ç§åºåˆ—åŒ–æœºåˆ¶çš„å®šåˆ¶çš„ï¼Œç¦ç”¨äº†writeObjectã€readObjectã€readObjectNoDataã€writeReplace å’Œ readResolve ç­‰æ–¹æ³•ã€‚</p><p>æšä¸¾çš„ååºåˆ—åŒ–å¹¶ä¸æ˜¯é€šè¿‡åå°„å®ç°çš„ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šå‘ç”Ÿç”±äºååºåˆ—åŒ–å¯¼è‡´çš„å•ä¾‹ç ´åé—®é¢˜ã€‚</p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><p>æœ€åé›†ä¸­å›ç­”ä¸‹å¼€å¤´çš„é—®é¢˜ï¼š</p><ul><li>é¥¿æ±‰æ–¹å¼å•ä¾‹åˆ°åº•æœ‰å¤šâ€œé¥¿â€ï¼Ÿ<br>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé¥¿æ±‰æ–¹å¼åŒæ‡’æ±‰æ–¹å¼ä¸€æ ·æ—¶å»¶è¿ŸåŠ è½½çš„</li><li>é™æ€å†…éƒ¨ç±»ä¸ºä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Ÿ<br>ä¾èµ–ç±»åŠ è½½æœºåˆ¶ï¼ŒåŠ è½½é™æ€å†…éƒ¨ç±»æ—¶æ‰ä¼šåˆå§‹åŒ–</li><li>æšä¸¾æ–¹å¼å•ä¾‹æ˜¯å»¶è¿ŸåŠ è½½çš„å—ï¼Ÿ<br>ä¸é¥¿æ±‰æ–¹å¼ç±»ä¼¼ï¼Œç±»åŠ è½½æ—¶åˆå§‹åŒ–</li><li>é¥¿æ±‰ã€é™æ€å†…éƒ¨ç±»ã€æšä¸¾æ–¹å¼å•ä¾‹ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ<br>å› ä¸ºå®ƒä»¬åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œè€Œç±»åŠ è½½æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>åºåˆ—åŒ–ä¸ºä»€ä¹ˆä¼šç ´åå•ä¾‹æ¨¡å¼ï¼Ÿ<br>æ™®é€šçš„ Java ç±»çš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡åå°„åˆ›å»ºæ–°çš„å®ä¾‹</li><li>æ€ä¹ˆé˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼ï¼Ÿ<br>ä½¿ç”¨æšä¸¾æˆ–é‡å†™ readResolve æ–¹æ³•</li><li>æšä¸¾æ–¹å¼å•ä¾‹æ˜¯æ€ä¹ˆé¿å…åºåˆ—åŒ–ç ´åçš„ï¼Ÿ<br>ä¾èµ–æšä¸¾è‡ªèº«ç‰¹æ®Šçš„åºåˆ—åŒ–æœºåˆ¶</li></ul><h6 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h6><p><a href="https://www.hollischuang.com/archives/1144" target="_blank" rel="noopener">å•ä¾‹ä¸åºåˆ—åŒ–çš„é‚£äº›äº‹å„¿</a><br><a href="https://www.hollischuang.com/archives/2498" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆæˆ‘å¢™è£‚å»ºè®®å¤§å®¶ä½¿ç”¨æšä¸¾æ¥å®ç°å•ä¾‹</a><br><a href="https://www.hollischuang.com/archives/197" target="_blank" rel="noopener">æ·±åº¦åˆ†æJavaçš„æšä¸¾ç±»å‹â€”-æšä¸¾çš„çº¿ç¨‹å®‰å…¨æ€§åŠåºåˆ—åŒ–é—®é¢˜</a><br><a href="https://stackoverflow.com/questions/16771373/singleton-via-enum-way-is-lazy-initialized" target="_blank" rel="noopener">stackoverflowï¼šsingleton-via-enum-way-is-lazy-initialized</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å•ä¾‹æ¨¡å¼å¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼äº†ï¼Œä½†åœ¨ä½¿ç”¨æ—¶ä¹Ÿæœ‰ä¸€äº›é—®é¢˜éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚çº¿ç¨‹å®‰å…¨æ€§å’Œåºåˆ—åŒ–ç ´åã€‚æœ¬æ–‡ä»¥å‡ ä¸ªé—®é¢˜ä¸ºå‡ºå‘ç‚¹ï¼Œåˆ†æå»¶è¿ŸåŠ è½½ã€çº¿ç¨‹å®‰å…¨ä»¥åŠåºåˆ—åŒ–ä¸‰ä¸ªæ–¹é¢ï¼Œæ·±å…¥äº†è§£ä¸€ä¸‹å•ä¾‹æ¨¡å¼çš„å„ç§å§¿åŠ¿ï¼Œä»¥ä¾¿åœ¨ä»Šåä½¿ç”¨æ—¶è¿½æ±‚æè‡´æ€§èƒ½  âŠ™ï¹âŠ™â€–âˆ£Â°&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://yhaowa.gitee.io/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yhaowa.gitee.io/tags/Java/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://yhaowa.gitee.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>[å‰‘æŒ‡offer] æœºå™¨äººèµ°æ ¼å­ä¹‹å›æº¯æ³•</title>
    <link href="http://yhaowa.gitee.io/e89c3ed9/"/>
    <id>http://yhaowa.gitee.io/e89c3ed9/</id>
    <published>2019-03-03T12:14:56.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œå’Œnåˆ—çš„æ–¹æ ¼ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡0,0çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œæ¯ä¸€æ¬¡åªèƒ½å‘å·¦ï¼Œå³ï¼Œä¸Šï¼Œä¸‹å››ä¸ªæ–¹å‘ç§»åŠ¨ä¸€æ ¼ï¼Œä½†æ˜¯ä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ï¼ˆ35,37ï¼‰ï¼Œå› ä¸º3+5+3+7 = 18ã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ï¼ˆ35,38ï¼‰ï¼Œå› ä¸º3+5+3+8 = 19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿè¾¾åˆ°å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ</p><a id="more"></a><p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong></p><ol><li>ä»(0,0)å¼€å§‹èµ°ï¼Œæ¯æˆåŠŸèµ°ä¸€æ­¥æ ‡è®°å½“å‰ä½ç½®ä¸ºtrue,ç„¶åä»å½“å‰ä½ç½®å¾€å››ä¸ªæ–¹å‘æ¢ç´¢ï¼Œè¿”å›1 + 4 ä¸ªæ–¹å‘çš„æ¢ç´¢å€¼ä¹‹å’Œã€‚</li><li>æ¢ç´¢æ—¶ï¼Œåˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å¯è¾¾çš„æ ‡å‡†ä¸ºï¼š1ï¼‰å½“å‰èŠ‚ç‚¹åœ¨çŸ©é˜µå†…ï¼›2ï¼‰å½“å‰èŠ‚ç‚¹æœªè¢«è®¿é—®è¿‡ï¼›3ï¼‰å½“å‰èŠ‚ç‚¹æ»¡è¶³limité™åˆ¶ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">movingCount</span><span class="params">(<span class="keyword">int</span> threshold, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span>[][] visited = <span class="keyword">new</span> <span class="keyword">boolean</span>[rows][cols];</span><br><span class="line">    <span class="keyword">return</span> countingSteps(threshold, rows, cols, <span class="number">0</span>, <span class="number">0</span>, visited);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countingSteps</span><span class="params">(<span class="keyword">int</span> limit, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">int</span> r, <span class="keyword">int</span> c, <span class="keyword">boolean</span>[][] visited)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (r &lt; <span class="number">0</span> || r &gt;= rows || c &lt; <span class="number">0</span> || c &gt;= cols</span><br><span class="line">            || visited[r][c] || bitSum(r) + bitSum(c) &gt; limit) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    visited[r][c] = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> countingSteps(limit, rows, cols, r - <span class="number">1</span>, c, visited)</span><br><span class="line">            + countingSteps(limit, rows, cols, r, c - <span class="number">1</span>, visited)</span><br><span class="line">            + countingSteps(limit, rows, cols, r + <span class="number">1</span>, c, visited)</span><br><span class="line">            + countingSteps(limit, rows, cols, r, c + <span class="number">1</span>, visited)</span><br><span class="line">            + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bitSum</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (t != <span class="number">0</span>) &#123;</span><br><span class="line">        count += t % <span class="number">10</span>;</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œå’Œnåˆ—çš„æ–¹æ ¼ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡0,0çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œæ¯ä¸€æ¬¡åªèƒ½å‘å·¦ï¼Œå³ï¼Œä¸Šï¼Œä¸‹å››ä¸ªæ–¹å‘ç§»åŠ¨ä¸€æ ¼ï¼Œä½†æ˜¯ä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ï¼ˆ35,37ï¼‰ï¼Œå› ä¸º3+5+3+7 = 18ã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ï¼ˆ35,38ï¼‰ï¼Œå› ä¸º3+5+3+8 = 19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿè¾¾åˆ°å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="ç®—æ³•ä¹‹ç¾" scheme="http://yhaowa.gitee.io/categories/%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/"/>
    
    
      <category term="å‰‘æŒ‡offer" scheme="http://yhaowa.gitee.io/tags/%E5%89%91%E6%8C%87offer/"/>
    
  </entry>
  
  <entry>
    <title>[å‰‘æŒ‡offer] äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</title>
    <link href="http://yhaowa.gitee.io/ff815187/"/>
    <id>http://yhaowa.gitee.io/ff815187/</id>
    <published>2019-02-28T15:03:46.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼ˆæ¯ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼‰ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> target, <span class="keyword">int</span>[][] array)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || array.length == <span class="number">0</span> || array[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> len = array[<span class="number">0</span>].length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>[] anArray : array) &#123;</span><br><span class="line">        <span class="keyword">if</span> (target == anArray[<span class="number">0</span>] || target == anArray[len - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; anArray[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; anArray[len - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a : anArray) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == target) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼ˆæ¯ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼‰ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç®—æ³•ä¹‹ç¾" scheme="http://yhaowa.gitee.io/categories/%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/"/>
    
    
      <category term="å‰‘æŒ‡offer" scheme="http://yhaowa.gitee.io/tags/%E5%89%91%E6%8C%87offer/"/>
    
  </entry>
  
  <entry>
    <title>ç®€æ´æ˜äº†çš„åˆ˜æµ·å±é€‚é…æ–¹æ¡ˆ</title>
    <link href="http://yhaowa.gitee.io/2f41d4d1/"/>
    <id>http://yhaowa.gitee.io/2f41d4d1/</id>
    <published>2019-02-26T15:11:04.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ä¸Šå…³äºåˆ˜æµ·å±é€‚é…çš„æ–‡ç« ä¸å°‘ï¼Œå¯è®²æ¸…æ¥šçš„å´æ²¡å‡ ç¯‡ï¼Œå¤§å¤šæ˜¯æ‹·è´æ–‡æ¡£ã€é•¿ç¯‡å¤§è®ºï¼Œç”šè‡³çƒ­æƒ…çš„è´´å›¾å‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯åˆ˜æµ·å±ï¼Œåˆ°æœ€åä½ ä»ä¸ç¡®å®šåˆ°åº•æ˜¯æ€æ ·çš„ä¸€ä¸ªé€‚é…æ–¹æ¡ˆï¼Œæ‰èƒ½è®©ä½ çš„ app çœŸæ­£çš„é€‚é…æ‰€æœ‰çš„åˆ˜æµ·å±æœºå‹ã€‚</p><p>çœ‹åˆ°è¿™ç¯‡æ–‡ç« ä½ å°±æ— éœ€å†æ€¨æ¨å„å¤§å‚å•†çš„è·Ÿé£â€œåˆ˜æµ·â€äº†ï¼Œå› ä¸ºåˆ˜æµ·å±çš„é€‚é…ååˆ†ç®€å•ã€‚</p><a id="more"></a><p>okï¼ŒåºŸè¯è¯´å®Œäº†ï¼Œå¼€å§‹é€‚é…ã€‚</p><p>é¦–å…ˆè¦æ¸…æ¥šçš„æ˜¯å“ªäº›ç•Œé¢éœ€è¦é€‚é…åˆ˜æµ·å±ï¼š</p><ul><li>æœ‰çŠ¶æ€æ çš„ç•Œé¢ï¼šåˆ˜æµ·åŒºåŸŸä¼šæ˜¾ç¤ºçŠ¶æ€æ ï¼Œæ— éœ€é€‚é…</li><li>å…¨å±ç•Œé¢ï¼šåˆ˜æµ·åŒºåŸŸå¯èƒ½é®æŒ¡å†…å®¹ï¼Œéœ€è¦é€‚é…</li></ul><p>å¦‚æœä½ çš„åº”ç”¨é‡Œæ‰€æœ‰ç•Œé¢éƒ½æœ‰çŠ¶æ€æ ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ ä¸ç”¨åšä»»ä½•æ“ä½œï¼ŒçŠ¶æ€æ å°±é‚£ä¹ˆè‡ªç„¶çš„æ˜¾ç¤ºåœ¨åˆ˜æµ·åŒºåŸŸï¼Œæ¯«æ— è¿å’Œï¼Œåˆ˜æµ·å±å·²é€‚é…å®Œæ¯•ï¼Œå¯ä»¥ç‚¹å‰å‡ºå»äº†ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œä½ çš„åº”ç”¨ä¸­å¾ˆå¤§å‡ ç‡ä¼šæœ‰å…¨å±ç•Œé¢ï¼Œæ‰€è°“çš„åˆ˜æµ·å±é€‚é…ï¼Œä¹Ÿæ­£æ˜¯é’ˆå¯¹è¿™äº›å…¨å±ç•Œé¢ã€‚</p><p>å¦‚æœä½ ä»€ä¹ˆéƒ½ä¸åšï¼Œé»˜è®¤è§„åˆ™ä¸å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸï¼Œå³åˆ˜æµ·å±åŒºåŸŸä¼šä¿ç•™ä¸€æ¡é»‘è¾¹ï¼Œä½ çš„å…¨å±ç•Œé¢ä¼šåœ¨åˆ˜æµ·ä¸‹æ–¹å±•ç¤ºï¼Œè¿™çœ‹èµ·æ¥å¥½åƒä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œç„¶åä½ ç«Ÿè¯´æœäº§å“è¾¾æˆå…±è¯†ï¼Œâ€œæ— ä¸ºè€Œæ²»â€æ‰æ˜¯æœ€å¼ºå¤§çš„åˆ˜æµ·å±é€‚é…æ–¹æ¡ˆï¼</p><p>ä½†æœ‰äº›æ‰‹æœºå‚å•†ï¼ˆè­¬å¦‚oppoï¼‰ä¸å¼€å¿ƒäº†ï¼Œæˆ‘è¾›è¾›è‹¦è‹¦ç ”å‘çš„åˆ˜æµ·å±æ‰‹æœºï¼Œä½ ä»¬è¿™äº›å¼€å‘è€…ç«Ÿç›´æ¥æ”¾å¼ƒåˆ˜æµ·åŒºåŸŸï¼ç„¶åå°±åœ¨ä½ çš„å…¨å±ç•Œé¢ä¸‹æ–¹åŠ äº†ä¸€æ¡æç¤ºï¼šâ€œå…¨å±æ˜¾ç¤ºâ€ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å¼€å¯åï¼Œå¼ºè¡ŒæŠŠä½ çš„å…¨å±ç•Œé¢æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸï¼Œç„¶åä¸€åˆ‡éƒ½ä¹±å¥—äº†â€¦</p><p>å—¯ï½ â€œæ— ä¸ºè€Œæ²»â€è¡Œä¸é€šã€‚</p><p>åªèƒ½å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸäº†ï¼Œå‚è€ƒå„å¤§å‚å•†çš„é€‚é…æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚ä½•å…è®¸ï¼Œæ¯”å¦‚åä¸ºæœºå‹åªéœ€åœ¨ AndroidManifest ä¸­é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;android.notch_support&quot;</span><br><span class="line">    android:value=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure></p><p>é…ç½®åï¼Œåä¸ºæœºå‹ä¸Šçš„å…¨å±ç•Œé¢å°±ä¼šæ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸäº†ï¼Œä½†è¿™ä¸ªåˆ˜æµ·ï¼Œæ˜¯å¯èƒ½æŒ¡ä½æˆ‘ä»¬å…¨å±ç•Œé¢ä¸­çš„å†…å®¹çš„ã€‚è¿™æ—¶éœ€è¦å°†å…¨å±ç•Œé¢ä¸­çš„è§†å›¾å…ƒç´ é€‚å½“ä¸‹ç§»ï¼Œä¿è¯ä¸ä¼šè¢«åˆ˜æµ·é®æŒ¡ä½ï¼Œå°± ok äº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ææ¸…æ¥šï¼šå…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸçš„æœºå‹ï¼Œæ‰éœ€è¦å°†å…¨å±ç•Œé¢ä¸­çš„è§†å›¾å…ƒç´ é€‚å½“ä¸‹ç§»ã€‚</p><p>æ¯”å¦‚è‹¥åªå…è®¸åä¸ºæœºå‹å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸï¼Œé‚£åªæœ‰åä¸ºçš„åˆ˜æµ·å±æœºå‹æ‰éœ€è¦å°†å…¨å±ç•Œé¢ä¸­çš„è§†å›¾å…ƒç´ é€‚å½“ä¸‹ç§»ï¼Œå…¶ä»–å‚å•†çš„åˆ˜æµ·å±æœºå‹åˆ™ä¸éœ€è¦ä¸‹ç§»ã€‚</p><p>å¦‚æœå…è®¸åä¸ºã€å°ç±³ã€oppoã€vivo å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸï¼Œé‚£ä¹ˆåä¸ºã€å°ç±³ã€oppoã€vivo åˆ˜æµ·å±æœºå‹éœ€è¦å°†å…¨å±ç•Œé¢ä¸­çš„è§†å›¾å…ƒç´ é€‚å½“ä¸‹ç§»ã€‚</p><p>å¦å¤–ä¹Ÿä¸ä¸€å®šè¦é€šè¿‡å…¨å±ç•Œé¢ä¸­çš„è§†å›¾å…ƒç´ é€‚å½“ä¸‹ç§»æ–¹å¼æ¥é€‚é…åˆ˜æµ·å±ï¼Œå¦‚æœäº§å“å½¢æ€å…è®¸çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥è®©è¯¥ç•Œé¢æ˜¾ç¤ºçŠ¶æ€æ å•Šã€‚</p><p>è‡³æ­¤åˆ˜æµ·å±é€‚é…å®Œæ¯•ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ï¼Ÿ</p><p>æœ€åä»£ç å¥‰ä¸Šï¼Œæ‹¿èµ°ä¸è°¢ï¼š</p><h4 id="å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸé…ç½®ï¼š"><a href="#å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸé…ç½®ï¼š" class="headerlink" title="å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸé…ç½®ï¼š"></a>å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸé…ç½®ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--å…è®¸ç»˜åˆ¶åˆ°oppoã€vivoåˆ˜æµ·å±æœºå‹çš„åˆ˜æµ·åŒºåŸŸ --&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;android.max_aspect&quot;</span><br><span class="line">    android:value=&quot;2.2&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å…è®¸ç»˜åˆ¶åˆ°åä¸ºåˆ˜æµ·å±æœºå‹çš„åˆ˜æµ·åŒºåŸŸ --&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;android.notch_support&quot;</span><br><span class="line">    android:value=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å…è®¸ç»˜åˆ¶åˆ°å°ç±³åˆ˜æµ·å±æœºå‹çš„åˆ˜æµ·åŒºåŸŸ --&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;notch.config&quot;</span><br><span class="line">    android:value=&quot;portrait&quot; /&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åœ¨ AndroidManifest çš„é…ç½®åœ¨ Android 9.0 ä¹‹å‰æœ‰æ•ˆï¼Œ9.0 ç³»ç»Ÿé’ˆå¯¹åˆ˜æµ·å±åˆ¶å®šäº†æ–°çš„ apiï¼Œé»˜è®¤ä¿ç•™ä¸€æ¡é»‘è¾¹ï¼Œå³ä¸å…è®¸ç»˜åˆ¶åˆ°åˆ˜æµ·åŒºåŸŸã€‚æ‰€ä»¥å¦‚æœä½ è¿˜æ²¡æœ‰é€‚é… Android 9.0ï¼Œé‚£åœ¨åˆ¤æ–­æ˜¯å¦æ˜¯å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹æ—¶ï¼Œå°±è¦åŠ ä¸Šç‰ˆæœ¬åˆ¤æ–­ã€‚</p><h4 id="åˆ¤æ–­æ˜¯å¦æ˜¯å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹ï¼š"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹ï¼š" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹ï¼š"></a>åˆ¤æ–­æ˜¯å¦æ˜¯å…è®¸å…¨å±ç•Œé¢å†…å®¹æ˜¾ç¤ºåˆ°åˆ˜æµ·åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CutoutUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Boolean sAllowDisplayToCutout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦ä¸ºå…è®¸å…¨å±ç•Œé¢æ˜¾ç¤ºå†…å®¹åˆ°åˆ˜æµ·åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹ï¼ˆä¸AndroidManifestä¸­é…ç½®å¯¹åº”ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">allowDisplayToCutout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sAllowDisplayToCutout == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O_MR1) &#123;</span><br><span class="line">                <span class="comment">// 9.0ç³»ç»Ÿå…¨å±ç•Œé¢é»˜è®¤ä¼šä¿ç•™é»‘è¾¹ï¼Œä¸å…è®¸æ˜¾ç¤ºå†…å®¹åˆ°åˆ˜æµ·åŒºåŸŸ</span></span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutoutDevice = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Context context = App.get();</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_Huawei(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_OPPO(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_VIVO(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_XIAOMI(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sAllowDisplayToCutout;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ˜¯åä¸ºåˆ˜æµ·å±æœºå‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_Huawei</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"HUAWEI"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader cl = context.getClassLoader();</span><br><span class="line">            Class HwNotchSizeUtil = cl.loadClass(<span class="string">"com.huawei.android.util.HwNotchSizeUtil"</span>);</span><br><span class="line">            <span class="keyword">if</span> (HwNotchSizeUtil != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method get = HwNotchSizeUtil.getMethod(<span class="string">"hasNotchInScreen"</span>);</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>) get.invoke(HwNotchSizeUtil);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ˜¯oppoåˆ˜æµ·å±æœºå‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_OPPO</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"oppo"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context.getPackageManager().hasSystemFeature(<span class="string">"com.oppo.feature.screen.heteromorphism"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ˜¯vivoåˆ˜æµ·å±æœºå‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_VIVO</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"vivo"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader cl = context.getClassLoader();</span><br><span class="line">            <span class="meta">@SuppressLint</span>(<span class="string">"PrivateApi"</span>)</span><br><span class="line">            Class ftFeatureUtil = cl.loadClass(<span class="string">"android.util.FtFeature"</span>);</span><br><span class="line">            <span class="keyword">if</span> (ftFeatureUtil != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method get = ftFeatureUtil.getMethod(<span class="string">"isFeatureSupport"</span>, <span class="keyword">int</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>) get.invoke(ftFeatureUtil, <span class="number">0x00000020</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ˜¯å°ç±³åˆ˜æµ·å±æœºå‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_XIAOMI</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"xiaomi"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader cl = context.getClassLoader();</span><br><span class="line">            <span class="meta">@SuppressLint</span>(<span class="string">"PrivateApi"</span>)</span><br><span class="line">            Class SystemProperties = cl.loadClass(<span class="string">"android.os.SystemProperties"</span>);</span><br><span class="line">            Class[] paramTypes = <span class="keyword">new</span> Class[<span class="number">2</span>];</span><br><span class="line">            paramTypes[<span class="number">0</span>] = String<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">            paramTypes[<span class="number">1</span>] = <span class="keyword">int</span><span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">            Method getInt = SystemProperties.getMethod(<span class="string">"getInt"</span>, paramTypes);</span><br><span class="line">            <span class="comment">//å‚æ•°</span></span><br><span class="line">            Object[] params = <span class="keyword">new</span> Object[<span class="number">2</span>];</span><br><span class="line">            params[<span class="number">0</span>] = <span class="string">"ro.miui.notch"</span>;</span><br><span class="line">            params[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> (Integer) getInt.invoke(SystemProperties, params) == <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æåˆ°ï¼Œä¸ä¸€å®šè¦é€šè¿‡å…¨å±ç•Œé¢ä¸­çš„è§†å›¾å…ƒç´ é€‚å½“ä¸‹ç§»æ–¹å¼æ¥é€‚é…åˆ˜æµ·å±ï¼Œå¦‚æœäº§å“å½¢æ€å…è®¸çš„è¯ï¼Œä¹Ÿå¯ä»¥è®©è¯¥ç•Œé¢æ˜¾ç¤ºçŠ¶æ€æ ã€‚</p><p>æ˜¾ç¤ºçŠ¶æ€æ çš„æ–¹æ¡ˆæ˜¯è¾ƒä¸ºé€šç”¨ç®€å•çš„ï¼Œæˆ–è€…è¯´ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œä¸€äº›å…¨å±ç•Œé¢å¾€å¾€æ˜¯å…è®¸ä½¿ç”¨æ˜¾ç¤ºçŠ¶æ€æ çš„æ–¹æ¡ˆæ¥é€‚é…çš„ï¼Œå¦‚æœä½ è€ƒè™‘ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œé‚£ä¾¿ä¼šæ˜¯è¿™ç§æ•ˆæœï¼š</p><ul><li>åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œä½ æœŸæœ›æŸäº›å…¨å±ç•Œé¢åœ¨åˆ˜æµ·å±æœºå‹ä¸Šå¿…é¡»å…¨å±å±•ç¤ºï¼Œé‚£ä½ å°±è‡ªè¡Œå°†ç•Œé¢å…ƒç´ é€‚å½“ä¸‹ç§»ï¼Œä»è€Œé¿å…è¢«åˆ˜æµ·é®æŒ¡ï¼›è€ŒæŸäº›å…¨å±ç•Œé¢ä¸æ˜¯éè¦å…¨å±æ˜¾ç¤ºï¼Œå…è®¸åœ¨åˆ˜æµ·å±æœºå‹æ˜¾ç¤ºçŠ¶æ€æ ï¼Œé‚£å°±é€šè¿‡æ˜¾ç¤ºçŠ¶æ€æ çš„æ–¹å¼ï¼Œä»è€Œé¿å…è¢«åˆ˜æµ·é®æŒ¡ã€‚</li></ul><p>ä¸ºäº†å®ç°è¿™ç§æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦æ ‡è®°åŒºåˆ†å“ªäº›ç•Œé¢å¿…é¡»å…¨å±å±•ç¤ºã€å“ªäº›ç•Œé¢å…è®¸æ˜¾ç¤ºçŠ¶æ€æ ã€‚è¿™é‡Œæä¾›ä¸€ç§å®ç°æ–¹å¼ï¼Œè®©å…è®¸æ˜¾ç¤ºçŠ¶æ€æ çš„ç•Œé¢ Activity ç»§æ‰¿ä¸€ä¸ªæ¥å£ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CutoutAdapt</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ ActivityLifecycleCallbacks å›è°ƒï¼Œç»Ÿä¸€é€‚é…å…è®¸é€šè¿‡æ˜¾ç¤ºçŠ¶æ€æ çš„å…¨å±ç•Œé¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityStarted</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å…è®¸å…¨å±æ˜¾ç¤ºåˆ°åˆ˜æµ·å±åŒºåŸŸçš„åˆ˜æµ·å±æœºå‹</span></span><br><span class="line">    <span class="keyword">if</span> (CutoutUtil.allowDisplayToCutout()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFullScreen(activity)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå…è®¸é€šè¿‡æ˜¾ç¤ºçŠ¶æ€æ æ–¹å¼é€‚é…åˆ˜æµ·å±</span></span><br><span class="line">            <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> CutoutAdapt) &#123;</span><br><span class="line">                <span class="comment">// æ˜¾ç¤ºçŠ¶æ€æ </span></span><br><span class="line">                StatusBarUtil.showStatusbar(activity.getWindow());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// éœ€è‡ªè¡Œå°†è¯¥ç•Œé¢è§†å›¾å…ƒç´ ä¸‹ç§»ï¼Œå¦åˆ™å¯èƒ½ä¼šè¢«åˆ˜æµ·é®æŒ¡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// éå…¨å±ç•Œé¢æ— éœ€é€‚é…åˆ˜æµ·å±</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç½‘ä¸Šå…³äºåˆ˜æµ·å±é€‚é…çš„æ–‡ç« ä¸å°‘ï¼Œå¯è®²æ¸…æ¥šçš„å´æ²¡å‡ ç¯‡ï¼Œå¤§å¤šæ˜¯æ‹·è´æ–‡æ¡£ã€é•¿ç¯‡å¤§è®ºï¼Œç”šè‡³çƒ­æƒ…çš„è´´å›¾å‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯åˆ˜æµ·å±ï¼Œåˆ°æœ€åä½ ä»ä¸ç¡®å®šåˆ°åº•æ˜¯æ€æ ·çš„ä¸€ä¸ªé€‚é…æ–¹æ¡ˆï¼Œæ‰èƒ½è®©ä½ çš„ app çœŸæ­£çš„é€‚é…æ‰€æœ‰çš„åˆ˜æµ·å±æœºå‹ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è¿™ç¯‡æ–‡ç« ä½ å°±æ— éœ€å†æ€¨æ¨å„å¤§å‚å•†çš„è·Ÿé£â€œåˆ˜æµ·â€äº†ï¼Œå› ä¸ºåˆ˜æµ·å±çš„é€‚é…ååˆ†ç®€å•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yhaowa.gitee.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
      <category term="åˆ˜æµ·å±é€‚é…" scheme="http://yhaowa.gitee.io/tags/%E5%88%98%E6%B5%B7%E5%B1%8F%E9%80%82%E9%85%8D/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - å±•ç¤º gif åŸç†</title>
    <link href="http://yhaowa.gitee.io/3fe9ef36/"/>
    <id>http://yhaowa.gitee.io/3fe9ef36/</id>
    <published>2019-02-17T10:03:14.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å±•ç¤º gif æ—¶ï¼Œå³ä½¿ä¸è°ƒç”¨ asGif æ–¹æ³•ï¼ŒGlide ä¹Ÿèƒ½è¯†åˆ«å‡º gif ç±»å‹å¹¶æ­£å¸¸å±•ç¤ºã€‚è§£ç é€»è¾‘ä½äº Downsampler çš„ decode æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å…ˆä»è¿™é‡Œå¼€å§‹ï¼Œçœ‹çœ‹ Glide æ˜¯å¦‚ä½•è¯†åˆ« gif ç±»å‹çš„ã€‚decode æ–¹æ³•ä¸­è°ƒç”¨äº† decodeFromWrappedStreams æ–¹æ³•å¼€å§‹å®é™…è§£ç é€»è¾‘ï¼š</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Bitmap <span class="title">decodeFromWrappedStreams</span><span class="params">(InputStream is,</span></span></span><br><span class="line"><span class="function"><span class="params">    BitmapFactory.Options options, DownsampleStrategy downsampleStrategy,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodeFormat decodeFormat, <span class="keyword">boolean</span> isHardwareConfigAllowed, <span class="keyword">int</span> requestedWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> requestedHeight, <span class="keyword">boolean</span> fixBitmapToRequestedDimensions,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodeCallbacks callbacks)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = LogTime.getLogTime();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span>[] sourceDimensions = getDimensions(is, options, callbacks, bitmapPool);</span><br><span class="line">  <span class="keyword">int</span> sourceWidth = sourceDimensions[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">int</span> sourceHeight = sourceDimensions[<span class="number">1</span>];</span><br><span class="line">  String sourceMimeType = options.outMimeType;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If we failed to obtain the image dimensions, we may end up with an incorrectly sized Bitmap,</span></span><br><span class="line">  <span class="comment">// so we want to use a mutable Bitmap type. One way this can happen is if the image header is so</span></span><br><span class="line">  <span class="comment">// large (10mb+) that our attempt to use inJustDecodeBounds fails and we're forced to decode the</span></span><br><span class="line">  <span class="comment">// full size image.</span></span><br><span class="line">  <span class="keyword">if</span> (sourceWidth == -<span class="number">1</span> || sourceHeight == -<span class="number">1</span>) &#123;</span><br><span class="line">    isHardwareConfigAllowed = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> orientation = ImageHeaderParserUtils.getOrientation(parsers, is, byteArrayPool);</span><br><span class="line">  <span class="keyword">int</span> degreesToRotate = TransformationUtils.getExifOrientationDegrees(orientation);</span><br><span class="line">  <span class="keyword">boolean</span> isExifOrientationRequired = TransformationUtils.isExifOrientationRequired(orientation);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> targetWidth = requestedWidth == Target.SIZE_ORIGINAL ? sourceWidth : requestedWidth;</span><br><span class="line">  <span class="keyword">int</span> targetHeight = requestedHeight == Target.SIZE_ORIGINAL ? sourceHeight : requestedHeight;</span><br><span class="line"></span><br><span class="line">  ImageType imageType = ImageHeaderParserUtils.getType(parsers, is, byteArrayPool);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... çœç•¥ä¸‹é¢çš„è§£ç é€»è¾‘ä»£ç </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rotated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è§£ç å¼€å§‹å‰ï¼Œå‡†å¤‡äº†å›¾ç‰‡è§’åº¦ã€è¾“å‡ºå°ºå¯¸çš„ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ ImageHeaderParserUtils è·å–äº†å›¾ç‰‡ç±»å‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageType imageType = ImageHeaderParserUtils.getType(parsers, is, byteArrayPool);</span><br></pre></td></tr></table></figure></p><p>Glide ä¸­å®šä¹‰äº†ä»¥ä¸‹å›¾ç‰‡ç±»å‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The format of the image data including whether or not the image may include transparent</span></span><br><span class="line"><span class="comment"> * pixels.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> ImageType &#123;</span><br><span class="line">  GIF(<span class="keyword">true</span>),</span><br><span class="line">  JPEG(<span class="keyword">false</span>),</span><br><span class="line">  RAW(<span class="keyword">false</span>),</span><br><span class="line">  <span class="comment">/** PNG type with alpha. */</span></span><br><span class="line">  PNG_A(<span class="keyword">true</span>),</span><br><span class="line">  <span class="comment">/** PNG type without alpha. */</span></span><br><span class="line">  PNG(<span class="keyword">false</span>),</span><br><span class="line">  <span class="comment">/** WebP type with alpha. */</span></span><br><span class="line">  WEBP_A(<span class="keyword">true</span>),</span><br><span class="line">  <span class="comment">/** WebP type without alpha. */</span></span><br><span class="line">  WEBP(<span class="keyword">false</span>),</span><br><span class="line">  <span class="comment">/** Unrecognized type. */</span></span><br><span class="line">  UNKNOWN(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> hasAlpha;</span><br><span class="line"></span><br><span class="line">  ImageType(<span class="keyword">boolean</span> hasAlpha) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hasAlpha = hasAlpha;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasAlpha</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hasAlpha;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€Œå®é™…è·å–å›¾ç‰‡ç±»å‹çš„é€»è¾‘ä½äº DefaultImageHeaderParser ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ImageType <span class="title">getType</span><span class="params">(Reader reader)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> firstTwoBytes = reader.getUInt16();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// JPEG.</span></span><br><span class="line">  <span class="keyword">if</span> (firstTwoBytes == EXIF_MAGIC_NUMBER) &#123;</span><br><span class="line">    <span class="keyword">return</span> JPEG;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> firstFourBytes = (firstTwoBytes &lt;&lt; <span class="number">16</span> &amp; <span class="number">0xFFFF0000</span>) | (reader.getUInt16() &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">  <span class="comment">// PNG.</span></span><br><span class="line">  <span class="keyword">if</span> (firstFourBytes == PNG_HEADER) &#123;</span><br><span class="line">    <span class="comment">// See: http://stackoverflow.com/questions/2057923/how-to-check-a-png-for-grayscale-alpha</span></span><br><span class="line">    <span class="comment">// -color-type</span></span><br><span class="line">    reader.skip(<span class="number">25</span> - <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">int</span> alpha = reader.getByte();</span><br><span class="line">    <span class="comment">// A RGB indexed PNG can also have transparency. Better safe than sorry!</span></span><br><span class="line">    <span class="keyword">return</span> alpha &gt;= <span class="number">3</span> ? PNG_A : PNG;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GIF from first 3 bytes.</span></span><br><span class="line">  <span class="keyword">if</span> (firstFourBytes &gt;&gt; <span class="number">8</span> == GIF_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> GIF;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// WebP (reads up to 21 bytes). See https://developers.google.com/speed/webp/docs/riff_container</span></span><br><span class="line">  <span class="comment">// for details.</span></span><br><span class="line">  <span class="keyword">if</span> (firstFourBytes != RIFF_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Bytes 4 - 7 contain length information. Skip these.</span></span><br><span class="line">  reader.skip(<span class="number">4</span>);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> thirdFourBytes =</span><br><span class="line">      (reader.getUInt16() &lt;&lt; <span class="number">16</span> &amp; <span class="number">0xFFFF0000</span>) | (reader.getUInt16() &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">  <span class="keyword">if</span> (thirdFourBytes != WEBP_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> fourthFourBytes =</span><br><span class="line">      (reader.getUInt16() &lt;&lt; <span class="number">16</span> &amp; <span class="number">0xFFFF0000</span>) | (reader.getUInt16() &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">  <span class="keyword">if</span> ((fourthFourBytes &amp; VP8_HEADER_MASK) != VP8_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((fourthFourBytes &amp; VP8_HEADER_TYPE_MASK) == VP8_HEADER_TYPE_EXTENDED) &#123;</span><br><span class="line">    <span class="comment">// Skip some more length bytes and check for transparency/alpha flag.</span></span><br><span class="line">    reader.skip(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">return</span> (reader.getByte() &amp; WEBP_EXTENDED_ALPHA_FLAG) != <span class="number">0</span> ? ImageType.WEBP_A : ImageType.WEBP;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((fourthFourBytes &amp; VP8_HEADER_TYPE_MASK) == VP8_HEADER_TYPE_LOSSLESS) &#123;</span><br><span class="line">    <span class="comment">// See chromium.googlesource.com/webm/libwebp/+/master/doc/webp-lossless-bitstream-spec.txt</span></span><br><span class="line">    <span class="comment">// for more info.</span></span><br><span class="line">    reader.skip(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">return</span> (reader.getByte() &amp; WEBP_LOSSLESS_ALPHA_FLAG) != <span class="number">0</span> ? ImageType.WEBP_A : ImageType.WEBP;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ImageType.WEBP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯é€šè¿‡æ–‡ä»¶å¤´æ ‡ç¤ºæ¥è·å–å›¾ç‰‡ç±»å‹çš„ï¼Œè€Œ gif æ–‡ä»¶å¤´å¦‚ä¸‹ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/4679478-588f3a9d994f274a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>æŸ¥çœ‹ä»£ç ï¼ŒGlide ä¸­ä¾¿æ˜¯é€šè¿‡ 0x474946 æ–‡ä»¶å¤´æ¥åˆ¤æ–­çš„ã€‚</p><p>Glide ä¸­å°† gif ç±»å‹å›¾ç‰‡å°è£…æˆäº† GifDrawableï¼Œåœ¨ ByteBufferGifDecoder ä¸­å¯ä»¥çœ‹åˆ° GifDrawable çš„ç”Ÿæˆé€»è¾‘ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> GifDrawableResource <span class="title">decode</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    ByteBuffer byteBuffer, <span class="keyword">int</span> width, <span class="keyword">int</span> height, GifHeaderParser parser, Options options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = LogTime.getLogTime();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> GifHeader header = parser.parseHeader();</span><br><span class="line">    <span class="keyword">if</span> (header.getNumFrames() &lt;= <span class="number">0</span> || header.getStatus() != GifDecoder.STATUS_OK) &#123;</span><br><span class="line">      <span class="comment">// If we couldn't decode the GIF, we will end up with a frame count of 0.</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Bitmap.Config config = options.get(GifOptions.DECODE_FORMAT) == DecodeFormat.PREFER_RGB_565</span><br><span class="line">        ? Bitmap.Config.RGB_565 : Bitmap.Config.ARGB_8888;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> sampleSize = getSampleSize(header, width, height);</span><br><span class="line">    GifDecoder gifDecoder = gifDecoderFactory.build(provider, header, byteBuffer, sampleSize);</span><br><span class="line">    gifDecoder.setDefaultBitmapConfig(config);</span><br><span class="line">    gifDecoder.advance();</span><br><span class="line">    Bitmap firstFrame = gifDecoder.getNextFrame();</span><br><span class="line">    <span class="keyword">if</span> (firstFrame == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Transformation&lt;Bitmap&gt; unitTransformation = UnitTransformation.get();</span><br><span class="line"></span><br><span class="line">    GifDrawable gifDrawable =</span><br><span class="line">        <span class="keyword">new</span> GifDrawable(context, gifDecoder, unitTransformation, width, height, firstFrame);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GifDrawableResource(gifDrawable);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class="line">      Log.v(TAG, <span class="string">"Decoded GIF from stream in "</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤å·²ç»è·å–åˆ° GifDrawable ï¼ŒGifDrawable ä¸­æŒæœ‰ä¸€ä¸ª GifFrameLoaderï¼Œè€Œ GifFrameLoader ä¸­æŒæœ‰äº† gif è§£ç å™¨ StandardGifDecoder ã€‚ç”±æ­¤å¯ä»¥å¾—å‡º gif çš„å±•ç¤ºé€»è¾‘å°±å°è£…äº GifDrawable ä¸­ï¼Œä¸»è¦é€šè¿‡ GifFrameLoader å®ç°ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å±•ç¤º gif æ—¶ï¼Œå³ä½¿ä¸è°ƒç”¨ asGif æ–¹æ³•ï¼ŒGlide ä¹Ÿèƒ½è¯†åˆ«å‡º gif ç±»å‹å¹¶æ­£å¸¸å±•ç¤ºã€‚è§£ç é€»è¾‘ä½äº Downsampler çš„ decode æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å…ˆä»è¿™é‡Œå¼€å§‹ï¼Œçœ‹çœ‹ Glide æ˜¯å¦‚ä½•è¯†åˆ« gif ç±»å‹çš„ã€‚decode æ–¹æ³•ä¸­è°ƒç”¨äº† decodeFromWrappedStreams æ–¹æ³•å¼€å§‹å®é™…è§£ç é€»è¾‘ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - ç¼©ç•¥å›¾ä½¿ç”¨åŠåŸç†</title>
    <link href="http://yhaowa.gitee.io/2455213e/"/>
    <id>http://yhaowa.gitee.io/2455213e/</id>
    <published>2019-02-17T08:25:28.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¼©ç•¥å›¾çš„ä½¿ç”¨å¯å‚è€ƒ<a href="https://muyangmin.github.io/glide-docs-cn/doc/options.html#ç¼©ç•¥å›¾-thumbnail-è¯·æ±‚" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>è‹¥ä½¿ç”¨ç®€åŒ–æ–¹å¼è®¾ç½®ç¼©ç•¥å›¾ï¼š</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(context).load(imgUrl).thumbnail(<span class="number">0.2f</span>).into(imageView);</span><br></pre></td></tr></table></figure><p>å‘èµ·ç¼©ç•¥å›¾è¯·æ±‚çš„å…³é”®é€»è¾‘ä½äº RequestBuilder çš„ buildThumbnailRequestRecursive æ–¹æ³•ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base case: thumbnail multiplier generates a thumbnail request, but cannot recurse.</span></span><br><span class="line">  ThumbnailRequestCoordinator coordinator = <span class="keyword">new</span> ThumbnailRequestCoordinator(parentCoordinator);</span><br><span class="line"></span><br><span class="line">  Request fullRequest =</span><br><span class="line">      obtainRequest(</span><br><span class="line">          target,</span><br><span class="line">          targetListener,</span><br><span class="line">          requestOptions,</span><br><span class="line">          coordinator,</span><br><span class="line">          transitionOptions,</span><br><span class="line">          priority,</span><br><span class="line">          overrideWidth,</span><br><span class="line">          overrideHeight);</span><br><span class="line"></span><br><span class="line">  RequestOptions thumbnailOptions = requestOptions.clone()</span><br><span class="line">      .sizeMultiplier(thumbSizeMultiplier);</span><br><span class="line">  Request thumbnailRequest =</span><br><span class="line">      obtainRequest(</span><br><span class="line">          target,</span><br><span class="line">          targetListener,</span><br><span class="line">          thumbnailOptions,</span><br><span class="line">          coordinator,</span><br><span class="line">          transitionOptions,</span><br><span class="line">          getThumbnailPriority(priority),</span><br><span class="line">          overrideWidth,</span><br><span class="line">          overrideHeight);</span><br><span class="line"></span><br><span class="line">  coordinator.setRequests(fullRequest, thumbnailRequest);</span><br><span class="line">  <span class="keyword">return</span> coordinator;</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ fullRequestã€thumbnailRequest åˆ†åˆ«ä¸ºåŸå›¾ã€ç¼©ç•¥å›¾è¯·æ±‚ï¼ŒThumbnailRequestCoordinator å°±æ˜¯å­—é¢æ„æ€ï¼Œä¸“é—¨ç”¨äºåè°ƒåŸå›¾ã€ç¼©ç•¥å›¾çš„è¯·æ±‚ï¼Œå¹¶åˆå¹¶æˆä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ„å»ºç¼©ç•¥å›¾è¯·æ±‚æ—¶ï¼Œä¸ºäº†å°½é‡è®©ç¼©ç•¥å›¾æ¯”åŸå›¾åŠ è½½çš„æ›´å¿«ä¸€ç‚¹ï¼Œè°ƒç”¨ getThumbnailPriority æ–¹æ³•è°ƒæ•´äº†è¯·æ±‚ä¼˜å…ˆçº§ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Priority <span class="title">getThumbnailPriority</span><span class="params">(@NonNull Priority current)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (current) &#123;</span><br><span class="line">    <span class="keyword">case</span> LOW:</span><br><span class="line">      <span class="keyword">return</span> Priority.NORMAL;</span><br><span class="line">    <span class="keyword">case</span> NORMAL:</span><br><span class="line">      <span class="keyword">return</span> Priority.HIGH;</span><br><span class="line">    <span class="keyword">case</span> HIGH:</span><br><span class="line">    <span class="keyword">case</span> IMMEDIATE:</span><br><span class="line">      <span class="keyword">return</span> Priority.IMMEDIATE;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"unknown priority: "</span> + requestOptions.getPriority());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŠ è½½å®Œæ•°æ®åï¼ŒGlide ä¼šåˆ†åˆ«è§£ç ç¼©ç•¥å›¾ã€åŸå›¾ä¸¤ç§å°ºå¯¸çš„å›¾ç‰‡ï¼Œå…·ä½“è§£ç å®ç°ä½äº Downsampler çš„ decode æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Resource&lt;Bitmap&gt; <span class="title">decode</span><span class="params">(InputStream is, <span class="keyword">int</span> requestedWidth, <span class="keyword">int</span> requestedHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    Options options, DecodeCallbacks callbacks)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  Preconditions.checkArgument(is.markSupported(), <span class="string">"You must provide an InputStream that supports"</span></span><br><span class="line">      + <span class="string">" mark()"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">byte</span>[] bytesForOptions = byteArrayPool.get(ArrayPool.STANDARD_BUFFER_SIZE_BYTES, <span class="keyword">byte</span>[]<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  BitmapFactory.Options bitmapFactoryOptions = getDefaultOptions();</span><br><span class="line">  bitmapFactoryOptions.inTempStorage = bytesForOptions;</span><br><span class="line"></span><br><span class="line">  DecodeFormat decodeFormat = options.get(DECODE_FORMAT);</span><br><span class="line">  DownsampleStrategy downsampleStrategy = options.get(DownsampleStrategy.OPTION);</span><br><span class="line">  <span class="keyword">boolean</span> fixBitmapToRequestedDimensions = options.get(FIX_BITMAP_SIZE_TO_REQUESTED_DIMENSIONS);</span><br><span class="line">  <span class="keyword">boolean</span> isHardwareConfigAllowed =</span><br><span class="line">    options.get(ALLOW_HARDWARE_CONFIG) != <span class="keyword">null</span> &amp;&amp; options.get(ALLOW_HARDWARE_CONFIG);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Bitmap result = decodeFromWrappedStreams(is, bitmapFactoryOptions,</span><br><span class="line">        downsampleStrategy, decodeFormat, isHardwareConfigAllowed, requestedWidth,</span><br><span class="line">        requestedHeight, fixBitmapToRequestedDimensions, callbacks);</span><br><span class="line">    <span class="keyword">return</span> BitmapResource.obtain(result, bitmapPool);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    releaseOptions(bitmapFactoryOptions);</span><br><span class="line">    byteArrayPool.put(bytesForOptions);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è§£ç å®Œåä¼šè°ƒç”¨åˆ° DecodeJob çš„ notifyComplete æ–¹æ³•ï¼Œè¿›ä¸€æ­¥è°ƒç”¨åˆ° EngineJob çš„ onResourceReady æ–¹æ³•ï¼Œåœ¨ onResourceReady æ–¹æ³•ä¸­é€šè¿‡ handle è½¬åˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åè°ƒç”¨åˆ° EngineJob çš„ handleResultOnMainThread æ–¹æ³•ï¼Œæ¥ç€è°ƒç”¨ SingleRequest çš„ onResourceReady æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(Resource&lt;R&gt; resource, R result, DataSource dataSource)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// We must call isFirstReadyResource before setting status.</span></span><br><span class="line">   <span class="keyword">boolean</span> isFirstResource = isFirstReadyResource();</span><br><span class="line">   status = Status.COMPLETE;</span><br><span class="line">   <span class="keyword">this</span>.resource = resource;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (glideContext.getLogLevel() &lt;= Log.DEBUG) &#123;</span><br><span class="line">     Log.d(GLIDE_TAG, <span class="string">"Finished loading "</span> + result.getClass().getSimpleName() + <span class="string">" from "</span></span><br><span class="line">         + dataSource + <span class="string">" for "</span> + model + <span class="string">" with size ["</span> + width + <span class="string">"x"</span> + height + <span class="string">"] in "</span></span><br><span class="line">         + LogTime.getElapsedMillis(startTime) + <span class="string">" ms"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   isCallingCallbacks = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="keyword">boolean</span> anyListenerHandledUpdatingTarget = <span class="keyword">false</span>;</span><br><span class="line">     <span class="keyword">if</span> (requestListeners != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">for</span> (RequestListener&lt;R&gt; listener : requestListeners) &#123;</span><br><span class="line">         anyListenerHandledUpdatingTarget |=</span><br><span class="line">             listener.onResourceReady(result, model, target, dataSource, isFirstResource);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     anyListenerHandledUpdatingTarget |=</span><br><span class="line">         targetListener != <span class="keyword">null</span></span><br><span class="line">             &amp;&amp; targetListener.onResourceReady(result, model, target, dataSource, isFirstResource);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!anyListenerHandledUpdatingTarget) &#123;</span><br><span class="line">       Transition&lt;? <span class="keyword">super</span> R&gt; animation =</span><br><span class="line">           animationFactory.build(dataSource, isFirstResource);</span><br><span class="line">       target.onResourceRReady(result, animation);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">     isCallingCallbacks = <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   notifyLoadSuccess();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æ­¤æ–¹æ³•ä¸­ç»ˆäºå°†åŠ è½½èµ„æºå›è°ƒç»™ Target äº†ï¼Œè°ƒç”¨æ ˆå¤§è‡´å¦‚ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/4679478-08af148de8e8a2c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>ä»¥ä¸Šä¸æ­¢æ˜¯è®¾ç½®ç¼©ç•¥å›¾æ—¶çš„åŠ è½½æµç¨‹ï¼Œæ²¡æœ‰ç¼©ç•¥å›¾æ—¶èµ°çš„ä¹Ÿæ˜¯è¿™ä¸ªæµç¨‹ã€‚æˆ‘ä»¬çŸ¥é“å›¾ç‰‡ç¼©ç•¥å›¾ä¸è¿‡æ˜¯é€šè¿‡ BitmapFactory.Options  è§£ç ä¸€å¼ å°ºå¯¸è¾ƒå°ã€è´¨é‡è¾ƒå·®çš„å›¾ç½¢äº†ï¼Œè€Œ Glide é™¤äº†æ”¯æŒé…ç½®å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œè¿˜æ”¯æŒé…ç½®æœ¬åœ°è§†é¢‘ç¼©ç•¥å›¾ã€‚å–è§†é¢‘ç¼©ç•¥å›¾çš„å…³é”®é€»è¾‘ä½äº VideoDecoder çš„ decodeFrame æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Bitmap <span class="title">decodeFrame</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     MediaMetadataRetriever mediaMetadataRetriever,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">long</span> frameTimeMicros,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> frameOption,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> outWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> outHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">     DownsampleStrategy strategy)</span> </span>&#123;</span><br><span class="line">   Bitmap result = <span class="keyword">null</span>;</span><br><span class="line">   <span class="comment">// Arguably we should handle the case where just width or just height is set to</span></span><br><span class="line">   <span class="comment">// Target.SIZE_ORIGINAL. Up to and including OMR1, MediaMetadataRetriever defaults to setting</span></span><br><span class="line">   <span class="comment">// the dimensions to the display width and height if they aren't specified (ie</span></span><br><span class="line">   <span class="comment">// getScaledFrameAtTime is not used). Given that this is an optimization only if</span></span><br><span class="line">   <span class="comment">// Target.SIZE_ORIGINAL is not used and not using getScaledFrameAtTime ever would match the</span></span><br><span class="line">   <span class="comment">// behavior of Glide in all versions of Android prior to OMR1, it's probably fine for now.</span></span><br><span class="line">   <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= VERSION_CODES.O_MR1</span><br><span class="line">       &amp;&amp; outWidth != Target.SIZE_ORIGINAL</span><br><span class="line">       &amp;&amp; outHeight != Target.SIZE_ORIGINAL</span><br><span class="line">       &amp;&amp; strategy != DownsampleStrategy.NONE) &#123;</span><br><span class="line">     result =</span><br><span class="line">         decodeScaledFrame(</span><br><span class="line">             mediaMetadataRetriever, frameTimeMicros, frameOption, outWidth, outHeight, strategy);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">     result = decodeOriginalFrame(mediaMetadataRetriever, frameTimeMicros, frameOption);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°åœ¨ Android 8.1 ç³»ç»Ÿä¸Šæ”¯æŒç›´æ¥è·å–ç¼©æ”¾çš„è§†é¢‘ç¼©ç•¥å›¾ï¼Œ8.1 ä»¥ä¸‹åˆ™ç›´æ¥è·å–å¸§åŸå›¾ï¼Œåˆ†åˆ«é€šè¿‡ MediaMetadataRetriever çš„ getScaledFrameAtTime ã€getFrameAtTime è·å–ã€‚MediaMetadataRetriever æ˜¯ Android æä¾›çš„ç±»ï¼Œç”¨æ¥è·å–æœ¬åœ°å’Œç½‘ç»œ Media æ–‡ä»¶ä¿¡æ¯ï¼Œæä¾›äº†ç”¨äºä»è¾“å…¥åª’ä½“æ–‡ä»¶æ£€ç´¢å¸§å’Œå…ƒæ•°æ®çš„ç»Ÿä¸€æ¥å£ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¼©ç•¥å›¾çš„ä½¿ç”¨å¯å‚è€ƒ&lt;a href=&quot;https://muyangmin.github.io/glide-docs-cn/doc/options.html#ç¼©ç•¥å›¾-thumbnail-è¯·æ±‚&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è‹¥ä½¿ç”¨ç®€åŒ–æ–¹å¼è®¾ç½®ç¼©ç•¥å›¾ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - è¯·æ±‚ä¼˜å…ˆçº§åŠåŸç†</title>
    <link href="http://yhaowa.gitee.io/aeb1195c/"/>
    <id>http://yhaowa.gitee.io/aeb1195c/</id>
    <published>2019-02-17T08:24:53.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>è‹¥ä¸€ä¸ªç•Œé¢ä¸­éœ€è¦å±•ç¤ºå¤šå¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœŸæœ›æŸå¼ å›¾ç‰‡ä¼˜å…ˆåŠ è½½ï¼Œè¿™å°±éœ€è¦è®¾ç½® Glide çš„è¯·æ±‚ä¼˜å…ˆçº§ï¼Œ Glide ä¸­æä¾›å››ç§ä¼˜å…ˆçº§ï¼š</p><a id="more"></a><ul><li>Priority.LOW</li><li>Priority.NORMAL</li><li>Priority.HIGH</li><li>Priority.IMMEDIATE</li></ul><p>ä½¿ç”¨ååˆ†ç®€å•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RequestOptions options = <span class="keyword">new</span> RequestOptions().priority(Priority.HIGH);</span><br><span class="line">Glide.with(context).load(imgUrl).apply(options).into(imageView);</span><br></pre></td></tr></table></figure></p><p>ä¸‹é¢æ¥åˆ†æä¸€ä¸‹æˆ‘ä»¬é…ç½®çš„ Priority.HIGH åˆ°åº•æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼Œè·Ÿè¸ªå‘ç°ä¼˜å…ˆçº§å‚æ•° priority ä¼šè¢«ä¼ å…¥åˆ° RequestBuilder çš„ buildThumbnailRequestRecursive æ–¹æ³•ï¼Œå…¶ä¸­ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Request <span class="title">buildThumbnailRequestRecursive</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     Target&lt;TranscodeType&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">     RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">     @Nullable RequestCoordinator parentCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">     TransitionOptions&lt;?, ? <span class="keyword">super</span> TranscodeType&gt; transitionOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">     Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">     RequestOptions requestOptions)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (thumbnailBuilder != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">// ç¼©ç•¥å›¾ç›¸å…³ï¼Œå…ˆå¿½ç•¥</span></span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (thumbSizeMultiplier != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">// ç¼©ç•¥å›¾ç›¸å…³ï¼Œå…ˆå¿½ç•¥</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">// Base case: no thumbnail.</span></span><br><span class="line">     <span class="keyword">return</span> obtainRequest(</span><br><span class="line">         target,</span><br><span class="line">         targetListener,</span><br><span class="line">         requestOptions,</span><br><span class="line">         parentCoordinator,</span><br><span class="line">         transitionOptions,</span><br><span class="line">         priority,</span><br><span class="line">         overrideWidth,</span><br><span class="line">         overrideHeight);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>ç”±äºå¹¶æœªè®¾ç½® thumbnailï¼Œå…ˆå¿½ç•¥ç¼©ç•¥å›¾ç›¸å…³é€»è¾‘ï¼Œæ­¤æ–¹æ³•ä¸­ä¼šè°ƒç”¨åˆ° obtainRequest æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¸ªï¼Œå‘ç°æˆ‘ä»¬é…ç½®çš„ priority å‚æ•°åœ¨ SingleRequest ä¸­çš„ onSizeReady æ–¹æ³•ä¸­è¢«ä¼ å…¥åˆ° Engine çš„ load æ–¹æ³•ä¸­:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;R&gt; <span class="function">LoadStatus <span class="title">load</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     GlideContext glideContext,</span></span></span><br><span class="line"><span class="function"><span class="params">     Object model,</span></span></span><br><span class="line"><span class="function"><span class="params">     Key signature,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">     Class&lt;?&gt; resourceClass,</span></span></span><br><span class="line"><span class="function"><span class="params">     Class&lt;R&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">     Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">     DiskCacheStrategy diskCacheStrategy,</span></span></span><br><span class="line"><span class="function"><span class="params">     Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> isTransformationRequired,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> isScaleOnlyOrNoTransform,</span></span></span><br><span class="line"><span class="function"><span class="params">     Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> isMemoryCacheable,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> useUnlimitedSourceExecutorPool,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> useAnimationPool,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> onlyRetrieveFromCache,</span></span></span><br><span class="line"><span class="function"><span class="params">     ResourceCallback cb)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// ...çœç•¥å…¶ä»–é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">   DecodeJob&lt;R&gt; decodeJob =</span><br><span class="line">       decodeJobFactory.build(</span><br><span class="line">           glideContext,</span><br><span class="line">           model,</span><br><span class="line">           key,</span><br><span class="line">           signature,</span><br><span class="line">           width,</span><br><span class="line">           height,</span><br><span class="line">           resourceClass,</span><br><span class="line">           transcodeClass,</span><br><span class="line">           priority,</span><br><span class="line">           diskCacheStrategy,</span><br><span class="line">           transformations,</span><br><span class="line">           isTransformationRequired,</span><br><span class="line">           isScaleOnlyOrNoTransform,</span><br><span class="line">           onlyRetrieveFromCache,</span><br><span class="line">           options,</span><br><span class="line">           engineJob);</span><br><span class="line"></span><br><span class="line">   jobs.put(key, engineJob);</span><br><span class="line"></span><br><span class="line">   engineJob.addCallback(cb);</span><br><span class="line">   engineJob.start(decodeJob);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class="line">     logWithTimeAndKey(<span class="string">"Started new load"</span>, startTime, key);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> LoadStatus(cb, engineJob);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œåœ¨æ„å»º DecodeJob æ—¶å°†ä¼˜å…ˆçº§é…ç½®ä¼ å…¥ï¼Œæœ€ç»ˆä¼ å…¥åˆ° DecodeJob å’Œ DecodeHelper ä¸­ï¼Œå…¶ä¸­ DecodeHelper è¢« DecodeJob æŒæœ‰ã€‚</p><p>æ¥ä¸‹æ¥åˆ†æ priority å‚æ•°åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™è¢«ç”¨åˆ°ï¼Œé¦–å…ˆçœ‹ DecodeJob ä¸­æŒæœ‰çš„ priorityï¼Œå…¶ä»…åœ¨å®ç° Comparable æ¥å£æ—¶ç”¨åˆ°ï¼Œè¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå¯ä»¥é€šè¿‡å¯¹ DecodeJob æ’åºæ¥å®ç°ä¼˜å…ˆçº§çš„è°ƒæ•´ã€‚DecodeHelper ä¸­æŒæœ‰çš„ priority åœ¨ DataFetcher çš„ loadData æ–¹æ³•ä¸­è¢«ä¼ å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loadData</span><span class="params">(@NonNull Priority priority, @NonNull DataCallback&lt;? <span class="keyword">super</span> T&gt; callback)</span></span>;</span><br></pre></td></tr></table></figure><p>DataFetch ç”¨äºåŠ è½½æ•°æ®ï¼Œå…¶å®ç°æœ‰å¾ˆå¤šï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/4679478-f7b5a4e8759e4930.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½èƒ½åº”ç”¨ä¼˜å…ˆçº§çš„ï¼Œè¿™å–å†³ä¸å…·ä½“çš„ä¸šåŠ¡ç»„ä»¶ï¼Œæ¯”å¦‚ OkHttp ä¸æ”¯æŒè¯·æ±‚ä¼˜å…ˆçº§è®¾ç½®ï¼Œç›´æ¥å¿½ç•¥äº† priority å‚æ•°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(@NonNull Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    @NonNull <span class="keyword">final</span> DataCallback&lt;? <span class="keyword">super</span> InputStream&gt; callback)</span> </span>&#123;</span><br><span class="line">  Request.Builder requestBuilder = <span class="keyword">new</span> Request.Builder().url(url.toStringUrl());</span><br><span class="line">  <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; headerEntry : url.getHeaders().entrySet()) &#123;</span><br><span class="line">    String key = headerEntry.getKey();</span><br><span class="line">    requestBuilder.addHeader(key, headerEntry.getValue());</span><br><span class="line">  &#125;</span><br><span class="line">  Request request = requestBuilder.build();</span><br><span class="line">  <span class="keyword">this</span>.callback = callback;</span><br><span class="line"></span><br><span class="line">  call = client.newCall(request);</span><br><span class="line">  call.enqueue(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€Œ Volley å°±æ”¯æŒè¯·æ±‚ä¼˜å…ˆçº§ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(@NonNull Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    @NonNull DataCallback&lt;? <span class="keyword">super</span> InputStream&gt; callback)</span> </span>&#123;</span><br><span class="line">  request = requestFactory.create(url.toStringUrl(), callback, glideToVolleyPriority(priority),</span><br><span class="line">      url.getHeaders());</span><br><span class="line">  requestQueue.add(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”±æ­¤ä¹Ÿå¯ä»¥å¾—å‡ºè®¾ç½®è¯·æ±‚ä¼˜å…ˆçº§å¹¶ä¸æ˜¯å¿…ç„¶ç”Ÿæ•ˆçš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è‹¥ä¸€ä¸ªç•Œé¢ä¸­éœ€è¦å±•ç¤ºå¤šå¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœŸæœ›æŸå¼ å›¾ç‰‡ä¼˜å…ˆåŠ è½½ï¼Œè¿™å°±éœ€è¦è®¾ç½® Glide çš„è¯·æ±‚ä¼˜å…ˆçº§ï¼Œ Glide ä¸­æä¾›å››ç§ä¼˜å…ˆçº§ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - å›¾ç‰‡æ ¼å¼åŠå†…å­˜ä¼˜åŒ–</title>
    <link href="http://yhaowa.gitee.io/da1371bf/"/>
    <id>http://yhaowa.gitee.io/da1371bf/</id>
    <published>2019-02-17T08:24:22.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å¾—åˆšæ¥è§¦ Glide æ—¶ï¼Œæ€»ä¼šçœ‹åˆ°è¿™ä¸ªæè¿°ï¼š</p><p><em>Glide é»˜è®¤çš„ Bitmap æ ¼å¼æ˜¯ RGB_565ï¼Œç›¸æ¯”äº Picassoï¼ŒåŠ è½½çš„å›¾ç‰‡è´¨é‡ç•¥å·®ï¼Œä½†æ¯” ARGB_8888 æ ¼å¼çš„å†…å­˜å¼€é”€è¦å°ä¸€åŠã€‚</em></p><p>è€Œç°åœ¨å†è®²è¿™ä¸ªç‰¹æ€§å°±ä¸å¯¹äº†ï¼Œå› ä¸ºåœ¨ Glide v4 ä¸­ï¼Œé»˜è®¤çš„ Bitmap æ ¼å¼æ”¹ä¸ºäº† ARGB_8888ã€‚å‡†ç¡®æ¥è¯´æ˜¯é»˜è®¤çš„è§£ç æ ¼å¼ç”± PREFER_RGB_565 æ”¹ä¸ºäº† PREFER_ARGB_8888ï¼Œå…·ä½“å¯å‚è€ƒ <a href="https://muyangmin.github.io/glide-docs-cn/doc/migrating.html#è§£ç æ ¼å¼" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a> ã€‚</p><a id="more"></a><p>Glide ä¸­å¯é…ç½®çš„è§£ç æ ¼å¼åªæä¾›äº† PREFER_RGB_565 å’Œ PREFER_ARGB_8888 ä¸¤ä¸ªé€‰é¡¹ï¼Œè€Œ Android Bitmap Config ä¸­æä¾›äº† RGB_565ã€ARGB_8888ã€ARGB_4444 ä»¥åŠ HARDWARE ç­‰ 7 ç§æ ¼å¼ï¼Œè¿™è®©æˆ‘ä»¬åœ¨ä½¿ç”¨å±‚é¢ä¸Šæœ‰ä¸€å®šç¨‹åº¦çš„ç®€åŒ–ï¼Œ Glide å†…éƒ¨è‡ªè¡Œé€‚é…äº†å…¶ä»–è§£ç æ ¼å¼ï¼Œæ¯”å¦‚è‹¥é…ç½®ä¸º PREFER_ARGB_8888ï¼Œåœ¨ Android 8.0 ç³»ç»Ÿä¸Šå°±ä¼šå°è¯•å¼€å¯ç¡¬ä»¶ä½å›¾ç¼–ç æ ¼å¼ï¼Œå¯¹åº”ä»£ç äº DecodeJob ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Options <span class="title">getOptionsWithHardwareConfig</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">  Options options = <span class="keyword">this</span>.options;</span><br><span class="line">  <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) &#123;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">boolean</span> isHardwareConfigSafe =</span><br><span class="line">      dataSource == DataSource.RESOURCE_DISK_CACHE || decodeHelper.isScaleOnlyOrNoTransform();</span><br><span class="line">  Boolean isHardwareConfigAllowed = options.get(Downsampler.ALLOW_HARDWARE_CONFIG);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If allow hardware config is defined, we can use it if it's set to false or if it's safe to</span></span><br><span class="line">  <span class="comment">// use the hardware config for the request.</span></span><br><span class="line">  <span class="keyword">if</span> (isHardwareConfigAllowed != <span class="keyword">null</span> &amp;&amp; (!isHardwareConfigAllowed || isHardwareConfigSafe)) &#123;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If allow hardware config is undefined or is set to true but it's unsafe for us to use the</span></span><br><span class="line">  <span class="comment">// hardware config for this request, we need to override the config.</span></span><br><span class="line">  options = <span class="keyword">new</span> Options();</span><br><span class="line">  options.putAll(<span class="keyword">this</span>.options);</span><br><span class="line">  options.set(Downsampler.ALLOW_HARDWARE_CONFIG, isHardwareConfigSafe);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> options;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹æ–‡æ¡£å…³äº <a href="https://muyangmin.github.io/glide-docs-cn/doc/hardwarebitmaps.html" target="_blank" rel="noopener">ç¡¬ä»¶ä½å›¾</a> çš„ä»‹ç»ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œå°±ä¸è¿‡å¤šæè¿°äº†ã€‚å¦å¤– Android ç«¯æ¶‰åŠåˆ°å›¾ç‰‡å†…å­˜ï¼Œå¿…é¡»äº†è§£çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š<a href="https://zhuanlan.zhihu.com/p/20732309?refer=bennyhuo" target="_blank" rel="noopener">ä½ çš„ Bitmap ç©¶ç«Ÿå å¤šå¤§å†…å­˜ï¼Ÿ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å¾—åˆšæ¥è§¦ Glide æ—¶ï¼Œæ€»ä¼šçœ‹åˆ°è¿™ä¸ªæè¿°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Glide é»˜è®¤çš„ Bitmap æ ¼å¼æ˜¯ RGB_565ï¼Œç›¸æ¯”äº Picassoï¼ŒåŠ è½½çš„å›¾ç‰‡è´¨é‡ç•¥å·®ï¼Œä½†æ¯” ARGB_8888 æ ¼å¼çš„å†…å­˜å¼€é”€è¦å°ä¸€åŠã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è€Œç°åœ¨å†è®²è¿™ä¸ªç‰¹æ€§å°±ä¸å¯¹äº†ï¼Œå› ä¸ºåœ¨ Glide v4 ä¸­ï¼Œé»˜è®¤çš„ Bitmap æ ¼å¼æ”¹ä¸ºäº† ARGB_8888ã€‚å‡†ç¡®æ¥è¯´æ˜¯é»˜è®¤çš„è§£ç æ ¼å¼ç”± PREFER_RGB_565 æ”¹ä¸ºäº† PREFER_ARGB_8888ï¼Œå…·ä½“å¯å‚è€ƒ &lt;a href=&quot;https://muyangmin.github.io/glide-docs-cn/doc/migrating.html#è§£ç æ ¼å¼&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - åŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ å’Œåº”ç”¨å°éƒ¨ä»¶ä¸­</title>
    <link href="http://yhaowa.gitee.io/693b387a/"/>
    <id>http://yhaowa.gitee.io/693b387a/</id>
    <published>2019-02-17T08:23:48.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šé¢è¯´åˆ°çš„ä¸‹è½½ã€é¢„åŠ è½½ä¸»è¦é€šè¿‡ RequestFutureTargetã€PreloadTarget å®ç°ï¼Œå¹³æ—¶ä½¿ç”¨ Glide ç›´æ¥åŠ è½½å›¾ç‰‡åˆ° ImageView çš„æ–¹å¼åˆ™æ˜¯é€šè¿‡ ImageViewTargetï¼ŒGlide ä¸­è¿˜æä¾›äº† NotificationTarget å’Œ AppWidgetTarget æ¥å®ç°åŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ å’Œåº”ç”¨å°éƒ¨ä»¶ä¸­ã€‚ä½¿ç”¨æ–¹æ³•ååˆ†ç®€å•ï¼Œä¸‹é¢åˆ—å‡ºåŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ çš„å®ç°ç¤ºä¾‹ï¼š</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadNotificationImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ„å»ºä¸€ä¸ªé€šçŸ¥æ </span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NOTIFICATION_ID = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">final</span> RemoteViews rv = <span class="keyword">new</span> RemoteViews(context.getPackageName(), R.layout.remoteview_notification);</span><br><span class="line">    rv.setImageViewResource(R.id.iv, R.mipmap.ic_launcher);</span><br><span class="line">    rv.setTextViewText(R.id.tv, <span class="string">"Short Message"</span>);</span><br><span class="line">    NotificationCompat.Builder mBuilder =</span><br><span class="line">            <span class="keyword">new</span> NotificationCompat.Builder(context, <span class="string">"channel_id"</span>)</span><br><span class="line">                    .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">                    .setContentTitle(<span class="string">"Content Title"</span>)</span><br><span class="line">                    .setContentText(<span class="string">"Content Text"</span>)</span><br><span class="line">                    .setContent(rv)</span><br><span class="line">                    .setPriority(NotificationCompat.PRIORITY_HIGH);</span><br><span class="line">    <span class="keyword">final</span> Notification notification = mBuilder.build();</span><br><span class="line">    notification.bigContentView = rv;</span><br><span class="line">    NotificationManager service = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">    service.notify(NOTIFICATION_ID, notification);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ </span></span><br><span class="line">    NotificationTarget notificationTarget = <span class="keyword">new</span> NotificationTarget(</span><br><span class="line">            context,</span><br><span class="line">            R.id.iv,</span><br><span class="line">            rv,</span><br><span class="line">            notification,</span><br><span class="line">            NOTIFICATION_ID);</span><br><span class="line">    Glide.with(context).asBitmap().load(imgUrl).into(notificationTarget);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…çš„æ›´æ–°æ–¹æ³•å°è£…äº NotificationTarget ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Updates the Notification after the Bitmap resource is loaded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  NotificationManager manager =</span><br><span class="line">      (NotificationManager) <span class="keyword">this</span>.context.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">  Preconditions.checkNotNull(manager)</span><br><span class="line">      .notify(<span class="keyword">this</span>.notificationTag, <span class="keyword">this</span>.notificationId, <span class="keyword">this</span>.notification);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ AppWidgetTarget åŠ è½½å›¾ç‰‡åˆ°åº”ç”¨å°éƒ¨ä»¶ä¸­ä¸æ­¤ç±»ä¼¼ï¼Œè¿™äº›å‡ç»§æ‰¿è‡ª  <a href="https://muyangmin.github.io/glide-docs-cn/doc/targets.html" target="_blank" rel="noopener">Target</a> æ¥å£ï¼Œäº†è§£åŸç†åï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ Target æ¥éšæ„çš„å®šåˆ¶åŠŸèƒ½äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸Šé¢è¯´åˆ°çš„ä¸‹è½½ã€é¢„åŠ è½½ä¸»è¦é€šè¿‡ RequestFutureTargetã€PreloadTarget å®ç°ï¼Œå¹³æ—¶ä½¿ç”¨ Glide ç›´æ¥åŠ è½½å›¾ç‰‡åˆ° ImageView çš„æ–¹å¼åˆ™æ˜¯é€šè¿‡ ImageViewTargetï¼ŒGlide ä¸­è¿˜æä¾›äº† NotificationTarget å’Œ AppWidgetTarget æ¥å®ç°åŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ å’Œåº”ç”¨å°éƒ¨ä»¶ä¸­ã€‚ä½¿ç”¨æ–¹æ³•ååˆ†ç®€å•ï¼Œä¸‹é¢åˆ—å‡ºåŠ è½½å›¾ç‰‡åˆ°é€šçŸ¥æ çš„å®ç°ç¤ºä¾‹ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - ä¸‹è½½åŠé¢„åŠ è½½</title>
    <link href="http://yhaowa.gitee.io/a7bea0ed/"/>
    <id>http://yhaowa.gitee.io/a7bea0ed/</id>
    <published>2019-02-17T08:21:41.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸‹è½½çš„æ ‡å‡†å†™æ³•å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯å®˜æ–¹ç¤ºä¾‹å†™æ³•ï¼š</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FutureTarget&lt;File&gt; target = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        target = Glide.with(context)</span><br><span class="line">                .downloadOnly()</span><br><span class="line">                .load(imgUrl)</span><br><span class="line">                .submit();</span><br><span class="line">        <span class="keyword">final</span> File cacheFile = target.get();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         *  é»˜è®¤ä¼šä¸‹è½½åˆ°ç£ç›˜ç¼“å­˜ä¸­,ç†è®ºä¸Šä¸åº”å¯¹ç¼“å­˜æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"download: "</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œè¦è°ƒç”¨cancelæ–¹æ³•å–æ¶ˆç­‰å¾…æ“ä½œå¹¶é‡Šæ”¾èµ„æº</span></span><br><span class="line">        <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">            target.cancel(<span class="keyword">true</span>); <span class="comment">// è‹¥ä¼ trueåˆ™å…è®¸ä¸­æ–­æ“ä½œ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹å¼è¦è‡ªè¡Œå¼€å­çº¿ç¨‹ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ç¨æ˜¾éº»çƒ¦ï¼Œç›´æ¥è°ƒç”¨ listener æ–¹æ³•ç›‘å¬ onResourceReady å›è°ƒå²‚ä¸æ˜¯æ›´ç®€å•ï¼Ÿå…¶å®ä¸æ˜¯çš„ï¼Œç”±äºè¦æ‹¿åˆ° FutureTarget è°ƒç”¨å…¶ cancel æ–¹æ³•ï¼Œè‹¥ç›‘å¬ onResourceReady ä»£ç é€»è¾‘ä¼šæ›´å¤æ‚ã€‚</p><p>å¯¹äº FutureTarget.get() æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯è°ƒç”¨æ—¶æ‰ä¼šå»åŠ è½½æ•°æ®ï¼Œè°ƒç”¨ submit æ–¹æ³•åå°±å·²ç»å¼€å§‹å»åŠ è½½æ•°æ®äº†ï¼Œget æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ° RequestFutureTarget çš„ doGet æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> R <span class="title">doGet</span><span class="params">(Long timeoutMillis)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ExecutionException, InterruptedException, TimeoutException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (assertBackgroundThread &amp;&amp; !isDone()) &#123;</span><br><span class="line">    Util.assertBackgroundThread();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CancellationException();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadFailed) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionException(exception);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resultReceived) &#123;</span><br><span class="line">    <span class="keyword">return</span> resource;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (timeoutMillis == <span class="keyword">null</span>) &#123;</span><br><span class="line">    waiter.waitForTimeout(<span class="keyword">this</span>, <span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (timeoutMillis &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">long</span> deadline = now + timeoutMillis;</span><br><span class="line">    <span class="keyword">while</span> (!isDone() &amp;&amp; now &lt; deadline) &#123;</span><br><span class="line">      waiter.waitForTimeout(<span class="keyword">this</span>, deadline - now);</span><br><span class="line">      now = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadFailed) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionException(exception);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CancellationException();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!resultReceived) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> resource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ° get æ–¹æ³•å†…éƒ¨å¹¶æ²¡æœ‰åŠ è½½æ•°æ®çš„é€»è¾‘ï¼Œ RequestFutureTarget å†…éƒ¨é€šè¿‡é”å®ç°äº† get æ–¹æ³•çš„é˜»å¡è°ƒç”¨ï¼Œå½“èµ„æºåŠ è½½å®Œæ¯•å onResourceReady ä¸­ä¼šè§£é™¤é˜»å¡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">onResourceReady</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    R resource, Object model, Target&lt;R&gt; target, DataSource dataSource, <span class="keyword">boolean</span> isFirstResource)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// We might get a null result.</span></span><br><span class="line">  resultReceived = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">this</span>.resource = resource;</span><br><span class="line">  waiter.notifyAll(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é™¤äº†ä¸‹è½½ File ç±»å‹ä»¥å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šä¸‹è½½ç±»å‹ï¼Œæ¯”å¦‚ä¸‹è½½ Bitmapï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadBitmap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RequestOptions DOWNLOAD_ONLY_OPTIONS = RequestOptions</span><br><span class="line">            .diskCacheStrategyOf(DiskCacheStrategy.DATA) <span class="comment">//è¿™è¾¹å…¶å®å¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯é…ç½®ï¼Œå¦‚æœæ˜¯ç½‘ç»œå›¾ç‰‡ä¸€èˆ¬éœ€è¦ç¼“å­˜</span></span><br><span class="line">            .priority(Priority.LOW) <span class="comment">// è®¾ç½®ä¼˜å…ˆçº§</span></span><br><span class="line">            .skipMemoryCache(<span class="keyword">true</span>);</span><br><span class="line">    FutureTarget&lt;Bitmap&gt; target = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        target = Glide.with(context)</span><br><span class="line">                .asBitmap()</span><br><span class="line">                .apply(DOWNLOAD_ONLY_OPTIONS)</span><br><span class="line">                .load(imgUrl)</span><br><span class="line">                .submit();</span><br><span class="line">        <span class="keyword">final</span> Bitmap bitmap = target.get();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"download: "</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œè¦è°ƒç”¨cancelæ–¹æ³•å–æ¶ˆç­‰å¾…æ“ä½œå¹¶é‡Šæ”¾èµ„æº</span></span><br><span class="line">        <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">            target.cancel(<span class="keyword">true</span>); <span class="comment">// è‹¥ä¼ trueåˆ™å…è®¸ä¸­æ–­æ“ä½œ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„ DOWNLOAD_ONLY_OPTIONS é…ç½®å…¶å®å°±æ˜¯ downloadOnly æ–¹æ³•åº”ç”¨çš„é…ç½®ã€‚</p><p>å®ç°é¢„åŠ è½½ååˆ†ç®€å•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(context).load(imgUrl).preload();</span><br></pre></td></tr></table></figure></p><p>å…³é”®ä»£ç ä½äº PreloadTarget ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PreloadTarget</span>&lt;<span class="title">Z</span>&gt; <span class="keyword">extends</span> <span class="title">SimpleTarget</span>&lt;<span class="title">Z</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MESSAGE_CLEAR = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Handler HANDLER = <span class="keyword">new</span> Handler(Looper.getMainLooper(), <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (message.what == MESSAGE_CLEAR) &#123;</span><br><span class="line">        ((PreloadTarget&lt;?&gt;) message.obj).clear();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RequestManager requestManager;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;Z&gt; <span class="function">PreloadTarget&lt;Z&gt; <span class="title">obtain</span><span class="params">(RequestManager requestManager, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PreloadTarget&lt;&gt;(requestManager, width, height);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">PreloadTarget</span><span class="params">(RequestManager requestManager, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(width, height);</span><br><span class="line">    <span class="keyword">this</span>.requestManager = requestManager;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(@NonNull Z resource, @Nullable Transition&lt;? <span class="keyword">super</span> Z&gt; transition)</span> </span>&#123;</span><br><span class="line">    HANDLER.obtainMessage(MESSAGE_CLEAR, <span class="keyword">this</span>).sendToTarget();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>)</span><br><span class="line">  <span class="meta">@Synthetic</span> <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    requestManager.clear(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç›¸æ¯”äº RequestFutureTargetï¼ŒPreloadTarget é‡Œçš„é€»è¾‘å°±ç®€å•å¤šäº†ï¼Œå¯ä»¥çœ‹åˆ°åŠ è½½èµ„æºç»“æŸååªæ˜¯æŠŠæ­¤æ¬¡è¯·æ±‚é‡Šæ”¾æ‰äº†ï¼Œä¸ç”¨åƒå…¶ä»– Target ä¸€æ ·åšé¢å¤–çš„æ“ä½œã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸‹è½½çš„æ ‡å‡†å†™æ³•å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯å®˜æ–¹ç¤ºä¾‹å†™æ³•ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide æºç åˆ†æ - æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸ </title>
    <link href="http://yhaowa.gitee.io/c135648c/"/>
    <id>http://yhaowa.gitee.io/c135648c/</id>
    <published>2019-02-17T08:20:28.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‘èµ·ä¸€ä¸ªå›¾ç‰‡åŠ è½½è¯·æ±‚åï¼Œæˆ‘ä»¬æœŸæœ›å½“è¯¥è¯·æ±‚æ‰€å¤„çš„ç•Œé¢ onStop æ—¶è¯·æ±‚ä¹Ÿéšä¹‹åœæ­¢ï¼Œå†æ¬¡ onStart æ—¶è¯·æ±‚èƒ½å¤Ÿéšä¹‹ç»§ç»­ï¼Œ onDestroy æ—¶è¯·æ±‚èƒ½å¤Ÿéšä¹‹é”€æ¯ã€‚è¿™å°±éœ€è¦èƒ½å¤Ÿæ„ŸçŸ¥å½“å‰ Activity çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œç”±äº Fragment åœ¨ onAttach ä¹‹åä¸ Activity æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œglide åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡ç»™ Activity æ·»åŠ ä¸€ä¸ªæ— ç•Œé¢çš„ Fragment å®ç°æ„ŸçŸ¥ã€‚</p><a id="more"></a><p><img src="https://upload-images.jianshu.io/upload_images/4679478-ac8b2896aba7322b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>å‘èµ·è¯·æ±‚æ—¶é€šè¿‡ with æ–¹æ³•ä¼ å…¥ä¸Šä¸‹æ–‡ï¼Œæ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª RequestManagerï¼ŒRequestManager ç”¨äºç®¡ç†å’Œå¯åŠ¨å›¾ç‰‡åŠ è½½è¯·æ±‚ï¼Œå¯ä»¥æ„ŸçŸ¥å¤–éƒ¨ Activity çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»è€Œç®¡ç†è¯·æ±‚éšä¹‹å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ã€‚</p><p>å…ˆæ¥åˆ†æä¸€ä¸ªè¾ƒä¸ºç®€å•çš„æµç¨‹ï¼šwith æ–¹æ³•ä¼ å…¥ Activityï¼Œä¼šè°ƒç”¨åˆ° RequestManagerRetriever çš„ get æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RequestManager <span class="title">get</span><span class="params">(@NonNull Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class="line">      <span class="keyword">return</span> get(activity.getApplicationContext());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      assertNotDestroyed(activity);</span><br><span class="line">      android.app.FragmentManager fm = activity.getFragmentManager();</span><br><span class="line">      <span class="keyword">return</span> fragmentGet(</span><br><span class="line">          activity, fm, <span class="comment">/*parentHint=*/</span> <span class="keyword">null</span>, isActivityVisible(activity));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­è°ƒç”¨ fragmentGet æ–¹æ³•å»æ–°å»º RequestManager ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> RequestManager <span class="title">fragmentGet</span><span class="params">(@NonNull Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">      @NonNull android.app.FragmentManager fm,</span></span></span><br><span class="line"><span class="function"><span class="params">      @Nullable android.app.Fragment parentHint,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">boolean</span> isParentVisible)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªæ— ç•Œé¢çš„ Fragmentï¼Œå¹¶æ·»åŠ åˆ°è¯¥ç•Œé¢</span></span><br><span class="line">    RequestManagerFragment current = getRequestManagerFragment(fm, parentHint, isParentVisible);</span><br><span class="line">    RequestManager requestManager = current.getRequestManager();</span><br><span class="line">    <span class="keyword">if</span> (requestManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">      Glide glide = Glide.get(context);</span><br><span class="line">      requestManager =</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ª requestManagerï¼Œå¹¶å°†æ— ç•Œé¢ Fragment çš„ç”Ÿå‘½å‘¨æœŸæš´éœ²ç»™ requestManager</span></span><br><span class="line">          factory.build(</span><br><span class="line">              glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);</span><br><span class="line">      current.setRequestManager(requestManager);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> requestManager;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>å½“æ— ç•Œé¢ Fragment ç”Ÿå‘½å‘¨æœŸå˜åŒ–æ—¶ï¼Œé€šè¿‡æ¥å£å›è°ƒå‡ºå»ç»™ requestManagerï¼Œè¿™æ · requestManager å°±å®ç°äº†éšå¤–éƒ¨ç”Ÿå‘½å‘¨æœŸå˜åŒ–è‡ªåŠ¨å¯åŠ¨ã€åœæ­¢å’Œé‡å¯è¯·æ±‚ã€‚with æ–¹æ³•è‹¥ä¼ å…¥å…¶ä»–å‚æ•°ï¼Œæµç¨‹ä¸Šä¹Ÿæ˜¯å¤§åŒå°å¼‚ï¼Œéƒ½æ˜¯æ‰¾åˆ°å½“å‰ Activity æˆ– Fragment ï¼Œç»™å…¶æ·»åŠ ä¸€ä¸ªæ— ç•Œé¢ Fragment ç½¢äº†ã€‚</p><p>è€Œä¸ç®¡ä¼ å…¥ä½•å‚æ•°ï¼Œéƒ½æœ‰è¿™æ ·ä¸€ä¸ªé€»è¾‘ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class="line">     <span class="keyword">return</span> get(view.getContext().getApplicationContext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‹¥å½“å‰å¤„äºéä¸»çº¿ç¨‹ï¼Œåˆ™ä¸€å¾‹åŸºäºåº”ç”¨ç”Ÿå‘½å‘¨æœŸè¯·æ±‚ï¼Œä¸å†å…³å¿ƒæ‰€åœ¨ Fragment æˆ– Activity çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ˜¯å› ä¸ºå­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡æœ¬èº«å°±æ˜¯è·Ÿæ‰€åœ¨ç•Œé¢ç”Ÿå‘½å‘¨æœŸæ— å…³çš„ã€‚</p><p>åœ¨åˆ†æè¿™ä¸€å—æ—¶æ¶‰åŠ ContextWrapper ç›¸å…³çš„é€»è¾‘ï¼Œè‹¥ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯å‚è€ƒï¼š<a href="https://blog.csdn.net/guolin_blog/article/details/47028975" target="_blank" rel="noopener">ContextWrapper</a> ã€‚</p><p>Glide æ¨å‡ºæ—¶è°·æ­Œè¿˜æœªå‘å¸ƒ Architecture Componentsï¼Œè€Œç°åœ¨è‹¥è¦å®ç°ä¸€ä¸ªå¯æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸçš„é€»è¾‘ï¼Œå¤§å¯ä¸å¿…åƒ Glide ä¸€æ ·æ·»åŠ ä¸€ä¸ª Fragment ï¼Œç›´æ¥ä½¿ç”¨ Architecture Components ä¸­çš„ Lifecycle ç»„ä»¶å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‘èµ·ä¸€ä¸ªå›¾ç‰‡åŠ è½½è¯·æ±‚åï¼Œæˆ‘ä»¬æœŸæœ›å½“è¯¥è¯·æ±‚æ‰€å¤„çš„ç•Œé¢ onStop æ—¶è¯·æ±‚ä¹Ÿéšä¹‹åœæ­¢ï¼Œå†æ¬¡ onStart æ—¶è¯·æ±‚èƒ½å¤Ÿéšä¹‹ç»§ç»­ï¼Œ onDestroy æ—¶è¯·æ±‚èƒ½å¤Ÿéšä¹‹é”€æ¯ã€‚è¿™å°±éœ€è¦èƒ½å¤Ÿæ„ŸçŸ¥å½“å‰ Activity çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œç”±äº Fragment åœ¨ onAttach ä¹‹åä¸ Activity æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œglide åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡ç»™ Activity æ·»åŠ ä¸€ä¸ªæ— ç•Œé¢çš„ Fragment å®ç°æ„ŸçŸ¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Glide æºç åˆ†æ" scheme="http://yhaowa.gitee.io/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yhaowa.gitee.io/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Android ç«¯éŸ³é¢‘å˜å£°æ–¹æ¡ˆ</title>
    <link href="http://yhaowa.gitee.io/785f874e/"/>
    <id>http://yhaowa.gitee.io/785f874e/</id>
    <published>2018-11-01T15:23:58.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>éŸ³é¢‘å˜å£°å®è´¨ä¸Šæ˜¯é€šè¿‡è°ƒæ•´ PCM æ•°æ®çš„éŸ³è°ƒã€èŠ‚æ‹ç­‰å±æ€§ï¼Œå®ç°å¬æ„Ÿä¸Šçš„å˜åŒ–ã€‚å¦‚æœæ˜¯ mp3ã€aac ç­‰å‹ç¼©éŸ³é¢‘ï¼Œåˆ™éœ€æå‰è§£ç æˆ PCM æ•°æ®ï¼ŒAndroid ç«¯å¯ä»¥é€šè¿‡ MediaExtractor åŠ MediaCodec è§£ç å¾—åˆ° PCMï¼Œä½†è°ƒæ•´éŸ³è°ƒã€èŠ‚æ‹ä»…é  Android api å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œåªèƒ½é›†æˆç¬¬ä¸‰æ–¹åº“æ¥å®ç°ï¼Œå¸¸è§çš„éŸ³é¢‘å¤„ç†åº“æœ‰ <a href="https://www.fmod.com" target="_blank" rel="noopener">Fmod</a> ã€  <a href="http://www.surina.net/soundtouch/" target="_blank" rel="noopener">SoundTouch</a> ã€‚</p><a id="more"></a><h3 id="Fmod"><a href="#Fmod" class="headerlink" title="Fmod"></a>Fmod</h3><p>Fmod æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„éŸ³é¢‘å¤„ç†å¼•æ“ï¼Œå®˜ç½‘æä¾›äº†å„ä¸ªå¹³å°çš„ <a href="https://www.fmod.com/resources/documentation-api" target="_blank" rel="noopener">æ¥å…¥æ–‡æ¡£</a>ï¼Œå¯ä»¥å®ç°å˜è°ƒã€å˜é€Ÿå˜å£°æ•ˆæœä»¥åŠæ··å“ã€é¢¤éŸ³ç­‰é«˜çº§æ•ˆæœã€‚å¼€å‘è°ƒç”¨ç®€å•ï¼Œsdk å¯¹å¤–æä¾›äº†æ’­æ”¾å™¨æ¥å£ï¼Œä¼ å…¥éŸ³é¢‘æ–‡ä»¶å³å¯ç›´æ¥å˜å£°æ’­æ”¾ã€‚ä½†ä¸æ”¯æŒä¿å­˜å¤„ç†åçš„éŸ³é¢‘åˆ°æ–‡ä»¶ï¼Œå•†ä¸šç”¨é€”éœ€è¦è´­ä¹°è®¸å¯è¯ã€‚</p><p>å¦‚æœä½ ä¸éœ€è¦ä¿å­˜å¤„ç†åçš„éŸ³é¢‘åˆ°æ–‡ä»¶ï¼Œé‚£å°±ä½¿ç”¨ Fmod å§ï¼Œä½ ä¼šå‘ç°éŸ³é¢‘å˜å£°æ˜¯å¦‚æ­¤ç®€å•ï¼Œè€Œä¸”è¿˜æ”¯æŒæ··å“ã€é¢¤éŸ³ç­‰é«˜çº§å˜å£°æ•ˆæœï¼</p><p>å¦‚æœéœ€è¦ä¿å­˜å¤„ç†åçš„éŸ³é¢‘åˆ°æ–‡ä»¶ï¼Œé‚£ä¹ˆâ€¦â€¦æˆ‘å°±è¯·ä½ å†è®¤çœŸçš„æ€è€ƒä¸€ä¸‹ï¼Œä½ çš„éœ€æ±‚çœŸçš„å¿…é¡»è¦ä¿å­˜å¤„ç†åçš„éŸ³é¢‘å—ï¼Ÿå‡è®¾ä¸€ä¸ªèŠå¤© app è¦å®ç°è¯­éŸ³æ¶ˆæ¯å˜å£°ï¼Œé‚£è¿™æ®µè¯­éŸ³åªä¼šåœ¨ä½ çš„åº”ç”¨ä¸­æ’­æ”¾ï¼Œé‚£å°±éƒ½å¯ä»¥é€šè¿‡ Fmod æ’­æ”¾å™¨å˜å£°æ’­æ”¾å•Šï¼Œè¦çŸ¥é“ Fmod å¯æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„éŸ³é¢‘å¼•æ“ï¼Œä¸è®ºæ˜¯ Androidã€IOS è¿˜æ˜¯ Web ç«¯ï¼Œåªè¦çŸ¥é“å˜å£°å‚æ•°å°±å¯ä»¥å˜å£°æ’­æ”¾äº†ï¼Œä¸éœ€è¦ä¿å­˜å¤„ç†åçš„éŸ³é¢‘åˆ°æ–‡ä»¶ã€‚</p><p>èƒ½å¦è·ƒè¿‡ä¸æ”¯æŒä¿å­˜å¤„ç†åçš„éŸ³é¢‘åˆ°æ–‡ä»¶è¿™ä¸€ç¼ºç‚¹ï¼Œå…³é”®æ˜¯è¦ç¡®å®šç”¨æˆ·èƒ½å¦ç›´æ¥æ¥è§¦åˆ°å¤„ç†åçš„éŸ³é¢‘æ–‡ä»¶ï¼Œè‹¥èƒ½æ¥è§¦åˆ°ï¼Œå°±æ— æ³•ä½¿ç”¨ Fmod äº†ã€‚</p><p>å…³äºé›†æˆä½¿ç”¨ Fmod åº“ååˆ†ç®€å•ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šï¼Œå°±ä¸å†å±•å¼€äº†ã€‚</p><h3 id="SoundTouch"><a href="#SoundTouch" class="headerlink" title="SoundTouch"></a>SoundTouch</h3><p>SoundTouch æ˜¯ä¸€ä¸ªå¼€æºå…è´¹çš„éŸ³é¢‘å¤„ç†åº“ï¼Œå¯ä»¥æ”¹å˜éŸ³è°ƒã€èŠ‚æ‹å’Œæ’­æ”¾é€Ÿç‡ã€‚å¼€å‘è°ƒç”¨æ—¶éœ€è‡ªè¡Œå°†éŸ³é¢‘æ–‡ä»¶è§£ç æˆ PCM æ•°æ®ï¼Œä¼ å…¥ SoundTouch å¤„ç†åï¼ŒSoundTouch ä¼šè¾“å‡ºå¤„ç†åçš„ PCM æ•°æ®ã€‚åŸºäºè¿™ç§ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è‡ªç”±å®šåˆ¶ä»¥é€‚ç”¨äºè‡ªå·±çš„åº”ç”¨ã€‚</p><p>æ¯”å¦‚ä½ è¦å®ç°ä¸€ä¸ª mp3 çš„å˜å£°æ’­æ”¾ï¼Œå¯ä»¥å…ˆç”¨ MediaCodec å°† mp3 è§£ç æˆ PCMï¼Œé€šè¿‡ SoundTouch å¤„ç†å¾—åˆ°å˜å£°åçš„ PCMï¼Œå†ç»“åˆ AudioTrack å®ç°æ’­æ”¾ï¼›å¦‚æœä½ è¦å°†ä¸€ä¸ª mp3 å˜å£°åä¿å­˜ä¸‹æ¥ï¼Œé‚£å°±åœ¨å¾—åˆ°å˜å£°åçš„ PCM åï¼Œç»“åˆ MediaCodec å°†å…¶ç¼–ç ä¿å­˜ä¸‹æ¥ã€‚</p><p>ç›¸æ¯” Fmodï¼ŒSoundTouch çš„é›†æˆä¼šå¤æ‚ç‚¹ï¼Œä¸æ˜¯éšä¾¿å‚è€ƒä¸€ç¯‡æ•™ç¨‹å°±å¯ä»¥è·‘é€šçš„äº†ï¼Œè¿™é‡Œæä¾›ä¸€ä»½äº²æµ‹å¯è¡Œçš„ <a href="https://github.com/yhaolpz/AndroidSoundTouch" target="_blank" rel="noopener">SoundTouch æºç </a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éŸ³é¢‘å˜å£°å®è´¨ä¸Šæ˜¯é€šè¿‡è°ƒæ•´ PCM æ•°æ®çš„éŸ³è°ƒã€èŠ‚æ‹ç­‰å±æ€§ï¼Œå®ç°å¬æ„Ÿä¸Šçš„å˜åŒ–ã€‚å¦‚æœæ˜¯ mp3ã€aac ç­‰å‹ç¼©éŸ³é¢‘ï¼Œåˆ™éœ€æå‰è§£ç æˆ PCM æ•°æ®ï¼ŒAndroid ç«¯å¯ä»¥é€šè¿‡ MediaExtractor åŠ MediaCodec è§£ç å¾—åˆ° PCMï¼Œä½†è°ƒæ•´éŸ³è°ƒã€èŠ‚æ‹ä»…é  Android api å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œåªèƒ½é›†æˆç¬¬ä¸‰æ–¹åº“æ¥å®ç°ï¼Œå¸¸è§çš„éŸ³é¢‘å¤„ç†åº“æœ‰ &lt;a href=&quot;https://www.fmod.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Fmod&lt;/a&gt; ã€  &lt;a href=&quot;http://www.surina.net/soundtouch/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SoundTouch&lt;/a&gt; ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="éŸ³è§†é¢‘" scheme="http://yhaowa.gitee.io/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
    
      <category term="Android" scheme="http://yhaowa.gitee.io/tags/Android/"/>
    
      <category term="FFmpeg" scheme="http://yhaowa.gitee.io/tags/FFmpeg/"/>
    
      <category term="éŸ³è§†é¢‘" scheme="http://yhaowa.gitee.io/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
</feed>
