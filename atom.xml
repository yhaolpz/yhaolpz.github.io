<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Great hopes make great man</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-09-25T11:05:44.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>yhao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android 9.0 Activity 启动流程分析</title>
    <link href="http://yoursite.com/a608ff50/"/>
    <id>http://yoursite.com/a608ff50/</id>
    <published>2019-09-15T11:42:33.000Z</published>
    <updated>2019-09-25T11:05:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>从一个问题出发：调用 startActivity 后系统到底做了什么事？</p><p>如果让我回答这个问题，我的答案会是这样：Android 系统启动后会先启动一个 init 进程，init 进程启动 Zygote 进程，Zygote 进程进而会启动 system server 进程，在这个 system server 进程中，会启动 AMS、WMS 等系统服务。我们的 app 中调用 startActivity 后，需要通过 AMS 执行启动 Activity，而我们的 app 进程与 system server 是不同的进程，所以要跨进程，跨进程是通过 Binder 来实现的。 </p><p>（？？？？？满脸问号脸），我这是回答了啥？</p><a id="more"></a><p>问题是调用 startActivity 后系统到底做了什么事？而我却只是讲了下需要跨进程调用 AMS，可以说几乎是没有回答。为什么我讲了一通却根本没有回答到点上呢？因为我不会… 我根本不知道具体要调用到哪几个类，有哪几个关键方法，做了哪些关键的事，为了突破这个障碍，今天就来仔细研究一下到底 startActivity 做了哪些事，涉及源码基于 <a href="http://androidxref.com/9.0.0_r3/" target="_blank" rel="noopener">Android 9.0 版本</a></p><p>在开始分析之前，心存这几个疑问：</p><ul><li>代码中具体是在哪里调用 AMS 跨进程通信的？</li><li>跨进程调用 AMS 是通过 AIDL 接口方式实现的吗？如果是的话，具体是哪个接口？</li><li>Intent 数据具体是怎样跨进程传输的呢？</li><li>为什么需要 AMS 去执行 Activity 的启动，AMS 到底做了哪些事？</li><li>AMS 执行完后再回到 app 进程也是跨进程，这部分是怎么实现的？ </li><li>上一个 Activity onPause 方法执行完新的 Activity 才能被创建，这个逻辑是在哪里控制的？</li></ul><p>好了开车吧！🙂️</p><p>startActivity 首先会调用到 Activity#startActivityForResult 方法，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityForResult</span><span class="params">(@RequiresPermission Intent intent, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">          @Nullable Bundle options)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (mParent == <span class="keyword">null</span>) &#123;<span class="comment">//【a】</span></span><br><span class="line">          options = transferSpringboardActivityOptions(options);</span><br><span class="line">          Instrumentation.ActivityResult ar =</span><br><span class="line">              mInstrumentation.execStartActivity(</span><br><span class="line">                  <span class="keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="keyword">this</span>,</span><br><span class="line">                  intent, requestCode, options);<span class="comment">//【b】</span></span><br><span class="line">          <span class="comment">//省略...</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">              mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode, options);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>【a】. mParent 是一个 Activity，父 Activity 是什么场景下的呢，起初怀疑与 manifest 中 parentActivityName 配置有关，但并没有。<br>【b】. 进一步调用 Instrumentation 的 execStartActivity 方法，Instrumentation 用于具体操作某个 Activity 的功能（单向调用 AMS）以及统计、测量该应用程序的所有开销，这与它的中文含义”仪表盘”可以说是相当吻合。一个进程只有一个 Instrumentation 对象，每个 Activity 都持有 Instrumentation 。</p><p>Instrumentation 的 execStartActivity 方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActivityResult <span class="title">execStartActivity</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Context who, IBinder contextThread, IBinder token, String target,</span></span></span><br><span class="line"><span class="function"><span class="params">    Intent intent, <span class="keyword">int</span> requestCode, Bundle options)</span> </span>&#123;</span><br><span class="line">    IApplicationThread whoThread = (IApplicationThread) contextThread;</span><br><span class="line">    <span class="keyword">if</span> (mActivityMonitors != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="comment">//省略...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        intent.migrateExtraStreamToClipData();</span><br><span class="line">        intent.prepareToLeaveProcess(who);</span><br><span class="line">        <span class="keyword">int</span> result = ActivityManager.getService()</span><br><span class="line">            .startActivity(whoThread, who.getBasePackageName(), intent,</span><br><span class="line">                    intent.resolveTypeIfNeeded(who.getContentResolver()),</span><br><span class="line">                    token, target, requestCode, <span class="number">0</span>, <span class="keyword">null</span>, options); <span class="comment">//【a】</span></span><br><span class="line">        checkStartActivityResult(result, intent);<span class="comment">//【b】</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failure from system"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>【b】. 处理启动 Activity 的结果，如果结果值异常的话进一步抛出异常<br>【a】. 通过 ActivityManager 获取到 AMS 并调用 startActivity 方法，这也说明上面对 Instrumentation 的描述是正确的，确实是通过它来调用 AMS 的，这时候我们也能自信的回答 “startActivity 方法是在哪里跨进程调用 AMS 的” 问题了。</p><p>继续来看 ActivityManager 的 getService 方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IActivityManager <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IActivityManagerSingleton.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityManager&gt; IActivityManagerSingleton =</span><br><span class="line">        <span class="keyword">new</span> Singleton&lt;IActivityManager&gt;() &#123;<span class="comment">//【a】</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> IActivityManager <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);<span class="comment">//【b】</span></span><br><span class="line">                <span class="keyword">final</span> IActivityManager am = IActivityManager.Stub.asInterface(b);<span class="comment">//【c】</span></span><br><span class="line">                <span class="keyword">return</span> am;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure></p><p>【a】. 这里通过 Singleton+泛型 方式实现了单例，有 lazy 和易读的优点，平时写单例一般是通过静态内部类或枚举实现的，适当的场景也可以考虑用这种方式写，不过 Singleton 是 @hide 的，需要我们在外部定义<br>【b】. 在学习 Binder 机制的时候有四个很重要的概念，Client、Server、ServiceManager、Binder 驱动，ServiceManager 主要作用就是帮助系统维护众多的 Service 列表，ServiceManager 本身也是运行在一个独立的进程，所以从 ServiceManager 中获取 Service 也是一个跨进程操作，为了提高性能，内部以 HashMap&lt;String, IBinder&gt; 形式缓存了各个 Service。<br>【c】. 这里可以看到是标准的 AIDL 的调用格式，IActivityManager 就是跨进程调用 AMS 的 AIDL 接口，源码位于 frameworks/base/core/java/android/app/IActivityManager.aidl，这时我们就能回答开头的 “跨进程调用 AMS 是通过 AIDL 接口方式实现的吗？如果是的话，具体是哪个接口” 问题了。</p><p>就这样调用逻辑在 Instrumentation 中由 AMS 接管，AMS 继承 IActivityManager.Stub 实现了 IPC 方法，供 Instrumentation、Context 调用，AMS 代码量很庞大（27000+行），源码位于 frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java</p><p>接着来看 AMS 的 startActivityAsUser 方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions, <span class="keyword">int</span> userId,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">boolean</span> validateIncomingUser)</span> </span>&#123;</span><br><span class="line">    enforceNotIsolatedCaller(<span class="string">"startActivity"</span>);</span><br><span class="line"></span><br><span class="line">    userId = mActivityStartController.checkTargetUser(userId, validateIncomingUser,</span><br><span class="line">            Binder.getCallingPid(), Binder.getCallingUid(), <span class="string">"startActivityAsUser"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Switch to user app stacks here.</span></span><br><span class="line">    <span class="keyword">return</span> mActivityStartController.obtainStarter(intent, <span class="string">"startActivityAsUser"</span>)</span><br><span class="line">            .setCaller(caller)</span><br><span class="line">            .setCallingPackage(callingPackage)</span><br><span class="line">            .setResolvedType(resolvedType)</span><br><span class="line">            .setResultTo(resultTo)</span><br><span class="line">            .setResultWho(resultWho)</span><br><span class="line">            .setRequestCode(requestCode)</span><br><span class="line">            .setStartFlags(startFlags)</span><br><span class="line">            .setProfilerInfo(profilerInfo)</span><br><span class="line">            .setActivityOptions(bOptions)</span><br><span class="line">            .setMayWait(userId)</span><br><span class="line">            .execute();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这里就已经处于 system server 进程了，对于开头的问题 “Intent 数据具体是怎样跨进程传输的”，也有了答案，是通过调用 AIDL 接口方法作为参数直接传递的。这里可以看到 Activity 的启动逻辑用 ActivityStarter 做了一层封装，写法上更加清晰，ActivityStarter 的 execute 方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mRequest.mayWait) &#123;</span><br><span class="line">            <span class="keyword">return</span> startActivityMayWait(mRequest.caller, mRequest.callingUid,</span><br><span class="line">                    mRequest.callingPackage, mRequest.intent, mRequest.resolvedType,</span><br><span class="line">                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line">                    mRequest.resultWho, mRequest.requestCode, mRequest.startFlags,</span><br><span class="line">                    mRequest.profilerInfo, mRequest.waitResult, mRequest.globalConfig,</span><br><span class="line">                    mRequest.activityOptions, mRequest.ignoreTargetSecurity, mRequest.userId,</span><br><span class="line">                    mRequest.inTask, mRequest.reason,</span><br><span class="line">                    mRequest.allowPendingRemoteAnimationRegistryLookup);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> startActivity(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,</span><br><span class="line">                    mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,</span><br><span class="line">                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line">                    mRequest.resultWho, mRequest.requestCode, mRequest.callingPid,</span><br><span class="line">                    mRequest.callingUid, mRequest.callingPackage, mRequest.realCallingPid,</span><br><span class="line">                    mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,</span><br><span class="line">                    mRequest.ignoreTargetSecurity, mRequest.componentSpecified,</span><br><span class="line">                    mRequest.outActivity, mRequest.inTask, mRequest.reason,</span><br><span class="line">                    mRequest.allowPendingRemoteAnimationRegistryLookup);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        onExecutionComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>进一步会调用 startActivityMayWait 方法，然后就是在 ActivityStarter 一大长串的调用了，调用顺序为：startActivityMayWait -&gt; startActivity -&gt; startActivity -&gt; startActivity -&gt; startActivityUnchecked，</p><h5 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h5><ol><li><a href="https://blog.csdn.net/itachi85/article/details/78569299" target="_blank" rel="noopener">Android深入四大组件（六）Android8.0 根Activity启动过程（前篇）</a></li><li><a href="https://blog.csdn.net/qinjuning/article/details/7262769" target="_blank" rel="noopener">Android中ActivityManagerService与应用程序(客户端)通信模型分析</a></li><li><a href="https://www.2cto.com/kf/201903/799681.html" target="_blank" rel="noopener">Android startActivity原理分析(基于Android 8.1 AOSP)</a></li><li><a href="https://segmentfault.com/a/1190000019042206" target="_blank" rel="noopener">AMS startActivity())</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;从一个问题出发：调用 startActivity 后系统到底做了什么事？&lt;/p&gt;
&lt;p&gt;如果让我回答这个问题，我的答案会是这样：Android 系统启动后会先启动一个 init 进程，init 进程启动 Zygote 进程，Zygote 进程进而会启动 system server 进程，在这个 system server 进程中，会启动 AMS、WMS 等系统服务。我们的 app 中调用 startActivity 后，需要通过 AMS 执行启动 Activity，而我们的 app 进程与 system server 是不同的进程，所以要跨进程，跨进程是通过 Binder 来实现的。 &lt;/p&gt;
&lt;p&gt;（？？？？？满脸问号脸），我这是回答了啥？&lt;/p&gt;
    
    </summary>
    
      <category term="Framework" scheme="http://yoursite.com/categories/Framework/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Framework" scheme="http://yoursite.com/tags/Framework/"/>
    
      <category term="AMS" scheme="http://yoursite.com/tags/AMS/"/>
    
  </entry>
  
  <entry>
    <title>Android 集成 FFmpeg (四) 轻松实现一个音视频编辑 App</title>
    <link href="http://yoursite.com/798144ac/"/>
    <id>http://yoursite.com/798144ac/</id>
    <published>2019-06-16T12:07:18.000Z</published>
    <updated>2019-06-28T10:02:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>在网上看到一篇关于 FFmpeg 的文章，讲的大概是基于 FFmpeg 实现了一个 App，支持视频拼图等强大炫酷的音视频编辑功能，其原理是在 Android 端集成 FFmpeg，通过命令方式调用 FFmpeg。</p><p>尽管在 Android 端集成命令方式调用并不复杂，但一个具有强大炫酷音视频编辑功能的 App 是有价值的。由此启发，并决定敲下 Android 集成 FFmpeg 系列的第四篇，以一个实际应用的方式展现 FFmpeg 强大的音视频编辑功能。</p><blockquote><p>强烈建议你下载试用感受一下：<a href="https://fir.im/f3vd" target="_blank" rel="noopener">https://fir.im/f3vd</a></p></blockquote><a id="more"></a><p>应用截图：</p><p><img src="../img/19.jpg" alt></p><blockquote><p>源码：<a href="https://github.com/yhaolpz/FFmpegCmd" target="_blank" rel="noopener">https://github.com/yhaolpz/FFmpegCmd</a></p></blockquote><p>若想实现更多效果，见 <a href="http://ffmpeg.org/ffmpeg.html" target="_blank" rel="noopener">ffmpeg Documentation</a>，应用代码非常简单，这里就不再过多阐述，直接查看源码，一看即懂，理论知识及编译实现见前三篇：</p><blockquote><p><a href="https://yhaolpz.github.io/e0b4d9fc/" target="_blank" rel="noopener">Android 集成 FFmpeg (一) 基础知识及简单调用</a><br><a href="https://yhaolpz.github.io/ddeb5551/" target="_blank" rel="noopener">Android 集成 FFmpeg (二) 以命令方式调用 FFmpeg</a><br><a href="https://yhaolpz.github.io/8837781/" target="_blank" rel="noopener">Android 集成 FFmpeg (三) 获取 FFmpeg 执行进度</a></p></blockquote><p>这个系列也算是画个句号，后续将学习 OpenGL 相关，结合实现高效的实时渲染。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在网上看到一篇关于 FFmpeg 的文章，讲的大概是基于 FFmpeg 实现了一个 App，支持视频拼图等强大炫酷的音视频编辑功能，其原理是在 Android 端集成 FFmpeg，通过命令方式调用 FFmpeg。&lt;/p&gt;
&lt;p&gt;尽管在 Android 端集成命令方式调用并不复杂，但一个具有强大炫酷音视频编辑功能的 App 是有价值的。由此启发，并决定敲下 Android 集成 FFmpeg 系列的第四篇，以一个实际应用的方式展现 FFmpeg 强大的音视频编辑功能。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;强烈建议你下载试用感受一下：&lt;a href=&quot;https://fir.im/f3vd&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://fir.im/f3vd&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="音视频" scheme="http://yoursite.com/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="FFmpeg" scheme="http://yoursite.com/tags/FFmpeg/"/>
    
      <category term="音视频" scheme="http://yoursite.com/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>Android OpenGL ES（三）简单图形变换</title>
    <link href="http://yoursite.com/1008175c/"/>
    <id>http://yoursite.com/1008175c/</id>
    <published>2019-06-16T09:11:32.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>尽管对 VAO、VBO 以及纹理相关的知识跃跃欲试，但还是决定耐下心来，先学习绘制一些简单图形及图形变换，在第一篇文章也只是简单学习了下 GLSL 语言，这篇文章的学习也可以对 GLSL 语言有更好的掌握。</p><a id="more"></a><blockquote><p>正在学习…</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;尽管对 VAO、VBO 以及纹理相关的知识跃跃欲试，但还是决定耐下心来，先学习绘制一些简单图形及图形变换，在第一篇文章也只是简单学习了下 GLSL 语言，这篇文章的学习也可以对 GLSL 语言有更好的掌握。&lt;/p&gt;
    
    </summary>
    
      <category term="OpenGL" scheme="http://yoursite.com/categories/OpenGL/"/>
    
    
      <category term="OpenGL" scheme="http://yoursite.com/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>Android OpenGL ES（二）绘制三角形</title>
    <link href="http://yoursite.com/2296ca3/"/>
    <id>http://yoursite.com/2296ca3/</id>
    <published>2019-06-16T08:39:50.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>通过上篇文章的学习，现在已经了解到，要想在 Android 端使用 OpenGL ES 绘制图形，必须创建 OpenGL ES 环境和视图窗口，具体来说就是构建 EGL 环境，即 OpenGL ES 和 Android 底层平台视窗系统之间的接口。另外 OpenGL ES 2.0 版本为可编程管线，我们就可以编写着色器程序来确定绘制内容，即编写 Vertex Shader 顶点着色器和 Fragment Shader 片元着色器。</p><p>而这些工作可以通过 GLSurfaceView 非常简单的实现。</p><a id="more"></a><p>在介绍 GLSurfaceView 之前先来看下 Android 系统提供的与 OpenGL ES 相关的包：</p><ul><li>javax.microedition.khronos.opengles： 存放 GL 绘图指令相关代码</li><li>javax.microedition.khronos.egl： 存放 EGL 管理相关代码，包括 Display、surface 等</li><li>android.opengl： 存放 GL 辅助类，连接 OpenGL 与 Android View，Activity 等</li></ul><p>其中 GLSurfaceView 处于 android.opengl 包中，GLSurfaceView 具有以下特性：</p><ul><li>内置 EGL 管理，自带 GL 上下文环境和 GLThread 绘制线程</li><li>起到连接 OpenGL ES 与 Android 的 View 层次结构之间的桥梁作用</li><li>使得 OpenGL ES 库适应于 Activity 生命周期</li><li>继承自 SurfaceView，拥有 SurfaceView 的全部特性，绘制结果会输出到 SurfaceView 所提供的 Surface 上</li><li>提供了方便使用的调试工具来跟踪 OpenGL ES 函数调用以帮助检查错误</li></ul><p>通过 GLSurfaceView 的 setRenderer 方法可设置要渲染的效果，即 GLSurfaceView.Renderer 渲染器接口，该接口方法：</p><ul><li>onSurfaceCreated：渲染线程开启时调用，可做初始化背景色、初始化纹理资源等工作</li><li>onSurfaceChanged：窗口尺寸改变时调用，通常会设置视窗范围或投影矩阵等</li><li>onDrawFrame：外部请求渲染一次就调用一次，可在此载入着色器程序、激活绑定纹理以及调用绘制</li></ul><p>下面来看具体如何绘制一个三角形：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">implements</span> <span class="title">GLSurfaceView</span>.<span class="title">Renderer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//顶点着色器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String vertexShaderResource =</span><br><span class="line">            <span class="string">"attribute vec3 vPosition;"</span> +</span><br><span class="line">                    <span class="string">"void main() &#123;"</span> +</span><br><span class="line">                    <span class="string">"  gl_Position = vec4(vPosition.x, vPosition.y, vPosition.z, 1.0);"</span> +</span><br><span class="line">                    <span class="string">"&#125;"</span>;</span><br><span class="line">    <span class="comment">//片段着色器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String fragmentShaderResource =</span><br><span class="line">            <span class="string">"precision mediump float;"</span> +</span><br><span class="line">                    <span class="string">"uniform vec4 vColor;"</span> +</span><br><span class="line">                    <span class="string">"void main() &#123;"</span> +</span><br><span class="line">                    <span class="string">"  gl_FragColor = vColor;"</span> +</span><br><span class="line">                    <span class="string">"&#125;"</span>;</span><br><span class="line">    <span class="comment">//顶点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span>[] vertexCoords = <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;</span><br><span class="line">            <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="comment">// top</span></span><br><span class="line">            -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="comment">// bottom left</span></span><br><span class="line">            <span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span>  <span class="comment">// bottom right</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> color[] = &#123;<span class="number">1.0f</span>, <span class="number">0f</span>, <span class="number">0f</span>, <span class="number">1.0f</span>&#125;; <span class="comment">//red</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 着色器程序</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mProgram;</span><br><span class="line">    <span class="comment">// 顶点坐标数据</span></span><br><span class="line">    <span class="keyword">private</span> FloatBuffer vertexFloatBuffer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceCreated</span><span class="params">(GL10 gl, EGLConfig config)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//设置清空屏幕后的背景色</span></span><br><span class="line">        GLES30.glClearColor(<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>);</span><br><span class="line">        <span class="comment">//构建顶点着色器</span></span><br><span class="line">        <span class="keyword">int</span> vertexShader = GLES30.glCreateShader(GLES30.GL_VERTEX_SHADER);</span><br><span class="line">        GLES30.glShaderSource(vertexShader, vertexShaderResource);</span><br><span class="line">        GLES30.glCompileShader(vertexShader);</span><br><span class="line">        <span class="comment">//构建片段着色器</span></span><br><span class="line">        <span class="keyword">int</span> fragmentShader = GLES30.glCreateShader(GLES30.GL_FRAGMENT_SHADER);</span><br><span class="line">        GLES30.glShaderSource(fragmentShader, fragmentShaderResource);</span><br><span class="line">        GLES30.glCompileShader(fragmentShader);</span><br><span class="line">        <span class="comment">//构建着色器程序，并将顶点着色器和片段着色器链接进来</span></span><br><span class="line">        mProgram = GLES30.glCreateProgram();</span><br><span class="line">        GLES30.glAttachShader(mProgram, vertexShader);</span><br><span class="line">        GLES30.glAttachShader(mProgram, fragmentShader);</span><br><span class="line">        GLES30.glLinkProgram(mProgram);</span><br><span class="line">        <span class="comment">//顶点着色器和片段着色器链接到着色器程序后就无用了</span></span><br><span class="line">        GLES30.glDeleteShader(vertexShader);</span><br><span class="line">        GLES30.glDeleteShader(fragmentShader);</span><br><span class="line">        <span class="comment">//转换为需要的顶点数据格式</span></span><br><span class="line">        vertexFloatBuffer = floatToBuffer(vertexCoords);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSurfaceChanged</span><span class="params">(GL10 gl, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//设置视窗</span></span><br><span class="line">        GLES30.glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawFrame</span><span class="params">(GL10 gl)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//清空屏幕，擦除屏幕上所有的颜色，用 glClearColor 定义的颜色填充</span></span><br><span class="line">        GLES30.glClear(GLES30.GL_COLOR_BUFFER_BIT);</span><br><span class="line">        <span class="comment">//在当前 EGL 环境激活着色器程序</span></span><br><span class="line">        GLES30.glUseProgram(mProgram);</span><br><span class="line">        <span class="comment">//获取顶点着色器的 vPosition 成员句柄</span></span><br><span class="line">        <span class="keyword">int</span> positionHandle = GLES30.glGetAttribLocation(mProgram, <span class="string">"vPosition"</span>);</span><br><span class="line">        <span class="comment">//启用句柄</span></span><br><span class="line">        GLES30.glEnableVertexAttribArray(positionHandle);</span><br><span class="line">        <span class="comment">//设置顶点坐标数据</span></span><br><span class="line">        GLES30.glVertexAttribPointer(positionHandle, <span class="number">3</span>, GLES30.GL_FLOAT,</span><br><span class="line">                <span class="keyword">false</span>, <span class="number">3</span> * <span class="number">4</span>, vertexFloatBuffer);</span><br><span class="line">        <span class="comment">//获取片元着色器的 vColor 成员句柄</span></span><br><span class="line">        <span class="keyword">int</span> colorHandle = GLES30.glGetUniformLocation(mProgram, <span class="string">"vColor"</span>);</span><br><span class="line">        <span class="comment">//设置颜色</span></span><br><span class="line">        GLES30.glUniform4fv(colorHandle, <span class="number">1</span>, color, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//绘制三角形</span></span><br><span class="line">        GLES30.glDrawArrays(GLES30.GL_TRIANGLE_STRIP, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">//禁止顶点数组的句柄</span></span><br><span class="line">        GLES30.glDisableVertexAttribArray(positionHandle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> FloatBuffer <span class="title">floatToBuffer</span><span class="params">(<span class="keyword">float</span>[] a)</span> </span>&#123;</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocateDirect(a.length * <span class="number">4</span>); <span class="comment">//float占4个字节</span></span><br><span class="line">        buffer.order(ByteOrder.nativeOrder());</span><br><span class="line">        FloatBuffer byteBuffer = buffer.asFloatBuffer();</span><br><span class="line">        byteBuffer.put(a);</span><br><span class="line">        byteBuffer.position(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> byteBuffer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="顶点输入"><a href="#顶点输入" class="headerlink" title="顶点输入"></a>顶点输入</h4><p>要绘制一个三角形，就要确定三个顶点的 3D 坐标（OpenGL 是一个 3D 图形库，在 OpenGL 中指定的所有坐标都需要是 3D 坐标，即 x、y 和 z）。而顶点坐标起始于局部坐标，需要为标准化设备坐标，即 x、y、z 的范围限定于 -1 到 1 之间，任何落在范围外的坐标都会被丢弃。上面代码中输入的顶点数据为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span>[] vertexCoords = <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">0.5f</span>, -<span class="number">0.5f</span>, <span class="number">0.0f</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>这里将 z 坐标都设置为 0，表示三角形每一点的深度都为 0（通常深度可以理解为z坐标，它代表一个像素在空间中和你的距离，如果离你远就可能被别的像素遮挡，你就看不到它了，它会被丢弃，以节省资源），这样定义的顶点数据反应到标准化设备坐标系中就是这样的：</p><p><img src="../img/17.jpg" alt></p><h4 id="解释顶点数据"><a href="#解释顶点数据" class="headerlink" title="解释顶点数据"></a>解释顶点数据</h4><p>可以看到调用 glVertexAttribPointer 设置顶点数据时并不是直接把 float[] 数组传递进去，而是转换成 FloatBuffer 传入，所谓的解释顶点数据就是说明输入数据的哪一个部分对应顶点着色器的哪一个顶点属性。对于 glVertexAttribPointer 函数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">glVertexAttribPointer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> indx,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> size, </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> type,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> normalized,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> stride,</span></span></span><br><span class="line"><span class="function"><span class="params">    java.nio.Buffer ptr</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure></p><ul><li>indx：指定要配置的顶点属性，这里传入顶点着色器的 vPosition 成员句柄</li><li>size：指定顶点属性的大小，顶点属性是一个 vec3，它由 3 个值（x、y、z）组成，所以大小传入 3</li><li>type：指定数据的类型为 float 类型</li><li>normalized：是否希望数据被标准化</li><li>stride：指定连续的顶点数据之间的间隔，由于一个顶点数据长度为 3 个 float，所以把步长设置为 3 * 4（一个 float 占 4 个字节）</li><li>ptr：顶点数据</li></ul><p>下图很好的阐释这个逻辑：</p><p><img src="../img/18.jpg" alt></p><h4 id="顶点着色器"><a href="#顶点着色器" class="headerlink" title="顶点着色器"></a>顶点着色器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String vertexShaderResource =</span><br><span class="line">    <span class="string">"attribute vec3 vPosition;"</span> +</span><br><span class="line">        <span class="string">"void main() &#123;"</span> +</span><br><span class="line">        <span class="string">"  gl_Position = vec4(vPosition.x, vPosition.y, vPosition.z, 1.0);"</span> +</span><br><span class="line">        <span class="string">"&#125;"</span>;</span><br></pre></td></tr></table></figure><p>由于每个顶点都有一个 3D 坐标，这里就创建一个 vec3 变量输入顶点坐标。而内置变量 gl_Position 为 vec4 类型，所以需要将三维向量转换为四维向量，最后 gl_Position 设置的值会成为该顶点着色器的输出。</p><p>onDrawFrame 方法中在获取顶点着色器的 vPosition 成员句柄后，需要调用 glEnableVertexAttribArray、glDisableVertexAttribArray 分别启用、禁止顶点数据，而片段着色器的 vColor 成员句柄就不需要。这是因为出于性能考虑，所有顶点着色器的属性默认都是关闭的。<br>glVertexAttribPointer 只是建立 CPU 和 GPU 之间的逻辑连接实现将 CPU 数据上传至 GPU，但是，数据在 GPU 端是否可见，即着色器能否读取到数据，还要取决于 glEnableVertexAttribArray 方法。</p><h4 id="片段着色器"><a href="#片段着色器" class="headerlink" title="片段着色器"></a>片段着色器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String fragmentShaderResource =</span><br><span class="line"><span class="string">"precision mediump float;"</span> +</span><br><span class="line">        <span class="string">"uniform vec4 vColor;"</span> +</span><br><span class="line">        <span class="string">"void main() &#123;"</span> +</span><br><span class="line">        <span class="string">"  gl_FragColor = vColor;"</span> +</span><br><span class="line">        <span class="string">"&#125;"</span>;</span><br></pre></td></tr></table></figure><p>在 OpenGL 中定义一个颜色的数据格式为 RGBA 四个 0.0 到 1.0 之间强度的分量，片段着色器所做的是计算像素最后的颜色输出，也只有 gl_FragColor 这一个输出变量。</p><h4 id="编译着色器"><a href="#编译着色器" class="headerlink" title="编译着色器"></a>编译着色器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> vertexShader = GLES30.glCreateShader(GLES30.GL_VERTEX_SHADER);</span><br><span class="line">GLES30.glShaderSource(vertexShader, vertexShaderResource);</span><br><span class="line">GLES30.glCompileShader(vertexShader);</span><br></pre></td></tr></table></figure><p>为了让 OpenGL 能够使用我们编写的着色器源码，必须在运行时动态编译。首先通过 glCreateShader 创建一个着色器对象，返回该着色器的 ID，然后通过 glShaderSource、glCompileShader 方法将源码附着在着色器对象上并编译它。</p><p>编译着色器可能失败，一般编译时会通过如下方法判断是否编译成功并输出编译信息：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span>[] compileStatus = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>];</span><br><span class="line">GLES20.glGetShaderiv(shaderObjectId, GLES20.GL_COMPILE_STATUS, compileStatus, <span class="number">0</span>);</span><br><span class="line">Log.d(TAG, <span class="string">"glCompileStatus: "</span> + compileStatus[<span class="number">0</span>] </span><br><span class="line">            + <span class="string">" log:"</span> + GLES20.glGetShaderInfoLog(shaderObjectId));</span><br><span class="line"><span class="keyword">if</span> (compileStatus[<span class="number">0</span>] == <span class="number">0</span>) &#123; <span class="comment">//编译失败</span></span><br><span class="line">    GLES20.glDeleteShader(shaderObjectId);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="着色器程序"><a href="#着色器程序" class="headerlink" title="着色器程序"></a>着色器程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mProgram = GLES30.glCreateProgram();</span><br><span class="line">GLES30.glAttachShader(mProgram, vertexShader);</span><br><span class="line">GLES30.glAttachShader(mProgram, fragmentShader);</span><br><span class="line">GLES30.glLinkProgram(mProgram);</span><br></pre></td></tr></table></figure><p>着色器程序对象是多个着色器合并之后并最终链接完成的版本，它将编译好的顶点着色器和片段着色器链接为一个着色器程序对象，链接后顶点着色器和片段着色器就没用了，可以通过 glDeleteShader 删除。就像着色器的编译一样，我们也可以检测链接着色器程序是否失败，并获取相应的日志：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span>[] linkStatus = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>];</span><br><span class="line">GLES20.glGetProgramiv(mProgram, GLES20.GL_LINK_STATUS, linkStatus, <span class="number">0</span>);</span><br><span class="line">Log.d(TAG, <span class="string">"glCompileStatus："</span> + linkStatus[<span class="number">0</span>]</span><br><span class="line">            + <span class="string">" log:"</span> + GLES20.glGetProgramInfoLog(mProgram));</span><br><span class="line"><span class="keyword">if</span> (linkStatus[<span class="number">0</span>] == <span class="number">0</span>) &#123; <span class="comment">//链接失败</span></span><br><span class="line">    GLES20.glDeleteProgram(mProgram);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>链接成功后，在渲染的时候通过 glUseProgram 方法激活着色器程序，已激活着色器程序的着色器就会在渲染时被使用，最后通过 glDrawArrays 方法触发绘制。</p><h5 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h5><p><a href="https://item.jd.com/12292642.html" target="_blank" rel="noopener">《音视频开发进阶指南 - 基于Android与IOS平台的实践》</a><br><a href="https://blog.csdn.net/TuGeLe/article/details/79199161" target="_blank" rel="noopener">Android GLSurfaceView详解</a><br><a href="http://wiki.jikexueyuan.com/project/opengl-es-guide/glsurfaceview.html" target="_blank" rel="noopener">GLSurfaceView</a><br><a href="https://learnopengl-cn.github.io/01%20Getting%20started/04%20Hello%20Triangle/" target="_blank" rel="noopener">你好，三角形</a><br><a href="https://www.jianshu.com/p/b05884a0ff8e" target="_blank" rel="noopener">OpenGL ES 3.0 glEnableVertexAttribArray的作用</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;通过上篇文章的学习，现在已经了解到，要想在 Android 端使用 OpenGL ES 绘制图形，必须创建 OpenGL ES 环境和视图窗口，具体来说就是构建 EGL 环境，即 OpenGL ES 和 Android 底层平台视窗系统之间的接口。另外 OpenGL ES 2.0 版本为可编程管线，我们就可以编写着色器程序来确定绘制内容，即编写 Vertex Shader 顶点着色器和 Fragment Shader 片元着色器。&lt;/p&gt;
&lt;p&gt;而这些工作可以通过 GLSurfaceView 非常简单的实现。&lt;/p&gt;
    
    </summary>
    
      <category term="OpenGL" scheme="http://yoursite.com/categories/OpenGL/"/>
    
    
      <category term="OpenGL" scheme="http://yoursite.com/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>Android OpenGL ES（一）开发入门</title>
    <link href="http://yoursite.com/eeb650a2/"/>
    <id>http://yoursite.com/eeb650a2/</id>
    <published>2019-06-09T12:40:06.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>早就听过大名鼎鼎的 OpenGL，却迟迟没有实践学习，有些惭愧。今天开始通过实践+博文方式学习掌握 OpenGL。此文对于 OpenGL 的学习分为以下部分：</p><ul><li>OpenGL 基础概念</li><li>OpenGL 坐标系理解</li><li>OpenGL 渲染管线</li><li>OpenGL 着色语言</li></ul><a id="more"></a><h1 id="OpenGL-基础概念"><a href="#OpenGL-基础概念" class="headerlink" title="OpenGL 基础概念"></a>OpenGL 基础概念</h1><h4 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h4><p>OpenGL 即 Open Graphics Library，是一个功能强大、调用方便的底层图形库，它定义了跨编程语言、跨平台的专业图形程序接口，可用于二维或三维图像的处理与渲染。</p><p>OpenGL 是跨平台的，除了它纯粹专注的渲染外，其他内容在每个平台上都要有它的具体实现，比如上下文环境和窗口的管理就交由各个设备自己来完成。</p><h4 id="OpenGL-ES"><a href="#OpenGL-ES" class="headerlink" title="OpenGL ES"></a>OpenGL ES</h4><p>OpenGL ES （OpenGL for Embedded Systems）是三维图形 API OpenGL 的子集，针对手机、PDA 和游戏主机等嵌入式设备而设计。</p><p>Android 对应 OpenGL ES 的版本支持如下：</p><ul><li>Android 1.0 开始支持 OpenGL ES 1.0 及 1.1</li><li>Android 2.2 开始支持 OpenGL ES 2.0</li><li>Android 4.3 开始支持 OpenGL ES 3.0</li><li>Android 5.0 开始支持 OpenGL ES 3.1</li></ul><p>其中 OpenGL ES 1.0 是以 OpenGL 1.3 规范为基础的，OpenGL ES 1.1 是以 OpenGL 1.5 规范为基础的，而 OpenGL ES 2.0 基于 OpenGL 2.0 实现。2.x 版本相比 1.x 版本有较大差异，1.x 版本为 fixed function pipeline，即固定管线硬件，而 2.x 版本为 programmable pipeline，可编程管线硬件。</p><p>固定管线中原本由系统做的一部分工作，在可编程管线中必须需要自己写程序实现，具体程序为 vertex shader（顶点着色器）和 fragment shader（片元着色器）。</p><h4 id="OpenGL-上下文"><a href="#OpenGL-上下文" class="headerlink" title="OpenGL 上下文"></a>OpenGL 上下文</h4><p>OpenGL 是一个仅仅关注图像渲染的图像接口库，在渲染过程中它需要将顶点信息、纹理信息、编译好的着色器等渲染状态信息存储起来，而存储这些信息的数据结构就可以看作 OpenGL 的上下文。</p><p>调用任何 OpenGL 函数前，必须已经创建了 OpenGL Context，GL Context 存储了OpenGL 的状态变量以及其他渲染有关的信息。OpenGL 是个状态机，有很多状态变量，是个标准的过程式操作过程，改变状态会影响后续所有操作，这和面向对象的解耦原则不符，毕竟渲染本身就是个复杂的过程。OpenGL 采用 Client-Server 模型来解释 OpenGL 程序，即 Server 存储 GL Context（可能不止一个），Client 提出渲染请求，Server 给予响应，一般 Server 和 Client 都在我们的 PC 上，但 Server 和 Client 也可以是通过网络连接。</p><p>之后的渲染工作就要依赖这些渲染状态信息来完成，当一个上下文被销毁时，它所对应的 OpenGL 渲染工作也将结束。</p><h4 id="EGL"><a href="#EGL" class="headerlink" title="EGL"></a>EGL</h4><p>在 OpenGL 的设计中，OpenGL 是不负责管理窗口的，窗口的管理交由各个设备自己来完成，具体来讲，IOS 平台上使用 EAGL 提供本地平台对 OpenGL 的实现，在 Android 平台上使用 EGL 提供本地平台对 OpenGL 的实现。EGL 是 OpenGL ES 和 Android 底层平台视窗系统之间的接口，在 OpenGL 的输出与设备屏幕之间架接起一个桥梁，承担了为 OpenGL 提供上下文环境以及管理窗口的职责。</p><p>EGL 为双缓冲工作模式，即有一个 Back Frame Buffer 和一个 Front Frame Buffer，正常绘制的目标都是 Back Frame Buffer，绘制完成后再调用 eglSwapBuffer API，将绘制完毕的 FrameBuffer 交换到 Front Frame Buffer 并显示出来。</p><p>从代码层面来看，OpenGL ES 的 opengles 包下定义了平台无关的绘图指令，EGL（javax.microedition.khronos.egl）<br>则定义了控制 displays，contexts 以及 surfaces 的统一的平台接口。</p><ul><li>Display（EGLDisplay） 是对实际显示设备的抽象</li><li>Surface（EGLSurface）是对用来存储图像的内存区域 FrameBuffer 的抽象，包括 Color Buffer、Stencil Buffer、Depth Buffer</li><li>Context（EGLContext）存储 OpenGL ES 绘图的一些状态信息</li></ul><p><img src="../img/1.jpeg" alt></p><blockquote><p>使用 EGL 绘图的一般步骤：<br>获取 EGLDisplay 对象<br>初始化与 EGLDisplay 之间的连接<br>获取 EGLConfig 对象<br>创建 EGLContext 实例<br>创建 EGLSurface 实例<br>连接 EGLContext 和 EGLSurface<br>使用 GL 指令绘制图形<br>断开并释放与 EGLSurface 关联的 EGLContext 对象<br>删除 EGLSurface 对象<br>删除 EGLContext 对象<br>终止与 EGLDisplay 之间的连接</p></blockquote><p>一般来说在 Android 平台上开发 OpenGL ES 应用，无需按照上述步骤来绘制图形，可以直接使用 GLSurfaceView 控件，该控件提供了对 Display、Surface 以及 Context 的管理，大大简化了开发流程。</p><h4 id="OpenGL-纹理"><a href="#OpenGL-纹理" class="headerlink" title="OpenGL 纹理"></a>OpenGL 纹理</h4><p>纹理（Texture）是一个 2D 图片（甚至也有 1D 和 3D 的纹理），它可以用来添加物体的细节；你可以想象纹理是一张绘有砖块的纸，无缝折叠贴合到你的 3D 的房子上，这样你的房子看起来就像有砖墙外表了。因为我们可以在一张图片上插入非常多的细节，这样就可以让物体非常精细而不用指定额外的顶点。</p><h1 id="OpenGL-坐标系理解"><a href="#OpenGL-坐标系理解" class="headerlink" title="OpenGL 坐标系理解"></a>OpenGL 坐标系理解</h1><p>OpenGL 要求输入的顶点坐标都是标准化设备坐标，即每个顶点的 x、y、z 都在 -1 到 1 之间，由标准化设备坐标转换为屏幕坐标的过程中会经历变换多个坐标系统，在这些特定的坐标系中，一些操作和计算可以更加方便。</p><p><img src="../img/15.jpg" alt></p><ul><li><strong>1. 局部坐标</strong><br>顶点坐标起始于局部空间（Local Space），在这里称为局部坐标，是以物体某一点为原点而建立的，该坐标系仅对该物体适用，用来简化对物体各部分坐标的描述。物体放到场景中时，各部分经历的坐标变换相同，相对位置不变。</li><li><strong>2. 世界坐标</strong><br>局部坐标通过模型矩阵进行位移、缩放、旋转，将物体从局部变换到世界空间，并和其他物体一起相对于世界的原点摆放。</li><li><strong>3. 观察坐标</strong><br>将世界空间坐标转化为用户视野前方的坐标，通常是由一系列的位移和旋转的组合（观察矩阵）来完成。</li><li><strong>4. 裁剪坐标</strong><br>坐标到达观察空间之后，通过投影矩阵会将指定范围内的坐标变换为标准化设备坐标的范围(-1.0, 1.0)，所有在范围外的坐标会被裁剪掉。</li><li><strong>5. 屏幕坐标</strong><br>将裁剪坐标位于(-1.0, 1.0)范围的坐标变换到由 glViewport 函数所定义的坐标范围内，最后变换出来的坐标将会送到光栅器，将其转化为片段。</li></ul><h1 id="OpenGL-渲染管线"><a href="#OpenGL-渲染管线" class="headerlink" title="OpenGL 渲染管线"></a>OpenGL 渲染管线</h1><p>OpenGL 渲染管线流程为：顶点数据 -&gt; 顶点着色器 -&gt; 图元装配 -&gt; 几何着色器 -&gt; 光栅化 -&gt; 片段着色器 -&gt; 逐片段处理 -&gt; 帧缓冲 </p><p><img src="../img/16.jpg" alt></p><p>OpenGL 渲染管线的流程其实就是 OpenGL 引擎渲染图像的流程，也就是说 OpenGL 引擎一步一步的将图片渲染到屏幕上的过程，渲染管线可以分为以下几个阶段：</p><ul><li><p><strong>1. 指定几何对象</strong><br>首先要了解几何图元的概念，几何图元就是点、直线、三角线等几何对象，在提供了顶点坐标后，还要确定具体要画的是点、线段还是三角形，这就要确定具体执行的绘制指令。比如 OpenGL 提供给开发者的绘制方法 glDrawArrays，这个方法的第一个参数就是指定绘制方式，可选值有：<br><strong>GL_POINTS</strong>：以点的形式进行绘制，通常用在绘制粒子效果的场景。<br><strong>GL_LINES</strong>：以线的形式进行绘制，通常用于绘制直线的场景。<br><strong>GL_TRIANGLE_STRIP</strong>：以三角形的形式进行绘制，所有二维图像的渲染都会使用这种方式。<br>具体选用哪一种绘制方式决定了 OpenGL 渲染管线的第一阶段应如何去绘制几何图元，这就是第一阶段指定几何对象。</p></li><li><p><strong>2. 顶点处理</strong><br>不论上面的几何图元是如何指定的，所有的几何数据都将会通过这个阶段。这个阶段的操作内容有：根据模型视图（即根据几何图元创建的物体）和投影矩阵进行变换来改变顶点的位置，根据纹理坐标与纹理矩阵来改变纹理坐标的位置，如果设计三维的渲染，还要处理光照计算和法线变换。<br>关键的操作就是顶点坐标变换及光照处理，每个顶点是分别单独处理的。这个阶段所接受的数据是每个顶点的属性特征，输出的则是变换后的顶点数据。</p></li><li><p><strong>3. 图元组装</strong><br>在顶点处理之后，顶点的全部属性都已经被确定。在这个阶段顶点将会根据应用程序设定的图元规则如 GL_POINTS 、GL_TRIANGLES(三角形) 等被组装成图元。</p></li><li><p><strong>4. 珊格化操作</strong><br>在图元组装后会传递过来图元数据，到目前为止，这些图元信息还只是顶点而已：顶点处都还没有“像素点”、直线段端点之间是空的、多边形的边和内部也是空的，光栅化的任务就是构造这些。<br>这个阶段会将图元数据分解成更小的单元并对应于帧缓冲区的各个像素，这些单元称为片元，一个片元可能包含窗口颜色、纹理坐标等属性。片元的属性则是图元上的顶点数据等经过插值而确定的，这就是珊格化操作，也就是确定好每一个片元是什么。</p></li><li><p><strong>5. 片元处理</strong><br>珊格化操作构造了像素点，这个阶段就是处理这些像素点，根据自己的业务处理（比如提亮、饱和度调节、对比度调节、高斯模糊等）来变换这个片元的颜色。</p></li><li><p><strong>6. 逐片段处理</strong><br>进行剪切、Alpha 测试、 模版测试、深度测试、混合等处理，这些操作将会最后影响其在帧缓冲区的颜色值。</p></li><li><p><strong>7. 帧缓冲操作</strong><br>此阶段主要执行帧缓冲的写入操作，也是渲染管线的最后一步，负责将最终的像素点写到帧缓冲区。</p></li></ul><p>上面提到 OpenGL ES 2.0 版本相比之前版本，提供了可编程的着色器来代替 1.x 版本渲染管线的某些阶段，具体为：</p><ul><li>Vertex Shader（顶点着色器）用于替换顶点处理阶段</li><li>Fragment Shader（片元着色器）用于替换片元处理阶段</li></ul><h1 id="OpenGL-着色语言"><a href="#OpenGL-着色语言" class="headerlink" title="OpenGL 着色语言"></a>OpenGL 着色语言</h1><p>OpenGL 着色语言 GLSL 全称为 OpenGL Shading Language，是为了实现着色器的功能而向开发人员提供的一种开发语言，语法与 C 语言类似，下面分为以下几点来学习 GLSL：</p><ul><li><strong>1. 基本数据类型</strong></li></ul><blockquote><p>void：空类型，即不返回任何值<br>bool：布尔类型，true/false<br>int：带符号的整数，signed integer<br>float：带符号的浮点数，signed scalar<br>vec2、vec3、vec4：n-维浮点数向量<br>bvec2、bvec3、bvec4：n-维布尔向量<br>ivec2、ivec3、ivec4：n-维整数向量<br>mat2、mat3、mat4：2x2、3x3、4x4 浮点数矩阵<br>sampler2D：2D 纹理<br>samplerCube：盒纹理</p></blockquote><p>其中 float 可指定精度：</p><blockquote><p>high：32bit，一般用于顶点坐标（vertex Coordinate）<br>medium：16bit，一般用于纹理坐标（texture Coordinate）<br>low：8bit，一般用于颜色表示（color）</p></blockquote><ul><li><strong>2. 变量修饰符</strong></li></ul><blockquote><p>none：(默认的可省略)本地变量，可读可写，函数的输入参数既是这种类型<br>const：声明变量或函数的参数为只读类型<br>attribute：用于保存顶点或法线数据,它可以在数据缓冲区中读取数据，仅能用于顶点着色器<br>uniform：在运行时 shader 无法改变 uniform 变量，一般用来放置程序传递给 shader 的变换矩阵，材质，光照参数等等，可用于顶点着色器和片元着色器<br>varying：用于修饰从顶点着色器向片元着色器传递的变量</p></blockquote><p>要注意全局变量限制符只能为 const、attribute、uniform 和 varying 中的某一个，不可复合。</p><ul><li><strong>3. 内置变量</strong></li></ul><p>GLSL 程序使用一些特殊的内置变量与硬件进行沟通，他们大致分成两种，一种是 input 类型,他负责向硬件(渲染管线)发送数据；另一种是 output 类型，负责向程序回传数据，以便编程时需要。<br>顶点着色器中 output 类型的内置变量如下：</p><blockquote><p>highp vec4  gl_Position：放置顶点坐标信息<br>mediump float gl_PointSize：需要绘制点的大小,(只在gl.POINTS模式下有效)</p></blockquote><p>片元着色器中 input 类型的内置变量如下：</p><blockquote><p>mediump vec4 gl_FragCoord;：片元在 framebuffer 画面的相对位置<br>bool gl_FrontFacing：标志当前图元是不是正面图元的一部分<br>mediump vec2 gl_PointCoord：经过插值计算后的纹理坐标,点的范围是0.0到1.0</p></blockquote><p>片元着色器中 output 类型的内置变量如下：</p><blockquote><p>mediump vec4 gl_FragColor：设置当前片点的颜色<br>mediump vec4 gl_FragData[n]：设置当前片点的颜色,使用glDrawBuffers数据数组</p></blockquote><ul><li><strong>4. 内置常量</strong></li></ul><p>GLSL 提供了一些内置的常量，用来说明当前系统的一些特性。有时我们需要针对这些特性，对 shader 程序进行优化，让程序兼容度更好。</p><p>顶点着色器中的内置常量如下：</p><blockquote><p>const mediump int gl_MaxVertexAttribs &gt;= 8：顶点着色器中可用的最大 attributes 数<br>const mediump int gl_MaxVertexUniformVectors &gt;= 128：顶点着色器中可用的最大 uniform vectors 数<br>const mediump int gl_MaxVaryingVectors &gt;= 8：顶点着色器中可用的最大 varying vectors 数<br>const mediump int gl_MaxVertexTextureImageUnits &gt;= 0：顶点着色器中可用的最大纹理单元数<br>const mediump int gl_MaxCombinedTextureImageUnits &gt;= 8：表示最多支持多少个纹理单元</p></blockquote><p>片元着色器中的内置常量如下：</p><blockquote><p>const mediump int gl_MaxTextureImageUnits &gt;= 8：片元着色器中能访问的最大纹理单元数<br>const mediump int gl_MaxFragmentUniformVectors &gt;= 16：片元着色器中可用的最大 uniform vectors 数<br>const mediump int gl_MaxDrawBuffers = 1：表示可用的 drawBuffers 数,在 OpenGL ES 2.0 中这个值为 1, 在将来的版本可能会有所变化</p></blockquote><p>上面这些值的大小取决于 OpenGL ES 在某设备上的具体实现。</p><ul><li><strong>5. 内置函数</strong></li></ul><blockquote><p>通用函数：abs、floor、min、max 等，参数可传入 float/vec2/vec3/vec4 类型<br>角度函数：sin、cos 等，参数可传入 float/vec2/vec3/vec4 类型<br>指数函数：pow、log 等，参数可传入 float/vec2/vec3/vec4 类型<br>几何函数：distance、dot 等，参数可传入 float/vec2/vec3/vec4 类型<br>矩阵函数：matrixCompMult，参数传入 mat 类型<br>向量函数：lessThan、equal 等，参数可传入 vec2/vec3/vec4 类型<br>纹理函数：texture2D、texture2DProj 等</p></blockquote><p>更详细的内置函数介绍可去官方文档查看，在此只简单列一下大致种类。</p><h5 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h5><p><a href="https://item.jd.com/12292642.html" target="_blank" rel="noopener">《音视频开发进阶指南 - 基于Android与IOS平台的实践》</a><br><a href="https://baike.baidu.com/item/OpenGL/238984?fr=aladdin" target="_blank" rel="noopener">OpenGL 百度百科</a><br><a href="https://blog.csdn.net/qq_36383623/article/details/89315921" target="_blank" rel="noopener">OpenGL Context（渲染上下文）</a><br><a href="https://baike.baidu.com/item/OpenGL%20ES" target="_blank" rel="noopener">OpenGL ES 百度百科</a><br><a href="https://blog.csdn.net/weixin_41101173/article/details/80036809" target="_blank" rel="noopener">在Android中使用OpenGL ES进行开发第（一）节：概念先行</a><br><a href="https://blog.csdn.net/jackie03/article/details/7298682" target="_blank" rel="noopener">Android OpenGL ES（四）:关于EGL</a><br><a href="https://blog.csdn.net/qq_35370018/article/details/80156643" target="_blank" rel="noopener">初学OpenGL（4）：纹理</a><br><a href="https://blog.csdn.net/u011153817/article/details/51899091" target="_blank" rel="noopener">OpenGL各坐标系及模型矩阵、投影矩阵等的深入理解</a><br><a href="https://www.cnblogs.com/liangliangh/p/4116164.html" target="_blank" rel="noopener">OpenGL管线（用经典管线代说着色器内部）</a><br><a href="https://blog.csdn.net/jeffasd/article/details/77989274" target="_blank" rel="noopener">OpenGL shader GLSL 中文手册</a><br><a href="https://learnopengl-cn.github.io/01%20Getting%20started/08%20Coordinate%20Systems/" target="_blank" rel="noopener">坐标系统</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;早就听过大名鼎鼎的 OpenGL，却迟迟没有实践学习，有些惭愧。今天开始通过实践+博文方式学习掌握 OpenGL。此文对于 OpenGL 的学习分为以下部分：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenGL 基础概念&lt;/li&gt;
&lt;li&gt;OpenGL 坐标系理解&lt;/li&gt;
&lt;li&gt;OpenGL 渲染管线&lt;/li&gt;
&lt;li&gt;OpenGL 着色语言&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="OpenGL" scheme="http://yoursite.com/categories/OpenGL/"/>
    
    
      <category term="OpenGL" scheme="http://yoursite.com/tags/OpenGL/"/>
    
  </entry>
  
  <entry>
    <title>Android 知识简记</title>
    <link href="http://yoursite.com/c75061d/"/>
    <id>http://yoursite.com/c75061d/</id>
    <published>2019-06-01T12:42:37.000Z</published>
    <updated>2019-09-15T10:47:42.000Z</updated>
    
    <content type="html"><![CDATA[<script src=/js/crypto-js.js></script><script>function doDecrypt (pwd, onError) {console.log('in doDecrypt');const txt = document.getElementById('enc_content').innerHTML;let plantext;try {const bytes = CryptoJS.AES.decrypt(txt, pwd);var plaintext = bytes.toString(CryptoJS.enc.Utf8);} catch(err) {if(onError) {onError(err);}return;}document.getElementById('enc_content').innerHTML = plaintext;document.getElementById('enc_content').style.display = 'block';document.getElementById('enc_passwd').style.display = 'none';if(typeof MathJax !== 'undefined') {MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX],['PreProcess', MathJax.Hub],['Reprocess', MathJax.Hub]);}}</script><div id="enc_content" style="display:none">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</div><div id="enc_passwd"> <input id="enc_pwd_input" type="password" style="border-radius: 5px;border-style: groove;height: 30px;width: 50%;cursor: auto;font-size: 102%;color: currentColor;outline: none;text-overflow: initial;padding-left: 5px;" onkeydown="if (event.keyCode == 13) { decrypt(); return false;}"> <input type="submit" value="解&nbsp;密" onclick="decrypt()" style="width: 58px;height: 34px;border-radius: 5px;background-color: white;border-style: solid;color: currentColor;"><div id="enc_error" style="display: inline-block;color: #d84527;margin-left: 10px"></div><script>var onError = function(error) {document.getElementById("enc_error").innerHTML = "password error!"};function decrypt() {var passwd = document.getElementById("enc_pwd_input").value;console.log(passwd);doDecrypt(passwd, onError);}</script></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Great hopes make great man&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>对 Android 开发的一点思考</title>
    <link href="http://yoursite.com/f713728e/"/>
    <id>http://yoursite.com/f713728e/</id>
    <published>2019-04-07T09:17:09.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>17 年毕业开始工作到现在已快两个年头，在实际项目开发的过程中，我对 Android 开发有了一些自己的思考。本着碰撞才会有火花、讨论才会进步的理念，我把对 Android 开发的一点思考分享出来，真诚的希望可以有不同的观点，在纠结反驳之中得到最优解，共同进步。</p><a id="more"></a><p>最初的时候，你是否是一个完美主义者，不容忍任何一点 warning 与叹号，if 必有 else，switch 必有 default，即使 else 和 default 中确实什么也不用处理，你也会添加一个 //do nothing 注释，表示这里的逻辑是经过充分考虑的，下次阅读程序时，告诉别人也告诉自己，这里的确什么也不用处理，可以快速跳过。</p><p>我想大多数开发者，都是经历过这种心态的，然后在繁忙的版本迭代中、在赶着回家的加班时、在愈来愈发的对自己的薪水不满时、在一次又一次看到团队中别人得过且过的代码时，渐渐的，就可能对“生活”妥协，丢掉了完美主义。</p><p>然而如果你有更高的追求，就要勇敢的战胜自己的感性。</p><h3 id="使用-IntDef、StringDef"><a href="#使用-IntDef、StringDef" class="headerlink" title="使用 IntDef、StringDef"></a>使用 IntDef、StringDef</h3><p>平时特常用的 View.setVisibility() 方法使用 IntDef 来规定参数的可选项，可以试想一下，假如没用 IntDef 会怎么样？对于初学者来说，可能要稍微阅读一下源码或查下资料才能知道 setVisibility 有哪些参数可以设置。你可能会觉得没什么差，因为你很清楚 setVisibility 方法有哪些参数可以设置。但若是程序中新增的一个方法呢？比如你新接触一个模块，某个界面有若干个跳转 Action，你得先找到定义这些 Action 的地方，而若一不小心将这些 Action 分散写在不同的地方，那对后面的维护和拓展可能就是一个灾难。</p><p>建议凡是符合语义的逻辑，都必须用 IntDef、StringDef 来约束，它比枚举节省内存，性能更优，其 RetentionPolicy.SOURCE 表示此注解只在源码中存在，编译时会剔除。你可以在 Android Studio 的 Live Templates 中添加 IntDef、StringDef 写法：<br><img src="../img/14.jpg" alt></p><h3 id="使用精准表达的变量类型"><a href="#使用精准表达的变量类型" class="headerlink" title="使用精准表达的变量类型"></a>使用精准表达的变量类型</h3><p>比如你需要声明一个变量来表示某个功能是否启用，譬如控制你的 App 是否展示广告，并且可以通过服务端在线下发开关来控制，如果没有接收到下发的开关，就根据地区来决定是否展示。</p><p>这种情况下你会使用什么类型的变量？</p><p>你可能会想到使用一个 int 类型变量来控制，然后需要给这个变量加上注释：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0：展示； 1：不展示； 2：未接收到在线开关，需要根据地区决定是否展示</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mShouldShowAd;</span><br></pre></td></tr></table></figure><p>以后每当改动到这部分逻辑，都需要查看一下这个变量数值对应的含义，随着时间的推移和代码量的增多，在此逻辑之上可能堆积了很多代码，然后就会出现各种各样的问题，别人可能在不存在的逻辑分支做了一些事：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mShouldShowAd == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mShouldShowAd == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mShouldShowAd == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>甚至可能对这个变量赋值 [0,2] 区间之外的数值！ 你可能对这个变量的意义很了解也绝不会用错，但你不能保证他人不会出现上面所说的荒唐的用法，因为这个变量类型并不能很精准的表达它的语义，也没有任何约束性。</p><p>我们可以怎样改善这种难维护、有风险的代码？</p><ul><li>可以使用 IntDef 规定这个变量的取值</li><li>可以换成 Boolean 类型，用 null 表示未获取到在线开关，恰好的表达语义并且易读、易维护</li></ul><h3 id="使用尽可能少的变量"><a href="#使用尽可能少的变量" class="headerlink" title="使用尽可能少的变量"></a>使用尽可能少的变量</h3><p>举个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mDebug = BuildConfig.DEBUG;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (mDebug) &#123;</span><br><span class="line">    Log.d(TAG, <span class="string">"..."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>你是否写过这样的逻辑？明明已经存在了一个可以直接使用的变量条件，你仍然要重新定义。这个例子逻辑还十分简单，此变量是 final 类型的，不会出错。而如果是非 final 类型的变量，那就是强行增加了一个赋值联动的逻辑，埋下了隐患，后续如果出了问题，白白的增加了定位问题的路径与复杂度。</p><p>实际开发中我们可能自己都意识不到使用了不必要的变量，比如我们的服务端接口一般会有多个接口环境，那你的代码可能是这样的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//是否是测试环境</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> sIsApiHostTest;</span><br><span class="line"><span class="comment">//是否是beta环境</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> sIsApiHostBeta;</span><br><span class="line"><span class="comment">//正式环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHost = <span class="string">"http://api.com/"</span>;</span><br><span class="line"><span class="comment">//测试环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostTest = <span class="string">"http://test.api.com/"</span>;</span><br><span class="line"><span class="comment">//beta环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostBeta = <span class="string">"http://beta.api.com/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是测试环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sIsApiHostTest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是beta环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiBeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sIsApiHostBeta;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取接口域名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getApiHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isApiTest()) &#123;</span><br><span class="line">        <span class="keyword">return</span> sApiHostTest;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isApiBeta()) &#123;</span><br><span class="line">        <span class="keyword">return</span> sApiHostBeta;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sApiHost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这样看起来好像没什么问题，只要维护好 sIsApiHostTest、sIsApiHostBeta 这两个变量就行了。如果后面又添加了一个环境呢？又添加了三四个环境呢？是不是还要维护多个变量？这个逻辑可以通过减少变量来改善：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sCurApiHost;</span><br><span class="line"><span class="comment">//正式环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHost = <span class="string">"http://api.com/"</span>;</span><br><span class="line"><span class="comment">//测试环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostTest = <span class="string">"http://test.api.com/"</span>;</span><br><span class="line"><span class="comment">//beta环境host</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sApiHostBeta = <span class="string">"http://beta.api.com/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是测试环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sApiHostTest.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是beta环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiBeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sApiHostBeta.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取接口域名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getApiHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sCurApiHost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>再加上 StringDef 就完美了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@StringDef</span>(&#123;ApiHost.sApiHost, ApiHost.sApiHostTest, ApiHost.sApiHostBeta&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ApiHost &#123;</span><br><span class="line">    <span class="comment">//正式环境host</span></span><br><span class="line">    String sApiHost = <span class="string">"http://api.com/"</span>;</span><br><span class="line">    <span class="comment">//测试环境host</span></span><br><span class="line">    String sApiHostTest = <span class="string">"http://test.api.com/"</span>;</span><br><span class="line">    <span class="comment">//beta环境host</span></span><br><span class="line">    String sApiHostBeta = <span class="string">"http://beta.api.com/"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当前环境host</span></span><br><span class="line"><span class="meta">@ApiHost</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String sCurApiHost = ApiHost.sApiHost;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是测试环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ApiHost.sApiHostTest.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是beta环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApiBeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ApiHost.sApiHostBeta.equals(sCurApiHost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取接口域名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiHost</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getApiHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sCurApiHost;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置接口域名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiHost</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setApiHost</span><span class="params">(@ApiHost String apiHost)</span> </span>&#123;</span><br><span class="line">    sCurApiHost = apiHost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不知道你有没有感受到易读性、可维护性、拓展性都蹭蹭蹭的往上涨呢？</p><h3 id="单一数据源"><a href="#单一数据源" class="headerlink" title="单一数据源"></a>单一数据源</h3><p>同时接受多个数据源数据的逻辑相比只接受一个数据源的数据需要考虑时序性等问题，要复杂很多。打个比方，可以把数据源当作你的直接上级，上级会不定时的分配任务给你做，如果你有多个上级，一个让你做任务 A，一个让你做任务 B，且 A 需要在 B 之前完成，你要怎么办？两个上级都让你做任务 A，但是只用做一次，你要怎么办？</p><p>在安卓中较为典型的场景就是同时加载网络和本地缓存数据到 UI 上，你的 UI 上展示的数据来自不同的地方，你需要考虑不同数据源之间如何协作。谷歌推出的 Jetpack 开发指南上推荐我们使用单一数据源，假如你的网络数据也需要缓存的话，那你的实现逻辑应该是这样：</p><ul><li>加载网络数据，返回后插入到本地<ul><li>统一从本地取数据展示到 UI 上</li></ul></li></ul><p>这点和上面说的“使用尽可能少的变量”有相通之处，都是尽量规避使用多个条件变量对程序产生影响的逻辑。</p><h3 id="职责分离"><a href="#职责分离" class="headerlink" title="职责分离"></a>职责分离</h3><p>强烈建议什么类里就干什么事，别把逻辑都揉到一块儿，这样随着代码量的增加，会愈发的难以维护，到最后就变成一颗存在重大隐患的地雷，看见就头疼。</p><p>举个例子，比如你要自定义一个 View，那就像系统控件一样，只负责一个控件该负责的事，处理一下渲染、展示，把手势交互通过接口开放出来，把数据的获取写在数据仓库中。这样如果数据展示出了问题，可以很快的定位到是数据获取出了问题，还是渲染展示出了问题；如果这个控件的渲染展示是经过验证的，之后就几乎不用改动此控件，至少你有机会可以将你的自定义 View 写的像系统的控件一样稳定。</p><p>这里再推荐一下谷歌的 Jetpack - MVVM 全家桶，MVC 真的是不易读、难维护、问题多、很简陋。</p><h3 id="回归最初的完美主义"><a href="#回归最初的完美主义" class="headerlink" title="回归最初的完美主义"></a>回归最初的完美主义</h3><p>希望你我可以战胜感性，不向“生活”妥协，让优秀成为准则和习惯，回归最初的完美主义。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;17 年毕业开始工作到现在已快两个年头，在实际项目开发的过程中，我对 Android 开发有了一些自己的思考。本着碰撞才会有火花、讨论才会进步的理念，我把对 Android 开发的一点思考分享出来，真诚的希望可以有不同的观点，在纠结反驳之中得到最优解，共同进步。&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="开发模式" scheme="http://yoursite.com/tags/%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>一个轻量的 Android 端日志打印记录库</title>
    <link href="http://yoursite.com/f346f34f/"/>
    <id>http://yoursite.com/f346f34f/</id>
    <published>2019-03-31T06:22:56.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p> 地址：<a href="https://github.com/yhaolpz/PLog" target="_blank" rel="noopener">https://github.com/yhaolpz/PLog</a></p><p><img src="../img/2.jpg" alt></p><p>PLog 即 Persistence Log，可持久化日志于文件，便于还原用户使用场景，解决异常问题。</p><h2 id="特性："><a href="#特性：" class="headerlink" title="特性："></a>特性：</h2><p>1.mmap 方式高效写入，规避 IO 操作带来的性能消耗</p><p>2.兼容多进程并发文件写入，日志文件保存在各自的进程目录下</p><p>3.通过 zip 压缩并加密，节省上报流量，保护日志私密性</p><p>4.内置收集 Activity/Fragment 生命周期、崩溃、网络状态等常用信息：</p><a id="more"></a><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h5 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1.初始化"></a>1.初始化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PLog.Config config = <span class="keyword">new</span> PLog.Config.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .logDir(mLogDirPath) <span class="comment">//日志存放目录，默认优先存储于SD卡</span></span><br><span class="line">        .logcatDebugLevel(PLog.DebugLevel.DEBUG) <span class="comment">//允许输出到Logcat的级别</span></span><br><span class="line">        .recordDebugLevel(PLog.DebugLevel.DEBUG) <span class="comment">//允许记录到日志文件的级别</span></span><br><span class="line">        .fileSizeLimitDay(<span class="number">15</span>) <span class="comment">//单天日志文件存储上限</span></span><br><span class="line">        .overdueDay(<span class="number">3</span>) <span class="comment">//日志文件过期天数</span></span><br><span class="line">        .cipherKey(<span class="string">"123456"</span>) <span class="comment">//日志密钥</span></span><br><span class="line">        .build();</span><br><span class="line">PLog.init(config);</span><br></pre></td></tr></table></figure><h5 id="2-打印"><a href="#2-打印" class="headerlink" title="2.打印"></a>2.打印</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通打印</span></span><br><span class="line">PLog.d(<span class="string">"wyh"</span>, <span class="string">"This is a log that can be recorded in a file"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Format</span></span><br><span class="line">PLog.d(<span class="string">"wyh"</span>, <span class="string">"This is a %s"</span>, <span class="string">"log"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//数组类型</span></span><br><span class="line">PLog.d(<span class="string">"wyh"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;);</span><br><span class="line"><span class="comment">//output: [a,b,c]</span></span><br></pre></td></tr></table></figure><h5 id="3-只记录到日志文件"><a href="#3-只记录到日志文件" class="headerlink" title="3.只记录到日志文件"></a>3.只记录到日志文件</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLog.record(PLog.DebugLevel.DEBUG,<span class="string">"wyh"</span>,<span class="string">"This is a log that can only be recorded in files"</span>);</span><br></pre></td></tr></table></figure><h5 id="4-只输出到logcat"><a href="#4-只输出到logcat" class="headerlink" title="4.只输出到logcat"></a>4.只输出到logcat</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PLog.print(PLog.DebugLevel.DEBUG,<span class="string">"wyh"</span>,<span class="string">"This is a log"</span>);</span><br></pre></td></tr></table></figure><h5 id="5-触发上传"><a href="#5-触发上传" class="headerlink" title="5.触发上传"></a>5.触发上传</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PLog.upload(<span class="keyword">new</span> UploadListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(@NonNull List&lt;File&gt; files)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//上传到你的服务端</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//建议上传成功及时删除日志文件</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">             <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">                file.delete();</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="存储逻辑"><a href="#存储逻辑" class="headerlink" title="存储逻辑"></a>存储逻辑</h2><h4 id="日志文件类型"><a href="#日志文件类型" class="headerlink" title="日志文件类型"></a>日志文件类型</h4><p>为更好的区分并管理日志，将从写入到上传经历不同状态的日志文件划分为以下类型：</p><ul><li>“-mmap” 正在写入的日志文件，不可上传，文件命名为: yyyy-MM-dd-mmap</li><li>“-mmap-up” 写入完成的日志文件，可压缩上传，文件命名为: yyyy-MM-dd-mmap-up</li><li>“-mmap-up-old” 单天较早写入完成的日志大小，可压缩上传，文件命名为: yyyy-MM-dd-mmap-up-old</li><li>“-mmap-up-last” 触发上传时超出存储上限部分的日志文件，上传操作的中间态，不会长久存在，可压缩上传，文件命名为: yyyy-MM-dd-mmap-up-last</li><li>“.zip” 已压缩加密的日志文件，可直接上传，文件命名为: yyyy-MM-dd HH:mm:ss.zip</li></ul><h4 id="控制日志时效"><a href="#控制日志时效" class="headerlink" title="控制日志时效"></a>控制日志时效</h4><p>暂定保留最近三天的日志，更早的日志将会在特定时机自动清除当前进程目录所有类型过期的日志文件，这些时机包括：</p><ul><li>初始化时</li><li>触发上传重命名日志文件添加”-up”时</li><li>触发上传压缩所有标记为”-up”的可上传的日志时</li><li>触发上传扫描所有”.zip”可上传的日志时</li></ul><h4 id="控制存储上限"><a href="#控制存储上限" class="headerlink" title="控制存储上限"></a>控制存储上限</h4><p>理论上我们应该避免无意义的日志记录滥用，控制日志体积，但为避免极端情况下大量日志写入导致存储爆炸，通过将日志文件分为两片控制存储上限。</p><p>譬如规定单天日志存储体积上限为 MAX，逻辑大致为下：</p><ul><li>当天日志文件 -mmap 写入体积达 MAX/3 时就会停止写入，并命名为 -mmap-up，然后新建文件 -mmap 继续写入</li><li>当写入达 MAX/3 时，先将已存在的 -mmap-up 命名为 -mmap-up-old，再将刚写满的 -mmap 命名为 -mmap-up，然后新建文件 -mmap 继续写入</li><li>当写入达 MAX/3 时，先删除 -mmap-up-old 文件，将已存在的 -mmap-up 命名为 -mmap-up-old，再将刚写满的 -mmap 命名为 -mmap-up，然后新建文件 -mmap 继续写入</li></ul><p>按照此逻辑，假定当天写入日志体积为 SIZE，可以将单天日志存储情况划分为以下几种状态：</p><ul><li>a. SIZE &lt; MAX/3</li><li>b. MAX/3 &lt; SIZE &lt; MAX*2/3</li><li>c. MAX*2/3 &lt; SIZE &lt; MAX</li></ul><p>当处于 a 状态时触发上传： -mmap –&gt; -mmap-up –&gt; zip<br>当处于 b 状态时触发上传： -mmap-up –&gt; -mmap-up-old –&gt; zip ;  -mmap –&gt; -mmap-up –&gt; zip<br>当处于 c 状态时触发上传： -mmap-up-old –&gt; zip ;  -mmap-up –&gt; zip ;  -mmap –&gt; -mmap-up-last –&gt; zip</p><p>为了防止频繁的判断日志体积，可设置每隔一定写入条数后判断一次进行优化，目前设置间隔为 1000 条。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; 地址：&lt;a href=&quot;https://github.com/yhaolpz/PLog&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/yhaolpz/PLog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../img/2.jpg&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;PLog 即 Persistence Log，可持久化日志于文件，便于还原用户使用场景，解决异常问题。&lt;/p&gt;
&lt;h2 id=&quot;特性：&quot;&gt;&lt;a href=&quot;#特性：&quot; class=&quot;headerlink&quot; title=&quot;特性：&quot;&gt;&lt;/a&gt;特性：&lt;/h2&gt;&lt;p&gt;1.mmap 方式高效写入，规避 IO 操作带来的性能消耗&lt;/p&gt;
&lt;p&gt;2.兼容多进程并发文件写入，日志文件保存在各自的进程目录下&lt;/p&gt;
&lt;p&gt;3.通过 zip 压缩并加密，节省上报流量，保护日志私密性&lt;/p&gt;
&lt;p&gt;4.内置收集 Activity/Fragment 生命周期、崩溃、网络状态等常用信息：&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="日志" scheme="http://yoursite.com/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>单例的线程安全及序列化问题</title>
    <link href="http://yoursite.com/1516a551/"/>
    <id>http://yoursite.com/1516a551/</id>
    <published>2019-03-05T15:04:44.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>单例模式可以说是最简单的设计模式了，但在使用时也有一些问题需要注意，比如线程安全性和序列化破坏。本文以几个问题为出发点，分析延迟加载、线程安全以及序列化三个方面，深入了解一下单例模式的各种姿势，以便在今后使用时追求极致性能  ⊙﹏⊙‖∣°</p><a id="more"></a><ul><li>饿汉方式单例到底有多“饿”？</li><li>静态内部类为什么是延迟加载的？</li><li>枚举方式单例是延迟加载的吗？</li><li>饿汉、静态内部类、枚举方式单例为什么是线程安全的？</li><li>序列化为什么会破坏单例模式？</li><li>怎么防止序列化破坏单例模式？</li><li>枚举方式单例是怎么避免序列化破坏的？</li></ul><p>开始正文前先思考下以上问题，如果你都掌握了，就可以点叉出去了。</p><h1 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h1><h4 id="饿汉方式"><a href="#饿汉方式" class="headerlink" title="饿汉方式"></a>饿汉方式</h4><p>先来看一下饿汉方式实现的单例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与饿汉方式一并提起的往往还有懒汉方式，对比而言，懒汉方式具有延迟加载（这里的加载指创建 Singleton 实例）的优点。这容易让人对饿汉方式有一个恶劣的刻板印象：它的性能很不好！没有使用它的时候它就会初始化，白白占用资源！</p><p>现在我们来思考一下，饿汉方式单例到底有多“饿”？它到底什么时候会初始化呢？我们知道类加载的时候会初始化静态资源，所以饿汉方式的初始化时机就是类加载时机，回顾一下类加载的时机：</p><ul><li>使用new关键字实例化对象</li><li>调用一个类的静态方法</li><li>读取一个类的静态字段（被 final 修饰已在编译期把结果放在常量池的静态字段除外）</li></ul><p>当使用单例时，往往都是先调用 getInstance() 获取单例，几乎不会涉及其他的静态方法或字段，所以大多数情况下，饿汉方式同懒汉方式一样是延迟加载的！如果你的单例只暴露了 getInstance() 方法（个人感觉也是比较规范的写法），那就放心的使用饿汉方式吧！如果别人 diss 了你的饿汉方式，那就 diss 回去让他去复习类加载机制 &gt;_&lt;||| </p><h4 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h4><p>静态内部类方式单例实现如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相比饿汉方式，这种方式实现的单例即使加载了 Singleton 类，也不一定会创建 Singleton 实例，因为 Singleton 的静态引用放到了静态内部类中，只有静态内部类被加载了，Singleton 实例才会被创建。</p><p>如果 Singleton 中对外只暴露了 getInstance 方法，那和饿汉方式无异；如果还暴露了其他的静态方法或字段，那相比饿汉方式，可以更精准的实现延迟加载。</p><h4 id="枚举方式"><a href="#枚举方式" class="headerlink" title="枚举方式"></a>枚举方式</h4><p>枚举方式实现的单例如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种形式或许我们无从下手，但反编译后就明白了，相当于：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，枚举方式实现的单例和饿汉方式差不多，延迟加载时机依赖类加载时机。</p><p>这里需要搞清楚被 static、final 修饰的编译期常量、运行期常量。</p><h1 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h1><p>这部分内容其实十分简单。</p><p>类加载的逻辑位于 synchronized 代码块中，是线程安全的，而饿汉、静态内部类以及枚举方式实现的单例初始化都处于类加载时机，所以它们都是线程安全的。</p><p>懒汉方式的初始化与类加载时机无关，所以要自行保证线程安全。</p><h1 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h1><p>我们期望单例模式可以实现只创建一个实例，通过特殊手段创建出其他的实例，就对单例模式造成了破坏，序列化就会破坏单例模式。</p><p>假如我们的单例实现了 serializable 接口，序列化时会通过反射调用无参数的构造方法创建一个新的实例，这时就要重写 readResolve 方法防止序列化破坏单例，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//防止序列化破坏单例模式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>普通的 Java 类的反序列化过程中，会通过反射创建新的实例。而枚举在序列化的时候仅是将枚举对象的 name 属性输出到结果中，反序列化的时候则是通过 java.lang.Enum 的 valueOf 方法来根据名字查找枚举对象。同时，编译器是不允许任何对这种序列化机制的定制的，禁用了writeObject、readObject、readObjectNoData、writeReplace 和 readResolve 等方法。</p><p>枚举的反序列化并不是通过反射实现的，所以也就不会发生由于反序列化导致的单例破坏问题。</p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><p>最后集中回答下开头的问题：</p><ul><li>饿汉方式单例到底有多“饿”？<br>大多数情况下，饿汉方式同懒汉方式一样时延迟加载的</li><li>静态内部类为什么是延迟加载的？<br>依赖类加载机制，加载静态内部类时才会初始化</li><li>枚举方式单例是延迟加载的吗？<br>与饿汉方式类似，类加载时初始化</li><li>饿汉、静态内部类、枚举方式单例为什么是线程安全的？<br>因为它们在类加载时初始化，而类加载是线程安全的</li><li>序列化为什么会破坏单例模式？<br>普通的 Java 类的反序列化过程中，会通过反射创建新的实例</li><li>怎么防止序列化破坏单例模式？<br>使用枚举或重写 readResolve 方法</li><li>枚举方式单例是怎么避免序列化破坏的？<br>依赖枚举自身特殊的序列化机制</li></ul><h6 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h6><p><a href="https://www.hollischuang.com/archives/1144" target="_blank" rel="noopener">单例与序列化的那些事儿</a><br><a href="https://www.hollischuang.com/archives/2498" target="_blank" rel="noopener">为什么我墙裂建议大家使用枚举来实现单例</a><br><a href="https://www.hollischuang.com/archives/197" target="_blank" rel="noopener">深度分析Java的枚举类型—-枚举的线程安全性及序列化问题</a><br><a href="https://stackoverflow.com/questions/16771373/singleton-via-enum-way-is-lazy-initialized" target="_blank" rel="noopener">stackoverflow：singleton-via-enum-way-is-lazy-initialized</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单例模式可以说是最简单的设计模式了，但在使用时也有一些问题需要注意，比如线程安全性和序列化破坏。本文以几个问题为出发点，分析延迟加载、线程安全以及序列化三个方面，深入了解一下单例模式的各种姿势，以便在今后使用时追求极致性能  ⊙﹏⊙‖∣°&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>[剑指offer] 机器人走格子之回溯法</title>
    <link href="http://yoursite.com/e89c3ed9/"/>
    <id>http://yoursite.com/e89c3ed9/</id>
    <published>2019-03-03T12:14:56.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>地上有一个m行和n列的方格。一个机器人从坐标0,0的格子开始移动，每一次只能向左，右，上，下四个方向移动一格，但是不能进入行坐标和列坐标的数位之和大于k的格子。 例如，当k为18时，机器人能够进入方格（35,37），因为3+5+3+7 = 18。但是，它不能进入方格（35,38），因为3+5+3+8 = 19。请问该机器人能够达到多少个格子？</p><a id="more"></a><p><strong>核心思路：</strong></p><ol><li>从(0,0)开始走，每成功走一步标记当前位置为true,然后从当前位置往四个方向探索，返回1 + 4 个方向的探索值之和。</li><li>探索时，判断当前节点是否可达的标准为：1）当前节点在矩阵内；2）当前节点未被访问过；3）当前节点满足limit限制。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">movingCount</span><span class="params">(<span class="keyword">int</span> threshold, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span>[][] visited = <span class="keyword">new</span> <span class="keyword">boolean</span>[rows][cols];</span><br><span class="line">    <span class="keyword">return</span> countingSteps(threshold, rows, cols, <span class="number">0</span>, <span class="number">0</span>, visited);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countingSteps</span><span class="params">(<span class="keyword">int</span> limit, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">int</span> r, <span class="keyword">int</span> c, <span class="keyword">boolean</span>[][] visited)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (r &lt; <span class="number">0</span> || r &gt;= rows || c &lt; <span class="number">0</span> || c &gt;= cols</span><br><span class="line">            || visited[r][c] || bitSum(r) + bitSum(c) &gt; limit) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    visited[r][c] = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> countingSteps(limit, rows, cols, r - <span class="number">1</span>, c, visited)</span><br><span class="line">            + countingSteps(limit, rows, cols, r, c - <span class="number">1</span>, visited)</span><br><span class="line">            + countingSteps(limit, rows, cols, r + <span class="number">1</span>, c, visited)</span><br><span class="line">            + countingSteps(limit, rows, cols, r, c + <span class="number">1</span>, visited)</span><br><span class="line">            + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bitSum</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (t != <span class="number">0</span>) &#123;</span><br><span class="line">        count += t % <span class="number">10</span>;</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;地上有一个m行和n列的方格。一个机器人从坐标0,0的格子开始移动，每一次只能向左，右，上，下四个方向移动一格，但是不能进入行坐标和列坐标的数位之和大于k的格子。 例如，当k为18时，机器人能够进入方格（35,37），因为3+5+3+7 = 18。但是，它不能进入方格（35,38），因为3+5+3+8 = 19。请问该机器人能够达到多少个格子？&lt;/p&gt;
    
    </summary>
    
      <category term="算法之美" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/"/>
    
    
      <category term="剑指offer" scheme="http://yoursite.com/tags/%E5%89%91%E6%8C%87offer/"/>
    
  </entry>
  
  <entry>
    <title>[剑指offer] 二维数组中的查找</title>
    <link href="http://yoursite.com/ff815187/"/>
    <id>http://yoursite.com/ff815187/</id>
    <published>2019-02-28T15:03:46.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>在一个二维数组中（每个一维数组的长度相同），每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> target, <span class="keyword">int</span>[][] array)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (array == <span class="keyword">null</span> || array.length == <span class="number">0</span> || array[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> len = array[<span class="number">0</span>].length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>[] anArray : array) &#123;</span><br><span class="line">        <span class="keyword">if</span> (target == anArray[<span class="number">0</span>] || target == anArray[len - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; anArray[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; anArray[len - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a : anArray) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a == target) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在一个二维数组中（每个一维数组的长度相同），每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。&lt;/p&gt;
    
    </summary>
    
      <category term="算法之美" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/"/>
    
    
      <category term="剑指offer" scheme="http://yoursite.com/tags/%E5%89%91%E6%8C%87offer/"/>
    
  </entry>
  
  <entry>
    <title>简洁明了的刘海屏适配方案</title>
    <link href="http://yoursite.com/2f41d4d1/"/>
    <id>http://yoursite.com/2f41d4d1/</id>
    <published>2019-02-26T15:11:04.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>网上关于刘海屏适配的文章不少，可讲清楚的却没几篇，大多是拷贝文档、长篇大论，甚至热情的贴图告诉你什么是刘海屏，到最后你仍不确定到底是怎样的一个适配方案，才能让你的 app 真正的适配所有的刘海屏机型。</p><p>看到这篇文章你就无需再怨恨各大厂商的跟风“刘海”了，因为刘海屏的适配十分简单。</p><a id="more"></a><p>ok，废话说完了，开始适配。</p><p>首先要清楚的是哪些界面需要适配刘海屏：</p><ul><li>有状态栏的界面：刘海区域会显示状态栏，无需适配</li><li>全屏界面：刘海区域可能遮挡内容，需要适配</li></ul><p>如果你的应用里所有界面都有状态栏，那么恭喜你，你不用做任何操作，状态栏就那么自然的显示在刘海区域，毫无违和，刘海屏已适配完毕，可以点叉出去了。</p><p>不幸的是，你的应用中很大几率会有全屏界面，所谓的刘海屏适配，也正是针对这些全屏界面。</p><p>如果你什么都不做，默认规则不允许全屏界面内容显示到刘海区域，即刘海屏区域会保留一条黑边，你的全屏界面会在刘海下方展示，这看起来好像也是可以接受的，然后你竟说服产品达成共识，“无为而治”才是最强大的刘海屏适配方案！</p><p>但有些手机厂商（譬如oppo）不开心了，我辛辛苦苦研发的刘海屏手机，你们这些开发者竟直接放弃刘海区域！然后就在你的全屏界面下方加了一条提示：“全屏显示”，当用户点击开启后，强行把你的全屏界面显示到刘海区域，然后一切都乱套了…</p><p>嗯～ “无为而治”行不通。</p><p>只能允许全屏界面内容显示到刘海区域了，参考各大厂商的适配文档，我们可以知道如何允许，比如华为机型只需在 AndroidManifest 中配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;android.notch_support&quot;</span><br><span class="line">    android:value=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure></p><p>配置后，华为机型上的全屏界面就会显示到刘海区域了，但这个刘海，是可能挡住我们全屏界面中的内容的。这时需要将全屏界面中的视图元素适当下移，保证不会被刘海遮挡住，就 ok 了。</p><p>这里我们搞清楚：允许全屏界面内容显示到刘海区域的机型，才需要将全屏界面中的视图元素适当下移。</p><p>比如若只允许华为机型全屏界面内容显示到刘海区域，那只有华为的刘海屏机型才需要将全屏界面中的视图元素适当下移，其他厂商的刘海屏机型则不需要下移。</p><p>如果允许华为、小米、oppo、vivo 全屏界面内容显示到刘海区域，那么华为、小米、oppo、vivo 刘海屏机型需要将全屏界面中的视图元素适当下移。</p><p>另外也不一定要通过全屏界面中的视图元素适当下移方式来适配刘海屏，如果产品形态允许的话，你也可以让该界面显示状态栏啊。</p><p>至此刘海屏适配完毕，是不是很简单！？</p><p>最后代码奉上，拿走不谢：</p><h4 id="允许全屏界面内容显示到刘海区域配置："><a href="#允许全屏界面内容显示到刘海区域配置：" class="headerlink" title="允许全屏界面内容显示到刘海区域配置："></a>允许全屏界面内容显示到刘海区域配置：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--允许绘制到oppo、vivo刘海屏机型的刘海区域 --&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;android.max_aspect&quot;</span><br><span class="line">    android:value=&quot;2.2&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 允许绘制到华为刘海屏机型的刘海区域 --&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;android.notch_support&quot;</span><br><span class="line">    android:value=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 允许绘制到小米刘海屏机型的刘海区域 --&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">    android:name=&quot;notch.config&quot;</span><br><span class="line">    android:value=&quot;portrait&quot; /&gt;</span><br></pre></td></tr></table></figure><p>上面在 AndroidManifest 的配置在 Android 9.0 之前有效，9.0 系统针对刘海屏制定了新的 api，默认保留一条黑边，即不允许绘制到刘海区域。所以如果你还没有适配 Android 9.0，那在判断是否是允许全屏界面内容显示到刘海区域的刘海屏机型时，就要加上版本判断。</p><h4 id="判断是否是允许全屏界面内容显示到刘海区域的刘海屏机型："><a href="#判断是否是允许全屏界面内容显示到刘海区域的刘海屏机型：" class="headerlink" title="判断是否是允许全屏界面内容显示到刘海区域的刘海屏机型："></a>判断是否是允许全屏界面内容显示到刘海区域的刘海屏机型：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CutoutUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Boolean sAllowDisplayToCutout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否为允许全屏界面显示内容到刘海区域的刘海屏机型（与AndroidManifest中配置对应）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">allowDisplayToCutout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sAllowDisplayToCutout == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.O_MR1) &#123;</span><br><span class="line">                <span class="comment">// 9.0系统全屏界面默认会保留黑边，不允许显示内容到刘海区域</span></span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutoutDevice = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Context context = App.get();</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_Huawei(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_OPPO(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_VIVO(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasCutout_XIAOMI(context)) &#123;</span><br><span class="line">                <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sAllowDisplayToCutout = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sAllowDisplayToCutout;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是华为刘海屏机型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_Huawei</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"HUAWEI"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader cl = context.getClassLoader();</span><br><span class="line">            Class HwNotchSizeUtil = cl.loadClass(<span class="string">"com.huawei.android.util.HwNotchSizeUtil"</span>);</span><br><span class="line">            <span class="keyword">if</span> (HwNotchSizeUtil != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method get = HwNotchSizeUtil.getMethod(<span class="string">"hasNotchInScreen"</span>);</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>) get.invoke(HwNotchSizeUtil);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是oppo刘海屏机型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_OPPO</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"oppo"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context.getPackageManager().hasSystemFeature(<span class="string">"com.oppo.feature.screen.heteromorphism"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是vivo刘海屏机型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_VIVO</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"vivo"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader cl = context.getClassLoader();</span><br><span class="line">            <span class="meta">@SuppressLint</span>(<span class="string">"PrivateApi"</span>)</span><br><span class="line">            Class ftFeatureUtil = cl.loadClass(<span class="string">"android.util.FtFeature"</span>);</span><br><span class="line">            <span class="keyword">if</span> (ftFeatureUtil != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method get = ftFeatureUtil.getMethod(<span class="string">"isFeatureSupport"</span>, <span class="keyword">int</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">boolean</span>) get.invoke(ftFeatureUtil, <span class="number">0x00000020</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是小米刘海屏机型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasCutout_XIAOMI</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Build.MANUFACTURER.equalsIgnoreCase(<span class="string">"xiaomi"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClassLoader cl = context.getClassLoader();</span><br><span class="line">            <span class="meta">@SuppressLint</span>(<span class="string">"PrivateApi"</span>)</span><br><span class="line">            Class SystemProperties = cl.loadClass(<span class="string">"android.os.SystemProperties"</span>);</span><br><span class="line">            Class[] paramTypes = <span class="keyword">new</span> Class[<span class="number">2</span>];</span><br><span class="line">            paramTypes[<span class="number">0</span>] = String<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">            paramTypes[<span class="number">1</span>] = <span class="keyword">int</span><span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">            Method getInt = SystemProperties.getMethod(<span class="string">"getInt"</span>, paramTypes);</span><br><span class="line">            <span class="comment">//参数</span></span><br><span class="line">            Object[] params = <span class="keyword">new</span> Object[<span class="number">2</span>];</span><br><span class="line">            params[<span class="number">0</span>] = <span class="string">"ro.miui.notch"</span>;</span><br><span class="line">            params[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> (Integer) getInt.invoke(SystemProperties, params) == <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面提到，不一定要通过全屏界面中的视图元素适当下移方式来适配刘海屏，如果产品形态允许的话，也可以让该界面显示状态栏。</p><p>显示状态栏的方案是较为通用简单的，或者说，在一个应用中，一些全屏界面往往是允许使用显示状态栏的方案来适配的，如果你考虑使用这种方案，那便会是这种效果：</p><ul><li>在你的应用中，你期望某些全屏界面在刘海屏机型上必须全屏展示，那你就自行将界面元素适当下移，从而避免被刘海遮挡；而某些全屏界面不是非要全屏显示，允许在刘海屏机型显示状态栏，那就通过显示状态栏的方式，从而避免被刘海遮挡。</li></ul><p>为了实现这种效果，我们需要标记区分哪些界面必须全屏展示、哪些界面允许显示状态栏。这里提供一种实现方式，让允许显示状态栏的界面 Activity 继承一个接口，比如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CutoutAdapt</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在 ActivityLifecycleCallbacks 回调，统一适配允许通过显示状态栏的全屏界面：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityStarted</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果是允许全屏显示到刘海屏区域的刘海屏机型</span></span><br><span class="line">    <span class="keyword">if</span> (CutoutUtil.allowDisplayToCutout()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFullScreen(activity)) &#123;</span><br><span class="line">            <span class="comment">// 如果允许通过显示状态栏方式适配刘海屏</span></span><br><span class="line">            <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> CutoutAdapt) &#123;</span><br><span class="line">                <span class="comment">// 显示状态栏</span></span><br><span class="line">                StatusBarUtil.showStatusbar(activity.getWindow());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 需自行将该界面视图元素下移，否则可能会被刘海遮挡</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 非全屏界面无需适配刘海屏</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;网上关于刘海屏适配的文章不少，可讲清楚的却没几篇，大多是拷贝文档、长篇大论，甚至热情的贴图告诉你什么是刘海屏，到最后你仍不确定到底是怎样的一个适配方案，才能让你的 app 真正的适配所有的刘海屏机型。&lt;/p&gt;
&lt;p&gt;看到这篇文章你就无需再怨恨各大厂商的跟风“刘海”了，因为刘海屏的适配十分简单。&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="刘海屏适配" scheme="http://yoursite.com/tags/%E5%88%98%E6%B5%B7%E5%B1%8F%E9%80%82%E9%85%8D/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 展示 gif 原理</title>
    <link href="http://yoursite.com/3fe9ef36/"/>
    <id>http://yoursite.com/3fe9ef36/</id>
    <published>2019-02-17T10:03:14.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>在展示 gif 时，即使不调用 asGif 方法，Glide 也能识别出 gif 类型并正常展示。解码逻辑位于 Downsampler 的 decode 方法中，我们先从这里开始，看看 Glide 是如何识别 gif 类型的。decode 方法中调用了 decodeFromWrappedStreams 方法开始实际解码逻辑：</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Bitmap <span class="title">decodeFromWrappedStreams</span><span class="params">(InputStream is,</span></span></span><br><span class="line"><span class="function"><span class="params">    BitmapFactory.Options options, DownsampleStrategy downsampleStrategy,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodeFormat decodeFormat, <span class="keyword">boolean</span> isHardwareConfigAllowed, <span class="keyword">int</span> requestedWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> requestedHeight, <span class="keyword">boolean</span> fixBitmapToRequestedDimensions,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodeCallbacks callbacks)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = LogTime.getLogTime();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span>[] sourceDimensions = getDimensions(is, options, callbacks, bitmapPool);</span><br><span class="line">  <span class="keyword">int</span> sourceWidth = sourceDimensions[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">int</span> sourceHeight = sourceDimensions[<span class="number">1</span>];</span><br><span class="line">  String sourceMimeType = options.outMimeType;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If we failed to obtain the image dimensions, we may end up with an incorrectly sized Bitmap,</span></span><br><span class="line">  <span class="comment">// so we want to use a mutable Bitmap type. One way this can happen is if the image header is so</span></span><br><span class="line">  <span class="comment">// large (10mb+) that our attempt to use inJustDecodeBounds fails and we're forced to decode the</span></span><br><span class="line">  <span class="comment">// full size image.</span></span><br><span class="line">  <span class="keyword">if</span> (sourceWidth == -<span class="number">1</span> || sourceHeight == -<span class="number">1</span>) &#123;</span><br><span class="line">    isHardwareConfigAllowed = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> orientation = ImageHeaderParserUtils.getOrientation(parsers, is, byteArrayPool);</span><br><span class="line">  <span class="keyword">int</span> degreesToRotate = TransformationUtils.getExifOrientationDegrees(orientation);</span><br><span class="line">  <span class="keyword">boolean</span> isExifOrientationRequired = TransformationUtils.isExifOrientationRequired(orientation);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> targetWidth = requestedWidth == Target.SIZE_ORIGINAL ? sourceWidth : requestedWidth;</span><br><span class="line">  <span class="keyword">int</span> targetHeight = requestedHeight == Target.SIZE_ORIGINAL ? sourceHeight : requestedHeight;</span><br><span class="line"></span><br><span class="line">  ImageType imageType = ImageHeaderParserUtils.getType(parsers, is, byteArrayPool);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... 省略下面的解码逻辑代码</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rotated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到解码开始前，准备了图片角度、输出尺寸的信息，并通过 ImageHeaderParserUtils 获取了图片类型：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageType imageType = ImageHeaderParserUtils.getType(parsers, is, byteArrayPool);</span><br></pre></td></tr></table></figure></p><p>Glide 中定义了以下图片类型:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The format of the image data including whether or not the image may include transparent</span></span><br><span class="line"><span class="comment"> * pixels.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> ImageType &#123;</span><br><span class="line">  GIF(<span class="keyword">true</span>),</span><br><span class="line">  JPEG(<span class="keyword">false</span>),</span><br><span class="line">  RAW(<span class="keyword">false</span>),</span><br><span class="line">  <span class="comment">/** PNG type with alpha. */</span></span><br><span class="line">  PNG_A(<span class="keyword">true</span>),</span><br><span class="line">  <span class="comment">/** PNG type without alpha. */</span></span><br><span class="line">  PNG(<span class="keyword">false</span>),</span><br><span class="line">  <span class="comment">/** WebP type with alpha. */</span></span><br><span class="line">  WEBP_A(<span class="keyword">true</span>),</span><br><span class="line">  <span class="comment">/** WebP type without alpha. */</span></span><br><span class="line">  WEBP(<span class="keyword">false</span>),</span><br><span class="line">  <span class="comment">/** Unrecognized type. */</span></span><br><span class="line">  UNKNOWN(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> hasAlpha;</span><br><span class="line"></span><br><span class="line">  ImageType(<span class="keyword">boolean</span> hasAlpha) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hasAlpha = hasAlpha;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasAlpha</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hasAlpha;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>而实际获取图片类型的逻辑位于 DefaultImageHeaderParser 中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ImageType <span class="title">getType</span><span class="params">(Reader reader)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> firstTwoBytes = reader.getUInt16();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// JPEG.</span></span><br><span class="line">  <span class="keyword">if</span> (firstTwoBytes == EXIF_MAGIC_NUMBER) &#123;</span><br><span class="line">    <span class="keyword">return</span> JPEG;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> firstFourBytes = (firstTwoBytes &lt;&lt; <span class="number">16</span> &amp; <span class="number">0xFFFF0000</span>) | (reader.getUInt16() &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">  <span class="comment">// PNG.</span></span><br><span class="line">  <span class="keyword">if</span> (firstFourBytes == PNG_HEADER) &#123;</span><br><span class="line">    <span class="comment">// See: http://stackoverflow.com/questions/2057923/how-to-check-a-png-for-grayscale-alpha</span></span><br><span class="line">    <span class="comment">// -color-type</span></span><br><span class="line">    reader.skip(<span class="number">25</span> - <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">int</span> alpha = reader.getByte();</span><br><span class="line">    <span class="comment">// A RGB indexed PNG can also have transparency. Better safe than sorry!</span></span><br><span class="line">    <span class="keyword">return</span> alpha &gt;= <span class="number">3</span> ? PNG_A : PNG;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GIF from first 3 bytes.</span></span><br><span class="line">  <span class="keyword">if</span> (firstFourBytes &gt;&gt; <span class="number">8</span> == GIF_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> GIF;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// WebP (reads up to 21 bytes). See https://developers.google.com/speed/webp/docs/riff_container</span></span><br><span class="line">  <span class="comment">// for details.</span></span><br><span class="line">  <span class="keyword">if</span> (firstFourBytes != RIFF_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Bytes 4 - 7 contain length information. Skip these.</span></span><br><span class="line">  reader.skip(<span class="number">4</span>);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> thirdFourBytes =</span><br><span class="line">      (reader.getUInt16() &lt;&lt; <span class="number">16</span> &amp; <span class="number">0xFFFF0000</span>) | (reader.getUInt16() &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">  <span class="keyword">if</span> (thirdFourBytes != WEBP_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> fourthFourBytes =</span><br><span class="line">      (reader.getUInt16() &lt;&lt; <span class="number">16</span> &amp; <span class="number">0xFFFF0000</span>) | (reader.getUInt16() &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">  <span class="keyword">if</span> ((fourthFourBytes &amp; VP8_HEADER_MASK) != VP8_HEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span> UNKNOWN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((fourthFourBytes &amp; VP8_HEADER_TYPE_MASK) == VP8_HEADER_TYPE_EXTENDED) &#123;</span><br><span class="line">    <span class="comment">// Skip some more length bytes and check for transparency/alpha flag.</span></span><br><span class="line">    reader.skip(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">return</span> (reader.getByte() &amp; WEBP_EXTENDED_ALPHA_FLAG) != <span class="number">0</span> ? ImageType.WEBP_A : ImageType.WEBP;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((fourthFourBytes &amp; VP8_HEADER_TYPE_MASK) == VP8_HEADER_TYPE_LOSSLESS) &#123;</span><br><span class="line">    <span class="comment">// See chromium.googlesource.com/webm/libwebp/+/master/doc/webp-lossless-bitstream-spec.txt</span></span><br><span class="line">    <span class="comment">// for more info.</span></span><br><span class="line">    reader.skip(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">return</span> (reader.getByte() &amp; WEBP_LOSSLESS_ALPHA_FLAG) != <span class="number">0</span> ? ImageType.WEBP_A : ImageType.WEBP;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ImageType.WEBP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到这里是通过文件头标示来获取图片类型的，而 gif 文件头如下：<br><img src="https://upload-images.jianshu.io/upload_images/4679478-588f3a9d994f274a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>查看代码，Glide 中便是通过 0x474946 文件头来判断的。</p><p>Glide 中将 gif 类型图片封装成了 GifDrawable，在 ByteBufferGifDecoder 中可以看到 GifDrawable 的生成逻辑：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> GifDrawableResource <span class="title">decode</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    ByteBuffer byteBuffer, <span class="keyword">int</span> width, <span class="keyword">int</span> height, GifHeaderParser parser, Options options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = LogTime.getLogTime();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> GifHeader header = parser.parseHeader();</span><br><span class="line">    <span class="keyword">if</span> (header.getNumFrames() &lt;= <span class="number">0</span> || header.getStatus() != GifDecoder.STATUS_OK) &#123;</span><br><span class="line">      <span class="comment">// If we couldn't decode the GIF, we will end up with a frame count of 0.</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Bitmap.Config config = options.get(GifOptions.DECODE_FORMAT) == DecodeFormat.PREFER_RGB_565</span><br><span class="line">        ? Bitmap.Config.RGB_565 : Bitmap.Config.ARGB_8888;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> sampleSize = getSampleSize(header, width, height);</span><br><span class="line">    GifDecoder gifDecoder = gifDecoderFactory.build(provider, header, byteBuffer, sampleSize);</span><br><span class="line">    gifDecoder.setDefaultBitmapConfig(config);</span><br><span class="line">    gifDecoder.advance();</span><br><span class="line">    Bitmap firstFrame = gifDecoder.getNextFrame();</span><br><span class="line">    <span class="keyword">if</span> (firstFrame == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Transformation&lt;Bitmap&gt; unitTransformation = UnitTransformation.get();</span><br><span class="line"></span><br><span class="line">    GifDrawable gifDrawable =</span><br><span class="line">        <span class="keyword">new</span> GifDrawable(context, gifDecoder, unitTransformation, width, height, firstFrame);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GifDrawableResource(gifDrawable);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class="line">      Log.v(TAG, <span class="string">"Decoded GIF from stream in "</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>至此已经获取到 GifDrawable ，GifDrawable 中持有一个 GifFrameLoader，而 GifFrameLoader 中持有了 gif 解码器 StandardGifDecoder 。由此可以得出 gif 的展示逻辑就封装于 GifDrawable 中，主要通过 GifFrameLoader 实现。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在展示 gif 时，即使不调用 asGif 方法，Glide 也能识别出 gif 类型并正常展示。解码逻辑位于 Downsampler 的 decode 方法中，我们先从这里开始，看看 Glide 是如何识别 gif 类型的。decode 方法中调用了 decodeFromWrappedStreams 方法开始实际解码逻辑：&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 缩略图使用及原理</title>
    <link href="http://yoursite.com/2455213e/"/>
    <id>http://yoursite.com/2455213e/</id>
    <published>2019-02-17T08:25:28.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>缩略图的使用可参考<a href="https://muyangmin.github.io/glide-docs-cn/doc/options.html#缩略图-thumbnail-请求" target="_blank" rel="noopener">官方文档</a>。</p><p>若使用简化方式设置缩略图：</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(context).load(imgUrl).thumbnail(<span class="number">0.2f</span>).into(imageView);</span><br></pre></td></tr></table></figure><p>发起缩略图请求的关键逻辑位于 RequestBuilder 的 buildThumbnailRequestRecursive 方法中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base case: thumbnail multiplier generates a thumbnail request, but cannot recurse.</span></span><br><span class="line">  ThumbnailRequestCoordinator coordinator = <span class="keyword">new</span> ThumbnailRequestCoordinator(parentCoordinator);</span><br><span class="line"></span><br><span class="line">  Request fullRequest =</span><br><span class="line">      obtainRequest(</span><br><span class="line">          target,</span><br><span class="line">          targetListener,</span><br><span class="line">          requestOptions,</span><br><span class="line">          coordinator,</span><br><span class="line">          transitionOptions,</span><br><span class="line">          priority,</span><br><span class="line">          overrideWidth,</span><br><span class="line">          overrideHeight);</span><br><span class="line"></span><br><span class="line">  RequestOptions thumbnailOptions = requestOptions.clone()</span><br><span class="line">      .sizeMultiplier(thumbSizeMultiplier);</span><br><span class="line">  Request thumbnailRequest =</span><br><span class="line">      obtainRequest(</span><br><span class="line">          target,</span><br><span class="line">          targetListener,</span><br><span class="line">          thumbnailOptions,</span><br><span class="line">          coordinator,</span><br><span class="line">          transitionOptions,</span><br><span class="line">          getThumbnailPriority(priority),</span><br><span class="line">          overrideWidth,</span><br><span class="line">          overrideHeight);</span><br><span class="line"></span><br><span class="line">  coordinator.setRequests(fullRequest, thumbnailRequest);</span><br><span class="line">  <span class="keyword">return</span> coordinator;</span><br></pre></td></tr></table></figure></p><p>其中 fullRequest、thumbnailRequest 分别为原图、缩略图请求，ThumbnailRequestCoordinator 就是字面意思，专门用于协调原图、缩略图的请求，并合并成一个请求，可以看到在构建缩略图请求时，为了尽量让缩略图比原图加载的更快一点，调用 getThumbnailPriority 方法调整了请求优先级：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Priority <span class="title">getThumbnailPriority</span><span class="params">(@NonNull Priority current)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (current) &#123;</span><br><span class="line">    <span class="keyword">case</span> LOW:</span><br><span class="line">      <span class="keyword">return</span> Priority.NORMAL;</span><br><span class="line">    <span class="keyword">case</span> NORMAL:</span><br><span class="line">      <span class="keyword">return</span> Priority.HIGH;</span><br><span class="line">    <span class="keyword">case</span> HIGH:</span><br><span class="line">    <span class="keyword">case</span> IMMEDIATE:</span><br><span class="line">      <span class="keyword">return</span> Priority.IMMEDIATE;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"unknown priority: "</span> + requestOptions.getPriority());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>加载完数据后，Glide 会分别解码缩略图、原图两种尺寸的图片，具体解码实现位于 Downsampler 的 decode 方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Resource&lt;Bitmap&gt; <span class="title">decode</span><span class="params">(InputStream is, <span class="keyword">int</span> requestedWidth, <span class="keyword">int</span> requestedHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    Options options, DecodeCallbacks callbacks)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  Preconditions.checkArgument(is.markSupported(), <span class="string">"You must provide an InputStream that supports"</span></span><br><span class="line">      + <span class="string">" mark()"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">byte</span>[] bytesForOptions = byteArrayPool.get(ArrayPool.STANDARD_BUFFER_SIZE_BYTES, <span class="keyword">byte</span>[]<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  BitmapFactory.Options bitmapFactoryOptions = getDefaultOptions();</span><br><span class="line">  bitmapFactoryOptions.inTempStorage = bytesForOptions;</span><br><span class="line"></span><br><span class="line">  DecodeFormat decodeFormat = options.get(DECODE_FORMAT);</span><br><span class="line">  DownsampleStrategy downsampleStrategy = options.get(DownsampleStrategy.OPTION);</span><br><span class="line">  <span class="keyword">boolean</span> fixBitmapToRequestedDimensions = options.get(FIX_BITMAP_SIZE_TO_REQUESTED_DIMENSIONS);</span><br><span class="line">  <span class="keyword">boolean</span> isHardwareConfigAllowed =</span><br><span class="line">    options.get(ALLOW_HARDWARE_CONFIG) != <span class="keyword">null</span> &amp;&amp; options.get(ALLOW_HARDWARE_CONFIG);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Bitmap result = decodeFromWrappedStreams(is, bitmapFactoryOptions,</span><br><span class="line">        downsampleStrategy, decodeFormat, isHardwareConfigAllowed, requestedWidth,</span><br><span class="line">        requestedHeight, fixBitmapToRequestedDimensions, callbacks);</span><br><span class="line">    <span class="keyword">return</span> BitmapResource.obtain(result, bitmapPool);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    releaseOptions(bitmapFactoryOptions);</span><br><span class="line">    byteArrayPool.put(bytesForOptions);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>解码完后会调用到 DecodeJob 的 notifyComplete 方法，进一步调用到 EngineJob 的 onResourceReady 方法，在 onResourceReady 方法中通过 handle 转到主线程，然后调用到 EngineJob 的 handleResultOnMainThread 方法，接着调用 SingleRequest 的 onResourceReady 方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(Resource&lt;R&gt; resource, R result, DataSource dataSource)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// We must call isFirstReadyResource before setting status.</span></span><br><span class="line">   <span class="keyword">boolean</span> isFirstResource = isFirstReadyResource();</span><br><span class="line">   status = Status.COMPLETE;</span><br><span class="line">   <span class="keyword">this</span>.resource = resource;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (glideContext.getLogLevel() &lt;= Log.DEBUG) &#123;</span><br><span class="line">     Log.d(GLIDE_TAG, <span class="string">"Finished loading "</span> + result.getClass().getSimpleName() + <span class="string">" from "</span></span><br><span class="line">         + dataSource + <span class="string">" for "</span> + model + <span class="string">" with size ["</span> + width + <span class="string">"x"</span> + height + <span class="string">"] in "</span></span><br><span class="line">         + LogTime.getElapsedMillis(startTime) + <span class="string">" ms"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   isCallingCallbacks = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="keyword">boolean</span> anyListenerHandledUpdatingTarget = <span class="keyword">false</span>;</span><br><span class="line">     <span class="keyword">if</span> (requestListeners != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">for</span> (RequestListener&lt;R&gt; listener : requestListeners) &#123;</span><br><span class="line">         anyListenerHandledUpdatingTarget |=</span><br><span class="line">             listener.onResourceReady(result, model, target, dataSource, isFirstResource);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     anyListenerHandledUpdatingTarget |=</span><br><span class="line">         targetListener != <span class="keyword">null</span></span><br><span class="line">             &amp;&amp; targetListener.onResourceReady(result, model, target, dataSource, isFirstResource);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!anyListenerHandledUpdatingTarget) &#123;</span><br><span class="line">       Transition&lt;? <span class="keyword">super</span> R&gt; animation =</span><br><span class="line">           animationFactory.build(dataSource, isFirstResource);</span><br><span class="line">       target.onResourceRReady(result, animation);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">     isCallingCallbacks = <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   notifyLoadSuccess();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>可以看到此方法中终于将加载资源回调给 Target 了，调用栈大致如下：</p><p><img src="https://upload-images.jianshu.io/upload_images/4679478-08af148de8e8a2c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>以上不止是设置缩略图时的加载流程，没有缩略图时走的也是这个流程。我们知道图片缩略图不过是通过 BitmapFactory.Options  解码一张尺寸较小、质量较差的图罢了，而 Glide 除了支持配置图片缩略图，还支持配置本地视频缩略图。取视频缩略图的关键逻辑位于 VideoDecoder 的 decodeFrame 方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Bitmap <span class="title">decodeFrame</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     MediaMetadataRetriever mediaMetadataRetriever,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">long</span> frameTimeMicros,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> frameOption,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> outWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> outHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">     DownsampleStrategy strategy)</span> </span>&#123;</span><br><span class="line">   Bitmap result = <span class="keyword">null</span>;</span><br><span class="line">   <span class="comment">// Arguably we should handle the case where just width or just height is set to</span></span><br><span class="line">   <span class="comment">// Target.SIZE_ORIGINAL. Up to and including OMR1, MediaMetadataRetriever defaults to setting</span></span><br><span class="line">   <span class="comment">// the dimensions to the display width and height if they aren't specified (ie</span></span><br><span class="line">   <span class="comment">// getScaledFrameAtTime is not used). Given that this is an optimization only if</span></span><br><span class="line">   <span class="comment">// Target.SIZE_ORIGINAL is not used and not using getScaledFrameAtTime ever would match the</span></span><br><span class="line">   <span class="comment">// behavior of Glide in all versions of Android prior to OMR1, it's probably fine for now.</span></span><br><span class="line">   <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= VERSION_CODES.O_MR1</span><br><span class="line">       &amp;&amp; outWidth != Target.SIZE_ORIGINAL</span><br><span class="line">       &amp;&amp; outHeight != Target.SIZE_ORIGINAL</span><br><span class="line">       &amp;&amp; strategy != DownsampleStrategy.NONE) &#123;</span><br><span class="line">     result =</span><br><span class="line">         decodeScaledFrame(</span><br><span class="line">             mediaMetadataRetriever, frameTimeMicros, frameOption, outWidth, outHeight, strategy);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">     result = decodeOriginalFrame(mediaMetadataRetriever, frameTimeMicros, frameOption);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>可以看到在 Android 8.1 系统上支持直接获取缩放的视频缩略图，8.1 以下则直接获取帧原图，分别通过 MediaMetadataRetriever 的 getScaledFrameAtTime 、getFrameAtTime 获取。MediaMetadataRetriever 是 Android 提供的类，用来获取本地和网络 Media 文件信息，提供了用于从输入媒体文件检索帧和元数据的统一接口。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;缩略图的使用可参考&lt;a href=&quot;https://muyangmin.github.io/glide-docs-cn/doc/options.html#缩略图-thumbnail-请求&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;若使用简化方式设置缩略图：&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 请求优先级及原理</title>
    <link href="http://yoursite.com/aeb1195c/"/>
    <id>http://yoursite.com/aeb1195c/</id>
    <published>2019-02-17T08:24:53.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>若一个界面中需要展示多张图片，我们可能会期望某张图片优先加载，这就需要设置 Glide 的请求优先级， Glide 中提供四种优先级：</p><a id="more"></a><ul><li>Priority.LOW</li><li>Priority.NORMAL</li><li>Priority.HIGH</li><li>Priority.IMMEDIATE</li></ul><p>使用十分简单：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RequestOptions options = <span class="keyword">new</span> RequestOptions().priority(Priority.HIGH);</span><br><span class="line">Glide.with(context).load(imgUrl).apply(options).into(imageView);</span><br></pre></td></tr></table></figure></p><p>下面来分析一下我们配置的 Priority.HIGH 到底是如何生效的，跟踪发现优先级参数 priority 会被传入到 RequestBuilder 的 buildThumbnailRequestRecursive 方法，其中主要逻辑如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Request <span class="title">buildThumbnailRequestRecursive</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     Target&lt;TranscodeType&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">     RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">     @Nullable RequestCoordinator parentCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">     TransitionOptions&lt;?, ? <span class="keyword">super</span> TranscodeType&gt; transitionOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">     Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">     RequestOptions requestOptions)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (thumbnailBuilder != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">// 缩略图相关，先忽略</span></span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (thumbSizeMultiplier != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">// 缩略图相关，先忽略</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">// Base case: no thumbnail.</span></span><br><span class="line">     <span class="keyword">return</span> obtainRequest(</span><br><span class="line">         target,</span><br><span class="line">         targetListener,</span><br><span class="line">         requestOptions,</span><br><span class="line">         parentCoordinator,</span><br><span class="line">         transitionOptions,</span><br><span class="line">         priority,</span><br><span class="line">         overrideWidth,</span><br><span class="line">         overrideHeight);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>由于并未设置 thumbnail，先忽略缩略图相关逻辑，此方法中会调用到 obtainRequest 方法，继续跟踪，发现我们配置的 priority 参数在 SingleRequest 中的 onSizeReady 方法中被传入到 Engine 的 load 方法中:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;R&gt; <span class="function">LoadStatus <span class="title">load</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     GlideContext glideContext,</span></span></span><br><span class="line"><span class="function"><span class="params">     Object model,</span></span></span><br><span class="line"><span class="function"><span class="params">     Key signature,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">     Class&lt;?&gt; resourceClass,</span></span></span><br><span class="line"><span class="function"><span class="params">     Class&lt;R&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">     Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">     DiskCacheStrategy diskCacheStrategy,</span></span></span><br><span class="line"><span class="function"><span class="params">     Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> isTransformationRequired,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> isScaleOnlyOrNoTransform,</span></span></span><br><span class="line"><span class="function"><span class="params">     Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> isMemoryCacheable,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> useUnlimitedSourceExecutorPool,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> useAnimationPool,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">boolean</span> onlyRetrieveFromCache,</span></span></span><br><span class="line"><span class="function"><span class="params">     ResourceCallback cb)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// ...省略其他逻辑</span></span><br><span class="line"></span><br><span class="line">   DecodeJob&lt;R&gt; decodeJob =</span><br><span class="line">       decodeJobFactory.build(</span><br><span class="line">           glideContext,</span><br><span class="line">           model,</span><br><span class="line">           key,</span><br><span class="line">           signature,</span><br><span class="line">           width,</span><br><span class="line">           height,</span><br><span class="line">           resourceClass,</span><br><span class="line">           transcodeClass,</span><br><span class="line">           priority,</span><br><span class="line">           diskCacheStrategy,</span><br><span class="line">           transformations,</span><br><span class="line">           isTransformationRequired,</span><br><span class="line">           isScaleOnlyOrNoTransform,</span><br><span class="line">           onlyRetrieveFromCache,</span><br><span class="line">           options,</span><br><span class="line">           engineJob);</span><br><span class="line"></span><br><span class="line">   jobs.put(key, engineJob);</span><br><span class="line"></span><br><span class="line">   engineJob.addCallback(cb);</span><br><span class="line">   engineJob.start(decodeJob);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class="line">     logWithTimeAndKey(<span class="string">"Started new load"</span>, startTime, key);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> LoadStatus(cb, engineJob);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>这里在构建 DecodeJob 时将优先级配置传入，最终传入到 DecodeJob 和 DecodeHelper 中，其中 DecodeHelper 被 DecodeJob 持有。</p><p>接下来分析 priority 参数分别在什么时候被用到，首先看 DecodeJob 中持有的 priority，其仅在实现 Comparable 接口时用到，这个比较容易理解，可以通过对 DecodeJob 排序来实现优先级的调整。DecodeHelper 中持有的 priority 在 DataFetcher 的 loadData 方法中被传入：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loadData</span><span class="params">(@NonNull Priority priority, @NonNull DataCallback&lt;? <span class="keyword">super</span> T&gt; callback)</span></span>;</span><br></pre></td></tr></table></figure><p>DataFetch 用于加载数据，其实现有很多：</p><p><img src="https://upload-images.jianshu.io/upload_images/4679478-f7b5a4e8759e4930.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>但并不是所有方法都能应用优先级的，这取决与具体的业务组件，比如 OkHttp 不支持请求优先级设置，直接忽略了 priority 参数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(@NonNull Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    @NonNull <span class="keyword">final</span> DataCallback&lt;? <span class="keyword">super</span> InputStream&gt; callback)</span> </span>&#123;</span><br><span class="line">  Request.Builder requestBuilder = <span class="keyword">new</span> Request.Builder().url(url.toStringUrl());</span><br><span class="line">  <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; headerEntry : url.getHeaders().entrySet()) &#123;</span><br><span class="line">    String key = headerEntry.getKey();</span><br><span class="line">    requestBuilder.addHeader(key, headerEntry.getValue());</span><br><span class="line">  &#125;</span><br><span class="line">  Request request = requestBuilder.build();</span><br><span class="line">  <span class="keyword">this</span>.callback = callback;</span><br><span class="line"></span><br><span class="line">  call = client.newCall(request);</span><br><span class="line">  call.enqueue(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>而 Volley 就支持请求优先级：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(@NonNull Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    @NonNull DataCallback&lt;? <span class="keyword">super</span> InputStream&gt; callback)</span> </span>&#123;</span><br><span class="line">  request = requestFactory.create(url.toStringUrl(), callback, glideToVolleyPriority(priority),</span><br><span class="line">      url.getHeaders());</span><br><span class="line">  requestQueue.add(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>由此也可以得出设置请求优先级并不是必然生效的。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;若一个界面中需要展示多张图片，我们可能会期望某张图片优先加载，这就需要设置 Glide 的请求优先级， Glide 中提供四种优先级：&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 图片格式及内存优化</title>
    <link href="http://yoursite.com/da1371bf/"/>
    <id>http://yoursite.com/da1371bf/</id>
    <published>2019-02-17T08:24:22.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>记得刚接触 Glide 时，总会看到这个描述：</p><p><em>Glide 默认的 Bitmap 格式是 RGB_565，相比于 Picasso，加载的图片质量略差，但比 ARGB_8888 格式的内存开销要小一半。</em></p><p>而现在再讲这个特性就不对了，因为在 Glide v4 中，默认的 Bitmap 格式改为了 ARGB_8888。准确来说是默认的解码格式由 PREFER_RGB_565 改为了 PREFER_ARGB_8888，具体可参考 <a href="https://muyangmin.github.io/glide-docs-cn/doc/migrating.html#解码格式" target="_blank" rel="noopener">官方文档</a> 。</p><a id="more"></a><p>Glide 中可配置的解码格式只提供了 PREFER_RGB_565 和 PREFER_ARGB_8888 两个选项，而 Android Bitmap Config 中提供了 RGB_565、ARGB_8888、ARGB_4444 以及 HARDWARE 等 7 种格式，这让我们在使用层面上有一定程度的简化， Glide 内部自行适配了其他解码格式，比如若配置为 PREFER_ARGB_8888，在 Android 8.0 系统上就会尝试开启硬件位图编码格式，对应代码于 DecodeJob 中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Options <span class="title">getOptionsWithHardwareConfig</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">  Options options = <span class="keyword">this</span>.options;</span><br><span class="line">  <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) &#123;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">boolean</span> isHardwareConfigSafe =</span><br><span class="line">      dataSource == DataSource.RESOURCE_DISK_CACHE || decodeHelper.isScaleOnlyOrNoTransform();</span><br><span class="line">  Boolean isHardwareConfigAllowed = options.get(Downsampler.ALLOW_HARDWARE_CONFIG);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If allow hardware config is defined, we can use it if it's set to false or if it's safe to</span></span><br><span class="line">  <span class="comment">// use the hardware config for the request.</span></span><br><span class="line">  <span class="keyword">if</span> (isHardwareConfigAllowed != <span class="keyword">null</span> &amp;&amp; (!isHardwareConfigAllowed || isHardwareConfigSafe)) &#123;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If allow hardware config is undefined or is set to true but it's unsafe for us to use the</span></span><br><span class="line">  <span class="comment">// hardware config for this request, we need to override the config.</span></span><br><span class="line">  options = <span class="keyword">new</span> Options();</span><br><span class="line">  options.putAll(<span class="keyword">this</span>.options);</span><br><span class="line">  options.set(Downsampler.ALLOW_HARDWARE_CONFIG, isHardwareConfigSafe);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> options;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>官方文档关于 <a href="https://muyangmin.github.io/glide-docs-cn/doc/hardwarebitmaps.html" target="_blank" rel="noopener">硬件位图</a> 的介绍也比较清晰，就不过多描述了。另外 Android 端涉及到图片内存，必须了解的一个问题就是：<a href="https://zhuanlan.zhihu.com/p/20732309?refer=bennyhuo" target="_blank" rel="noopener">你的 Bitmap 究竟占多大内存？</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记得刚接触 Glide 时，总会看到这个描述：&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Glide 默认的 Bitmap 格式是 RGB_565，相比于 Picasso，加载的图片质量略差，但比 ARGB_8888 格式的内存开销要小一半。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;而现在再讲这个特性就不对了，因为在 Glide v4 中，默认的 Bitmap 格式改为了 ARGB_8888。准确来说是默认的解码格式由 PREFER_RGB_565 改为了 PREFER_ARGB_8888，具体可参考 &lt;a href=&quot;https://muyangmin.github.io/glide-docs-cn/doc/migrating.html#解码格式&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt; 。&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 加载图片到通知栏和应用小部件中</title>
    <link href="http://yoursite.com/693b387a/"/>
    <id>http://yoursite.com/693b387a/</id>
    <published>2019-02-17T08:23:48.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>上面说到的下载、预加载主要通过 RequestFutureTarget、PreloadTarget 实现，平时使用 Glide 直接加载图片到 ImageView 的方式则是通过 ImageViewTarget，Glide 中还提供了 NotificationTarget 和 AppWidgetTarget 来实现加载图片到通知栏和应用小部件中。使用方法十分简单，下面列出加载图片到通知栏的实现示例：</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加载图片到通知栏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadNotificationImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构建一个通知栏</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NOTIFICATION_ID = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">final</span> RemoteViews rv = <span class="keyword">new</span> RemoteViews(context.getPackageName(), R.layout.remoteview_notification);</span><br><span class="line">    rv.setImageViewResource(R.id.iv, R.mipmap.ic_launcher);</span><br><span class="line">    rv.setTextViewText(R.id.tv, <span class="string">"Short Message"</span>);</span><br><span class="line">    NotificationCompat.Builder mBuilder =</span><br><span class="line">            <span class="keyword">new</span> NotificationCompat.Builder(context, <span class="string">"channel_id"</span>)</span><br><span class="line">                    .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">                    .setContentTitle(<span class="string">"Content Title"</span>)</span><br><span class="line">                    .setContentText(<span class="string">"Content Text"</span>)</span><br><span class="line">                    .setContent(rv)</span><br><span class="line">                    .setPriority(NotificationCompat.PRIORITY_HIGH);</span><br><span class="line">    <span class="keyword">final</span> Notification notification = mBuilder.build();</span><br><span class="line">    notification.bigContentView = rv;</span><br><span class="line">    NotificationManager service = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">    service.notify(NOTIFICATION_ID, notification);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载图片到通知栏</span></span><br><span class="line">    NotificationTarget notificationTarget = <span class="keyword">new</span> NotificationTarget(</span><br><span class="line">            context,</span><br><span class="line">            R.id.iv,</span><br><span class="line">            rv,</span><br><span class="line">            notification,</span><br><span class="line">            NOTIFICATION_ID);</span><br><span class="line">    Glide.with(context).asBitmap().load(imgUrl).into(notificationTarget);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际的更新方法封装于 NotificationTarget 中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Updates the Notification after the Bitmap resource is loaded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  NotificationManager manager =</span><br><span class="line">      (NotificationManager) <span class="keyword">this</span>.context.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">  Preconditions.checkNotNull(manager)</span><br><span class="line">      .notify(<span class="keyword">this</span>.notificationTag, <span class="keyword">this</span>.notificationId, <span class="keyword">this</span>.notification);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过 AppWidgetTarget 加载图片到应用小部件中与此类似，这些均继承自  <a href="https://muyangmin.github.io/glide-docs-cn/doc/targets.html" target="_blank" rel="noopener">Target</a> 接口，了解原理后，我们可以自定义 Target 来随意的定制功能了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上面说到的下载、预加载主要通过 RequestFutureTarget、PreloadTarget 实现，平时使用 Glide 直接加载图片到 ImageView 的方式则是通过 ImageViewTarget，Glide 中还提供了 NotificationTarget 和 AppWidgetTarget 来实现加载图片到通知栏和应用小部件中。使用方法十分简单，下面列出加载图片到通知栏的实现示例：&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 下载及预加载</title>
    <link href="http://yoursite.com/a7bea0ed/"/>
    <id>http://yoursite.com/a7bea0ed/</id>
    <published>2019-02-17T08:21:41.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>下载的标准写法如下，也是官方示例写法：</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FutureTarget&lt;File&gt; target = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        target = Glide.with(context)</span><br><span class="line">                .downloadOnly()</span><br><span class="line">                .load(imgUrl)</span><br><span class="line">                .submit();</span><br><span class="line">        <span class="keyword">final</span> File cacheFile = target.get();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         *  默认会下载到磁盘缓存中,理论上不应对缓存文件进行编辑、删除</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"download: "</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 这里要调用cancel方法取消等待操作并释放资源</span></span><br><span class="line">        <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">            target.cancel(<span class="keyword">true</span>); <span class="comment">// 若传true则允许中断操作</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方式要自行开子线程，你可能会觉得稍显麻烦，直接调用 listener 方法监听 onResourceReady 回调岂不是更简单？其实不是的，由于要拿到 FutureTarget 调用其 cancel 方法，若监听 onResourceReady 代码逻辑会更复杂。</p><p>对于 FutureTarget.get() 方法，并不是调用时才会去加载数据，调用 submit 方法后就已经开始去加载数据了，get 方法最终会调用到 RequestFutureTarget 的 doGet 方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> R <span class="title">doGet</span><span class="params">(Long timeoutMillis)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ExecutionException, InterruptedException, TimeoutException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (assertBackgroundThread &amp;&amp; !isDone()) &#123;</span><br><span class="line">    Util.assertBackgroundThread();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CancellationException();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadFailed) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionException(exception);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resultReceived) &#123;</span><br><span class="line">    <span class="keyword">return</span> resource;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (timeoutMillis == <span class="keyword">null</span>) &#123;</span><br><span class="line">    waiter.waitForTimeout(<span class="keyword">this</span>, <span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (timeoutMillis &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">long</span> deadline = now + timeoutMillis;</span><br><span class="line">    <span class="keyword">while</span> (!isDone() &amp;&amp; now &lt; deadline) &#123;</span><br><span class="line">      waiter.waitForTimeout(<span class="keyword">this</span>, deadline - now);</span><br><span class="line">      now = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadFailed) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionException(exception);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CancellationException();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!resultReceived) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> resource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到 get 方法内部并没有加载数据的逻辑， RequestFutureTarget 内部通过锁实现了 get 方法的阻塞调用，当资源加载完毕后 onResourceReady 中会解除阻塞：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">onResourceReady</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    R resource, Object model, Target&lt;R&gt; target, DataSource dataSource, <span class="keyword">boolean</span> isFirstResource)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// We might get a null result.</span></span><br><span class="line">  resultReceived = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">this</span>.resource = resource;</span><br><span class="line">  waiter.notifyAll(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>除了下载 File 类型以外，还可以指定下载类型，比如下载 Bitmap：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadBitmap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RequestOptions DOWNLOAD_ONLY_OPTIONS = RequestOptions</span><br><span class="line">            .diskCacheStrategyOf(DiskCacheStrategy.DATA) <span class="comment">//这边其实可以根据业务场景配置，如果是网络图片一般需要缓存</span></span><br><span class="line">            .priority(Priority.LOW) <span class="comment">// 设置优先级</span></span><br><span class="line">            .skipMemoryCache(<span class="keyword">true</span>);</span><br><span class="line">    FutureTarget&lt;Bitmap&gt; target = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        target = Glide.with(context)</span><br><span class="line">                .asBitmap()</span><br><span class="line">                .apply(DOWNLOAD_ONLY_OPTIONS)</span><br><span class="line">                .load(imgUrl)</span><br><span class="line">                .submit();</span><br><span class="line">        <span class="keyword">final</span> Bitmap bitmap = target.get();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"download: "</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 这里要调用cancel方法取消等待操作并释放资源</span></span><br><span class="line">        <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">            target.cancel(<span class="keyword">true</span>); <span class="comment">// 若传true则允许中断操作</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这里的 DOWNLOAD_ONLY_OPTIONS 配置其实就是 downloadOnly 方法应用的配置。</p><p>实现预加载十分简单：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(context).load(imgUrl).preload();</span><br></pre></td></tr></table></figure></p><p>关键代码位于 PreloadTarget 中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PreloadTarget</span>&lt;<span class="title">Z</span>&gt; <span class="keyword">extends</span> <span class="title">SimpleTarget</span>&lt;<span class="title">Z</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MESSAGE_CLEAR = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Handler HANDLER = <span class="keyword">new</span> Handler(Looper.getMainLooper(), <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (message.what == MESSAGE_CLEAR) &#123;</span><br><span class="line">        ((PreloadTarget&lt;?&gt;) message.obj).clear();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RequestManager requestManager;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;Z&gt; <span class="function">PreloadTarget&lt;Z&gt; <span class="title">obtain</span><span class="params">(RequestManager requestManager, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PreloadTarget&lt;&gt;(requestManager, width, height);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">PreloadTarget</span><span class="params">(RequestManager requestManager, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(width, height);</span><br><span class="line">    <span class="keyword">this</span>.requestManager = requestManager;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(@NonNull Z resource, @Nullable Transition&lt;? <span class="keyword">super</span> Z&gt; transition)</span> </span>&#123;</span><br><span class="line">    HANDLER.obtainMessage(MESSAGE_CLEAR, <span class="keyword">this</span>).sendToTarget();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>)</span><br><span class="line">  <span class="meta">@Synthetic</span> <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    requestManager.clear(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>相比于 RequestFutureTarget，PreloadTarget 里的逻辑就简单多了，可以看到加载资源结束后只是把此次请求释放掉了，不用像其他 Target 一样做额外的操作。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;下载的标准写法如下，也是官方示例写法：&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Glide 源码分析 - 感知生命周期 </title>
    <link href="http://yoursite.com/c135648c/"/>
    <id>http://yoursite.com/c135648c/</id>
    <published>2019-02-17T08:20:28.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>发起一个图片加载请求后，我们期望当该请求所处的界面 onStop 时请求也随之停止，再次 onStart 时请求能够随之继续， onDestroy 时请求能够随之销毁。这就需要能够感知当前 Activity 的生命周期变化，由于 Fragment 在 onAttach 之后与 Activity 有相同的生命周期，glide 利用这一点，通过给 Activity 添加一个无界面的 Fragment 实现感知。</p><a id="more"></a><p><img src="https://upload-images.jianshu.io/upload_images/4679478-ac8b2896aba7322b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p><p>发起请求时通过 with 方法传入上下文，此方法会返回一个 RequestManager，RequestManager 用于管理和启动图片加载请求，可以感知外部 Activity 的生命周期，从而管理请求随之启动、停止和重启。</p><p>先来分析一个较为简单的流程：with 方法传入 Activity，会调用到 RequestManagerRetriever 的 get 方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RequestManager <span class="title">get</span><span class="params">(@NonNull Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class="line">      <span class="keyword">return</span> get(activity.getApplicationContext());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      assertNotDestroyed(activity);</span><br><span class="line">      android.app.FragmentManager fm = activity.getFragmentManager();</span><br><span class="line">      <span class="keyword">return</span> fragmentGet(</span><br><span class="line">          activity, fm, <span class="comment">/*parentHint=*/</span> <span class="keyword">null</span>, isActivityVisible(activity));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>其中调用 fragmentGet 方法去新建 RequestManager ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> RequestManager <span class="title">fragmentGet</span><span class="params">(@NonNull Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">      @NonNull android.app.FragmentManager fm,</span></span></span><br><span class="line"><span class="function"><span class="params">      @Nullable android.app.Fragment parentHint,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">boolean</span> isParentVisible)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这里新建了一个无界面的 Fragment，并添加到该界面</span></span><br><span class="line">    RequestManagerFragment current = getRequestManagerFragment(fm, parentHint, isParentVisible);</span><br><span class="line">    RequestManager requestManager = current.getRequestManager();</span><br><span class="line">    <span class="keyword">if</span> (requestManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">      Glide glide = Glide.get(context);</span><br><span class="line">      requestManager =</span><br><span class="line">    <span class="comment">//这里新建了一个 requestManager，并将无界面 Fragment 的生命周期暴露给 requestManager</span></span><br><span class="line">          factory.build(</span><br><span class="line">              glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);</span><br><span class="line">      current.setRequestManager(requestManager);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> requestManager;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>当无界面 Fragment 生命周期变化时，通过接口回调出去给 requestManager，这样 requestManager 就实现了随外部生命周期变化自动启动、停止和重启请求。with 方法若传入其他参数，流程上也是大同小异，都是找到当前 Activity 或 Fragment ，给其添加一个无界面 Fragment 罢了。</p><p>而不管传入何参数，都有这样一个逻辑：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class="line">     <span class="keyword">return</span> get(view.getContext().getApplicationContext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>若当前处于非主线程，则一律基于应用生命周期请求，不再关心所在 Fragment 或 Activity 的生命周期，这是因为子线程中执行的任务本身就是跟所在界面生命周期无关的。</p><p>在分析这一块时涉及 ContextWrapper 相关的逻辑，若不太熟悉，可参考：<a href="https://blog.csdn.net/guolin_blog/article/details/47028975" target="_blank" rel="noopener">ContextWrapper</a> 。</p><p>Glide 推出时谷歌还未发布 Architecture Components，而现在若要实现一个可感知生命周期的逻辑，大可不必像 Glide 一样添加一个 Fragment ，直接使用 Architecture Components 中的 Lifecycle 组件就可以很方便的实现了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;发起一个图片加载请求后，我们期望当该请求所处的界面 onStop 时请求也随之停止，再次 onStart 时请求能够随之继续， onDestroy 时请求能够随之销毁。这就需要能够感知当前 Activity 的生命周期变化，由于 Fragment 在 onAttach 之后与 Activity 有相同的生命周期，glide 利用这一点，通过给 Activity 添加一个无界面的 Fragment 实现感知。&lt;/p&gt;
    
    </summary>
    
      <category term="Glide 源码分析" scheme="http://yoursite.com/categories/Glide-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="glide" scheme="http://yoursite.com/tags/glide/"/>
    
  </entry>
  
  <entry>
    <title>Android 端音频变声方案</title>
    <link href="http://yoursite.com/785f874e/"/>
    <id>http://yoursite.com/785f874e/</id>
    <published>2018-11-01T15:23:58.000Z</published>
    <updated>2019-06-28T09:45:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>音频变声实质上是通过调整 PCM 数据的音调、节拍等属性，实现听感上的变化。如果是 mp3、aac 等压缩音频，则需提前解码成 PCM 数据，Android 端可以通过 MediaExtractor 及 MediaCodec 解码得到 PCM，但调整音调、节拍仅靠 Android api 就无能为力了，只能集成第三方库来实现，常见的音频处理库有 <a href="https://www.fmod.com" target="_blank" rel="noopener">Fmod</a> 、  <a href="http://www.surina.net/soundtouch/" target="_blank" rel="noopener">SoundTouch</a> 。</p><a id="more"></a><h3 id="Fmod"><a href="#Fmod" class="headerlink" title="Fmod"></a>Fmod</h3><p>Fmod 是一个跨平台的音频处理引擎，官网提供了各个平台的 <a href="https://www.fmod.com/resources/documentation-api" target="_blank" rel="noopener">接入文档</a>，可以实现变调、变速变声效果以及混响、颤音等高级效果。开发调用简单，sdk 对外提供了播放器接口，传入音频文件即可直接变声播放。但不支持保存处理后的音频到文件，商业用途需要购买许可证。</p><p>如果你不需要保存处理后的音频到文件，那就使用 Fmod 吧，你会发现音频变声是如此简单，而且还支持混响、颤音等高级变声效果！</p><p>如果需要保存处理后的音频到文件，那么……我就请你再认真的思考一下，你的需求真的必须要保存处理后的音频吗？假设一个聊天 app 要实现语音消息变声，那这段语音只会在你的应用中播放，那就都可以通过 Fmod 播放器变声播放啊，要知道 Fmod 可是一个跨平台的音频引擎，不论是 Android、IOS 还是 Web 端，只要知道变声参数就可以变声播放了，不需要保存处理后的音频到文件。</p><p>能否跃过不支持保存处理后的音频到文件这一缺点，关键是要确定用户能否直接接触到处理后的音频文件，若能接触到，就无法使用 Fmod 了。</p><p>关于集成使用 Fmod 库十分简单，网上也有很多，就不再展开了。</p><h3 id="SoundTouch"><a href="#SoundTouch" class="headerlink" title="SoundTouch"></a>SoundTouch</h3><p>SoundTouch 是一个开源免费的音频处理库，可以改变音调、节拍和播放速率。开发调用时需自行将音频文件解码成 PCM 数据，传入 SoundTouch 处理后，SoundTouch 会输出处理后的 PCM 数据。基于这种使用方式，我们可以对其自由定制以适用于自己的应用。</p><p>比如你要实现一个 mp3 的变声播放，可以先用 MediaCodec 将 mp3 解码成 PCM，通过 SoundTouch 处理得到变声后的 PCM，再结合 AudioTrack 实现播放；如果你要将一个 mp3 变声后保存下来，那就在得到变声后的 PCM 后，结合 MediaCodec 将其编码保存下来。</p><p>相比 Fmod，SoundTouch 的集成会复杂点，不是随便参考一篇教程就可以跑通的了，这里提供一份亲测可行的 <a href="https://github.com/yhaolpz/AndroidSoundTouch" target="_blank" rel="noopener">SoundTouch 源码</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;音频变声实质上是通过调整 PCM 数据的音调、节拍等属性，实现听感上的变化。如果是 mp3、aac 等压缩音频，则需提前解码成 PCM 数据，Android 端可以通过 MediaExtractor 及 MediaCodec 解码得到 PCM，但调整音调、节拍仅靠 Android api 就无能为力了，只能集成第三方库来实现，常见的音频处理库有 &lt;a href=&quot;https://www.fmod.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Fmod&lt;/a&gt; 、  &lt;a href=&quot;http://www.surina.net/soundtouch/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SoundTouch&lt;/a&gt; 。&lt;/p&gt;
    
    </summary>
    
      <category term="音视频" scheme="http://yoursite.com/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="FFmpeg" scheme="http://yoursite.com/tags/FFmpeg/"/>
    
      <category term="音视频" scheme="http://yoursite.com/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
</feed>
